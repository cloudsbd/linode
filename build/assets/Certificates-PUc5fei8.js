import{j as e,ad as k,T as S,bB as g,ag as P,af as V,aW as Y,b as _,e as H,u as W,r as v,C as G,a0 as D,a1 as L,f as q}from"./index-Eksrs3uK.js";import{A as Q}from"./ActionMenu-4CPisA_2.js";import{P as J}from"./PaginationFooter-NHWf7fW2.js";import{b as X,T as B,a as E,c as Z}from"./TableRow-phXfWUGW.js";import{T as ee}from"./TableRowEmpty-aXmC67-Z.js";import{T as te}from"./TableRowError-8gKmGX7P.js";import{T as A}from"./TableSortCell-hcsagFzN.js";import{u as ae}from"./useOrder-rsUMHEuj.js";import{u as re}from"./usePagination-Sxr0Tlb7.js";import{c as ie,d as oe,e as ne,u as se}from"./certificates-6TEM7uZ-.js";import{u as R}from"./formik.esm-Kap5lsIh.js";import{D as F}from"./Drawer-A9yKjC3Z.js";import{g as $}from"./formikErrorUtils-jhqfCjwU.js";import{s as K}from"./scrollErrorIntoView-6n4Cku1Y.js";import{T as le}from"./TableHead-Si_pzkLK.js";import"./OrderBy-H-bWJCPy.js";import"./splitAt-pbTnq2Oi.js";import"./loadbalancers-xfUXrZkQ.js";const ce={ca:{certificate:"",label:"",type:"ca"},downstream:{certificate:"",key:"",label:"",type:"downstream"}},T={Create:{ca:"For HTTPS, used by the load balancer to accept responses from your endpoints in your Service Target. This is the certificate installed on your endpoints.",downstream:"TLS certificates terminate incoming traffic to the load balancer. Once the load balancing policy is applied, traffic is forwarded to your service targets over TLS connections. "},Edit:{ca:"You can edit this cert here.",downstream:"TLS certificates terminate incoming traffic to the load balancer. Once the load balancing policy is applied, traffic is forwarded to your service targets over TLS connections."},Tooltips:{Certificate:"Paste the PEM-formatted contents of your SSL certificate. If you have linked multiple segments of a chained certificate, be sure to copy all of its contents into the text field, appearing one after another. The certificate must be signed using the RSA algorithm, which is the default in most cases.",Key:"Paste the PEM-formatted contents of your private key. Your private key must not have a passphrase."}},de={ca:"Upload Service Target Certificate",downstream:"Upload TLS Certificate"},M={ca:"Server Certificate",downstream:"TLS Certificate"},pe=`-----BEGIN CERTIFICATE-----
Paste .pem format
-----END CERTIFICATE-----
`,me=`-----BEGIN PRIVATE KEY-----
Paste .pem format
-----END PRIVATE KEY-----
`,ue=l=>{var y;const{loadbalancerId:t,onClose:m,open:n,type:c}=l,d=()=>{a.resetForm(),m(),h()},{error:r,mutateAsync:b,reset:h}=ie(t),a=R({enableReinitialize:!0,initialValues:ce[c],async onSubmit(u){try{await b(u),d()}catch(p){a.setErrors($(p)),K()}},validateOnBlur:!r,validateOnChange:!r}),f=(y=r==null?void 0:r.find(u=>!u.field))==null?void 0:y.reason;return e.jsx(F,{onClose:d,open:n,title:de[c]??"",wide:!0,children:e.jsxs("form",{onSubmit:a.handleSubmit,children:[f&&e.jsx(k,{text:f,variant:"error"}),e.jsx(S,{children:T.Create[c]}),e.jsx(g,{errorText:a.errors.label,expand:!0,label:"Label",name:"label",onChange:a.handleChange,value:a.values.label}),e.jsx(g,{errorText:a.errors.certificate,expand:!0,label:M[c],labelTooltipText:T.Tooltips.Certificate,multiline:!0,name:"certificate",onChange:a.handleChange,placeholder:pe,trimmed:!0,value:a.values.certificate}),c==="downstream"&&e.jsx(g,{errorText:a.errors.key,expand:!0,label:"Private Key",labelTooltipText:T.Tooltips.Key,multiline:!0,name:"key",onChange:a.handleChange,placeholder:me,trimmed:!0,value:a.values.key}),e.jsx(P,{primaryButtonProps:{"data-testid":"submit",label:"Upload Certificate",type:"submit"}})]})})},he=l=>{var a;const{certificate:t,loadbalancerId:m,onClose:n,open:c}=l,{error:d,isLoading:r,mutateAsync:b}=oe(m,(t==null?void 0:t.id)??-1),h=async()=>{await b(),n()};return e.jsx(V,{actions:e.jsx(P,{primaryButtonProps:{label:"Delete",loading:r,onClick:h},secondaryButtonProps:{label:"Cancel",onClick:n}}),error:(a=d==null?void 0:d[0])==null?void 0:a.reason,onClose:n,open:c,title:`Delete Certificate ${t==null?void 0:t.label}?`,children:"Are you sure you want to delete this certificate?"})},fe=l=>{var u,p;const{certificate:t,loadbalancerId:m,onClose:n,open:c}=l,d=Y(),{error:r,mutateAsync:b,reset:h}=ne(m,(t==null?void 0:t.id)??-1),a=R({enableReinitialize:!0,initialValues:{certificate:(u=t==null?void 0:t.certificate)==null?void 0:u.trim(),key:"",label:(t==null?void 0:t.label)??"",type:t==null?void 0:t.type},async onSubmit(i){var x;const C=((x=t==null?void 0:t.certificate)==null?void 0:x.trim())===i.certificate&&i.key==="";try{await b({certificate:i.certificate&&!C?i.certificate:void 0,key:i.key&&!C?i.key:void 0,label:i.label,type:i.type}),y()}catch(w){a.setErrors($(w)),K()}},validateOnBlur:!r,validateOnChange:!r}),f=(p=r==null?void 0:r.find(i=>!i.field))==null?void 0:p.reason,y=()=>{a.resetForm(),n(),h()};return e.jsxs(F,{onClose:y,open:c,title:`Edit ${(t==null?void 0:t.label)??"Certificate"}`,wide:!0,children:[f&&e.jsx(k,{variant:"error",children:f}),t?e.jsxs("form",{onSubmit:a.handleSubmit,children:[e.jsx(S,{sx:{marginBottom:d.spacing(2)},children:T.Edit[t.type]}),e.jsx(g,{errorText:a.errors.label,expand:!0,label:"Certificate Label",name:"label",onChange:a.handleChange,value:a.values.label}),e.jsx(g,{errorText:a.errors.certificate,expand:!0,label:M[t.type],labelTooltipText:T.Tooltips.Certificate,multiline:!0,name:"certificate",onChange:a.handleChange,trimmed:!0,value:a.values.certificate}),(t==null?void 0:t.type)==="downstream"&&e.jsx(g,{errorText:a.errors.key,expand:!0,label:"Private Key",labelTooltipText:T.Tooltips.Key,multiline:!0,name:"key",onChange:a.handleChange,placeholder:"Private key is redacted for security.",trimmed:!0,value:a.values.key}),e.jsx(P,{primaryButtonProps:{"data-testid":"submit",label:"Update Certificate",type:"submit"}})]}):e.jsx(k,{variant:"error",children:"Error loading certificate."})]})},O="loadbalancer-certificates",Oe=()=>{const{loadbalancerId:l,type:t}=_(),m=t??"downstream",n=Number(l),c=H(),d=W(),r=c.pathname.endsWith("/create"),[b,h]=v.useState(!1),[a,f]=v.useState(!1),[y,u]=v.useState(),p=re(1,O),{handleOrderChange:i,order:C,orderBy:x}=ae({order:"desc",orderBy:"label"},`${O}-order`),w={"+order":C,"+order_by":x,type:m},{data:s,error:j,isLoading:z}=se(n,{page:p.page,page_size:p.pageSize},w),N=o=>{h(!0),u(o.id)},U=o=>{f(!0),u(o.id)};if(z)return e.jsx(G,{});const I=s==null?void 0:s.data.find(o=>o.id===y);return e.jsxs(D,{paddingTop:1,spacing:2,children:[e.jsxs(D,{alignItems:"center",direction:"row",flexWrap:{md:"unset",sm:"wrap",xs:"wrap"},gap:2,justifyContent:"space-between",children:[m==="ca"?e.jsxs(S,{children:["Used by the load balancer to accept responses from your endpoints in your Service Target. This is the certificate installed on your Endpoints. Apply these certificate(s) in the"," ",e.jsx(L,{to:`/loadbalancers/${l}/service-targets`,children:"Service Targets"})," ","Tab."]}):e.jsxs(S,{children:["Certificate used by your load balancer to terminate the connection and decrypt request from client. Apply these certificate(s) in the Details section of your HTTPS"," ",e.jsx(L,{to:`/loadbalancers/${l}/configurations`,children:"Configuration"}),"."]}),e.jsx(q,{onClick:()=>d.push(`/loadbalancers/${l}/certificates/${m}/create`),buttonType:"primary",sx:{minWidth:200},children:"Upload Certificate"})]}),e.jsxs(X,{children:[e.jsx(le,{children:e.jsxs(B,{children:[e.jsx(A,{active:x==="label",direction:C,handleClick:i,label:"label",children:"Label"}),e.jsx(A,{active:x==="id",direction:C,handleClick:i,label:"id",children:"ID"}),e.jsx(E,{})]})}),e.jsxs(Z,{children:[j&&e.jsx(te,{colSpan:3,message:j==null?void 0:j[0].reason}),(s==null?void 0:s.results)===0&&e.jsx(ee,{colSpan:3}),s==null?void 0:s.data.map(o=>e.jsxs(B,{children:[e.jsx(E,{children:o.label}),e.jsx(E,{children:o.id}),e.jsx(E,{actionCell:!0,children:e.jsx(Q,{actionsList:[{onClick:()=>N(o),title:"Edit"},{onClick:()=>U(o),title:"Delete"}],ariaLabel:`Action Menu for certificate ${o.label}`})})]},`${o.label}-${o.type}`))]})]}),e.jsx(J,{count:(s==null?void 0:s.results)??0,handlePageChange:p.handlePageChange,handleSizeChange:p.handlePageSizeChange,page:p.page,pageSize:p.pageSize}),e.jsx(ue,{onClose:()=>d.push(`/loadbalancers/${l}/certificates/${t}`),loadbalancerId:n,open:r,type:m}),e.jsx(fe,{certificate:I,loadbalancerId:n,onClose:()=>h(!1),open:b}),e.jsx(he,{certificate:I,loadbalancerId:n,onClose:()=>f(!1),open:a})]})};export{Oe as Certificates};
