var L=Object.defineProperty;var P=(r,s,t)=>s in r?L(r,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[s]=t;var u=(r,s,t)=>(P(r,typeof s!="symbol"?s+"":s,t),t);import{w as B,r as h,j as e,ad as b,bB as C,d0 as R,ag as F,l1 as I,an as O,u as _,aW as z,bD as q,ao as U,a0 as D,eT as $,T as x,B as S,cp as M,W as j,aq as G,eR as H,Q as N}from"./index-Eksrs3uK.js";import{A as Q}from"./AddNewLink-LwviGK8c.js";import{P as W}from"./PaginationFooter-NHWf7fW2.js";import{T as y,a as m,b as Y,c as J}from"./TableRow-phXfWUGW.js";import{T as K}from"./TableRowEmpty-aXmC67-Z.js";import{T as V}from"./TableRowError-8gKmGX7P.js";import{T as X}from"./TableRowLoading-iP7zIRHG.js";import{T}from"./TableSortCell-hcsagFzN.js";import{u as Z}from"./useOrder-rsUMHEuj.js";import{u as ee}from"./usePagination-Sxr0Tlb7.js";import{D as se}from"./Drawer-A9yKjC3Z.js";import{T as te}from"./Toggle-AbahDP9J.js";import{g as re}from"./getAPIErrorFor-OfQrArkQ.js";import{U as ae}from"./UserDeleteConfirmationDialog-ljHlCZd0.js";import{D as w}from"./DateTimeDisplay-bXC9mIcz.js";import{S as ne}from"./StatusIcon-RuV8PvAV.js";import{A as ie}from"./ActionMenu-4CPisA_2.js";import{I as oe}from"./InlineMenuAction-d5mRENST.js";import{T as le}from"./TableHead-Si_pzkLK.js";import"./Skeleton-iwmO4Yae.js";import"./OrderBy-H-bWJCPy.js";import"./splitAt-pbTnq2Oi.js";class ce extends h.Component{constructor(){super(...arguments);u(this,"handleChangeEmail",t=>{this.setState({email:t.target.value})});u(this,"handleChangeRestricted",()=>{this.setState({restricted:!this.state.restricted})});u(this,"handleChangeUsername",t=>{this.setState({username:t.target.value})});u(this,"onSubmit",()=>{const{history:{push:t},onClose:n,refetch:c}=this.props,{email:l,restricted:i,username:o}=this.state;this.setState({errors:[],submitting:!0}),I({email:l,restricted:i,username:o}).then(a=>{this.setState({submitting:!1}),n(),a.restricted&&t(`/account/users/${o}/permissions`,{newUsername:a.username}),c()}).catch(a=>{const d=O(a,"Error creating user.");this.setState({errors:d,submitting:!1})})});u(this,"state",{email:"",errors:[],restricted:!1,submitting:!1,username:""})}componentDidUpdate(t){this.props.open===!0&&t.open===!1&&this.setState({email:"",errors:[],restricted:!1,submitting:!1,username:""})}render(){const{onClose:t,open:n}=this.props,{email:c,errors:l,restricted:i,submitting:o,username:a}=this.state,d=re({email:"Email",username:"Username"},l),g=d("none");return e.jsxs(se,{onClose:t,open:n,title:"Add a User",children:[g&&e.jsx(b,{text:g,variant:"error"}),e.jsx(C,{"data-qa-create-username":!0,errorText:d("username"),label:"Username",onBlur:this.handleChangeUsername,onChange:this.handleChangeUsername,required:!0,trimmed:!0,value:a}),e.jsx(C,{"data-qa-create-email":!0,errorText:d("email"),label:"Email",onChange:this.handleChangeEmail,required:!0,trimmed:!0,type:"email",value:c}),e.jsx(R,{control:e.jsx(te,{checked:!i,"data-qa-create-restricted":!0,onChange:this.handleChangeRestricted}),label:i?`This user will have limited access to account features.
              This can be changed later.`:`This user will have full access to account features.
              This can be changed later.`,style:{marginTop:8}}),e.jsx("div",{style:{marginTop:8},children:e.jsx(b,{text:"The user will be sent an email to set their password",variant:"warning"})}),e.jsx(F,{primaryButtonProps:{"data-testid":"submit",label:"Add User",loading:o,onClick:this.onSubmit},secondaryButtonProps:{"data-testid":"cancel",label:"Cancel",onClick:t}})]})}}const de=B(ce),me=({onDelete:r,username:s})=>{const t=_(),n=z(),c=q(n.breakpoints.down("md")),{data:l}=U(),i=l==null?void 0:l.username,o=[{onClick:()=>{t.push(`/account/users/${s}`)},title:"User Profile"},{onClick:()=>{t.push(`/account/users/${s}/permissions`)},title:"User Permissions"},{disabled:s===i,onClick:()=>{r(s)},title:"Delete",tooltip:s===i?"You can't delete the currently active user.":void 0}];return e.jsx(e.Fragment,{children:c?e.jsx(ie,{actionsList:o,ariaLabel:`Action menu for user ${i}`}):o.map(a=>e.jsx(oe,{actionText:a.title,disabled:a.disabled,onClick:a.onClick},a.title))})},ue=({onDelete:r,user:s})=>e.jsxs(y,{ariaLabel:`User ${s.username}`,children:[e.jsx(m,{children:e.jsxs(D,{alignItems:"center",direction:"row",spacing:1.5,children:[e.jsx($,{email:s.email}),e.jsx(x,{children:s.username}),e.jsx(S,{display:"flex",flexGrow:1}),s.tfa_enabled&&e.jsx(M,{color:"success",label:"2FA"})]})}),e.jsx(j,{smDown:!0,children:e.jsx(m,{children:s.email})}),e.jsx(m,{children:s.restricted?"Limited":"Full"}),e.jsx(j,{lgDown:!0,children:e.jsx(m,{children:e.jsx(he,{last_login:s.last_login})})}),e.jsx(m,{actionCell:!0,children:e.jsx(me,{onDelete:r,username:s.username})})]},s.username),he=r=>{const{last_login:s}=r;return s===null?e.jsx(x,{children:"Never"}):s.status==="successful"?e.jsx(w,{value:s.login_datetime}):e.jsxs(D,{alignItems:"center",direction:"row",spacing:1,children:[e.jsx(w,{value:s.login_datetime}),e.jsx(x,{children:"â€”"}),e.jsx(ne,{status:"error"}),e.jsx(x,{children:G(s.status)})]})},Oe=()=>{const{data:r}=U(),s=ee(1,"account-users"),t=Z(),{data:n,error:c,isLoading:l,refetch:i}=H({page:s.page,page_size:s.pageSize},{"+order":t.order,"+order_by":t.orderBy}),o=r==null?void 0:r.restricted,[a,d]=h.useState(!1),[g,f]=h.useState(!1),[v,A]=h.useState(""),E=p=>{f(!0),A(p)},k=()=>l?e.jsx(X,{columns:5,responsive:{1:{smDown:!0},3:{lgDown:!0}},rows:1}):c?e.jsx(V,{colSpan:5,message:c[0].reason}):!n||n.results===0?e.jsx(K,{colSpan:5}):n.data.map(p=>e.jsx(ue,{onDelete:E,user:p},p.username));return e.jsxs(h.Fragment,{children:[e.jsx(N,{segment:"Users & Grants"}),e.jsx(S,{display:"flex",justifyContent:"flex-end",sx:{marginBottom:1},children:e.jsx(Q,{disabledReason:o?"You cannot create other users as a restricted user.":void 0,disabled:o,label:"Add a User",onClick:()=>d(!0)})}),e.jsxs(Y,{"aria-label":"List of Users",children:[e.jsx(le,{children:e.jsxs(y,{children:[e.jsx(T,{active:t.orderBy==="username",direction:t.order,handleClick:t.handleOrderChange,label:"username",children:"Username"}),e.jsx(j,{smDown:!0,children:e.jsx(T,{active:t.orderBy==="email",direction:t.order,handleClick:t.handleOrderChange,label:"email",children:"Email Address"})}),e.jsx(m,{children:"Account Access"}),e.jsx(j,{lgDown:!0,children:e.jsx(m,{children:"Last Login"})}),e.jsx(m,{})]})}),e.jsx(J,{children:k()})]}),e.jsx(W,{count:(n==null?void 0:n.results)||0,eventCategory:"users landing",handlePageChange:s.handlePageChange,handleSizeChange:s.handlePageSizeChange,page:s.page,pageSize:s.pageSize}),e.jsx(de,{onClose:()=>d(!1),open:a,refetch:i}),e.jsx(ae,{onClose:()=>f(!1),open:g,username:v})]})};export{Oe as UsersLanding};
