import{r as m,s as h,G as j,aa as E,C as G,T as A,bM as M,j as e,E as $,B as K,a1 as O,f as U,c as W,bI as z,ad as Q,d0 as Y,bB as D,ag as _,aW as N,bD as Z,cx as J,an as V,W as R,Q as X}from"./index-Eksrs3uK.js";import{c as ee}from"./index-Y5esPPk-.js";import{m as se,n as F,o as re}from"./ManagedLanding-ANON5BFb.js";import{p as te}from"./immer.esm--MpJ8fpr.js";import{O as ae}from"./OrderBy-H-bWJCPy.js";import{P as ne}from"./Paginate-XLm_-WxT.js";import{P as oe}from"./PaginationFooter-NHWf7fW2.js";import{T as q,a as y,b as ie,c as le}from"./TableRow-phXfWUGW.js";import{T}from"./TableSortCell-hcsagFzN.js";import{u as ce}from"./useOpenClose-GWPIoKTB.js";import{F as de}from"./formik.esm-Kap5lsIh.js";import{D as pe}from"./Drawer-A9yKjC3Z.js";import{T as ue}from"./Toggle-AbahDP9J.js";import{h as he,a as me}from"./formikErrorUtils-jhqfCjwU.js";import{p as ge,r as I}from"./ipUtils-P4y3JNCT.js";import{T as xe}from"./TableRowEmpty-aXmC67-Z.js";import{T as Se}from"./TableRowError-8gKmGX7P.js";import{T as be}from"./TableRowLoading-iP7zIRHG.js";import{A as fe}from"./ActionMenu-4CPisA_2.js";import{I as ye}from"./InlineMenuAction-d5mRENST.js";import{T as je}from"./TableHead-Si_pzkLK.js";import"./LandingHeader-JXAVBhqg.js";import"./NavTabs-EcGU7lQb.js";import"./SafeTabPanel-S0Pp8CVT.js";import"./TabList-4PWL4GSj.js";import"./TabLinkList-BrXtJznm.js";import"./ProductInformationBanner-NRgFHJLr.js";import"./LineGraph-UgU3EQj3.js";import"./utilities-JekaXHyt.js";import"./visuallyHidden-DVicuktI.js";import"./TabbedPanel-IicwaI6L.js";import"./monitor-ok-uFJibhtB.js";import"./SupportTicketDialog-vNptwFQg.js";import"./scrollErrorIntoView-6n4Cku1Y.js";import"./TabbedReply-8laJdW9a.js";import"./remove-KHZAQMPH.js";import"./splitAt-pbTnq2Oi.js";import"./ipaddr-jlottelM.js";import"./Skeleton-iwmO4Yae.js";const Ce=s=>m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...s},m.createElement("g",{fill:"none",fillRule:"evenodd",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5},m.createElement("path",{d:"M12.7499997,9.807 C12.749,6.493 10.062,3.808 6.748,3.80899972 C3.435,3.80899972 0.749,6.496 0.749999721,9.81 C0.751,12.545 2.601,14.934 5.24999972,15.618 L5.24999972,21.754 C5.24999972,22.582 5.922,23.254 6.74999972,23.254 C7.578,23.254 8.24999972,22.582 8.24999972,21.754 L8.24999972,15.618 C10.9,14.934 12.751,12.544 12.7499997,9.807 Z"}),m.createElement("path",{d:"M13.563 15.75C14.347 15.642 15.101 15.379 15.782 14.977L20.689 19.883C21.285 20.459 22.234 20.442 22.81 19.846 23.371 19.265 23.371 18.343 22.81 17.762L17.9 12.856C19.585 10.002 18.637 6.324 15.784 4.639 13.923 3.54 11.615 3.527 9.741 4.605M6.75 7.557C7.578 7.557 8.25 8.229 8.25 9.057 8.25 9.885 7.578 10.557 6.75 10.557 5.922 10.557 5.25 9.885 5.25 9.057 5.25 8.229 5.922 7.557 6.75 7.557z"}),m.createElement("path",{d:"M6.75,7.557 L6.75,3 C6.75,1.757 7.757,0.75 9,0.75 C10.243,0.75 11.25,1.757 11.25,3 L11.25,3.989"}))),Te=h(j,{label:"StyledCopyToClipboardGrid"})(({theme:s})=>({"& > button":{marginTop:s.spacing(1),minWidth:190},alignItems:"flex-start",display:"flex",justifyContent:"flex-start",[s.breakpoints.up("sm")]:{justifyContent:"flex-end"}})),ve=h(E,{label:"StyledErrorStatePaper"})(({theme:s})=>({"& > div":{padding:0},padding:`calc(${s.spacing(2)} - 1px)`})),Le=h(Ce,{label:"StyledSSHKeyIcon"})(({theme:s})=>({marginBottom:`calc(${s.spacing(1)} - 2px)`,marginRight:s.spacing(1),stroke:s.color.offBlack})),ke=h(E,{label:"StyledLoadingStatePaper"})(({theme:s})=>({alignItems:"center",display:"flex",justifyContent:"center",minHeight:"112px",padding:s.spacing(2.5)})),Ae=h(E,{label:"StyledRootPaper"})(({theme:s})=>({minHeight:"112px",padding:s.spacing(2.5)})),we=h(G,{label:"StyledCircleProgress"})(({theme:s})=>({padding:s.spacing(5)})),Ee=h(A,{label:"StyledTypography"})(({theme:s})=>({"&:hover":{WebkitLineClamp:"unset",transition:"all 1s ease-in"},WebkitBoxOrient:"vertical",WebkitLineClamp:3,color:s.color.grey1,display:"-webkit-box",fontFamily:'"Ubuntu Mono", monospace, sans-serif',fontSize:"0.9rem",overflow:"hidden",[s.breakpoints.up("lg")]:{paddingRight:s.spacing(6)},[s.breakpoints.up("md")]:{padding:`0 ${s.spacing(4)} 0 ${s.spacing(1)}`},[s.breakpoints.up("xl")]:{paddingLeft:s.spacing(4),paddingRight:s.spacing(4)},transition:"all 1s ease-in",wordBreak:"break-all"})),Pe=h(j,{label:"StyledSSHKeyContainerGrid"})({alignItems:"center",display:"flex",flex:1}),He="https://www.linode.com/docs/platform/linode-managed/#adding-the-public-key",De=()=>{const{data:s,error:t,isLoading:d}=se(),[r,u]=m.useState(!1),i=m.useRef();m.useEffect(()=>(r&&(i.current=setTimeout(()=>{u(!1)},1e3)),()=>{i.current&&clearTimeout(i.current)}),[r]);const p=()=>{s&&(u(!0),ee(s.ssh_key))};if(t){const o=M(t);return e.jsx(ve,{children:e.jsx($,{errorText:o})})}return d?e.jsx(ke,{children:e.jsx(we,{mini:!0})}):e.jsx(Ae,{children:e.jsxs(j,{container:!0,justifyContent:"space-between",spacing:2,children:[e.jsxs(j,{lg:4,md:3,xs:12,children:[e.jsxs(K,{display:"flex",flexDirection:"row",children:[e.jsx(Le,{}),e.jsx(A,{variant:"h3",children:"Linode Public Key"})]}),e.jsxs(A,{children:["You must ",e.jsx(O,{to:He,children:"install our public SSH key"})," on all managed Linodes so we can access them and diagnose issues."]})]}),e.jsx(Pe,{md:6,sm:5,xs:12,children:e.jsx(Ee,{variant:"subtitle1",children:(s==null?void 0:s.ssh_key)||""})}),e.jsx(Te,{lg:2,md:3,sm:4,xs:12,children:e.jsx(U,{buttonType:"secondary",onClick:p,children:r?"Copied!":"Copy to clipboard"})})]})})},Ie=s=>{const{customizeOptions:t,handleChange:d,linodeId:r,value:u}=s,{data:i,error:p,isLoading:o}=W(r),l=[];i&&(l.push(...i.ipv4),i.ipv6&&l.push(i.ipv6));let n=l.map(c=>({label:c,value:c}));t&&(n=t(n));let a="";return s.errorText?a=s.errorText:p&&(a="There was an error retrieving this Linode’s IP addresses."),e.jsx(z,{errorText:a,isClearable:!1,isLoading:o,label:"IP Address",onChange:c=>d(c.value),options:n,placeholder:"Select an IP Address...",value:n.find(c=>c.value===u.value)})},Me=h(A,{label:"StyledTypography"})(({theme:s})=>({marginBottom:s.spacing(1.25)})),Re=h(j,{label:"StyledIPGrid"})(({theme:s})=>({[s.breakpoints.down("md")]:{paddingBottom:"0px"}})),Fe=h(j,{label:"StyledPortGrid"})(({theme:s})=>({[s.breakpoints.down("md")]:{paddingTop:"0px"}})),S={port:22,user:"root"},qe=s=>{const{closeDrawer:t,isOpen:d,linodeSetting:r}=s,{mutateAsync:u}=F((r==null?void 0:r.id)||-1),i=r?`Edit SSH Access for ${r.label}`:"Edit SSH Access",p=(o,{setErrors:l,setStatus:n,setSubmitting:a})=>{if(!r)return;n(void 0);const c=o.ssh.user!==""?o.ssh.user:S.user,g=String(o.ssh.port)!==""?o.ssh.port:S.port;u({ssh:{...o.ssh,port:g,user:c}}).then(()=>{a(!1),t()}).catch(x=>{a(!1);const C="Unable to update SSH Access for this Linode. Please try again later.",b=f=>n({generalError:f});he(l,x),me(b,x,C)})};return e.jsx(pe,{onClose:t,open:d,title:i,children:r?e.jsx(e.Fragment,{children:e.jsx(de,{initialValues:{ssh:{access:r.ssh.access,ip:r.ssh.ip,port:r.ssh.port,user:r.ssh.user}},onSubmit:p,children:({errors:o,handleBlur:l,handleChange:n,handleSubmit:a,isSubmitting:c,setFieldValue:g,status:x,values:C})=>{const{access:b,ip:f,port:v,user:L}=C.ssh,P=o["ssh.user"],B=o["ssh.ip"]||o.ip,H=o["ssh.port"];return e.jsxs(e.Fragment,{children:[x&&e.jsx(Q,{text:x.generalError,variant:"error"},x),e.jsxs("form",{children:[e.jsxs(Me,{variant:"body1",children:["We’ll use the default settings for User Account (",S.user,") and Port (",S.port,") if you leave those fields empty."]}),e.jsx(Y,{control:e.jsx(ue,{checked:b,name:"ssh.access",onChange:()=>g("ssh.access",!b)}),label:b?"Access enabled":"Access disabled"}),e.jsx(D,{error:!!P,errorText:P,label:"User Account",name:"ssh.user",onBlur:l,onChange:n,placeholder:L||S.user,value:L}),e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(Re,{md:8,xs:12,children:e.jsx(Ie,{customizeOptions:w=>[{label:"Any",value:"any"},...w.filter(k=>!ge.test(k.value)).map(k=>({label:I(k.value),value:I(k.value)}))],handleChange:w=>g("ssh.ip",w),value:{label:f==="any"?"Any":f,value:f},errorText:B,linodeId:r.id})}),e.jsx(Fe,{md:4,xs:12,children:e.jsx(D,{error:!!H,errorText:H,label:"Port",name:"ssh.port",onBlur:l,onChange:n,placeholder:String(v||S.port),type:"number",value:v})})]}),e.jsx(_,{primaryButtonProps:{label:"Save Changes",loading:c,onClick:()=>a()}})]})]})}})}):null})},Be=h("div",{label:"StyledDiv"})(({theme:s})=>({"&:before":{display:"none"},marginTop:s.spacing(4)})),Ge=s=>{const{isEnabled:t,linodeId:d,openDrawer:r}=s,u=N(),i=Z(u.breakpoints.down("md")),{enqueueSnackbar:p}=J(),{mutateAsync:o}=F(d),l=(a,c)=>{const g=V(c,a);p(g[0].reason,{variant:"error"})},n=[{onClick:()=>{r(d)},title:"Edit"},t?{onClick:()=>{o({ssh:{access:!1}}).then(()=>{p("SSH Access disabled successfully.",{variant:"success"})}).catch(a=>{l("Error disabling SSH Access for this Linode.",a)})},title:"Disable"}:{onClick:()=>{o({ssh:{access:!0}}).then(()=>{p("SSH Access enabled successfully.",{variant:"success"})}).catch(a=>{l("Error enabling SSH Access for this Linode.",a)})},title:"Enable"}];return e.jsx(e.Fragment,{children:i?e.jsx(fe,{actionsList:n,ariaLabel:`Action menu for SSH Access key for Linode ${s.linodeLabel}`}):n.map(a=>e.jsx(ye,{actionText:a.title,onClick:a.onClick},a.title))})},$e=s=>{const{linodeSetting:t,openDrawer:d}=s,r=t.ssh.access;return e.jsxs(q,{ariaLabel:t.label,"data-qa-monitor-cell":t.id,"data-testid":"linode-row",children:[e.jsx(y,{"data-qa-managed-linode":!0,children:t.label}),e.jsx(y,{"data-qa-managed-ssh-access":!0,children:r?"Enabled":"Disabled"}),e.jsxs(R,{smDown:!0,children:[e.jsx(y,{"data-qa-managed-user":!0,children:t.ssh.user}),e.jsx(y,{"data-qa-managed-ip":!0,children:t.ssh.ip==="any"?"Any":t.ssh.ip}),e.jsx(y,{"data-qa-managed-port":!0,children:t.ssh.port})]}),e.jsx(y,{actionCell:!0,children:e.jsx(Ge,{isEnabled:r,linodeId:t.id,linodeLabel:t.label,openDrawer:d})})]},t.id)},Ke=s=>{const{error:t,linodeSettings:d,loading:r,openDrawer:u}=s;if(r)return e.jsx(be,{columns:6});if(t){const i=M(t);return e.jsx(Se,{colSpan:6,message:i})}return d.length===0?e.jsx(xe,{colSpan:5,message:"You don't have any Linodes on your account."}):e.jsx(e.Fragment,{children:d.map((i,p)=>e.jsx($e,{linodeSetting:i,openDrawer:u},`linode-setting-row-${p}`))})},Oe=()=>{const{data:s,error:t,isLoading:d}=re(),r=s||[],[u,i]=m.useState(null),p=ce(),o=te(r,l=>{r.forEach((n,a)=>{n.ssh.user===null&&(l[a].ssh.user=S.user),n.ssh.port===null&&(l[a].ssh.port=S.port)})});return e.jsxs(e.Fragment,{children:[e.jsx(ae,{data:o,order:"asc",orderBy:"label",children:({data:l,handleOrderChange:n,order:a,orderBy:c})=>e.jsx(ne,{data:l,children:({count:g,data:x,handlePageChange:C,handlePageSizeChange:b,page:f,pageSize:v})=>e.jsxs(e.Fragment,{children:[e.jsx(Be,{children:e.jsxs(ie,{"aria-label":"List of Your Managed SSH Access Settings",children:[e.jsx(je,{children:e.jsxs(q,{children:[e.jsx(T,{active:c==="label","data-qa-ssh-linode-header":!0,direction:a,handleClick:n,label:"label",children:"Linode"}),e.jsx(T,{active:c==="ssh:access","data-qa-ssh-access-header":!0,direction:a,handleClick:n,label:"ssh:access",children:"SSH Access"}),e.jsxs(R,{smDown:!0,children:[e.jsx(T,{active:c==="ssh:user","data-qa-ssh-user-header":!0,direction:a,handleClick:n,label:"ssh:user",children:"User"}),e.jsx(T,{active:c==="ssh:ip","data-qa-ssh-ip-header":!0,direction:a,handleClick:n,label:"ssh:ip",children:"IP"}),e.jsx(T,{active:c==="ssh:port","data-qa-ssh-port-header":!0,direction:a,handleClick:n,label:"ssh:port",children:"Port"})]}),e.jsx(y,{})]})}),e.jsx(le,{children:e.jsx(Ke,{openDrawer:L=>{i(L),p.open()},error:t,linodeSettings:x,loading:d})})]})}),e.jsx(oe,{count:g,eventCategory:"managed ssh access table",handlePageChange:C,handleSizeChange:b,page:f,pageSize:v})]})})}),e.jsx(qe,{closeDrawer:p.close,isOpen:p.isOpen,linodeSetting:o.find(l=>l.id===u)})]})},Ue=()=>e.jsxs(e.Fragment,{children:[e.jsx(X,{segment:"SSH Access"}),e.jsx(De,{}),e.jsx(Oe,{})]}),Es=Ue;export{Es as default};
