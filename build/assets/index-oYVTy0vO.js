import{cx as O,ms as V,r as f,u as U,j as e,ad as D,T as h,an as G,m as z,f as $,mt as H,af as J,ag as X,km as Y,J as N,bI as M,c3 as K,V as Q,d0 as Z,ao as ee,aa as ae,$ as P}from"./index-Eksrs3uK.js";import{A as te}from"./AccessControls-OuapwWFu.js";import{T as se}from"./TypeToConfirmDialog-9yjZCCL0.js";import{u as oe}from"./formik.esm-Kap5lsIh.js";import{R as ne}from"./Radio-HudVgwMW.js";import{F as C}from"./FormControl-CNHz4Ctl.js";import{R as le}from"./RadioGroup-zpRjMzXK.js";import"./AddNewLink-LwviGK8c.js";import"./InlineMenuAction-d5mRENST.js";import"./TableRow-phXfWUGW.js";import"./ipUtils-P4y3JNCT.js";import"./ipaddr-jlottelM.js";import"./Drawer-A9yKjC3Z.js";import"./MultipleIPInput-NQt3M-F3.js";import"./FirewallRuleDrawer.utils-gE7QU4cL.js";import"./uniq-xa8_MmzW.js";import"./_contains-91K6xqrF.js";import"./shared-QcuPM2Px.js";import"./sortBy-avzW26A0.js";import"./formikErrorUtils-jhqfCjwU.js";import"./TypeToConfirm-koQ3u5up.js";const ie=s=>{const{databaseEngine:t,databaseID:o,databaseLabel:l,onClose:u,open:r}=s,{enqueueSnackbar:n}=O(),{mutateAsync:d}=V(t,o),y="There was an error deleting this Database Cluster.",[i,g]=f.useState(""),[w,m]=f.useState(!1),{push:T}=U(),j=()=>{m(!0),d().then(()=>{m(!1),n("Database Cluster deleted successfully.",{variant:"success"}),u(),T("/databases")}).catch(_=>{m(!1),g(G(_,y)[0].reason)})};return e.jsxs(se,{entity:{action:"deletion",name:l,primaryBtnText:"Delete Cluster",subType:"Cluster",type:"Database"},label:"Cluster Name",loading:w,onClick:j,onClose:u,open:r,title:`Delete Database Cluster ${l}`,children:[i?e.jsx(D,{text:i,variant:"error"}):null,e.jsx(D,{variant:"warning",children:e.jsxs(h,{style:{fontSize:"0.875rem"},children:[e.jsx("strong",{children:"Warning:"})," Deleting your entire database will delete any backups and nodes associated with database ",l,", which may result in permanent data loss. This action cannot be undone."]})})]})},re=z()(s=>({sectionButton:{minWidth:214,[s.breakpoints.down("md")]:{alignSelf:"flex-start"}},sectionText:{[s.breakpoints.down("md")]:{marginBottom:"1rem"},[s.breakpoints.down("sm")]:{width:"100%"},width:"65%"},sectionTitle:{marginBottom:"0.25rem"},sectionTitleAndText:{width:"100%"},topSection:{alignItems:"center",display:"flex",justifyContent:"space-between",[s.breakpoints.down("md")]:{flexDirection:"column"}}})),E=s=>{const{buttonText:t,descriptiveText:o,disabled:l=!1,onClick:u,sectionTitle:r}=s,{classes:n}=re();return e.jsxs("div",{className:n.topSection,"data-qa-settings-section":r,children:[e.jsxs("div",{className:n.sectionTitleAndText,children:[e.jsx(h,{className:n.sectionTitle,variant:"h3",children:r}),e.jsx(h,{className:n.sectionText,children:o})]}),e.jsx($,{buttonType:"primary",className:n.sectionButton,"data-qa-settings-button":t,disabled:l,onClick:u,children:t})]})},de=(s,t,o)=>e.jsx(X,{primaryButtonProps:{"data-testid":"confirm",label:"Reset Root Password",loading:o,onClick:t},secondaryButtonProps:{label:"Cancel",onClick:s}}),ce=s=>{const{databaseEngine:t,databaseID:o,onClose:l,open:u}=s,{error:r,isLoading:n,mutateAsync:d}=H(t,o),y=async()=>{await d(),l()};return e.jsxs(J,{actions:de(l,y,n),onClose:l,open:u,title:"Reset Root Password",children:[r?e.jsx(D,{variant:"error",children:r[0].reason}):void 0,e.jsx(h,{children:"After resetting your root password, you can view your new password on the database cluster summary page."})]})},ue=z()(s=>({formControlDropdown:{"& label":{overflow:"visible"},marginRight:"3rem"},sectionButton:{alignSelf:"end",marginBottom:"1rem",marginTop:"1rem",minWidth:214,[s.breakpoints.down("md")]:{alignSelf:"flex-start"}},sectionText:{[s.breakpoints.down("md")]:{marginBottom:"1rem"},[s.breakpoints.down("sm")]:{width:"100%"},width:"65%"},sectionTitle:{marginBottom:"0.25rem"},sectionTitleAndText:{width:"100%"},topSection:{alignItems:"center",display:"flex",justifyContent:"space-between",[s.breakpoints.down("lg")]:{flexDirection:"column"}}})),me=s=>{var W,q,F;const{database:t,timezone:o}=s,[l,u]=f.useState(),[r,n]=f.useState(!1),[d,y]=f.useState([]),{classes:i}=ue(),{enqueueSnackbar:g}=O(),{mutateAsync:w}=Y(t.engine,t.id),m=(a,c)=>{const b=c.map(k=>({label:`${k.label} ${a} of each month`,value:k.value}));y(b)};f.useEffect(()=>{var b;const a=(b=t.updates)==null?void 0:b.day_of_week,c=x.find(k=>k.value===a)??x[0];m(c.label,A)},[]);const T=(a,{setSubmitting:c})=>{w({allow_list:t.allow_list,updates:a}).then(()=>{c(!1),g("Maintenance Window settings saved successfully.",{variant:"success"}),n(!1)}).catch(b=>{u(b),c(!1)})},j=o?N.fromISO(new Date().toISOString(),{zone:o}).offset/60:N.now().offset/60,_=()=>{var a,c;return((a=t.updates)==null?void 0:a.frequency)==="monthly"?((c=t.updates)==null?void 0:c.week_of_month)??1:null},{errors:S,handleSubmit:L,isSubmitting:I,setFieldValue:v,touched:R,values:p}=oe({initialValues:{day_of_week:((W=t.updates)==null?void 0:W.day_of_week)??1,frequency:((q=t.updates)==null?void 0:q.frequency)??"weekly",hour_of_day:((F=t.updates)==null?void 0:F.hour_of_day)??20,week_of_month:_()},onSubmit:T});return e.jsx("form",{onSubmit:L,children:e.jsxs("div",{className:i.topSection,children:[e.jsxs("div",{className:i.sectionTitleAndText,children:[e.jsx(h,{className:i.sectionTitle,variant:"h3",children:"Maintenance Window"}),l?e.jsx(D,{spacingTop:8,variant:"error",children:l[0].reason}):null,e.jsxs(h,{className:i.sectionText,children:["OS and DB engine updates will be performed on the schedule below. Select the frequency, day, and time youâ€™d prefer maintenance to occur."," ",t.cluster_size!==3?"For non-HA plans, expect downtime during this window.":null]}),e.jsxs("div",{children:[e.jsx(C,{className:i.formControlDropdown,children:e.jsx(M,{defaultValue:x.find(a=>a.value===1),onChange:a=>{n(!0),v("day_of_week",a.value),m(a.label,A),p.week_of_month&&v("week_of_month",p.week_of_month)},textFieldProps:{dataAttrs:{"data-qa-weekday-select":!0}},value:x.find(a=>a.value===p.day_of_week),errorText:R.day_of_week?S.day_of_week:void 0,isClearable:!1,label:"Day of Week",menuPlacement:"top",name:"Day of Week",noMarginTop:!0,options:x,placeholder:"Choose a day"})}),e.jsx(C,{className:i.formControlDropdown,children:e.jsxs("div",{style:{alignItems:"center",display:"flex"},children:[e.jsx(M,{defaultValue:B.find(a=>a.value===20),errorText:R.hour_of_day?S.hour_of_day:void 0,onChange:a=>{n(!0),v("hour_of_day",a.value)},textFieldProps:{dataAttrs:{"data-qa-time-select":!0}},value:B.find(a=>a.value===p.hour_of_day),isClearable:!1,label:"Time of Day (UTC)",menuPlacement:"top",name:"Time of Day",noMarginTop:!0,options:B,placeholder:"Choose a time"}),e.jsx(K,{sxTooltipIcon:{marginTop:"1.25rem",padding:"0px 8px"},text:e.jsxs(h,{children:["UTC is ",be(j)," hours compared to your local timezone. Click"," ",e.jsx(Q,{to:"/profile/display",children:"here"})," to view or change your timezone settings."]}),interactive:!0,status:"help"})]})})]}),e.jsx(C,{onChange:a=>{if(n(!0),v("frequency",a.target.value),a.target.value==="weekly"&&v("week_of_month",null),a.target.value==="monthly"){const c=x.find(b=>b.value===p.day_of_week)??x[0];m(c.label,A),v("week_of_month",d[0].value)}},children:e.jsx(le,{style:{marginBottom:0,marginTop:0},value:p.frequency,children:pe.map(a=>e.jsx(Z,{control:e.jsx(ne,{}),label:a.key,value:a.value},a.value))})}),e.jsx("div",{children:p.frequency==="monthly"?e.jsx(C,{className:i.formControlDropdown,style:{minWidth:"250px"},children:e.jsx(M,{errorText:R.week_of_month?S.week_of_month:void 0,onChange:a=>{n(!0),v("week_of_month",a.value)},textFieldProps:{dataAttrs:{"data-qa-week-in-month-select":!0}},value:d.find(a=>a.value===p.week_of_month),defaultValue:d[0],isClearable:!1,label:"Repeats on",menuPlacement:"top",name:"Repeats on",noMarginTop:!0,options:d,placeholder:"Repeats on"})}):null})]}),e.jsx($,{buttonType:"primary",className:i.sectionButton,compactX:!0,disabled:!r||I,loading:I,type:"submit",children:"Save Changes"})]})})},pe=[{key:"Weekly",value:"weekly"},{key:"Monthly",value:"monthly"}],x=[{label:"Monday",value:1},{label:"Tuesday",value:2},{label:"Wednesday",value:3},{label:"Thursday",value:4},{label:"Friday",value:5},{label:"Saturday",value:6},{label:"Sunday",value:7}],B=[{label:"00:00",value:0},{label:"01:00",value:2},{label:"02:00",value:1},{label:"03:00",value:3},{label:"04:00",value:4},{label:"05:00",value:5},{label:"06:00",value:6},{label:"07:00",value:7},{label:"08:00",value:8},{label:"09:00",value:9},{label:"10:00",value:10},{label:"11:00",value:11},{label:"12:00",value:12},{label:"13:00",value:13},{label:"14:00",value:14},{label:"15:00",value:15},{label:"16:00",value:16},{label:"17:00",value:17},{label:"18:00",value:18},{label:"19:00",value:19},{label:"20:00",value:20},{label:"21:00",value:21},{label:"22:00",value:22},{label:"23:00",value:23}],A=[{label:"First",value:1},{label:"Second",value:2},{label:"Third",value:3},{label:"Fourth",value:4}],be=s=>s<0?`+${Math.abs(s)}`:`-${s}`,fe=s=>{const{database:t}=s,{data:o}=ee(),l=e.jsx(h,{children:"Add or remove IPv4 addresses or ranges that should be authorized to access your cluster."}),u="Resetting your root password will automatically generate a new password. You can view the updated password on your database cluster summary page. ",r="Deleting a database cluster is permanent and cannot be undone.",[n,d]=f.useState(!1),[y,i]=f.useState(!1),g=()=>{i(!0)},w=()=>{d(!0)},m=()=>{d(!1)},T=()=>{i(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(ae,{children:[e.jsx(te,{database:t,description:l}),e.jsx(P,{spacingBottom:22,spacingTop:28}),e.jsx(E,{buttonText:"Reset Root Password",descriptiveText:u,onClick:g,sectionTitle:"Reset Root Password"}),e.jsx(P,{spacingBottom:22,spacingTop:28}),e.jsx(E,{buttonText:"Delete Cluster",descriptiveText:r,disabled:!!(o!=null&&o.restricted),onClick:w,sectionTitle:"Delete Cluster"}),e.jsx(P,{spacingBottom:22,spacingTop:28}),e.jsx(me,{database:t,timezone:o==null?void 0:o.timezone})]}),e.jsx(ie,{databaseEngine:t.engine,databaseID:t.id,databaseLabel:t.label,onClose:m,open:n}),e.jsx(ce,{databaseEngine:t.engine,databaseID:t.id,onClose:T,open:y})]})},Fe=fe;export{Fe as default};
