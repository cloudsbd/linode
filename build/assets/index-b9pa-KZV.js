var ua=Object.defineProperty;var fa=(r,i,t)=>i in r?ua(r,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[i]=t;var ei=(r,i,t)=>(fa(r,typeof i!="symbol"?i+"":i,t),t);import{r as ze,j as Ee,m as _a,E as Or,B as da,u as pa,a as va,b as ga,c as ya,d as xa,s as Ao,C as ba}from"./index-Eksrs3uK.js";import{S as as}from"./SafeTabPanel-S0Pp8CVT.js";import{T as ma}from"./TabLinkList-BrXtJznm.js";import{T as Sa,a as wa}from"./TabList-4PWL4GSj.js";import{r as Mo,g as Pn}from"./lishUtils-OjFanRCH.js";function Ca(r){return r>>>0}function Xn(r){return r|0}let cs="warn",ue=()=>{},Ne=()=>{},it=()=>{},Ce=()=>{};function ka(r){if(typeof r>"u"?r=cs:cs=r,ue=Ne=it=Ce=()=>{},typeof window.console<"u")switch(r){case"debug":ue=console.debug.bind(window.console);case"info":Ne=console.info.bind(window.console);case"warn":it=console.warn.bind(window.console);case"error":Ce=console.error.bind(window.console);case"none":break;default:throw new window.Error("invalid logging type '"+r+"'")}}ka();function gn(r,i=!1){try{return decodeURIComponent(escape(r))}catch(t){if(t instanceof URIError&&i)return r;throw t}}function vt(r){return unescape(encodeURIComponent(r))}let Ro="ontouchstart"in document.documentElement||document.ontouchstart!==void 0||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;window.addEventListener("touchstart",function r(){Ro=!0,window.removeEventListener("touchstart",r,!1)},!1);let ls=10*(window.devicePixelRatio||1),To=!1;try{const r=document.createElement("canvas");r.style.cursor='url("data:image/x-icon;base64,AAACAAEACAgAAAIAAgA4AQAAFgAAACgAAAAIAAAAEAAAAAEAIAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AAAAAAAAAAAAAAAAAAAAAA==") 2 2, default',r.style.cursor.indexOf("url")===0?(Ne("Data URI scheme cursor supported"),To=!0):it("Data URI scheme cursor not supported")}catch(r){Ce("Data URI scheme cursor test exception: "+r)}const Ea=To;let La=!0;try{const r=document.createElement("div");r.style.visibility="hidden",r.style.overflow="scroll",document.body.appendChild(r);const i=document.createElement("div");r.appendChild(i);const t=r.offsetWidth-i.offsetWidth;r.parentNode.removeChild(r),La=t!=0}catch(r){Ce("Scrollbar test exception: "+r)}function li(){return!!/mac/i.exec(navigator.platform)}function Tr(){return!!/win/i.exec(navigator.platform)}function yr(){return!!/ipad/i.exec(navigator.platform)||!!/iphone/i.exec(navigator.platform)||!!/ipod/i.exec(navigator.platform)}function ti(r,i,t){const n=t.getBoundingClientRect();let d={x:0,y:0};return r<n.left?d.x=0:r>=n.right?d.x=n.width-1:d.x=r-n.left,i<n.top?d.y=0:i>=n.bottom?d.y=n.height-1:d.y=i-n.top,d}function Nt(r){r.stopPropagation(),r.preventDefault()}let yn=!1,Fo=null;document.captureElement=null;function Bt(r){if(yn)return;const i=new r.constructor(r.type,r);yn=!0,document.captureElement?document.captureElement.dispatchEvent(i):Fo.dispatchEvent(i),yn=!1,r.stopPropagation(),i.defaultPrevented&&r.preventDefault(),r.type==="mouseup"&&Oo()}function Do(){const r=document.getElementById("noVNC_mouse_capture_elem");r.style.cursor=window.getComputedStyle(document.captureElement).cursor}const Bo=new MutationObserver(Do);function Aa(r){if(r.setCapture)r.setCapture(),document.captureElement=r;else{Oo();let i=document.getElementById("noVNC_mouse_capture_elem");i===null&&(i=document.createElement("div"),i.id="noVNC_mouse_capture_elem",i.style.position="fixed",i.style.top="0px",i.style.left="0px",i.style.width="100%",i.style.height="100%",i.style.zIndex=1e4,i.style.display="none",document.body.appendChild(i),i.addEventListener("contextmenu",Bt),i.addEventListener("mousemove",Bt),i.addEventListener("mouseup",Bt)),document.captureElement=r,Bo.observe(r,{attributes:!0}),Do(),i.style.display="",window.addEventListener("mousemove",Bt),window.addEventListener("mouseup",Bt)}}function Oo(){if(document.releaseCapture)document.releaseCapture(),document.captureElement=null;else{if(!document.captureElement)return;Fo=document.captureElement,document.captureElement=null,Bo.disconnect();const r=document.getElementById("noVNC_mouse_capture_elem");r.style.display="none",window.removeEventListener("mousemove",Bt),window.removeEventListener("mouseup",Bt)}}class Ko{constructor(){this._listeners=new Map}addEventListener(i,t){this._listeners.has(i)||this._listeners.set(i,new Set),this._listeners.get(i).add(t)}removeEventListener(i,t){this._listeners.has(i)&&this._listeners.get(i).delete(t)}dispatchEvent(i){return this._listeners.has(i.type)?(this._listeners.get(i.type).forEach(t=>t.call(this,i)),!i.defaultPrevented):!0}}var Po={toBase64Table:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""),base64Pad:"=",encode(r){let i="";const t=r.length,n=t%3;for(let e=0;e<t-2;e+=3)i+=this.toBase64Table[r[e]>>2],i+=this.toBase64Table[((r[e]&3)<<4)+(r[e+1]>>4)],i+=this.toBase64Table[((r[e+1]&15)<<2)+(r[e+2]>>6)],i+=this.toBase64Table[r[e+2]&63];const d=t-n;return n===2?(i+=this.toBase64Table[r[d]>>2],i+=this.toBase64Table[((r[d]&3)<<4)+(r[d+1]>>4)],i+=this.toBase64Table[(r[d+1]&15)<<2],i+=this.toBase64Table[64]):n===1&&(i+=this.toBase64Table[r[d]>>2],i+=this.toBase64Table[(r[d]&3)<<4],i+=this.toBase64Table[64],i+=this.toBase64Table[64]),i},toBinaryTable:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],decode(r,i=0){let t=r.indexOf("=")-i;t<0&&(t=r.length-i);const n=(t>>2)*3+Math.floor(t%4/1.5),d=new Array(n);let e=0,a=0;for(let u=0,v=i;v<r.length;v++){const l=this.toBinaryTable[r.charCodeAt(v)&127],_=r.charAt(v)===this.base64Pad;if(l===-1){Ce("Illegal character code "+r.charCodeAt(v)+" at position "+v);continue}a=a<<6|l,e+=6,e>=8&&(e-=8,_||(d[u++]=a>>e&255),a&=(1<<e)-1)}if(e){const u=new Error("Corrupted base64 string");throw u.name="Base64-Error",u}return d}};class Ma{constructor(i){if(this._drawCtx=null,this._renderQ=[],this._flushing=!1,this._fbWidth=0,this._fbHeight=0,this._prevDrawStyle="",ue(">> Display.constructor"),this._target=i,!this._target)throw new Error("Target must be set");if(typeof this._target=="string")throw new Error("target must be a DOM element");if(!this._target.getContext)throw new Error("no getContext method");this._targetCtx=this._target.getContext("2d"),this._viewportLoc={x:0,y:0,w:this._target.width,h:this._target.height},this._backbuffer=document.createElement("canvas"),this._drawCtx=this._backbuffer.getContext("2d"),this._damageBounds={left:0,top:0,right:this._backbuffer.width,bottom:this._backbuffer.height},ue("User Agent: "+navigator.userAgent),ue("<< Display.constructor"),this._scale=1,this._clipViewport=!1,this.onflush=()=>{}}get scale(){return this._scale}set scale(i){this._rescale(i)}get clipViewport(){return this._clipViewport}set clipViewport(i){this._clipViewport=i;const t=this._viewportLoc;this.viewportChangeSize(t.w,t.h),this.viewportChangePos(0,0)}get width(){return this._fbWidth}get height(){return this._fbHeight}viewportChangePos(i,t){const n=this._viewportLoc;i=Math.floor(i),t=Math.floor(t),this._clipViewport||(i=-n.w,t=-n.h);const d=n.x+n.w-1,e=n.y+n.h-1;i<0&&n.x+i<0&&(i=-n.x),d+i>=this._fbWidth&&(i-=d+i-this._fbWidth+1),n.y+t<0&&(t=-n.y),e+t>=this._fbHeight&&(t-=e+t-this._fbHeight+1),!(i===0&&t===0)&&(ue("viewportChange deltaX: "+i+", deltaY: "+t),n.x+=i,n.y+=t,this._damage(n.x,n.y,n.w,n.h),this.flip())}viewportChangeSize(i,t){(!this._clipViewport||typeof i>"u"||typeof t>"u")&&(ue("Setting viewport to full display region"),i=this._fbWidth,t=this._fbHeight),i=Math.floor(i),t=Math.floor(t),i>this._fbWidth&&(i=this._fbWidth),t>this._fbHeight&&(t=this._fbHeight);const n=this._viewportLoc;if(n.w!==i||n.h!==t){n.w=i,n.h=t;const d=this._target;d.width=i,d.height=t,this.viewportChangePos(0,0),this._damage(n.x,n.y,n.w,n.h),this.flip(),this._rescale(this._scale)}}absX(i){return this._scale===0?0:Xn(i/this._scale+this._viewportLoc.x)}absY(i){return this._scale===0?0:Xn(i/this._scale+this._viewportLoc.y)}resize(i,t){this._prevDrawStyle="",this._fbWidth=i,this._fbHeight=t;const n=this._backbuffer;if(n.width!==i||n.height!==t){let e=null;n.width>0&&n.height>0&&(e=this._drawCtx.getImageData(0,0,n.width,n.height)),n.width!==i&&(n.width=i),n.height!==t&&(n.height=t),e&&this._drawCtx.putImageData(e,0,0)}const d=this._viewportLoc;this.viewportChangeSize(d.w,d.h),this.viewportChangePos(0,0)}getImageData(){return this._drawCtx.getImageData(0,0,this.width,this.height)}toDataURL(i,t){return this._backbuffer.toDataURL(i,t)}toBlob(i,t,n){return this._backbuffer.toBlob(i,t,n)}_damage(i,t,n,d){i<this._damageBounds.left&&(this._damageBounds.left=i),t<this._damageBounds.top&&(this._damageBounds.top=t),i+n>this._damageBounds.right&&(this._damageBounds.right=i+n),t+d>this._damageBounds.bottom&&(this._damageBounds.bottom=t+d)}flip(i){if(this._renderQ.length!==0&&!i)this._renderQPush({type:"flip"});else{let t=this._damageBounds.left,n=this._damageBounds.top,d=this._damageBounds.right-t,e=this._damageBounds.bottom-n,a=t-this._viewportLoc.x,u=n-this._viewportLoc.y;a<0&&(d+=a,t-=a,a=0),u<0&&(e+=u,n-=u,u=0),a+d>this._viewportLoc.w&&(d=this._viewportLoc.w-a),u+e>this._viewportLoc.h&&(e=this._viewportLoc.h-u),d>0&&e>0&&this._targetCtx.drawImage(this._backbuffer,t,n,d,e,a,u,d,e),this._damageBounds.left=this._damageBounds.top=65535,this._damageBounds.right=this._damageBounds.bottom=0}}pending(){return this._renderQ.length>0}flush(){this._renderQ.length===0?this.onflush():this._flushing=!0}fillRect(i,t,n,d,e,a){this._renderQ.length!==0&&!a?this._renderQPush({type:"fill",x:i,y:t,width:n,height:d,color:e}):(this._setFillColor(e),this._drawCtx.fillRect(i,t,n,d),this._damage(i,t,n,d))}copyImage(i,t,n,d,e,a,u){this._renderQ.length!==0&&!u?this._renderQPush({type:"copy",oldX:i,oldY:t,x:n,y:d,width:e,height:a}):(this._drawCtx.mozImageSmoothingEnabled=!1,this._drawCtx.webkitImageSmoothingEnabled=!1,this._drawCtx.msImageSmoothingEnabled=!1,this._drawCtx.imageSmoothingEnabled=!1,this._drawCtx.drawImage(this._backbuffer,i,t,e,a,n,d,e,a),this._damage(n,d,e,a))}imageRect(i,t,n,d,e,a){if(n===0||d===0)return;const u=new Image;u.src="data: "+e+";base64,"+Po.encode(a),this._renderQPush({type:"img",img:u,x:i,y:t,width:n,height:d})}blitImage(i,t,n,d,e,a,u){if(this._renderQ.length!==0&&!u){const v=new Uint8Array(n*d*4);v.set(new Uint8Array(e.buffer,0,v.length)),this._renderQPush({type:"blit",data:v,x:i,y:t,width:n,height:d})}else{let v=new Uint8ClampedArray(e.buffer,e.byteOffset+a,n*d*4),l=new ImageData(v,n,d);this._drawCtx.putImageData(l,i,t),this._damage(i,t,n,d)}}drawImage(i,t,n){this._drawCtx.drawImage(i,t,n),this._damage(t,n,i.width,i.height)}autoscale(i,t){let n;if(i===0||t===0)n=0;else{const d=this._viewportLoc,e=i/t;d.w/d.h>=e?n=i/d.w:n=t/d.h}this._rescale(n)}_rescale(i){this._scale=i;const t=this._viewportLoc,n=i*t.w+"px",d=i*t.h+"px";(this._target.style.width!==n||this._target.style.height!==d)&&(this._target.style.width=n,this._target.style.height=d)}_setFillColor(i){const t="rgb("+i[0]+","+i[1]+","+i[2]+")";t!==this._prevDrawStyle&&(this._drawCtx.fillStyle=t,this._prevDrawStyle=t)}_renderQPush(i){this._renderQ.push(i),this._renderQ.length===1&&this._scanRenderQ()}_resumeRenderQ(){this.removeEventListener("load",this._noVNCDisplay._resumeRenderQ),this._noVNCDisplay._scanRenderQ()}_scanRenderQ(){let i=!0;for(;i&&this._renderQ.length>0;){const t=this._renderQ[0];switch(t.type){case"flip":this.flip(!0);break;case"copy":this.copyImage(t.oldX,t.oldY,t.x,t.y,t.width,t.height,!0);break;case"fill":this.fillRect(t.x,t.y,t.width,t.height,t.color,!0);break;case"blit":this.blitImage(t.x,t.y,t.width,t.height,t.data,0,!0);break;case"img":if(t.img.complete){if(t.img.width!==t.width||t.img.height!==t.height){Ce("Decoded image has incorrect dimensions. Got "+t.img.width+"x"+t.img.height+". Expected "+t.width+"x"+t.height+".");return}this.drawImage(t.img,t.x,t.y)}else t.img._noVNCDisplay=this,t.img.addEventListener("load",this._resumeRenderQ),i=!1;break}i&&this._renderQ.shift()}this._renderQ.length===0&&this._flushing&&(this._flushing=!1,this.onflush())}}function yt(r,i,t,n,d){if(i.subarray&&r.subarray){r.set(i.subarray(t,t+n),d);return}for(var e=0;e<n;e++)r[d+e]=i[t+e]}var Kr=Uint8Array,et=Uint16Array,Pr=Int32Array;function In(r,i,t,n){for(var d=r&65535|0,e=r>>>16&65535|0,a=0;t!==0;){a=t>2e3?2e3:t,t-=a;do d=d+i[n++]|0,e=e+d|0;while(--a);d%=65521,e%=65521}return d|e<<16|0}function De(){for(var r,i=[],t=0;t<256;t++){r=t;for(var n=0;n<8;n++)r=r&1?3988292384^r>>>1:r>>>1;i[t]=r}return i}De();var xr=30,Ra=12;function Ta(r,i){var t,n,d,e,a,u,v,l,_,S,b,p,g,w,x,h,s,c,o,f,m,y,C,L,k;t=r.state,n=r.next_in,L=r.input,d=n+(r.avail_in-5),e=r.next_out,k=r.output,a=e-(i-r.avail_out),u=e+(r.avail_out-257),v=t.dmax,l=t.wsize,_=t.whave,S=t.wnext,b=t.window,p=t.hold,g=t.bits,w=t.lencode,x=t.distcode,h=(1<<t.lenbits)-1,s=(1<<t.distbits)-1;e:do{g<15&&(p+=L[n++]<<g,g+=8,p+=L[n++]<<g,g+=8),c=w[p&h];t:for(;;){if(o=c>>>24,p>>>=o,g-=o,o=c>>>16&255,o===0)k[e++]=c&65535;else if(o&16){f=c&65535,o&=15,o&&(g<o&&(p+=L[n++]<<g,g+=8),f+=p&(1<<o)-1,p>>>=o,g-=o),g<15&&(p+=L[n++]<<g,g+=8,p+=L[n++]<<g,g+=8),c=x[p&s];i:for(;;){if(o=c>>>24,p>>>=o,g-=o,o=c>>>16&255,o&16){if(m=c&65535,o&=15,g<o&&(p+=L[n++]<<g,g+=8,g<o&&(p+=L[n++]<<g,g+=8)),m+=p&(1<<o)-1,m>v){r.msg="invalid distance too far back",t.mode=xr;break e}if(p>>>=o,g-=o,o=e-a,m>o){if(o=m-o,o>_&&t.sane){r.msg="invalid distance too far back",t.mode=xr;break e}if(y=0,C=b,S===0){if(y+=l-o,o<f){f-=o;do k[e++]=b[y++];while(--o);y=e-m,C=k}}else if(S<o){if(y+=l+S-o,o-=S,o<f){f-=o;do k[e++]=b[y++];while(--o);if(y=0,S<f){o=S,f-=o;do k[e++]=b[y++];while(--o);y=e-m,C=k}}}else if(y+=S-o,o<f){f-=o;do k[e++]=b[y++];while(--o);y=e-m,C=k}for(;f>2;)k[e++]=C[y++],k[e++]=C[y++],k[e++]=C[y++],f-=3;f&&(k[e++]=C[y++],f>1&&(k[e++]=C[y++]))}else{y=e-m;do k[e++]=k[y++],k[e++]=k[y++],k[e++]=k[y++],f-=3;while(f>2);f&&(k[e++]=k[y++],f>1&&(k[e++]=k[y++]))}}else if(o&64){r.msg="invalid distance code",t.mode=xr;break e}else{c=x[(c&65535)+(p&(1<<o)-1)];continue i}break}}else if(o&64)if(o&32){t.mode=Ra;break e}else{r.msg="invalid literal/length code",t.mode=xr;break e}else{c=w[(c&65535)+(p&(1<<o)-1)];continue t}break}}while(n<d&&e<u);f=g>>3,n-=f,g-=f<<3,p&=(1<<g)-1,r.next_in=n,r.next_out=e,r.avail_in=n<d?5+(d-n):5-(n-d),r.avail_out=e<u?257+(u-e):257-(e-u),t.hold=p,t.bits=g}var Wt=15,hs=852,us=592,fs=0,xn=1,_s=2,Fa=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Da=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Ba=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Oa=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function fi(r,i,t,n,d,e,a,u){var v=u.bits,l=0,_=0,S=0,b=0,p=0,g=0,w=0,x=0,h=0,s=0,c,o,f,m,y,C=null,L=0,k,E=new et(Wt+1),A=new et(Wt+1),D=null,M=0,F,T,R;for(l=0;l<=Wt;l++)E[l]=0;for(_=0;_<n;_++)E[i[t+_]]++;for(p=v,b=Wt;b>=1&&E[b]===0;b--);if(p>b&&(p=b),b===0)return d[e++]=1<<24|64<<16|0,d[e++]=1<<24|64<<16|0,u.bits=1,0;for(S=1;S<b&&E[S]===0;S++);for(p<S&&(p=S),x=1,l=1;l<=Wt;l++)if(x<<=1,x-=E[l],x<0)return-1;if(x>0&&(r===fs||b!==1))return-1;for(A[1]=0,l=1;l<Wt;l++)A[l+1]=A[l]+E[l];for(_=0;_<n;_++)i[t+_]!==0&&(a[A[i[t+_]]++]=_);if(r===fs?(C=D=a,k=19):r===xn?(C=Fa,L-=257,D=Da,M-=257,k=256):(C=Ba,D=Oa,k=-1),s=0,_=0,l=S,y=e,g=p,w=0,f=-1,h=1<<p,m=h-1,r===xn&&h>hs||r===_s&&h>us)return 1;for(;;){F=l-w,a[_]<k?(T=0,R=a[_]):a[_]>k?(T=D[M+a[_]],R=C[L+a[_]]):(T=96,R=0),c=1<<l-w,o=1<<g,S=o;do o-=c,d[y+(s>>w)+o]=F<<24|T<<16|R|0;while(o!==0);for(c=1<<l-1;s&c;)c>>=1;if(c!==0?(s&=c-1,s+=c):s=0,_++,--E[l]===0){if(l===b)break;l=i[t+a[_]]}if(l>p&&(s&m)!==f){for(w===0&&(w=p),y+=S,g=l-w,x=1<<g;g+w<b&&(x-=E[g+w],!(x<=0));)g++,x<<=1;if(h+=1<<g,r===xn&&h>hs||r===_s&&h>us)return 1;f=s&m,d[f]=p<<24|g<<16|y-e|0}}return s!==0&&(d[y+s]=l-w<<24|64<<16|0),u.bits=p,0}var Ka=0,Xo=1,Io=2;const ds=4,Pa=5,br=6,Xr=0,Xa=1,Ia=2,Xt=-2,Ha=-3,Ua=-4,ja=-5,ps=8;var Ho=1,vs=2,gs=3,ys=4,xs=5,bs=6,ms=7,Ss=8,ws=9,Cs=10,ks=11,pt=12,bn=13,Es=14,mn=15,Ls=16,As=17,Ms=18,Rs=19,mr=20,Sr=21,Ts=22,Fs=23,Ds=24,Bs=25,Os=26,Sn=27,Ks=28,Ps=29,we=30,Na=31,Wa=32,za=852,qa=592,Qa=15,Va=Qa;function Xs(r){return(r>>>24&255)+(r>>>8&65280)+((r&65280)<<8)+((r&255)<<24)}function Ga(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new et(320),this.work=new et(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Za(r){var i;return!r||!r.state?Xt:(i=r.state,r.total_in=r.total_out=i.total=0,r.msg="",i.wrap&&(r.adler=i.wrap&1),i.mode=Ho,i.last=0,i.havedict=0,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new Pr(za),i.distcode=i.distdyn=new Pr(qa),i.sane=1,i.back=-1,Xr)}function Uo(r){var i;return!r||!r.state?Xt:(i=r.state,i.wsize=0,i.whave=0,i.wnext=0,Za(r))}function Ya(r,i){var t,n;return!r||!r.state||(n=r.state,i<0?(t=0,i=-i):(t=(i>>4)+1,i<48&&(i&=15)),i&&(i<8||i>15))?Xt:(n.window!==null&&n.wbits!==i&&(n.window=null),n.wrap=t,n.wbits=i,Uo(r))}function Ja(r,i){var t,n;return r?(n=new Ga,r.state=n,n.window=null,t=Ya(r,i),t!==Xr&&(r.state=null),t):Xt}function $a(r){return Ja(r,Va)}var Is=!0,wn,Cn;function ec(r){if(Is){var i;for(wn=new Pr(512),Cn=new Pr(32),i=0;i<144;)r.lens[i++]=8;for(;i<256;)r.lens[i++]=9;for(;i<280;)r.lens[i++]=7;for(;i<288;)r.lens[i++]=8;for(fi(Xo,r.lens,0,288,wn,0,r.work,{bits:9}),i=0;i<32;)r.lens[i++]=5;fi(Io,r.lens,0,32,Cn,0,r.work,{bits:5}),Is=!1}r.lencode=wn,r.lenbits=9,r.distcode=Cn,r.distbits=5}function tc(r,i,t,n){var d,e=r.state;return e.window===null&&(e.wsize=1<<e.wbits,e.wnext=0,e.whave=0,e.window=new Kr(e.wsize)),n>=e.wsize?(yt(e.window,i,t-e.wsize,e.wsize,0),e.wnext=0,e.whave=e.wsize):(d=e.wsize-e.wnext,d>n&&(d=n),yt(e.window,i,t-n,d,e.wnext),n-=d,n?(yt(e.window,i,t-n,n,0),e.wnext=n,e.whave=e.wsize):(e.wnext+=d,e.wnext===e.wsize&&(e.wnext=0),e.whave<e.wsize&&(e.whave+=d))),0}function ic(r,i){var t,n,d,e,a,u,v,l,_,S,b,p,g,w,x=0,h,s,c,o,f,m,y,C,L=new Kr(4),k,E,A=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!r||!r.state||!r.output||!r.input&&r.avail_in!==0)return Xt;t=r.state,t.mode===pt&&(t.mode=bn),a=r.next_out,d=r.output,v=r.avail_out,e=r.next_in,n=r.input,u=r.avail_in,l=t.hold,_=t.bits,S=u,b=v,C=Xr;e:for(;;)switch(t.mode){case Ho:if(t.wrap===0){t.mode=bn;break}for(;_<16;){if(u===0)break e;u--,l+=n[e++]<<_,_+=8}if(t.wrap&2&&l===35615){t.check=0,L[0]=l&255,L[1]=l>>>8&255,t.check=De(t.check),l=0,_=0,t.mode=vs;break}if(t.flags=0,t.head&&(t.head.done=!1),!(t.wrap&1)||(((l&255)<<8)+(l>>8))%31){r.msg="incorrect header check",t.mode=we;break}if((l&15)!==ps){r.msg="unknown compression method",t.mode=we;break}if(l>>>=4,_-=4,y=(l&15)+8,t.wbits===0)t.wbits=y;else if(y>t.wbits){r.msg="invalid window size",t.mode=we;break}t.dmax=1<<y,r.adler=t.check=1,t.mode=l&512?Cs:pt,l=0,_=0;break;case vs:for(;_<16;){if(u===0)break e;u--,l+=n[e++]<<_,_+=8}if(t.flags=l,(t.flags&255)!==ps){r.msg="unknown compression method",t.mode=we;break}if(t.flags&57344){r.msg="unknown header flags set",t.mode=we;break}t.head&&(t.head.text=l>>8&1),t.flags&512&&(L[0]=l&255,L[1]=l>>>8&255,t.check=De(t.check)),l=0,_=0,t.mode=gs;case gs:for(;_<32;){if(u===0)break e;u--,l+=n[e++]<<_,_+=8}t.head&&(t.head.time=l),t.flags&512&&(L[0]=l&255,L[1]=l>>>8&255,L[2]=l>>>16&255,L[3]=l>>>24&255,t.check=De(t.check)),l=0,_=0,t.mode=ys;case ys:for(;_<16;){if(u===0)break e;u--,l+=n[e++]<<_,_+=8}t.head&&(t.head.xflags=l&255,t.head.os=l>>8),t.flags&512&&(L[0]=l&255,L[1]=l>>>8&255,t.check=De(t.check)),l=0,_=0,t.mode=xs;case xs:if(t.flags&1024){for(;_<16;){if(u===0)break e;u--,l+=n[e++]<<_,_+=8}t.length=l,t.head&&(t.head.extra_len=l),t.flags&512&&(L[0]=l&255,L[1]=l>>>8&255,t.check=De(t.check)),l=0,_=0}else t.head&&(t.head.extra=null);t.mode=bs;case bs:if(t.flags&1024&&(p=t.length,p>u&&(p=u),p&&(t.head&&(y=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Array(t.head.extra_len)),yt(t.head.extra,n,e,p,y)),t.flags&512&&(t.check=De(t.check)),u-=p,e+=p,t.length-=p),t.length))break e;t.length=0,t.mode=ms;case ms:if(t.flags&2048){if(u===0)break e;p=0;do y=n[e+p++],t.head&&y&&t.length<65536&&(t.head.name+=String.fromCharCode(y));while(y&&p<u);if(t.flags&512&&(t.check=De(t.check)),u-=p,e+=p,y)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=Ss;case Ss:if(t.flags&4096){if(u===0)break e;p=0;do y=n[e+p++],t.head&&y&&t.length<65536&&(t.head.comment+=String.fromCharCode(y));while(y&&p<u);if(t.flags&512&&(t.check=De(t.check)),u-=p,e+=p,y)break e}else t.head&&(t.head.comment=null);t.mode=ws;case ws:if(t.flags&512){for(;_<16;){if(u===0)break e;u--,l+=n[e++]<<_,_+=8}if(l!==(t.check&65535)){r.msg="header crc mismatch",t.mode=we;break}l=0,_=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),r.adler=t.check=0,t.mode=pt;break;case Cs:for(;_<32;){if(u===0)break e;u--,l+=n[e++]<<_,_+=8}r.adler=t.check=Xs(l),l=0,_=0,t.mode=ks;case ks:if(t.havedict===0)return r.next_out=a,r.avail_out=v,r.next_in=e,r.avail_in=u,t.hold=l,t.bits=_,Ia;r.adler=t.check=1,t.mode=pt;case pt:if(i===Pa||i===br)break e;case bn:if(t.last){l>>>=_&7,_-=_&7,t.mode=Sn;break}for(;_<3;){if(u===0)break e;u--,l+=n[e++]<<_,_+=8}switch(t.last=l&1,l>>>=1,_-=1,l&3){case 0:t.mode=Es;break;case 1:if(ec(t),t.mode=mr,i===br){l>>>=2,_-=2;break e}break;case 2:t.mode=As;break;case 3:r.msg="invalid block type",t.mode=we}l>>>=2,_-=2;break;case Es:for(l>>>=_&7,_-=_&7;_<32;){if(u===0)break e;u--,l+=n[e++]<<_,_+=8}if((l&65535)!==(l>>>16^65535)){r.msg="invalid stored block lengths",t.mode=we;break}if(t.length=l&65535,l=0,_=0,t.mode=mn,i===br)break e;case mn:t.mode=Ls;case Ls:if(p=t.length,p){if(p>u&&(p=u),p>v&&(p=v),p===0)break e;yt(d,n,e,p,a),u-=p,e+=p,v-=p,a+=p,t.length-=p;break}t.mode=pt;break;case As:for(;_<14;){if(u===0)break e;u--,l+=n[e++]<<_,_+=8}if(t.nlen=(l&31)+257,l>>>=5,_-=5,t.ndist=(l&31)+1,l>>>=5,_-=5,t.ncode=(l&15)+4,l>>>=4,_-=4,t.nlen>286||t.ndist>30){r.msg="too many length or distance symbols",t.mode=we;break}t.have=0,t.mode=Ms;case Ms:for(;t.have<t.ncode;){for(;_<3;){if(u===0)break e;u--,l+=n[e++]<<_,_+=8}t.lens[A[t.have++]]=l&7,l>>>=3,_-=3}for(;t.have<19;)t.lens[A[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,k={bits:t.lenbits},C=fi(Ka,t.lens,0,19,t.lencode,0,t.work,k),t.lenbits=k.bits,C){r.msg="invalid code lengths set",t.mode=we;break}t.have=0,t.mode=Rs;case Rs:for(;t.have<t.nlen+t.ndist;){for(;x=t.lencode[l&(1<<t.lenbits)-1],h=x>>>24,s=x>>>16&255,c=x&65535,!(h<=_);){if(u===0)break e;u--,l+=n[e++]<<_,_+=8}if(c<16)l>>>=h,_-=h,t.lens[t.have++]=c;else{if(c===16){for(E=h+2;_<E;){if(u===0)break e;u--,l+=n[e++]<<_,_+=8}if(l>>>=h,_-=h,t.have===0){r.msg="invalid bit length repeat",t.mode=we;break}y=t.lens[t.have-1],p=3+(l&3),l>>>=2,_-=2}else if(c===17){for(E=h+3;_<E;){if(u===0)break e;u--,l+=n[e++]<<_,_+=8}l>>>=h,_-=h,y=0,p=3+(l&7),l>>>=3,_-=3}else{for(E=h+7;_<E;){if(u===0)break e;u--,l+=n[e++]<<_,_+=8}l>>>=h,_-=h,y=0,p=11+(l&127),l>>>=7,_-=7}if(t.have+p>t.nlen+t.ndist){r.msg="invalid bit length repeat",t.mode=we;break}for(;p--;)t.lens[t.have++]=y}}if(t.mode===we)break;if(t.lens[256]===0){r.msg="invalid code -- missing end-of-block",t.mode=we;break}if(t.lenbits=9,k={bits:t.lenbits},C=fi(Xo,t.lens,0,t.nlen,t.lencode,0,t.work,k),t.lenbits=k.bits,C){r.msg="invalid literal/lengths set",t.mode=we;break}if(t.distbits=6,t.distcode=t.distdyn,k={bits:t.distbits},C=fi(Io,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,k),t.distbits=k.bits,C){r.msg="invalid distances set",t.mode=we;break}if(t.mode=mr,i===br)break e;case mr:t.mode=Sr;case Sr:if(u>=6&&v>=258){r.next_out=a,r.avail_out=v,r.next_in=e,r.avail_in=u,t.hold=l,t.bits=_,Ta(r,b),a=r.next_out,d=r.output,v=r.avail_out,e=r.next_in,n=r.input,u=r.avail_in,l=t.hold,_=t.bits,t.mode===pt&&(t.back=-1);break}for(t.back=0;x=t.lencode[l&(1<<t.lenbits)-1],h=x>>>24,s=x>>>16&255,c=x&65535,!(h<=_);){if(u===0)break e;u--,l+=n[e++]<<_,_+=8}if(s&&!(s&240)){for(o=h,f=s,m=c;x=t.lencode[m+((l&(1<<o+f)-1)>>o)],h=x>>>24,s=x>>>16&255,c=x&65535,!(o+h<=_);){if(u===0)break e;u--,l+=n[e++]<<_,_+=8}l>>>=o,_-=o,t.back+=o}if(l>>>=h,_-=h,t.back+=h,t.length=c,s===0){t.mode=Os;break}if(s&32){t.back=-1,t.mode=pt;break}if(s&64){r.msg="invalid literal/length code",t.mode=we;break}t.extra=s&15,t.mode=Ts;case Ts:if(t.extra){for(E=t.extra;_<E;){if(u===0)break e;u--,l+=n[e++]<<_,_+=8}t.length+=l&(1<<t.extra)-1,l>>>=t.extra,_-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=Fs;case Fs:for(;x=t.distcode[l&(1<<t.distbits)-1],h=x>>>24,s=x>>>16&255,c=x&65535,!(h<=_);){if(u===0)break e;u--,l+=n[e++]<<_,_+=8}if(!(s&240)){for(o=h,f=s,m=c;x=t.distcode[m+((l&(1<<o+f)-1)>>o)],h=x>>>24,s=x>>>16&255,c=x&65535,!(o+h<=_);){if(u===0)break e;u--,l+=n[e++]<<_,_+=8}l>>>=o,_-=o,t.back+=o}if(l>>>=h,_-=h,t.back+=h,s&64){r.msg="invalid distance code",t.mode=we;break}t.offset=c,t.extra=s&15,t.mode=Ds;case Ds:if(t.extra){for(E=t.extra;_<E;){if(u===0)break e;u--,l+=n[e++]<<_,_+=8}t.offset+=l&(1<<t.extra)-1,l>>>=t.extra,_-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){r.msg="invalid distance too far back",t.mode=we;break}t.mode=Bs;case Bs:if(v===0)break e;if(p=b-v,t.offset>p){if(p=t.offset-p,p>t.whave&&t.sane){r.msg="invalid distance too far back",t.mode=we;break}p>t.wnext?(p-=t.wnext,g=t.wsize-p):g=t.wnext-p,p>t.length&&(p=t.length),w=t.window}else w=d,g=a-t.offset,p=t.length;p>v&&(p=v),v-=p,t.length-=p;do d[a++]=w[g++];while(--p);t.length===0&&(t.mode=Sr);break;case Os:if(v===0)break e;d[a++]=t.length,v--,t.mode=Sr;break;case Sn:if(t.wrap){for(;_<32;){if(u===0)break e;u--,l|=n[e++]<<_,_+=8}if(b-=v,r.total_out+=b,t.total+=b,b&&(r.adler=t.check=t.flags?De(t.check):In(t.check,d,b,a-b)),b=v,(t.flags?l:Xs(l))!==t.check){r.msg="incorrect data check",t.mode=we;break}l=0,_=0}t.mode=Ks;case Ks:if(t.wrap&&t.flags){for(;_<32;){if(u===0)break e;u--,l+=n[e++]<<_,_+=8}if(l!==(t.total&4294967295)){r.msg="incorrect length check",t.mode=we;break}l=0,_=0}t.mode=Ps;case Ps:C=Xa;break e;case we:C=Ha;break e;case Na:return Ua;case Wa:default:return Xt}return r.next_out=a,r.avail_out=v,r.next_in=e,r.avail_in=u,t.hold=l,t.bits=_,(t.wsize||b!==r.avail_out&&t.mode<we&&(t.mode<Sn||i!==ds))&&tc(r,r.output,r.next_out,b-r.avail_out),S-=r.avail_in,b-=r.avail_out,r.total_in+=S,r.total_out+=b,t.total+=b,t.wrap&&b&&(r.adler=t.check=t.flags?De(t.check,d,b,r.next_out-b):In(t.check,d,b,r.next_out-b)),r.data_type=t.bits+(t.last?64:0)+(t.mode===pt?128:0)+(t.mode===mr||t.mode===mn?256:0),(S===0&&b===0||i===ds)&&C===Xr&&(C=ja),C}function jo(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}class Wn{constructor(){this.strm=new jo,this.chunkSize=1024*10*10,this.strm.output=new Uint8Array(this.chunkSize),this.windowBits=5,$a(this.strm,this.windowBits)}setInput(i){i?(this.strm.input=i,this.strm.avail_in=this.strm.input.length,this.strm.next_in=0):(this.strm.input=null,this.strm.avail_in=0,this.strm.next_in=0)}inflate(i){if(i>this.chunkSize&&(this.chunkSize=i,this.strm.output=new Uint8Array(this.chunkSize)),this.strm.next_out=0,this.strm.avail_out=i,ic(this.strm,0)<0)throw new Error("zlib inflate failed");if(this.strm.next_out!=i)throw new Error("Incomplete zlib block");return new Uint8Array(this.strm.output.buffer,0,this.strm.next_out)}reset(){Uo(this.strm)}}var rc=4,Hs=0,Us=1,nc=2;function Zt(r){for(var i=r.length;--i>=0;)r[i]=0}var sc=0,No=1,oc=2,ac=3,cc=258,zn=29,xi=256,pi=xi+1+zn,Vt=30,qn=19,Wo=2*pi+1,Pt=15,kn=16,lc=7,Qn=256,zo=16,qo=17,Qo=18,Hn=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Fr=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],hc=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Vo=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],uc=512,gt=new Array((pi+2)*2);Zt(gt);var _i=new Array(Vt*2);Zt(_i);var vi=new Array(uc);Zt(vi);var gi=new Array(cc-ac+1);Zt(gi);var Vn=new Array(zn);Zt(Vn);var Ir=new Array(Vt);Zt(Ir);function En(r,i,t,n,d){this.static_tree=r,this.extra_bits=i,this.extra_base=t,this.elems=n,this.max_length=d,this.has_stree=r&&r.length}var Go,Zo,Yo;function Ln(r,i){this.dyn_tree=r,this.max_code=0,this.stat_desc=i}function Jo(r){return r<256?vi[r]:vi[256+(r>>>7)]}function yi(r,i){r.pending_buf[r.pending++]=i&255,r.pending_buf[r.pending++]=i>>>8&255}function Ve(r,i,t){r.bi_valid>kn-t?(r.bi_buf|=i<<r.bi_valid&65535,yi(r,r.bi_buf),r.bi_buf=i>>kn-r.bi_valid,r.bi_valid+=t-kn):(r.bi_buf|=i<<r.bi_valid&65535,r.bi_valid+=t)}function _t(r,i,t){Ve(r,t[i*2],t[i*2+1])}function $o(r,i){var t=0;do t|=r&1,r>>>=1,t<<=1;while(--i>0);return t>>>1}function fc(r){r.bi_valid===16?(yi(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=r.bi_buf&255,r.bi_buf>>=8,r.bi_valid-=8)}function _c(r,i){var t=i.dyn_tree,n=i.max_code,d=i.stat_desc.static_tree,e=i.stat_desc.has_stree,a=i.stat_desc.extra_bits,u=i.stat_desc.extra_base,v=i.stat_desc.max_length,l,_,S,b,p,g,w=0;for(b=0;b<=Pt;b++)r.bl_count[b]=0;for(t[r.heap[r.heap_max]*2+1]=0,l=r.heap_max+1;l<Wo;l++)_=r.heap[l],b=t[t[_*2+1]*2+1]+1,b>v&&(b=v,w++),t[_*2+1]=b,!(_>n)&&(r.bl_count[b]++,p=0,_>=u&&(p=a[_-u]),g=t[_*2],r.opt_len+=g*(b+p),e&&(r.static_len+=g*(d[_*2+1]+p)));if(w!==0){do{for(b=v-1;r.bl_count[b]===0;)b--;r.bl_count[b]--,r.bl_count[b+1]+=2,r.bl_count[v]--,w-=2}while(w>0);for(b=v;b!==0;b--)for(_=r.bl_count[b];_!==0;)S=r.heap[--l],!(S>n)&&(t[S*2+1]!==b&&(r.opt_len+=(b-t[S*2+1])*t[S*2],t[S*2+1]=b),_--)}}function ea(r,i,t){var n=new Array(Pt+1),d=0,e,a;for(e=1;e<=Pt;e++)n[e]=d=d+t[e-1]<<1;for(a=0;a<=i;a++){var u=r[a*2+1];u!==0&&(r[a*2]=$o(n[u]++,u))}}function dc(){var r,i,t,n,d,e=new Array(Pt+1);for(t=0,n=0;n<zn-1;n++)for(Vn[n]=t,r=0;r<1<<Hn[n];r++)gi[t++]=n;for(gi[t-1]=n,d=0,n=0;n<16;n++)for(Ir[n]=d,r=0;r<1<<Fr[n];r++)vi[d++]=n;for(d>>=7;n<Vt;n++)for(Ir[n]=d<<7,r=0;r<1<<Fr[n]-7;r++)vi[256+d++]=n;for(i=0;i<=Pt;i++)e[i]=0;for(r=0;r<=143;)gt[r*2+1]=8,r++,e[8]++;for(;r<=255;)gt[r*2+1]=9,r++,e[9]++;for(;r<=279;)gt[r*2+1]=7,r++,e[7]++;for(;r<=287;)gt[r*2+1]=8,r++,e[8]++;for(ea(gt,pi+1,e),r=0;r<Vt;r++)_i[r*2+1]=5,_i[r*2]=$o(r,5);Go=new En(gt,Hn,xi+1,pi,Pt),Zo=new En(_i,Fr,0,Vt,Pt),Yo=new En(new Array(0),hc,0,qn,lc)}function ta(r){var i;for(i=0;i<pi;i++)r.dyn_ltree[i*2]=0;for(i=0;i<Vt;i++)r.dyn_dtree[i*2]=0;for(i=0;i<qn;i++)r.bl_tree[i*2]=0;r.dyn_ltree[Qn*2]=1,r.opt_len=r.static_len=0,r.last_lit=r.matches=0}function ia(r){r.bi_valid>8?yi(r,r.bi_buf):r.bi_valid>0&&(r.pending_buf[r.pending++]=r.bi_buf),r.bi_buf=0,r.bi_valid=0}function pc(r,i,t,n){ia(r),n&&(yi(r,t),yi(r,~t)),yt(r.pending_buf,r.window,i,t,r.pending),r.pending+=t}function js(r,i,t,n){var d=i*2,e=t*2;return r[d]<r[e]||r[d]===r[e]&&n[i]<=n[t]}function An(r,i,t){for(var n=r.heap[t],d=t<<1;d<=r.heap_len&&(d<r.heap_len&&js(i,r.heap[d+1],r.heap[d],r.depth)&&d++,!js(i,n,r.heap[d],r.depth));)r.heap[t]=r.heap[d],t=d,d<<=1;r.heap[t]=n}function Ns(r,i,t){var n,d,e=0,a,u;if(r.last_lit!==0)do n=r.pending_buf[r.d_buf+e*2]<<8|r.pending_buf[r.d_buf+e*2+1],d=r.pending_buf[r.l_buf+e],e++,n===0?_t(r,d,i):(a=gi[d],_t(r,a+xi+1,i),u=Hn[a],u!==0&&(d-=Vn[a],Ve(r,d,u)),n--,a=Jo(n),_t(r,a,t),u=Fr[a],u!==0&&(n-=Ir[a],Ve(r,n,u)));while(e<r.last_lit);_t(r,Qn,i)}function Un(r,i){var t=i.dyn_tree,n=i.stat_desc.static_tree,d=i.stat_desc.has_stree,e=i.stat_desc.elems,a,u,v=-1,l;for(r.heap_len=0,r.heap_max=Wo,a=0;a<e;a++)t[a*2]!==0?(r.heap[++r.heap_len]=v=a,r.depth[a]=0):t[a*2+1]=0;for(;r.heap_len<2;)l=r.heap[++r.heap_len]=v<2?++v:0,t[l*2]=1,r.depth[l]=0,r.opt_len--,d&&(r.static_len-=n[l*2+1]);for(i.max_code=v,a=r.heap_len>>1;a>=1;a--)An(r,t,a);l=e;do a=r.heap[1],r.heap[1]=r.heap[r.heap_len--],An(r,t,1),u=r.heap[1],r.heap[--r.heap_max]=a,r.heap[--r.heap_max]=u,t[l*2]=t[a*2]+t[u*2],r.depth[l]=(r.depth[a]>=r.depth[u]?r.depth[a]:r.depth[u])+1,t[a*2+1]=t[u*2+1]=l,r.heap[1]=l++,An(r,t,1);while(r.heap_len>=2);r.heap[--r.heap_max]=r.heap[1],_c(r,i),ea(t,v,r.bl_count)}function Ws(r,i,t){var n,d=-1,e,a=i[0*2+1],u=0,v=7,l=4;for(a===0&&(v=138,l=3),i[(t+1)*2+1]=65535,n=0;n<=t;n++)e=a,a=i[(n+1)*2+1],!(++u<v&&e===a)&&(u<l?r.bl_tree[e*2]+=u:e!==0?(e!==d&&r.bl_tree[e*2]++,r.bl_tree[zo*2]++):u<=10?r.bl_tree[qo*2]++:r.bl_tree[Qo*2]++,u=0,d=e,a===0?(v=138,l=3):e===a?(v=6,l=3):(v=7,l=4))}function zs(r,i,t){var n,d=-1,e,a=i[0*2+1],u=0,v=7,l=4;for(a===0&&(v=138,l=3),n=0;n<=t;n++)if(e=a,a=i[(n+1)*2+1],!(++u<v&&e===a)){if(u<l)do _t(r,e,r.bl_tree);while(--u!==0);else e!==0?(e!==d&&(_t(r,e,r.bl_tree),u--),_t(r,zo,r.bl_tree),Ve(r,u-3,2)):u<=10?(_t(r,qo,r.bl_tree),Ve(r,u-3,3)):(_t(r,Qo,r.bl_tree),Ve(r,u-11,7));u=0,d=e,a===0?(v=138,l=3):e===a?(v=6,l=3):(v=7,l=4)}}function vc(r){var i;for(Ws(r,r.dyn_ltree,r.l_desc.max_code),Ws(r,r.dyn_dtree,r.d_desc.max_code),Un(r,r.bl_desc),i=qn-1;i>=3&&r.bl_tree[Vo[i]*2+1]===0;i--);return r.opt_len+=3*(i+1)+5+5+4,i}function gc(r,i,t,n){var d;for(Ve(r,i-257,5),Ve(r,t-1,5),Ve(r,n-4,4),d=0;d<n;d++)Ve(r,r.bl_tree[Vo[d]*2+1],3);zs(r,r.dyn_ltree,i-1),zs(r,r.dyn_dtree,t-1)}function yc(r){var i=4093624447,t;for(t=0;t<=31;t++,i>>>=1)if(i&1&&r.dyn_ltree[t*2]!==0)return Hs;if(r.dyn_ltree[9*2]!==0||r.dyn_ltree[10*2]!==0||r.dyn_ltree[13*2]!==0)return Us;for(t=32;t<xi;t++)if(r.dyn_ltree[t*2]!==0)return Us;return Hs}var qs=!1;function xc(r){qs||(dc(),qs=!0),r.l_desc=new Ln(r.dyn_ltree,Go),r.d_desc=new Ln(r.dyn_dtree,Zo),r.bl_desc=new Ln(r.bl_tree,Yo),r.bi_buf=0,r.bi_valid=0,ta(r)}function ra(r,i,t,n){Ve(r,(sc<<1)+(n?1:0),3),pc(r,i,t,!0)}function bc(r){Ve(r,No<<1,3),_t(r,Qn,gt),fc(r)}function mc(r,i,t,n){var d,e,a=0;r.level>0?(r.strm.data_type===nc&&(r.strm.data_type=yc(r)),Un(r,r.l_desc),Un(r,r.d_desc),a=vc(r),d=r.opt_len+3+7>>>3,e=r.static_len+3+7>>>3,e<=d&&(d=e)):d=e=t+5,t+4<=d&&i!==-1?ra(r,i,t,n):r.strategy===rc||e===d?(Ve(r,(No<<1)+(n?1:0),3),Ns(r,gt,_i)):(Ve(r,(oc<<1)+(n?1:0),3),gc(r,r.l_desc.max_code+1,r.d_desc.max_code+1,a+1),Ns(r,r.dyn_ltree,r.dyn_dtree)),ta(r),n&&ia(r)}function At(r,i,t){return r.pending_buf[r.d_buf+r.last_lit*2]=i>>>8&255,r.pending_buf[r.d_buf+r.last_lit*2+1]=i&255,r.pending_buf[r.l_buf+r.last_lit]=t&255,r.last_lit++,i===0?r.dyn_ltree[t*2]++:(r.matches++,i--,r.dyn_ltree[(gi[t]+xi+1)*2]++,r.dyn_dtree[Jo(i)*2]++),r.last_lit===r.lit_bufsize-1}var Sc={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};const Ht=0,wc=1,jn=3,Mt=4,Qs=5,Ot=0,Vs=1,Gt=-2,Mn=-5,Cc=-1,kc=1,wr=2,Ec=3,Lc=4,Ac=0,Mc=2,Nr=8;var Rc=9,Tc=15,Fc=8,Dc=29,Bc=256,Nn=Bc+1+Dc,Oc=30,Kc=19,Pc=2*Nn+1,Xc=15,ge=3,Et=258,nt=Et+ge+1,Ic=32,na=42,Gs=69,Rn=73,Tn=91,Fn=103,hi=113,Cr=666,Be=1,bi=2,It=3,Yt=4,Hc=3;function qt(r,i){return r.msg=Sc[i],i}function Zs(r){return(r<<1)-(r>4?9:0)}function Kt(r){for(var i=r.length;--i>=0;)r[i]=0}function kt(r){var i=r.state,t=i.pending;t>r.avail_out&&(t=r.avail_out),t!==0&&(yt(r.output,i.pending_buf,i.pending_out,t,r.next_out),r.next_out+=t,i.pending_out+=t,r.total_out+=t,r.avail_out-=t,i.pending-=t,i.pending===0&&(i.pending_out=0))}function Oe(r,i){mc(r,r.block_start>=0?r.block_start:-1,r.strstart-r.block_start,i),r.block_start=r.strstart,kt(r.strm)}function ve(r,i){r.pending_buf[r.pending++]=i}function ii(r,i){r.pending_buf[r.pending++]=i>>>8&255,r.pending_buf[r.pending++]=i&255}function Uc(r,i,t,n){var d=r.avail_in;return d>n&&(d=n),d===0?0:(r.avail_in-=d,yt(i,r.input,r.next_in,d,t),r.state.wrap===1?r.adler=In(r.adler,i,d,t):r.state.wrap===2&&(r.adler=De(r.adler)),r.next_in+=d,r.total_in+=d,d)}function sa(r,i){var t=r.max_chain_length,n=r.strstart,d,e,a=r.prev_length,u=r.nice_match,v=r.strstart>r.w_size-nt?r.strstart-(r.w_size-nt):0,l=r.window,_=r.w_mask,S=r.prev,b=r.strstart+Et,p=l[n+a-1],g=l[n+a];r.prev_length>=r.good_match&&(t>>=2),u>r.lookahead&&(u=r.lookahead);do if(d=i,!(l[d+a]!==g||l[d+a-1]!==p||l[d]!==l[n]||l[++d]!==l[n+1])){n+=2,d++;do;while(l[++n]===l[++d]&&l[++n]===l[++d]&&l[++n]===l[++d]&&l[++n]===l[++d]&&l[++n]===l[++d]&&l[++n]===l[++d]&&l[++n]===l[++d]&&l[++n]===l[++d]&&n<b);if(e=Et-(b-n),n=b-Et,e>a){if(r.match_start=i,a=e,e>=u)break;p=l[n+a-1],g=l[n+a]}}while((i=S[i&_])>v&&--t!==0);return a<=r.lookahead?a:r.lookahead}function mi(r){var i=r.w_size,t,n,d,e,a;do{if(e=r.window_size-r.lookahead-r.strstart,r.strstart>=i+(i-nt)){yt(r.window,r.window,i,i,0),r.match_start-=i,r.strstart-=i,r.block_start-=i,n=r.hash_size,t=n;do d=r.head[--t],r.head[t]=d>=i?d-i:0;while(--n);n=i,t=n;do d=r.prev[--t],r.prev[t]=d>=i?d-i:0;while(--n);e+=i}if(r.strm.avail_in===0)break;if(n=Uc(r.strm,r.window,r.strstart+r.lookahead,e),r.lookahead+=n,r.lookahead+r.insert>=ge)for(a=r.strstart-r.insert,r.ins_h=r.window[a],r.ins_h=(r.ins_h<<r.hash_shift^r.window[a+1])&r.hash_mask;r.insert&&(r.ins_h=(r.ins_h<<r.hash_shift^r.window[a+ge-1])&r.hash_mask,r.prev[a&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=a,a++,r.insert--,!(r.lookahead+r.insert<ge)););}while(r.lookahead<nt&&r.strm.avail_in!==0)}function jc(r,i){var t=65535;for(t>r.pending_buf_size-5&&(t=r.pending_buf_size-5);;){if(r.lookahead<=1){if(mi(r),r.lookahead===0&&i===Ht)return Be;if(r.lookahead===0)break}r.strstart+=r.lookahead,r.lookahead=0;var n=r.block_start+t;if((r.strstart===0||r.strstart>=n)&&(r.lookahead=r.strstart-n,r.strstart=n,Oe(r,!1),r.strm.avail_out===0)||r.strstart-r.block_start>=r.w_size-nt&&(Oe(r,!1),r.strm.avail_out===0))return Be}return r.insert=0,i===Mt?(Oe(r,!0),r.strm.avail_out===0?It:Yt):(r.strstart>r.block_start&&(Oe(r,!1),r.strm.avail_out===0),Be)}function Dn(r,i){for(var t,n;;){if(r.lookahead<nt){if(mi(r),r.lookahead<nt&&i===Ht)return Be;if(r.lookahead===0)break}if(t=0,r.lookahead>=ge&&(r.ins_h=(r.ins_h<<r.hash_shift^r.window[r.strstart+ge-1])&r.hash_mask,t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),t!==0&&r.strstart-t<=r.w_size-nt&&(r.match_length=sa(r,t)),r.match_length>=ge)if(n=At(r,r.strstart-r.match_start,r.match_length-ge),r.lookahead-=r.match_length,r.match_length<=r.max_lazy_match&&r.lookahead>=ge){r.match_length--;do r.strstart++,r.ins_h=(r.ins_h<<r.hash_shift^r.window[r.strstart+ge-1])&r.hash_mask,t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart;while(--r.match_length!==0);r.strstart++}else r.strstart+=r.match_length,r.match_length=0,r.ins_h=r.window[r.strstart],r.ins_h=(r.ins_h<<r.hash_shift^r.window[r.strstart+1])&r.hash_mask;else n=At(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++;if(n&&(Oe(r,!1),r.strm.avail_out===0))return Be}return r.insert=r.strstart<ge-1?r.strstart:ge-1,i===Mt?(Oe(r,!0),r.strm.avail_out===0?It:Yt):r.last_lit&&(Oe(r,!1),r.strm.avail_out===0)?Be:bi}function zt(r,i){for(var t,n,d;;){if(r.lookahead<nt){if(mi(r),r.lookahead<nt&&i===Ht)return Be;if(r.lookahead===0)break}if(t=0,r.lookahead>=ge&&(r.ins_h=(r.ins_h<<r.hash_shift^r.window[r.strstart+ge-1])&r.hash_mask,t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),r.prev_length=r.match_length,r.prev_match=r.match_start,r.match_length=ge-1,t!==0&&r.prev_length<r.max_lazy_match&&r.strstart-t<=r.w_size-nt&&(r.match_length=sa(r,t),r.match_length<=5&&(r.strategy===kc||r.match_length===ge&&r.strstart-r.match_start>4096)&&(r.match_length=ge-1)),r.prev_length>=ge&&r.match_length<=r.prev_length){d=r.strstart+r.lookahead-ge,n=At(r,r.strstart-1-r.prev_match,r.prev_length-ge),r.lookahead-=r.prev_length-1,r.prev_length-=2;do++r.strstart<=d&&(r.ins_h=(r.ins_h<<r.hash_shift^r.window[r.strstart+ge-1])&r.hash_mask,t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart);while(--r.prev_length!==0);if(r.match_available=0,r.match_length=ge-1,r.strstart++,n&&(Oe(r,!1),r.strm.avail_out===0))return Be}else if(r.match_available){if(n=At(r,0,r.window[r.strstart-1]),n&&Oe(r,!1),r.strstart++,r.lookahead--,r.strm.avail_out===0)return Be}else r.match_available=1,r.strstart++,r.lookahead--}return r.match_available&&(n=At(r,0,r.window[r.strstart-1]),r.match_available=0),r.insert=r.strstart<ge-1?r.strstart:ge-1,i===Mt?(Oe(r,!0),r.strm.avail_out===0?It:Yt):r.last_lit&&(Oe(r,!1),r.strm.avail_out===0)?Be:bi}function Nc(r,i){for(var t,n,d,e,a=r.window;;){if(r.lookahead<=Et){if(mi(r),r.lookahead<=Et&&i===Ht)return Be;if(r.lookahead===0)break}if(r.match_length=0,r.lookahead>=ge&&r.strstart>0&&(d=r.strstart-1,n=a[d],n===a[++d]&&n===a[++d]&&n===a[++d])){e=r.strstart+Et;do;while(n===a[++d]&&n===a[++d]&&n===a[++d]&&n===a[++d]&&n===a[++d]&&n===a[++d]&&n===a[++d]&&n===a[++d]&&d<e);r.match_length=Et-(e-d),r.match_length>r.lookahead&&(r.match_length=r.lookahead)}if(r.match_length>=ge?(t=At(r,1,r.match_length-ge),r.lookahead-=r.match_length,r.strstart+=r.match_length,r.match_length=0):(t=At(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++),t&&(Oe(r,!1),r.strm.avail_out===0))return Be}return r.insert=0,i===Mt?(Oe(r,!0),r.strm.avail_out===0?It:Yt):r.last_lit&&(Oe(r,!1),r.strm.avail_out===0)?Be:bi}function Wc(r,i){for(var t;;){if(r.lookahead===0&&(mi(r),r.lookahead===0)){if(i===Ht)return Be;break}if(r.match_length=0,t=At(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++,t&&(Oe(r,!1),r.strm.avail_out===0))return Be}return r.insert=0,i===Mt?(Oe(r,!0),r.strm.avail_out===0?It:Yt):r.last_lit&&(Oe(r,!1),r.strm.avail_out===0)?Be:bi}function ht(r,i,t,n,d){this.good_length=r,this.max_lazy=i,this.nice_length=t,this.max_chain=n,this.func=d}var Qt;Qt=[new ht(0,0,0,0,jc),new ht(4,4,8,4,Dn),new ht(4,5,16,8,Dn),new ht(4,6,32,32,Dn),new ht(4,4,16,16,zt),new ht(8,16,32,32,zt),new ht(8,16,128,128,zt),new ht(8,32,128,256,zt),new ht(32,128,258,1024,zt),new ht(32,258,258,4096,zt)];function zc(r){r.window_size=2*r.w_size,Kt(r.head),r.max_lazy_match=Qt[r.level].max_lazy,r.good_match=Qt[r.level].good_length,r.nice_match=Qt[r.level].nice_length,r.max_chain_length=Qt[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=ge-1,r.match_available=0,r.ins_h=0}function qc(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Nr,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new et(Pc*2),this.dyn_dtree=new et((2*Oc+1)*2),this.bl_tree=new et((2*Kc+1)*2),Kt(this.dyn_ltree),Kt(this.dyn_dtree),Kt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new et(Xc+1),this.heap=new et(2*Nn+1),Kt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new et(2*Nn+1),Kt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Qc(r){var i;return!r||!r.state?qt(r,Gt):(r.total_in=r.total_out=0,r.data_type=Mc,i=r.state,i.pending=0,i.pending_out=0,i.wrap<0&&(i.wrap=-i.wrap),i.status=i.wrap?na:hi,r.adler=i.wrap===2?0:1,i.last_flush=Ht,xc(i),Ot)}function Vc(r){var i=Qc(r);return i===Ot&&zc(r.state),i}function Gc(r,i,t,n,d,e){if(!r)return Gt;var a=1;if(i===Cc&&(i=6),n<0?(a=0,n=-n):n>15&&(a=2,n-=16),d<1||d>Rc||t!==Nr||n<8||n>15||i<0||i>9||e<0||e>Lc)return qt(r,Gt);n===8&&(n=9);var u=new qc;return r.state=u,u.strm=r,u.wrap=a,u.gzhead=null,u.w_bits=n,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=d+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+ge-1)/ge),u.window=new Kr(u.w_size*2),u.head=new et(u.hash_size),u.prev=new et(u.w_size),u.lit_bufsize=1<<d+6,u.pending_buf_size=u.lit_bufsize*4,u.pending_buf=new Kr(u.pending_buf_size),u.d_buf=1*u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=i,u.strategy=e,u.method=t,Vc(r)}function Zc(r,i){return Gc(r,i,Nr,Tc,Fc,Ac)}function Ys(r,i){var t,n,d,e;if(!r||!r.state||i>Qs||i<0)return r?qt(r,Gt):Gt;if(n=r.state,!r.output||!r.input&&r.avail_in!==0||n.status===Cr&&i!==Mt)return qt(r,r.avail_out===0?Mn:Gt);if(n.strm=r,t=n.last_flush,n.last_flush=i,n.status===na)if(n.wrap===2)r.adler=0,ve(n,31),ve(n,139),ve(n,8),n.gzhead?(ve(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),ve(n,n.gzhead.time&255),ve(n,n.gzhead.time>>8&255),ve(n,n.gzhead.time>>16&255),ve(n,n.gzhead.time>>24&255),ve(n,n.level===9?2:n.strategy>=wr||n.level<2?4:0),ve(n,n.gzhead.os&255),n.gzhead.extra&&n.gzhead.extra.length&&(ve(n,n.gzhead.extra.length&255),ve(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(r.adler=De(r.adler,n.pending_buf,n.pending)),n.gzindex=0,n.status=Gs):(ve(n,0),ve(n,0),ve(n,0),ve(n,0),ve(n,0),ve(n,n.level===9?2:n.strategy>=wr||n.level<2?4:0),ve(n,Hc),n.status=hi);else{var a=Nr+(n.w_bits-8<<4)<<8,u=-1;n.strategy>=wr||n.level<2?u=0:n.level<6?u=1:n.level===6?u=2:u=3,a|=u<<6,n.strstart!==0&&(a|=Ic),a+=31-a%31,n.status=hi,ii(n,a),n.strstart!==0&&(ii(n,r.adler>>>16),ii(n,r.adler&65535)),r.adler=1}if(n.status===Gs)if(n.gzhead.extra){for(d=n.pending;n.gzindex<(n.gzhead.extra.length&65535)&&!(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>d&&(r.adler=De(r.adler,n.pending_buf,n.pending-d)),kt(r),d=n.pending,n.pending===n.pending_buf_size));)ve(n,n.gzhead.extra[n.gzindex]&255),n.gzindex++;n.gzhead.hcrc&&n.pending>d&&(r.adler=De(r.adler,n.pending_buf,n.pending-d)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=Rn)}else n.status=Rn;if(n.status===Rn)if(n.gzhead.name){d=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>d&&(r.adler=De(r.adler,n.pending_buf,n.pending-d)),kt(r),d=n.pending,n.pending===n.pending_buf_size)){e=1;break}n.gzindex<n.gzhead.name.length?e=n.gzhead.name.charCodeAt(n.gzindex++)&255:e=0,ve(n,e)}while(e!==0);n.gzhead.hcrc&&n.pending>d&&(r.adler=De(r.adler,n.pending_buf,n.pending-d)),e===0&&(n.gzindex=0,n.status=Tn)}else n.status=Tn;if(n.status===Tn)if(n.gzhead.comment){d=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>d&&(r.adler=De(r.adler,n.pending_buf,n.pending-d)),kt(r),d=n.pending,n.pending===n.pending_buf_size)){e=1;break}n.gzindex<n.gzhead.comment.length?e=n.gzhead.comment.charCodeAt(n.gzindex++)&255:e=0,ve(n,e)}while(e!==0);n.gzhead.hcrc&&n.pending>d&&(r.adler=De(r.adler,n.pending_buf,n.pending-d)),e===0&&(n.status=Fn)}else n.status=Fn;if(n.status===Fn&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&kt(r),n.pending+2<=n.pending_buf_size&&(ve(n,r.adler&255),ve(n,r.adler>>8&255),r.adler=0,n.status=hi)):n.status=hi),n.pending!==0){if(kt(r),r.avail_out===0)return n.last_flush=-1,Ot}else if(r.avail_in===0&&Zs(i)<=Zs(t)&&i!==Mt)return qt(r,Mn);if(n.status===Cr&&r.avail_in!==0)return qt(r,Mn);if(r.avail_in!==0||n.lookahead!==0||i!==Ht&&n.status!==Cr){var v=n.strategy===wr?Wc(n,i):n.strategy===Ec?Nc(n,i):Qt[n.level].func(n,i);if((v===It||v===Yt)&&(n.status=Cr),v===Be||v===It)return r.avail_out===0&&(n.last_flush=-1),Ot;if(v===bi&&(i===wc?bc(n):i!==Qs&&(ra(n,0,0,!1),i===jn&&(Kt(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),kt(r),r.avail_out===0))return n.last_flush=-1,Ot}return i!==Mt?Ot:n.wrap<=0?Vs:(n.wrap===2?(ve(n,r.adler&255),ve(n,r.adler>>8&255),ve(n,r.adler>>16&255),ve(n,r.adler>>24&255),ve(n,r.total_in&255),ve(n,r.total_in>>8&255),ve(n,r.total_in>>16&255),ve(n,r.total_in>>24&255)):(ii(n,r.adler>>>16),ii(n,r.adler&65535)),kt(r),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?Ot:Vs)}class Yc{constructor(){this.strm=new jo,this.chunkSize=1024*10*10,this.outputBuffer=new Uint8Array(this.chunkSize),this.windowBits=5,Zc(this.strm,this.windowBits)}deflate(i){this.strm.input=i,this.strm.avail_in=this.strm.input.length,this.strm.next_in=0,this.strm.output=this.outputBuffer,this.strm.avail_out=this.chunkSize,this.strm.next_out=0;let t=Ys(this.strm,jn),n=new Uint8Array(this.strm.output.buffer,0,this.strm.next_out);if(t<0)throw new Error("zlib deflate failed");if(this.strm.avail_in>0){let d=[n],e=n.length;do{if(this.strm.output=new Uint8Array(this.chunkSize),this.strm.next_out=0,this.strm.avail_out=this.chunkSize,t=Ys(this.strm,jn),t<0)throw new Error("zlib deflate failed");let v=new Uint8Array(this.strm.output.buffer,0,this.strm.next_out);e+=v.length,d.push(v)}while(this.strm.avail_in>0);let a=new Uint8Array(e),u=0;for(let v=0;v<d.length;v++)a.set(d[v],u),u+=d[v].length;n=a}return this.strm.input=null,this.strm.avail_in=0,this.strm.next_in=0,n}}var P={XK_VoidSymbol:16777215,XK_BackSpace:65288,XK_Tab:65289,XK_Linefeed:65290,XK_Clear:65291,XK_Return:65293,XK_Pause:65299,XK_Scroll_Lock:65300,XK_Sys_Req:65301,XK_Escape:65307,XK_Delete:65535,XK_Multi_key:65312,XK_Codeinput:65335,XK_SingleCandidate:65340,XK_MultipleCandidate:65341,XK_PreviousCandidate:65342,XK_Kanji:65313,XK_Muhenkan:65314,XK_Henkan_Mode:65315,XK_Henkan:65315,XK_Romaji:65316,XK_Hiragana:65317,XK_Katakana:65318,XK_Hiragana_Katakana:65319,XK_Zenkaku:65320,XK_Hankaku:65321,XK_Zenkaku_Hankaku:65322,XK_Touroku:65323,XK_Massyo:65324,XK_Kana_Lock:65325,XK_Kana_Shift:65326,XK_Eisu_Shift:65327,XK_Eisu_toggle:65328,XK_Kanji_Bangou:65335,XK_Zen_Koho:65341,XK_Mae_Koho:65342,XK_Home:65360,XK_Left:65361,XK_Up:65362,XK_Right:65363,XK_Down:65364,XK_Prior:65365,XK_Page_Up:65365,XK_Next:65366,XK_Page_Down:65366,XK_End:65367,XK_Begin:65368,XK_Select:65376,XK_Print:65377,XK_Execute:65378,XK_Insert:65379,XK_Undo:65381,XK_Redo:65382,XK_Menu:65383,XK_Find:65384,XK_Cancel:65385,XK_Help:65386,XK_Break:65387,XK_Mode_switch:65406,XK_script_switch:65406,XK_Num_Lock:65407,XK_KP_Space:65408,XK_KP_Tab:65417,XK_KP_Enter:65421,XK_KP_F1:65425,XK_KP_F2:65426,XK_KP_F3:65427,XK_KP_F4:65428,XK_KP_Home:65429,XK_KP_Left:65430,XK_KP_Up:65431,XK_KP_Right:65432,XK_KP_Down:65433,XK_KP_Prior:65434,XK_KP_Page_Up:65434,XK_KP_Next:65435,XK_KP_Page_Down:65435,XK_KP_End:65436,XK_KP_Begin:65437,XK_KP_Insert:65438,XK_KP_Delete:65439,XK_KP_Equal:65469,XK_KP_Multiply:65450,XK_KP_Add:65451,XK_KP_Separator:65452,XK_KP_Subtract:65453,XK_KP_Decimal:65454,XK_KP_Divide:65455,XK_KP_0:65456,XK_KP_1:65457,XK_KP_2:65458,XK_KP_3:65459,XK_KP_4:65460,XK_KP_5:65461,XK_KP_6:65462,XK_KP_7:65463,XK_KP_8:65464,XK_KP_9:65465,XK_F1:65470,XK_F2:65471,XK_F3:65472,XK_F4:65473,XK_F5:65474,XK_F6:65475,XK_F7:65476,XK_F8:65477,XK_F9:65478,XK_F10:65479,XK_F11:65480,XK_L1:65480,XK_F12:65481,XK_L2:65481,XK_F13:65482,XK_L3:65482,XK_F14:65483,XK_L4:65483,XK_F15:65484,XK_L5:65484,XK_F16:65485,XK_L6:65485,XK_F17:65486,XK_L7:65486,XK_F18:65487,XK_L8:65487,XK_F19:65488,XK_L9:65488,XK_F20:65489,XK_L10:65489,XK_F21:65490,XK_R1:65490,XK_F22:65491,XK_R2:65491,XK_F23:65492,XK_R3:65492,XK_F24:65493,XK_R4:65493,XK_F25:65494,XK_R5:65494,XK_F26:65495,XK_R6:65495,XK_F27:65496,XK_R7:65496,XK_F28:65497,XK_R8:65497,XK_F29:65498,XK_R9:65498,XK_F30:65499,XK_R10:65499,XK_F31:65500,XK_R11:65500,XK_F32:65501,XK_R12:65501,XK_F33:65502,XK_R13:65502,XK_F34:65503,XK_R14:65503,XK_F35:65504,XK_R15:65504,XK_Shift_L:65505,XK_Shift_R:65506,XK_Control_L:65507,XK_Control_R:65508,XK_Caps_Lock:65509,XK_Shift_Lock:65510,XK_Meta_L:65511,XK_Meta_R:65512,XK_Alt_L:65513,XK_Alt_R:65514,XK_Super_L:65515,XK_Super_R:65516,XK_Hyper_L:65517,XK_Hyper_R:65518,XK_ISO_Level3_Shift:65027,XK_ISO_Next_Group:65032,XK_ISO_Prev_Group:65034,XK_ISO_First_Group:65036,XK_ISO_Last_Group:65038,XK_space:32,XK_exclam:33,XK_quotedbl:34,XK_numbersign:35,XK_dollar:36,XK_percent:37,XK_ampersand:38,XK_apostrophe:39,XK_quoteright:39,XK_parenleft:40,XK_parenright:41,XK_asterisk:42,XK_plus:43,XK_comma:44,XK_minus:45,XK_period:46,XK_slash:47,XK_0:48,XK_1:49,XK_2:50,XK_3:51,XK_4:52,XK_5:53,XK_6:54,XK_7:55,XK_8:56,XK_9:57,XK_colon:58,XK_semicolon:59,XK_less:60,XK_equal:61,XK_greater:62,XK_question:63,XK_at:64,XK_A:65,XK_B:66,XK_C:67,XK_D:68,XK_E:69,XK_F:70,XK_G:71,XK_H:72,XK_I:73,XK_J:74,XK_K:75,XK_L:76,XK_M:77,XK_N:78,XK_O:79,XK_P:80,XK_Q:81,XK_R:82,XK_S:83,XK_T:84,XK_U:85,XK_V:86,XK_W:87,XK_X:88,XK_Y:89,XK_Z:90,XK_bracketleft:91,XK_backslash:92,XK_bracketright:93,XK_asciicircum:94,XK_underscore:95,XK_grave:96,XK_quoteleft:96,XK_a:97,XK_b:98,XK_c:99,XK_d:100,XK_e:101,XK_f:102,XK_g:103,XK_h:104,XK_i:105,XK_j:106,XK_k:107,XK_l:108,XK_m:109,XK_n:110,XK_o:111,XK_p:112,XK_q:113,XK_r:114,XK_s:115,XK_t:116,XK_u:117,XK_v:118,XK_w:119,XK_x:120,XK_y:121,XK_z:122,XK_braceleft:123,XK_bar:124,XK_braceright:125,XK_asciitilde:126,XK_nobreakspace:160,XK_exclamdown:161,XK_cent:162,XK_sterling:163,XK_currency:164,XK_yen:165,XK_brokenbar:166,XK_section:167,XK_diaeresis:168,XK_copyright:169,XK_ordfeminine:170,XK_guillemotleft:171,XK_notsign:172,XK_hyphen:173,XK_registered:174,XK_macron:175,XK_degree:176,XK_plusminus:177,XK_twosuperior:178,XK_threesuperior:179,XK_acute:180,XK_mu:181,XK_paragraph:182,XK_periodcentered:183,XK_cedilla:184,XK_onesuperior:185,XK_masculine:186,XK_guillemotright:187,XK_onequarter:188,XK_onehalf:189,XK_threequarters:190,XK_questiondown:191,XK_Agrave:192,XK_Aacute:193,XK_Acircumflex:194,XK_Atilde:195,XK_Adiaeresis:196,XK_Aring:197,XK_AE:198,XK_Ccedilla:199,XK_Egrave:200,XK_Eacute:201,XK_Ecircumflex:202,XK_Ediaeresis:203,XK_Igrave:204,XK_Iacute:205,XK_Icircumflex:206,XK_Idiaeresis:207,XK_ETH:208,XK_Eth:208,XK_Ntilde:209,XK_Ograve:210,XK_Oacute:211,XK_Ocircumflex:212,XK_Otilde:213,XK_Odiaeresis:214,XK_multiply:215,XK_Oslash:216,XK_Ooblique:216,XK_Ugrave:217,XK_Uacute:218,XK_Ucircumflex:219,XK_Udiaeresis:220,XK_Yacute:221,XK_THORN:222,XK_Thorn:222,XK_ssharp:223,XK_agrave:224,XK_aacute:225,XK_acircumflex:226,XK_atilde:227,XK_adiaeresis:228,XK_aring:229,XK_ae:230,XK_ccedilla:231,XK_egrave:232,XK_eacute:233,XK_ecircumflex:234,XK_ediaeresis:235,XK_igrave:236,XK_iacute:237,XK_icircumflex:238,XK_idiaeresis:239,XK_eth:240,XK_ntilde:241,XK_ograve:242,XK_oacute:243,XK_ocircumflex:244,XK_otilde:245,XK_odiaeresis:246,XK_division:247,XK_oslash:248,XK_ooblique:248,XK_ugrave:249,XK_uacute:250,XK_ucircumflex:251,XK_udiaeresis:252,XK_yacute:253,XK_thorn:254,XK_ydiaeresis:255,XK_Hangul:65329,XK_Hangul_Hanja:65332,XK_Hangul_Jeonja:65336,XF86XK_ModeLock:269025025,XF86XK_MonBrightnessUp:269025026,XF86XK_MonBrightnessDown:269025027,XF86XK_KbdLightOnOff:269025028,XF86XK_KbdBrightnessUp:269025029,XF86XK_KbdBrightnessDown:269025030,XF86XK_Standby:269025040,XF86XK_AudioLowerVolume:269025041,XF86XK_AudioMute:269025042,XF86XK_AudioRaiseVolume:269025043,XF86XK_AudioPlay:269025044,XF86XK_AudioStop:269025045,XF86XK_AudioPrev:269025046,XF86XK_AudioNext:269025047,XF86XK_HomePage:269025048,XF86XK_Mail:269025049,XF86XK_Start:269025050,XF86XK_Search:269025051,XF86XK_AudioRecord:269025052,XF86XK_Calculator:269025053,XF86XK_Memo:269025054,XF86XK_ToDoList:269025055,XF86XK_Calendar:269025056,XF86XK_PowerDown:269025057,XF86XK_ContrastAdjust:269025058,XF86XK_RockerUp:269025059,XF86XK_RockerDown:269025060,XF86XK_RockerEnter:269025061,XF86XK_Back:269025062,XF86XK_Forward:269025063,XF86XK_Stop:269025064,XF86XK_Refresh:269025065,XF86XK_PowerOff:269025066,XF86XK_WakeUp:269025067,XF86XK_Eject:269025068,XF86XK_ScreenSaver:269025069,XF86XK_WWW:269025070,XF86XK_Sleep:269025071,XF86XK_Favorites:269025072,XF86XK_AudioPause:269025073,XF86XK_AudioMedia:269025074,XF86XK_MyComputer:269025075,XF86XK_VendorHome:269025076,XF86XK_LightBulb:269025077,XF86XK_Shop:269025078,XF86XK_History:269025079,XF86XK_OpenURL:269025080,XF86XK_AddFavorite:269025081,XF86XK_HotLinks:269025082,XF86XK_BrightnessAdjust:269025083,XF86XK_Finance:269025084,XF86XK_Community:269025085,XF86XK_AudioRewind:269025086,XF86XK_BackForward:269025087,XF86XK_Launch0:269025088,XF86XK_Launch1:269025089,XF86XK_Launch2:269025090,XF86XK_Launch3:269025091,XF86XK_Launch4:269025092,XF86XK_Launch5:269025093,XF86XK_Launch6:269025094,XF86XK_Launch7:269025095,XF86XK_Launch8:269025096,XF86XK_Launch9:269025097,XF86XK_LaunchA:269025098,XF86XK_LaunchB:269025099,XF86XK_LaunchC:269025100,XF86XK_LaunchD:269025101,XF86XK_LaunchE:269025102,XF86XK_LaunchF:269025103,XF86XK_ApplicationLeft:269025104,XF86XK_ApplicationRight:269025105,XF86XK_Book:269025106,XF86XK_CD:269025107,XF86XK_Calculater:269025108,XF86XK_Clear:269025109,XF86XK_Close:269025110,XF86XK_Copy:269025111,XF86XK_Cut:269025112,XF86XK_Display:269025113,XF86XK_DOS:269025114,XF86XK_Documents:269025115,XF86XK_Excel:269025116,XF86XK_Explorer:269025117,XF86XK_Game:269025118,XF86XK_Go:269025119,XF86XK_iTouch:269025120,XF86XK_LogOff:269025121,XF86XK_Market:269025122,XF86XK_Meeting:269025123,XF86XK_MenuKB:269025125,XF86XK_MenuPB:269025126,XF86XK_MySites:269025127,XF86XK_New:269025128,XF86XK_News:269025129,XF86XK_OfficeHome:269025130,XF86XK_Open:269025131,XF86XK_Option:269025132,XF86XK_Paste:269025133,XF86XK_Phone:269025134,XF86XK_Q:269025136,XF86XK_Reply:269025138,XF86XK_Reload:269025139,XF86XK_RotateWindows:269025140,XF86XK_RotationPB:269025141,XF86XK_RotationKB:269025142,XF86XK_Save:269025143,XF86XK_ScrollUp:269025144,XF86XK_ScrollDown:269025145,XF86XK_ScrollClick:269025146,XF86XK_Send:269025147,XF86XK_Spell:269025148,XF86XK_SplitScreen:269025149,XF86XK_Support:269025150,XF86XK_TaskPane:269025151,XF86XK_Terminal:269025152,XF86XK_Tools:269025153,XF86XK_Travel:269025154,XF86XK_UserPB:269025156,XF86XK_User1KB:269025157,XF86XK_User2KB:269025158,XF86XK_Video:269025159,XF86XK_WheelButton:269025160,XF86XK_Word:269025161,XF86XK_Xfer:269025162,XF86XK_ZoomIn:269025163,XF86XK_ZoomOut:269025164,XF86XK_Away:269025165,XF86XK_Messenger:269025166,XF86XK_WebCam:269025167,XF86XK_MailForward:269025168,XF86XK_Pictures:269025169,XF86XK_Music:269025170,XF86XK_Battery:269025171,XF86XK_Bluetooth:269025172,XF86XK_WLAN:269025173,XF86XK_UWB:269025174,XF86XK_AudioForward:269025175,XF86XK_AudioRepeat:269025176,XF86XK_AudioRandomPlay:269025177,XF86XK_Subtitle:269025178,XF86XK_AudioCycleTrack:269025179,XF86XK_CycleAngle:269025180,XF86XK_FrameBack:269025181,XF86XK_FrameForward:269025182,XF86XK_Time:269025183,XF86XK_Select:269025184,XF86XK_View:269025185,XF86XK_TopMenu:269025186,XF86XK_Red:269025187,XF86XK_Green:269025188,XF86XK_Yellow:269025189,XF86XK_Blue:269025190,XF86XK_Suspend:269025191,XF86XK_Hibernate:269025192,XF86XK_TouchpadToggle:269025193,XF86XK_TouchpadOn:269025200,XF86XK_TouchpadOff:269025201,XF86XK_AudioMicMute:269025202,XF86XK_Switch_VT_1:269024769,XF86XK_Switch_VT_2:269024770,XF86XK_Switch_VT_3:269024771,XF86XK_Switch_VT_4:269024772,XF86XK_Switch_VT_5:269024773,XF86XK_Switch_VT_6:269024774,XF86XK_Switch_VT_7:269024775,XF86XK_Switch_VT_8:269024776,XF86XK_Switch_VT_9:269024777,XF86XK_Switch_VT_10:269024778,XF86XK_Switch_VT_11:269024779,XF86XK_Switch_VT_12:269024780,XF86XK_Ungrab:269024800,XF86XK_ClearGrab:269024801,XF86XK_Next_VMode:269024802,XF86XK_Prev_VMode:269024803,XF86XK_LogWindowTree:269024804,XF86XK_LogGrabInfo:269024805};const Jc={256:960,257:992,258:451,259:483,260:417,261:433,262:454,263:486,264:710,265:742,266:709,267:741,268:456,269:488,270:463,271:495,272:464,273:496,274:938,275:954,278:972,279:1004,280:458,281:490,282:460,283:492,284:728,285:760,286:683,287:699,288:725,289:757,290:939,291:955,292:678,293:694,294:673,295:689,296:933,297:949,298:975,299:1007,302:967,303:999,304:681,305:697,308:684,309:700,310:979,311:1011,312:930,313:453,314:485,315:934,316:950,317:421,318:437,321:419,322:435,323:465,324:497,325:977,326:1009,327:466,328:498,330:957,331:959,332:978,333:1010,336:469,337:501,338:5052,339:5053,340:448,341:480,342:931,343:947,344:472,345:504,346:422,347:438,348:734,349:766,350:426,351:442,352:425,353:441,354:478,355:510,356:427,357:443,358:940,359:956,360:989,361:1021,362:990,363:1022,364:733,365:765,366:473,367:505,368:475,369:507,370:985,371:1017,376:5054,377:428,378:444,379:431,380:447,381:430,382:446,402:2294,466:16777681,711:439,728:418,729:511,731:434,733:445,901:1966,902:1953,904:1954,905:1955,906:1956,908:1959,910:1960,911:1963,912:1974,913:1985,914:1986,915:1987,916:1988,917:1989,918:1990,919:1991,920:1992,921:1993,922:1994,923:1995,924:1996,925:1997,926:1998,927:1999,928:2e3,929:2001,931:2002,932:2004,933:2005,934:2006,935:2007,936:2008,937:2009,938:1957,939:1961,940:1969,941:1970,942:1971,943:1972,944:1978,945:2017,946:2018,947:2019,948:2020,949:2021,950:2022,951:2023,952:2024,953:2025,954:2026,955:2027,956:2028,957:2029,958:2030,959:2031,960:2032,961:2033,962:2035,963:2034,964:2036,965:2037,966:2038,967:2039,968:2040,969:2041,970:1973,971:1977,972:1975,973:1976,974:1979,1025:1715,1026:1713,1027:1714,1028:1716,1029:1717,1030:1718,1031:1719,1032:1720,1033:1721,1034:1722,1035:1723,1036:1724,1038:1726,1039:1727,1040:1761,1041:1762,1042:1783,1043:1767,1044:1764,1045:1765,1046:1782,1047:1786,1048:1769,1049:1770,1050:1771,1051:1772,1052:1773,1053:1774,1054:1775,1055:1776,1056:1778,1057:1779,1058:1780,1059:1781,1060:1766,1061:1768,1062:1763,1063:1790,1064:1787,1065:1789,1066:1791,1067:1785,1068:1784,1069:1788,1070:1760,1071:1777,1072:1729,1073:1730,1074:1751,1075:1735,1076:1732,1077:1733,1078:1750,1079:1754,1080:1737,1081:1738,1082:1739,1083:1740,1084:1741,1085:1742,1086:1743,1087:1744,1088:1746,1089:1747,1090:1748,1091:1749,1092:1734,1093:1736,1094:1731,1095:1758,1096:1755,1097:1757,1098:1759,1099:1753,1100:1752,1101:1756,1102:1728,1103:1745,1105:1699,1106:1697,1107:1698,1108:1700,1109:1701,1110:1702,1111:1703,1112:1704,1113:1705,1114:1706,1115:1707,1116:1708,1118:1710,1119:1711,1168:1725,1169:1709,1488:3296,1489:3297,1490:3298,1491:3299,1492:3300,1493:3301,1494:3302,1495:3303,1496:3304,1497:3305,1498:3306,1499:3307,1500:3308,1501:3309,1502:3310,1503:3311,1504:3312,1505:3313,1506:3314,1507:3315,1508:3316,1509:3317,1510:3318,1511:3319,1512:3320,1513:3321,1514:3322,1548:1452,1563:1467,1567:1471,1569:1473,1570:1474,1571:1475,1572:1476,1573:1477,1574:1478,1575:1479,1576:1480,1577:1481,1578:1482,1579:1483,1580:1484,1581:1485,1582:1486,1583:1487,1584:1488,1585:1489,1586:1490,1587:1491,1588:1492,1589:1493,1590:1494,1591:1495,1592:1496,1593:1497,1594:1498,1600:1504,1601:1505,1602:1506,1603:1507,1604:1508,1605:1509,1606:1510,1607:1511,1608:1512,1609:1513,1610:1514,1611:1515,1612:1516,1613:1517,1614:1518,1615:1519,1616:1520,1617:1521,1618:1522,3585:3489,3586:3490,3587:3491,3588:3492,3589:3493,3590:3494,3591:3495,3592:3496,3593:3497,3594:3498,3595:3499,3596:3500,3597:3501,3598:3502,3599:3503,3600:3504,3601:3505,3602:3506,3603:3507,3604:3508,3605:3509,3606:3510,3607:3511,3608:3512,3609:3513,3610:3514,3611:3515,3612:3516,3613:3517,3614:3518,3615:3519,3616:3520,3617:3521,3618:3522,3619:3523,3620:3524,3621:3525,3622:3526,3623:3527,3624:3528,3625:3529,3626:3530,3627:3531,3628:3532,3629:3533,3630:3534,3631:3535,3632:3536,3633:3537,3634:3538,3635:3539,3636:3540,3637:3541,3638:3542,3639:3543,3640:3544,3641:3545,3642:3546,3647:3551,3648:3552,3649:3553,3650:3554,3651:3555,3652:3556,3653:3557,3654:3558,3655:3559,3656:3560,3657:3561,3658:3562,3659:3563,3660:3564,3661:3565,3664:3568,3665:3569,3666:3570,3667:3571,3668:3572,3669:3573,3670:3574,3671:3575,3672:3576,3673:3577,8194:2722,8195:2721,8196:2723,8197:2724,8199:2725,8200:2726,8201:2727,8202:2728,8210:2747,8211:2730,8212:2729,8213:1967,8215:3295,8216:2768,8217:2769,8218:2813,8220:2770,8221:2771,8222:2814,8224:2801,8225:2802,8226:2790,8229:2735,8230:2734,8240:2773,8242:2774,8243:2775,8248:2812,8254:1150,8361:3839,8364:8364,8453:2744,8470:1712,8471:2811,8478:2772,8482:2761,8531:2736,8532:2737,8533:2738,8534:2739,8535:2740,8536:2741,8537:2742,8538:2743,8539:2755,8540:2756,8541:2757,8542:2758,8592:2299,8593:2300,8594:2301,8595:2302,8658:2254,8660:2253,8706:2287,8711:2245,8728:3018,8730:2262,8733:2241,8734:2242,8743:2270,8744:2271,8745:2268,8746:2269,8747:2239,8756:2240,8764:2248,8771:2249,8773:16785992,8800:2237,8801:2255,8804:2236,8805:2238,8834:2266,8835:2267,8866:3068,8867:3036,8868:3010,8869:3022,8968:3027,8970:3012,8981:2810,8992:2212,8993:2213,9109:3020,9115:2219,9117:2220,9118:2221,9120:2222,9121:2215,9123:2216,9124:2217,9126:2218,9128:2223,9132:2224,9143:2209,9146:2543,9147:2544,9148:2546,9149:2547,9225:2530,9226:2533,9227:2537,9228:2531,9229:2532,9251:2732,9252:2536,9472:2211,9474:2214,9484:2210,9488:2539,9492:2541,9496:2538,9500:2548,9508:2549,9516:2551,9524:2550,9532:2542,9618:2529,9642:2791,9643:2785,9644:2779,9645:2786,9646:2783,9647:2767,9650:2792,9651:2787,9654:2781,9655:2765,9660:2793,9661:2788,9664:2780,9665:2764,9670:2528,9675:2766,9679:2782,9702:2784,9734:2789,9742:2809,9747:2762,9756:2794,9758:2795,9792:2808,9794:2807,9827:2796,9829:2798,9830:2797,9837:2806,9839:2805,10003:2803,10007:2804,10013:2777,10016:2800,10216:2748,10217:2750,12289:1188,12290:1185,12300:1186,12301:1187,12443:1246,12444:1247,12449:1191,12450:1201,12451:1192,12452:1202,12453:1193,12454:1203,12455:1194,12456:1204,12457:1195,12458:1205,12459:1206,12461:1207,12463:1208,12465:1209,12467:1210,12469:1211,12471:1212,12473:1213,12475:1214,12477:1215,12479:1216,12481:1217,12483:1199,12484:1218,12486:1219,12488:1220,12490:1221,12491:1222,12492:1223,12493:1224,12494:1225,12495:1226,12498:1227,12501:1228,12504:1229,12507:1230,12510:1231,12511:1232,12512:1233,12513:1234,12514:1235,12515:1196,12516:1236,12517:1197,12518:1237,12519:1198,12520:1238,12521:1239,12522:1240,12523:1241,12524:1242,12525:1243,12527:1244,12530:1190,12531:1245,12539:1189,12540:1200};var $c={lookup(r){if(r>=32&&r<=255)return r;const i=Jc[r];return i!==void 0?i:16777216|r}},Js={8:"Backspace",9:"Tab",10:"NumpadClear",13:"Enter",16:"ShiftLeft",17:"ControlLeft",18:"AltLeft",19:"Pause",20:"CapsLock",21:"Lang1",25:"Lang2",27:"Escape",28:"Convert",29:"NonConvert",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",41:"Select",44:"PrintScreen",45:"Insert",46:"Delete",47:"Help",48:"Digit0",49:"Digit1",50:"Digit2",51:"Digit3",52:"Digit4",53:"Digit5",54:"Digit6",55:"Digit7",56:"Digit8",57:"Digit9",91:"MetaLeft",92:"MetaRight",93:"ContextMenu",95:"Sleep",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9",106:"NumpadMultiply",107:"NumpadAdd",108:"NumpadDecimal",109:"NumpadSubtract",110:"NumpadDecimal",111:"NumpadDivide",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",124:"F13",125:"F14",126:"F15",127:"F16",128:"F17",129:"F18",130:"F19",131:"F20",132:"F21",133:"F22",134:"F23",135:"F24",144:"NumLock",145:"ScrollLock",166:"BrowserBack",167:"BrowserForward",168:"BrowserRefresh",169:"BrowserStop",170:"BrowserSearch",171:"BrowserFavorites",172:"BrowserHome",173:"AudioVolumeMute",174:"AudioVolumeDown",175:"AudioVolumeUp",176:"MediaTrackNext",177:"MediaTrackPrevious",178:"MediaStop",179:"MediaPlayPause",180:"LaunchMail",181:"MediaSelect",182:"LaunchApp1",183:"LaunchApp2",225:"AltRight"},$s={Backspace:"Backspace",AltLeft:"Alt",AltRight:"Alt",CapsLock:"CapsLock",ContextMenu:"ContextMenu",ControlLeft:"Control",ControlRight:"Control",Enter:"Enter",MetaLeft:"Meta",MetaRight:"Meta",ShiftLeft:"Shift",ShiftRight:"Shift",Tab:"Tab",Delete:"Delete",End:"End",Help:"Help",Home:"Home",Insert:"Insert",PageDown:"PageDown",PageUp:"PageUp",ArrowDown:"ArrowDown",ArrowLeft:"ArrowLeft",ArrowRight:"ArrowRight",ArrowUp:"ArrowUp",NumLock:"NumLock",NumpadBackspace:"Backspace",NumpadClear:"Clear",Escape:"Escape",F1:"F1",F2:"F2",F3:"F3",F4:"F4",F5:"F5",F6:"F6",F7:"F7",F8:"F8",F9:"F9",F10:"F10",F11:"F11",F12:"F12",F13:"F13",F14:"F14",F15:"F15",F16:"F16",F17:"F17",F18:"F18",F19:"F19",F20:"F20",F21:"F21",F22:"F22",F23:"F23",F24:"F24",F25:"F25",F26:"F26",F27:"F27",F28:"F28",F29:"F29",F30:"F30",F31:"F31",F32:"F32",F33:"F33",F34:"F34",F35:"F35",PrintScreen:"PrintScreen",ScrollLock:"ScrollLock",Pause:"Pause",BrowserBack:"BrowserBack",BrowserFavorites:"BrowserFavorites",BrowserForward:"BrowserForward",BrowserHome:"BrowserHome",BrowserRefresh:"BrowserRefresh",BrowserSearch:"BrowserSearch",BrowserStop:"BrowserStop",Eject:"Eject",LaunchApp1:"LaunchMyComputer",LaunchApp2:"LaunchCalendar",LaunchMail:"LaunchMail",MediaPlayPause:"MediaPlay",MediaStop:"MediaStop",MediaTrackNext:"MediaTrackNext",MediaTrackPrevious:"MediaTrackPrevious",Power:"Power",Sleep:"Sleep",AudioVolumeDown:"AudioVolumeDown",AudioVolumeMute:"AudioVolumeMute",AudioVolumeUp:"AudioVolumeUp",WakeUp:"WakeUp"};const Rt={};function V(r,i){if(i===void 0)throw new Error('Undefined keysym for key "'+r+'"');if(r in Rt)throw new Error('Duplicate entry for key "'+r+'"');Rt[r]=[i,i,i,i]}function Wr(r,i,t){if(i===void 0)throw new Error('Undefined keysym for key "'+r+'"');if(t===void 0)throw new Error('Undefined keysym for key "'+r+'"');if(r in Rt)throw new Error('Duplicate entry for key "'+r+'"');Rt[r]=[i,i,t,i]}function ye(r,i,t){if(i===void 0)throw new Error('Undefined keysym for key "'+r+'"');if(t===void 0)throw new Error('Undefined keysym for key "'+r+'"');if(r in Rt)throw new Error('Duplicate entry for key "'+r+'"');Rt[r]=[i,i,i,t]}Wr("Alt",P.XK_Alt_L,P.XK_Alt_R);V("AltGraph",P.XK_ISO_Level3_Shift);V("CapsLock",P.XK_Caps_Lock);Wr("Control",P.XK_Control_L,P.XK_Control_R);Wr("Meta",P.XK_Super_L,P.XK_Super_R);V("NumLock",P.XK_Num_Lock);V("ScrollLock",P.XK_Scroll_Lock);Wr("Shift",P.XK_Shift_L,P.XK_Shift_R);ye("Enter",P.XK_Return,P.XK_KP_Enter);V("Tab",P.XK_Tab);ye(" ",P.XK_space,P.XK_KP_Space);ye("ArrowDown",P.XK_Down,P.XK_KP_Down);ye("ArrowLeft",P.XK_Left,P.XK_KP_Left);ye("ArrowRight",P.XK_Right,P.XK_KP_Right);ye("ArrowUp",P.XK_Up,P.XK_KP_Up);ye("End",P.XK_End,P.XK_KP_End);ye("Home",P.XK_Home,P.XK_KP_Home);ye("PageDown",P.XK_Next,P.XK_KP_Next);ye("PageUp",P.XK_Prior,P.XK_KP_Prior);V("Backspace",P.XK_BackSpace);ye("Clear",P.XK_Clear,P.XK_KP_Begin);V("Copy",P.XF86XK_Copy);V("Cut",P.XF86XK_Cut);ye("Delete",P.XK_Delete,P.XK_KP_Delete);ye("Insert",P.XK_Insert,P.XK_KP_Insert);V("Paste",P.XF86XK_Paste);V("Redo",P.XK_Redo);V("Undo",P.XK_Undo);V("Cancel",P.XK_Cancel);V("ContextMenu",P.XK_Menu);V("Escape",P.XK_Escape);V("Execute",P.XK_Execute);V("Find",P.XK_Find);V("Help",P.XK_Help);V("Pause",P.XK_Pause);V("Select",P.XK_Select);V("ZoomIn",P.XF86XK_ZoomIn);V("ZoomOut",P.XF86XK_ZoomOut);V("BrightnessDown",P.XF86XK_MonBrightnessDown);V("BrightnessUp",P.XF86XK_MonBrightnessUp);V("Eject",P.XF86XK_Eject);V("LogOff",P.XF86XK_LogOff);V("Power",P.XF86XK_PowerOff);V("PowerOff",P.XF86XK_PowerDown);V("PrintScreen",P.XK_Print);V("Hibernate",P.XF86XK_Hibernate);V("Standby",P.XF86XK_Standby);V("WakeUp",P.XF86XK_WakeUp);V("AllCandidates",P.XK_MultipleCandidate);V("Alphanumeric",P.XK_Eisu_toggle);V("CodeInput",P.XK_Codeinput);V("Compose",P.XK_Multi_key);V("Convert",P.XK_Henkan);V("GroupFirst",P.XK_ISO_First_Group);V("GroupLast",P.XK_ISO_Last_Group);V("GroupNext",P.XK_ISO_Next_Group);V("GroupPrevious",P.XK_ISO_Prev_Group);V("NonConvert",P.XK_Muhenkan);V("PreviousCandidate",P.XK_PreviousCandidate);V("SingleCandidate",P.XK_SingleCandidate);V("HangulMode",P.XK_Hangul);V("HanjaMode",P.XK_Hangul_Hanja);V("JunjaMode",P.XK_Hangul_Jeonja);V("Eisu",P.XK_Eisu_toggle);V("Hankaku",P.XK_Hankaku);V("Hiragana",P.XK_Hiragana);V("HiraganaKatakana",P.XK_Hiragana_Katakana);V("KanaMode",P.XK_Kana_Shift);V("KanjiMode",P.XK_Kanji);V("Katakana",P.XK_Katakana);V("Romaji",P.XK_Romaji);V("Zenkaku",P.XK_Zenkaku);V("ZenkakuHankaku",P.XK_Zenkaku_Hankaku);V("F1",P.XK_F1);V("F2",P.XK_F2);V("F3",P.XK_F3);V("F4",P.XK_F4);V("F5",P.XK_F5);V("F6",P.XK_F6);V("F7",P.XK_F7);V("F8",P.XK_F8);V("F9",P.XK_F9);V("F10",P.XK_F10);V("F11",P.XK_F11);V("F12",P.XK_F12);V("F13",P.XK_F13);V("F14",P.XK_F14);V("F15",P.XK_F15);V("F16",P.XK_F16);V("F17",P.XK_F17);V("F18",P.XK_F18);V("F19",P.XK_F19);V("F20",P.XK_F20);V("F21",P.XK_F21);V("F22",P.XK_F22);V("F23",P.XK_F23);V("F24",P.XK_F24);V("F25",P.XK_F25);V("F26",P.XK_F26);V("F27",P.XK_F27);V("F28",P.XK_F28);V("F29",P.XK_F29);V("F30",P.XK_F30);V("F31",P.XK_F31);V("F32",P.XK_F32);V("F33",P.XK_F33);V("F34",P.XK_F34);V("F35",P.XK_F35);V("Close",P.XF86XK_Close);V("MailForward",P.XF86XK_MailForward);V("MailReply",P.XF86XK_Reply);V("MailSend",P.XF86XK_Send);V("MediaFastForward",P.XF86XK_AudioForward);V("MediaPause",P.XF86XK_AudioPause);V("MediaPlay",P.XF86XK_AudioPlay);V("MediaRecord",P.XF86XK_AudioRecord);V("MediaRewind",P.XF86XK_AudioRewind);V("MediaStop",P.XF86XK_AudioStop);V("MediaTrackNext",P.XF86XK_AudioNext);V("MediaTrackPrevious",P.XF86XK_AudioPrev);V("New",P.XF86XK_New);V("Open",P.XF86XK_Open);V("Print",P.XK_Print);V("Save",P.XF86XK_Save);V("SpellCheck",P.XF86XK_Spell);V("AudioVolumeDown",P.XF86XK_AudioLowerVolume);V("AudioVolumeUp",P.XF86XK_AudioRaiseVolume);V("AudioVolumeMute",P.XF86XK_AudioMute);V("MicrophoneVolumeMute",P.XF86XK_AudioMicMute);V("LaunchApplication1",P.XF86XK_MyComputer);V("LaunchApplication2",P.XF86XK_Calculator);V("LaunchCalendar",P.XF86XK_Calendar);V("LaunchMail",P.XF86XK_Mail);V("LaunchMediaPlayer",P.XF86XK_AudioMedia);V("LaunchMusicPlayer",P.XF86XK_Music);V("LaunchPhone",P.XF86XK_Phone);V("LaunchScreenSaver",P.XF86XK_ScreenSaver);V("LaunchSpreadsheet",P.XF86XK_Excel);V("LaunchWebBrowser",P.XF86XK_WWW);V("LaunchWebCam",P.XF86XK_WebCam);V("LaunchWordProcessor",P.XF86XK_Word);V("BrowserBack",P.XF86XK_Back);V("BrowserFavorites",P.XF86XK_Favorites);V("BrowserForward",P.XF86XK_Forward);V("BrowserHome",P.XF86XK_HomePage);V("BrowserRefresh",P.XF86XK_Refresh);V("BrowserSearch",P.XF86XK_Search);V("BrowserStop",P.XF86XK_Stop);V("Dimmer",P.XF86XK_BrightnessAdjust);V("MediaAudioTrack",P.XF86XK_AudioCycleTrack);V("RandomToggle",P.XF86XK_AudioRandomPlay);V("SplitScreenToggle",P.XF86XK_SplitScreen);V("Subtitle",P.XF86XK_Subtitle);V("VideoModeNext",P.XF86XK_Next_VMode);ye("=",P.XK_equal,P.XK_KP_Equal);ye("+",P.XK_plus,P.XK_KP_Add);ye("-",P.XK_minus,P.XK_KP_Subtract);ye("*",P.XK_asterisk,P.XK_KP_Multiply);ye("/",P.XK_slash,P.XK_KP_Divide);ye(".",P.XK_period,P.XK_KP_Decimal);ye(",",P.XK_comma,P.XK_KP_Separator);ye("0",P.XK_0,P.XK_KP_0);ye("1",P.XK_1,P.XK_KP_1);ye("2",P.XK_2,P.XK_KP_2);ye("3",P.XK_3,P.XK_KP_3);ye("4",P.XK_4,P.XK_KP_4);ye("5",P.XK_5,P.XK_KP_5);ye("6",P.XK_6,P.XK_KP_6);ye("7",P.XK_7,P.XK_KP_7);ye("8",P.XK_8,P.XK_KP_8);ye("9",P.XK_9,P.XK_KP_9);function di(r){if(r.code){switch(r.code){case"OSLeft":return"MetaLeft";case"OSRight":return"MetaRight"}return r.code}if(r.keyCode in Js){let i=Js[r.keyCode];if(li()&&i==="ContextMenu"&&(i="MetaRight"),r.location===2)switch(i){case"ShiftLeft":return"ShiftRight";case"ControlLeft":return"ControlRight";case"AltLeft":return"AltRight"}if(r.location===3)switch(i){case"Delete":return"NumpadDecimal";case"Insert":return"Numpad0";case"End":return"Numpad1";case"ArrowDown":return"Numpad2";case"PageDown":return"Numpad3";case"ArrowLeft":return"Numpad4";case"ArrowRight":return"Numpad6";case"Home":return"Numpad7";case"ArrowUp":return"Numpad8";case"PageUp":return"Numpad9";case"Enter":return"NumpadEnter"}return i}return"Unidentified"}function el(r){if(r.key!==void 0){switch(r.key){case"OS":return"Meta";case"LaunchMyComputer":return"LaunchApplication1";case"LaunchCalculator":return"LaunchApplication2"}switch(r.key){case"UIKeyInputUpArrow":return"ArrowUp";case"UIKeyInputDownArrow":return"ArrowDown";case"UIKeyInputLeftArrow":return"ArrowLeft";case"UIKeyInputRightArrow":return"ArrowRight";case"UIKeyInputEscape":return"Escape"}return r.key==="\0"&&r.code==="NumpadDecimal"?"Delete":r.key}const i=di(r);return i in $s?$s[i]:r.charCode?String.fromCharCode(r.charCode):"Unidentified"}function tl(r){const i=el(r);if(i==="Unidentified")return null;if(i in Rt){let n=r.location;if(i==="Meta"&&n===0&&(n=2),i==="Clear"&&n===3&&di(r)==="NumLock"&&(n=0),(n===void 0||n>3)&&(n=0),i==="Meta"){let d=di(r);if(d==="AltLeft")return P.XK_Meta_L;if(d==="AltRight")return P.XK_Meta_R}if(i==="Clear"&&di(r)==="NumLock")return P.XK_Num_Lock;if(Tr())switch(i){case"Zenkaku":case"Hankaku":return P.XK_Zenkaku_Hankaku;case"Romaji":case"KanaMode":return P.XK_Romaji}return Rt[i][n]}if(i.length!==1)return null;const t=i.charCodeAt();return t?$c.lookup(t):null}class il{constructor(i){this._target=i||null,this._keyDownList={},this._altGrArmed=!1,this._eventHandlers={keyup:this._handleKeyUp.bind(this),keydown:this._handleKeyDown.bind(this),blur:this._allKeysUp.bind(this)},this.onkeyevent=()=>{}}_sendKeyEvent(i,t,n){if(n)this._keyDownList[t]=i;else{if(!(t in this._keyDownList))return;delete this._keyDownList[t]}ue("onkeyevent "+(n?"down":"up")+", keysym: "+i,", code: "+t),this.onkeyevent(i,t,n)}_getKeyCode(i){const t=di(i);if(t!=="Unidentified")return t;if(i.keyCode&&i.keyCode!==229)return"Platform"+i.keyCode;if(i.keyIdentifier){if(i.keyIdentifier.substr(0,2)!=="U+")return i.keyIdentifier;const n=parseInt(i.keyIdentifier.substr(2),16);return"Platform"+String.fromCharCode(n).toUpperCase().charCodeAt()}return"Unidentified"}_handleKeyDown(i){const t=this._getKeyCode(i);let n=tl(i);if(this._altGrArmed&&(this._altGrArmed=!1,clearTimeout(this._altGrTimeout),t==="AltRight"&&i.timeStamp-this._altGrCtrlTime<50?n=P.XK_ISO_Level3_Shift:this._sendKeyEvent(P.XK_Control_L,"ControlLeft",!0)),t==="Unidentified"){n&&(this._sendKeyEvent(n,t,!0),this._sendKeyEvent(n,t,!1)),Nt(i);return}if(li()||yr())switch(n){case P.XK_Super_L:n=P.XK_Alt_L;break;case P.XK_Super_R:n=P.XK_Super_L;break;case P.XK_Alt_L:n=P.XK_Mode_switch;break;case P.XK_Alt_R:n=P.XK_ISO_Level3_Shift;break}if(t in this._keyDownList&&(n=this._keyDownList[t]),(li()||yr())&&i.metaKey&&t!=="MetaLeft"&&t!=="MetaRight"){this._sendKeyEvent(n,t,!0),this._sendKeyEvent(n,t,!1),Nt(i);return}if((li()||yr())&&t==="CapsLock"){this._sendKeyEvent(P.XK_Caps_Lock,"CapsLock",!0),this._sendKeyEvent(P.XK_Caps_Lock,"CapsLock",!1),Nt(i);return}const d=[P.XK_Zenkaku_Hankaku,P.XK_Eisu_toggle,P.XK_Katakana,P.XK_Hiragana,P.XK_Romaji];if(Tr()&&d.includes(n)){this._sendKeyEvent(n,t,!0),this._sendKeyEvent(n,t,!1),Nt(i);return}if(Nt(i),t==="ControlLeft"&&Tr()&&!("ControlLeft"in this._keyDownList)){this._altGrArmed=!0,this._altGrTimeout=setTimeout(this._handleAltGrTimeout.bind(this),100),this._altGrCtrlTime=i.timeStamp;return}this._sendKeyEvent(n,t,!0)}_handleKeyUp(i){Nt(i);const t=this._getKeyCode(i);if(this._altGrArmed&&(this._altGrArmed=!1,clearTimeout(this._altGrTimeout),this._sendKeyEvent(P.XK_Control_L,"ControlLeft",!0)),(li()||yr())&&t==="CapsLock"){this._sendKeyEvent(P.XK_Caps_Lock,"CapsLock",!0),this._sendKeyEvent(P.XK_Caps_Lock,"CapsLock",!1);return}this._sendKeyEvent(this._keyDownList[t],t,!1),Tr()&&(t==="ShiftLeft"||t==="ShiftRight")&&("ShiftRight"in this._keyDownList&&this._sendKeyEvent(this._keyDownList.ShiftRight,"ShiftRight",!1),"ShiftLeft"in this._keyDownList&&this._sendKeyEvent(this._keyDownList.ShiftLeft,"ShiftLeft",!1))}_handleAltGrTimeout(){this._altGrArmed=!1,clearTimeout(this._altGrTimeout),this._sendKeyEvent(P.XK_Control_L,"ControlLeft",!0)}_allKeysUp(){ue(">> Keyboard.allKeysUp");for(let i in this._keyDownList)this._sendKeyEvent(this._keyDownList[i],i,!1);ue("<< Keyboard.allKeysUp")}grab(){this._target.addEventListener("keydown",this._eventHandlers.keydown),this._target.addEventListener("keyup",this._eventHandlers.keyup),window.addEventListener("blur",this._eventHandlers.blur)}ungrab(){this._target.removeEventListener("keydown",this._eventHandlers.keydown),this._target.removeEventListener("keyup",this._eventHandlers.keyup),window.removeEventListener("blur",this._eventHandlers.blur),this._allKeysUp()}}const ut=0,ri=1,ni=2,si=4,kr=8,oi=16,St=32,wt=64,Bn=127,eo=50,rl=90,to=250,nl=1e3,sl=1e3,ol=50;class al{constructor(){this._target=null,this._state=Bn,this._tracked=[],this._ignored=[],this._waitingRelease=!1,this._releaseStart=0,this._longpressTimeoutId=null,this._twoTouchTimeoutId=null,this._boundEventHandler=this._eventHandler.bind(this)}attach(i){this.detach(),this._target=i,this._target.addEventListener("touchstart",this._boundEventHandler),this._target.addEventListener("touchmove",this._boundEventHandler),this._target.addEventListener("touchend",this._boundEventHandler),this._target.addEventListener("touchcancel",this._boundEventHandler)}detach(){this._target&&(this._stopLongpressTimeout(),this._stopTwoTouchTimeout(),this._target.removeEventListener("touchstart",this._boundEventHandler),this._target.removeEventListener("touchmove",this._boundEventHandler),this._target.removeEventListener("touchend",this._boundEventHandler),this._target.removeEventListener("touchcancel",this._boundEventHandler),this._target=null)}_eventHandler(i){let t;switch(i.stopPropagation(),i.preventDefault(),i.type){case"touchstart":t=this._touchStart;break;case"touchmove":t=this._touchMove;break;case"touchend":case"touchcancel":t=this._touchEnd;break}for(let n=0;n<i.changedTouches.length;n++){let d=i.changedTouches[n];t.call(this,d.identifier,d.clientX,d.clientY)}}_touchStart(i,t,n){if(this._hasDetectedGesture()||this._state===ut){this._ignored.push(i);return}if(this._tracked.length>0&&Date.now()-this._tracked[0].started>to){this._state=ut,this._ignored.push(i);return}if(this._waitingRelease){this._state=ut,this._ignored.push(i);return}switch(this._tracked.push({id:i,started:Date.now(),active:!0,firstX:t,firstY:n,lastX:t,lastY:n,angle:0}),this._tracked.length){case 1:this._startLongpressTimeout();break;case 2:this._state&=~(ri|kr|oi),this._stopLongpressTimeout();break;case 3:this._state&=~(ni|St|wt);break;default:this._state=ut}}_touchMove(i,t,n){let d=this._tracked.find(u=>u.id===i);if(d===void 0)return;d.lastX=t,d.lastY=n;let e=t-d.firstX,a=n-d.firstY;if((d.firstX!==d.lastX||d.firstY!==d.lastY)&&(d.angle=Math.atan2(a,e)*180/Math.PI),!this._hasDetectedGesture()){if(Math.hypot(e,a)<eo)return;if(this._state&=~(ri|ni|si|oi),this._stopLongpressTimeout(),this._tracked.length!==1&&(this._state&=~kr),this._tracked.length!==2&&(this._state&=~(St|wt)),this._tracked.length===2){let u=this._tracked.find(l=>l.id!==i);if(Math.hypot(u.firstX-u.lastX,u.firstY-u.lastY)>eo){let l=Math.abs(d.angle-u.angle);l=Math.abs((l+180)%360-180),l>rl?this._state&=~St:this._state&=~wt,this._isTwoTouchTimeoutRunning()&&this._stopTwoTouchTimeout()}else this._isTwoTouchTimeoutRunning()||this._startTwoTouchTimeout()}if(!this._hasDetectedGesture())return;this._pushEvent("gesturestart")}this._pushEvent("gesturemove")}_touchEnd(i,t,n){if(this._ignored.indexOf(i)!==-1){this._ignored.splice(this._ignored.indexOf(i),1),this._ignored.length===0&&this._tracked.length===0&&(this._state=Bn,this._waitingRelease=!1);return}if(!this._hasDetectedGesture()&&this._isTwoTouchTimeoutRunning()&&(this._stopTwoTouchTimeout(),this._state=ut),!this._hasDetectedGesture()&&(this._state&=~(kr|St|wt),this._state&=~oi,this._stopLongpressTimeout(),!this._waitingRelease))switch(this._releaseStart=Date.now(),this._waitingRelease=!0,this._tracked.length){case 1:this._state&=~(ni|si);break;case 2:this._state&=~(ri|si);break}if(this._waitingRelease){Date.now()-this._releaseStart>to&&(this._state=ut),this._tracked.some(e=>Date.now()-e.started>nl)&&(this._state=ut);let d=this._tracked.find(e=>e.id===i);if(d.active=!1,this._hasDetectedGesture())this._pushEvent("gesturestart");else if(this._state!==ut)return}this._hasDetectedGesture()&&this._pushEvent("gestureend");for(let d=0;d<this._tracked.length;d++)this._tracked[d].active&&this._ignored.push(this._tracked[d].id);this._tracked=[],this._state=ut,this._ignored.indexOf(i)!==-1&&this._ignored.splice(this._ignored.indexOf(i),1),this._ignored.length===0&&(this._state=Bn,this._waitingRelease=!1)}_hasDetectedGesture(){return!(this._state===ut||this._state&this._state-1||this._state&(ri|ni|si)&&this._tracked.some(i=>i.active))}_startLongpressTimeout(){this._stopLongpressTimeout(),this._longpressTimeoutId=setTimeout(()=>this._longpressTimeout(),sl)}_stopLongpressTimeout(){clearTimeout(this._longpressTimeoutId),this._longpressTimeoutId=null}_longpressTimeout(){if(this._hasDetectedGesture())throw new Error("A longpress gesture failed, conflict with a different gesture");this._state=oi,this._pushEvent("gesturestart")}_startTwoTouchTimeout(){this._stopTwoTouchTimeout(),this._twoTouchTimeoutId=setTimeout(()=>this._twoTouchTimeout(),ol)}_stopTwoTouchTimeout(){clearTimeout(this._twoTouchTimeoutId),this._twoTouchTimeoutId=null}_isTwoTouchTimeoutRunning(){return this._twoTouchTimeoutId!==null}_twoTouchTimeout(){if(this._tracked.length===0)throw new Error("A pinch or two drag gesture failed, no tracked touches");let i=this._getAverageMovement(),t=Math.abs(i.x),n=Math.abs(i.y),d=this._getAverageDistance(),e=Math.abs(Math.hypot(d.first.x,d.first.y)-Math.hypot(d.last.x,d.last.y));n<e&&t<e?this._state=wt:this._state=St,this._pushEvent("gesturestart"),this._pushEvent("gesturemove")}_pushEvent(i){let t={type:this._stateToGesture(this._state)},n=this._getPosition(),d=n.last;switch(i==="gesturestart"&&(d=n.first),this._state){case St:case wt:d=n.first;break}if(t.clientX=d.x,t.clientY=d.y,this._state===wt){let a=this._getAverageDistance();i==="gesturestart"?(t.magnitudeX=a.first.x,t.magnitudeY=a.first.y):(t.magnitudeX=a.last.x,t.magnitudeY=a.last.y)}else if(this._state===St)if(i==="gesturestart")t.magnitudeX=0,t.magnitudeY=0;else{let a=this._getAverageMovement();t.magnitudeX=a.x,t.magnitudeY=a.y}let e=new CustomEvent(i,{detail:t});this._target.dispatchEvent(e)}_stateToGesture(i){switch(i){case ri:return"onetap";case ni:return"twotap";case si:return"threetap";case kr:return"drag";case oi:return"longpress";case St:return"twodrag";case wt:return"pinch"}throw new Error("Unknown gesture state: "+i)}_getPosition(){if(this._tracked.length===0)throw new Error("Failed to get gesture position, no tracked touches");let i=this._tracked.length,t=0,n=0,d=0,e=0;for(let a=0;a<this._tracked.length;a++)t+=this._tracked[a].firstX,n+=this._tracked[a].firstY,d+=this._tracked[a].lastX,e+=this._tracked[a].lastY;return{first:{x:t/i,y:n/i},last:{x:d/i,y:e/i}}}_getAverageMovement(){if(this._tracked.length===0)throw new Error("Failed to get gesture movement, no tracked touches");let i,t;i=t=0;let n=this._tracked.length;for(let d=0;d<this._tracked.length;d++)i+=this._tracked[d].lastX-this._tracked[d].firstX,t+=this._tracked[d].lastY-this._tracked[d].firstY;return{x:i/n,y:t/n}}_getAverageDistance(){if(this._tracked.length===0)throw new Error("Failed to get gesture distance, no tracked touches");let i=this._tracked[0],t=this._tracked[this._tracked.length-1],n=Math.abs(t.firstX-i.firstX),d=Math.abs(t.firstY-i.firstY),e=Math.abs(t.lastX-i.lastX),a=Math.abs(t.lastY-i.lastY);return{first:{x:n,y:d},last:{x:e,y:a}}}}const ai=!Ea||Ro;class cl{constructor(){this._target=null,this._canvas=document.createElement("canvas"),ai&&(this._canvas.style.position="fixed",this._canvas.style.zIndex="65535",this._canvas.style.pointerEvents="none",this._canvas.style.userSelect="none",this._canvas.style.WebkitUserSelect="none",this._canvas.style.visibility="hidden"),this._position={x:0,y:0},this._hotSpot={x:0,y:0},this._eventHandlers={mouseover:this._handleMouseOver.bind(this),mouseleave:this._handleMouseLeave.bind(this),mousemove:this._handleMouseMove.bind(this),mouseup:this._handleMouseUp.bind(this)}}attach(i){if(this._target&&this.detach(),this._target=i,ai){document.body.appendChild(this._canvas);const t={capture:!0,passive:!0};this._target.addEventListener("mouseover",this._eventHandlers.mouseover,t),this._target.addEventListener("mouseleave",this._eventHandlers.mouseleave,t),this._target.addEventListener("mousemove",this._eventHandlers.mousemove,t),this._target.addEventListener("mouseup",this._eventHandlers.mouseup,t)}this.clear()}detach(){if(this._target){if(ai){const i={capture:!0,passive:!0};this._target.removeEventListener("mouseover",this._eventHandlers.mouseover,i),this._target.removeEventListener("mouseleave",this._eventHandlers.mouseleave,i),this._target.removeEventListener("mousemove",this._eventHandlers.mousemove,i),this._target.removeEventListener("mouseup",this._eventHandlers.mouseup,i),document.body.removeChild(this._canvas)}this._target=null}}change(i,t,n,d,e){if(d===0||e===0){this.clear();return}this._position.x=this._position.x+this._hotSpot.x-t,this._position.y=this._position.y+this._hotSpot.y-n,this._hotSpot.x=t,this._hotSpot.y=n;let a=this._canvas.getContext("2d");this._canvas.width=d,this._canvas.height=e;let u=new ImageData(new Uint8ClampedArray(i),d,e);if(a.clearRect(0,0,d,e),a.putImageData(u,0,0),ai)this._updatePosition();else{let v=this._canvas.toDataURL();this._target.style.cursor="url("+v+")"+t+" "+n+", default"}}clear(){this._target.style.cursor="none",this._canvas.width=0,this._canvas.height=0,this._position.x=this._position.x+this._hotSpot.x,this._position.y=this._position.y+this._hotSpot.y,this._hotSpot.x=0,this._hotSpot.y=0}move(i,t){if(!ai)return;window.visualViewport?(this._position.x=i+window.visualViewport.offsetLeft,this._position.y=t+window.visualViewport.offsetTop):(this._position.x=i,this._position.y=t),this._updatePosition();let n=document.elementFromPoint(i,t);this._updateVisibility(n)}_handleMouseOver(i){this._handleMouseMove(i)}_handleMouseLeave(i){this._updateVisibility(i.relatedTarget)}_handleMouseMove(i){this._updateVisibility(i.target),this._position.x=i.clientX-this._hotSpot.x,this._position.y=i.clientY-this._hotSpot.y,this._updatePosition()}_handleMouseUp(i){let t=document.elementFromPoint(i.clientX,i.clientY);this._updateVisibility(t),this._captureIsActive()&&window.setTimeout(()=>{this._target&&(t=document.elementFromPoint(i.clientX,i.clientY),this._updateVisibility(t))},0)}_showCursor(){this._canvas.style.visibility==="hidden"&&(this._canvas.style.visibility="")}_hideCursor(){this._canvas.style.visibility!=="hidden"&&(this._canvas.style.visibility="hidden")}_shouldShowCursor(i){return i?i===this._target?!0:!(!this._target.contains(i)||window.getComputedStyle(i).cursor!=="none"):!1}_updateVisibility(i){this._captureIsActive()&&(i=document.captureElement),this._shouldShowCursor(i)?this._showCursor():this._hideCursor()}_updatePosition(){this._canvas.style.left=this._position.x+"px",this._canvas.style.top=this._position.y+"px"}_captureIsActive(){return document.captureElement&&document.documentElement.contains(document.captureElement)}}const On=40*1024*1024,Er={CONNECTING:"connecting",OPEN:"open",CLOSING:"closing",CLOSED:"closed"},Lr={CONNECTING:[WebSocket.CONNECTING,Er.CONNECTING],OPEN:[WebSocket.OPEN,Er.OPEN],CLOSING:[WebSocket.CLOSING,Er.CLOSING],CLOSED:[WebSocket.CLOSED,Er.CLOSED]},io=["send","close","binaryType","onerror","onmessage","onopen","protocol","readyState"];class ll{constructor(){this._websocket=null,this._rQi=0,this._rQlen=0,this._rQbufferSize=1024*1024*4,this._rQ=null,this._sQbufferSize=1024*10,this._sQlen=0,this._sQ=null,this._eventHandlers={message:()=>{},open:()=>{},close:()=>{},error:()=>{}}}get readyState(){let i;return this._websocket===null?"unused":(i=this._websocket.readyState,Lr.CONNECTING.includes(i)?"connecting":Lr.OPEN.includes(i)?"open":Lr.CLOSING.includes(i)?"closing":Lr.CLOSED.includes(i)?"closed":"unknown")}get sQ(){return this._sQ}get rQ(){return this._rQ}get rQi(){return this._rQi}set rQi(i){this._rQi=i}get rQlen(){return this._rQlen-this._rQi}rQpeek8(){return this._rQ[this._rQi]}rQskipBytes(i){this._rQi+=i}rQshift8(){return this._rQshift(1)}rQshift16(){return this._rQshift(2)}rQshift32(){return this._rQshift(4)}_rQshift(i){let t=0;for(let n=i-1;n>=0;n--)t+=this._rQ[this._rQi++]<<n*8;return t}rQshiftStr(i){typeof i>"u"&&(i=this.rQlen);let t="";for(let n=0;n<i;n+=4096){let d=this.rQshiftBytes(Math.min(4096,i-n));t+=String.fromCharCode.apply(null,d)}return t}rQshiftBytes(i){return typeof i>"u"&&(i=this.rQlen),this._rQi+=i,new Uint8Array(this._rQ.buffer,this._rQi-i,i)}rQshiftTo(i,t){t===void 0&&(t=this.rQlen),i.set(new Uint8Array(this._rQ.buffer,this._rQi,t)),this._rQi+=t}rQslice(i,t=this.rQlen){return new Uint8Array(this._rQ.buffer,this._rQi+i,t-i)}rQwait(i,t,n){if(this.rQlen<t){if(n){if(this._rQi<n)throw new Error("rQwait cannot backup "+n+" bytes");this._rQi-=n}return!0}return!1}flush(){this._sQlen>0&&this.readyState==="open"&&(this._websocket.send(this._encodeMessage()),this._sQlen=0)}send(i){this._sQ.set(i,this._sQlen),this._sQlen+=i.length,this.flush()}sendString(i){this.send(i.split("").map(t=>t.charCodeAt(0)))}off(i){this._eventHandlers[i]=()=>{}}on(i,t){this._eventHandlers[i]=t}_allocateBuffers(){this._rQ=new Uint8Array(this._rQbufferSize),this._sQ=new Uint8Array(this._sQbufferSize)}init(){this._allocateBuffers(),this._rQi=0,this._websocket=null}open(i,t){this.attach(new WebSocket(i,t))}attach(i){this.init();const t=[...Object.keys(i),...Object.getOwnPropertyNames(Object.getPrototypeOf(i))];for(let n=0;n<io.length;n++){const d=io[n];if(t.indexOf(d)<0)throw new Error("Raw channel missing property: "+d)}this._websocket=i,this._websocket.binaryType="arraybuffer",this._websocket.onmessage=this._recvMessage.bind(this),this._websocket.onopen=()=>{ue(">> WebSock.onopen"),this._websocket.protocol&&Ne("Server choose sub-protocol: "+this._websocket.protocol),this._eventHandlers.open(),ue("<< WebSock.onopen")},this._websocket.onclose=n=>{ue(">> WebSock.onclose"),this._eventHandlers.close(n),ue("<< WebSock.onclose")},this._websocket.onerror=n=>{ue(">> WebSock.onerror: "+n),this._eventHandlers.error(n),ue("<< WebSock.onerror: "+n)}}close(){this._websocket&&((this.readyState==="connecting"||this.readyState==="open")&&(Ne("Closing WebSocket connection"),this._websocket.close()),this._websocket.onmessage=()=>{})}_encodeMessage(){return new Uint8Array(this._sQ.buffer,0,this._sQlen)}_expandCompactRQ(i){const t=(this._rQlen-this._rQi+i)*8,n=this._rQbufferSize<t;if(n&&(this._rQbufferSize=Math.max(this._rQbufferSize*2,t)),this._rQbufferSize>On&&(this._rQbufferSize=On,this._rQbufferSize-this.rQlen<i))throw new Error("Receive Queue buffer exceeded "+On+" bytes, and the new message could not fit");if(n){const d=this._rQ.buffer;this._rQ=new Uint8Array(this._rQbufferSize),this._rQ.set(new Uint8Array(d,this._rQi,this._rQlen-this._rQi))}else this._rQ.copyWithin(0,this._rQi,this._rQlen);this._rQlen=this._rQlen-this._rQi,this._rQi=0}_DecodeMessage(i){const t=new Uint8Array(i);t.length>this._rQbufferSize-this._rQlen&&this._expandCompactRQ(t.length),this._rQ.set(t,this._rQlen),this._rQlen+=t.length}_recvMessage(i){this._DecodeMessage(i.data),this.rQlen>0?(this._eventHandlers.message(),this._rQlen==this._rQi&&(this._rQlen=0,this._rQi=0)):ue("Ignoring empty message")}}var hl={Again:57349,AltLeft:56,AltRight:57400,ArrowDown:57424,ArrowLeft:57419,ArrowRight:57421,ArrowUp:57416,AudioVolumeDown:57390,AudioVolumeMute:57376,AudioVolumeUp:57392,Backquote:41,Backslash:43,Backspace:14,BracketLeft:26,BracketRight:27,BrowserBack:57450,BrowserFavorites:57446,BrowserForward:57449,BrowserHome:57394,BrowserRefresh:57447,BrowserSearch:57445,BrowserStop:57448,CapsLock:58,Comma:51,ContextMenu:57437,ControlLeft:29,ControlRight:57373,Convert:121,Copy:57464,Cut:57404,Delete:57427,Digit0:11,Digit1:2,Digit2:3,Digit3:4,Digit4:5,Digit5:6,Digit6:7,Digit7:8,Digit8:9,Digit9:10,Eject:57469,End:57423,Enter:28,Equal:13,Escape:1,F1:59,F10:68,F11:87,F12:88,F13:93,F14:94,F15:95,F16:85,F17:57347,F18:57463,F19:57348,F2:60,F20:90,F21:116,F22:57465,F23:109,F24:111,F3:61,F4:62,F5:63,F6:64,F7:65,F8:66,F9:67,Find:57409,Help:57461,Hiragana:119,Home:57415,Insert:57426,IntlBackslash:86,IntlRo:115,IntlYen:125,KanaMode:112,Katakana:120,KeyA:30,KeyB:48,KeyC:46,KeyD:32,KeyE:18,KeyF:33,KeyG:34,KeyH:35,KeyI:23,KeyJ:36,KeyK:37,KeyL:38,KeyM:50,KeyN:49,KeyO:24,KeyP:25,KeyQ:16,KeyR:19,KeyS:31,KeyT:20,KeyU:22,KeyV:47,KeyW:17,KeyX:45,KeyY:21,KeyZ:44,Lang1:114,Lang2:113,Lang3:120,Lang4:119,Lang5:118,LaunchApp1:57451,LaunchApp2:57377,LaunchMail:57452,MediaPlayPause:57378,MediaSelect:57453,MediaStop:57380,MediaTrackNext:57369,MediaTrackPrevious:57360,MetaLeft:57435,MetaRight:57436,Minus:12,NonConvert:123,NumLock:69,Numpad0:82,Numpad1:79,Numpad2:80,Numpad3:81,Numpad4:75,Numpad5:76,Numpad6:77,Numpad7:71,Numpad8:72,Numpad9:73,NumpadAdd:78,NumpadComma:126,NumpadDecimal:83,NumpadDivide:57397,NumpadEnter:57372,NumpadEqual:89,NumpadMultiply:55,NumpadParenLeft:57462,NumpadParenRight:57467,NumpadSubtract:74,Open:100,PageDown:57425,PageUp:57417,Paste:101,Pause:57414,Period:52,Power:57438,PrintScreen:84,Props:57350,Quote:40,ScrollLock:70,Semicolon:39,ShiftLeft:42,ShiftRight:54,Slash:53,Sleep:57439,Space:57,Suspend:57381,Tab:15,Undo:57351,WakeUp:57443};const de={encodingRaw:0,encodingCopyRect:1,encodingRRE:2,encodingHextile:5,encodingTight:7,encodingZRLE:16,encodingTightPNG:-260,encodingJPEG:21,pseudoEncodingQualityLevel9:-23,pseudoEncodingQualityLevel0:-32,pseudoEncodingDesktopSize:-223,pseudoEncodingLastRect:-224,pseudoEncodingCursor:-239,pseudoEncodingQEMUExtendedKeyEvent:-258,pseudoEncodingDesktopName:-307,pseudoEncodingExtendedDesktopSize:-308,pseudoEncodingXvp:-309,pseudoEncodingFence:-312,pseudoEncodingContinuousUpdates:-313,pseudoEncodingCompressLevel9:-247,pseudoEncodingCompressLevel0:-256,pseudoEncodingVMwareCursor:1464686180,pseudoEncodingExtendedClipboard:3231835598};class Gn{constructor(){this._key=null}get algorithm(){return{name:"AES-ECB"}}static async importKey(i,t,n,d){const e=new Gn;return await e._importKey(i,n,d),e}async _importKey(i,t,n){this._key=await window.crypto.subtle.importKey("raw",i,{name:"AES-CBC"},t,n)}async encrypt(i,t){const n=new Uint8Array(t);if(n.length%16!==0||this._key===null)return null;const d=n.length/16;for(let e=0;e<d;e++){const a=new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-CBC",iv:new Uint8Array(16)},this._key,n.slice(e*16,e*16+16))).slice(0,16);n.set(a,e*16)}return n}}class Zn{constructor(){this._rawKey=null,this._ctrKey=null,this._cbcKey=null,this._zeroBlock=new Uint8Array(16),this._prefixBlock0=this._zeroBlock,this._prefixBlock1=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1]),this._prefixBlock2=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2])}get algorithm(){return{name:"AES-EAX"}}async _encryptBlock(i){const t=await window.crypto.subtle.encrypt({name:"AES-CBC",iv:this._zeroBlock},this._cbcKey,i);return new Uint8Array(t).slice(0,16)}async _initCMAC(){const i=await this._encryptBlock(this._zeroBlock),t=new Uint8Array(16),n=i[0]>>>6;for(let e=0;e<15;e++)t[e]=i[e+1]>>6|i[e]<<2,i[e]=i[e+1]>>7|i[e]<<1;const d=[0,135,14,137];t[14]^=n>>>1,t[15]=i[15]<<2^d[n],i[15]=i[15]<<1^d[n>>1],this._k1=i,this._k2=t}async _encryptCTR(i,t){const n=await window.crypto.subtle.encrypt({name:"AES-CTR",counter:t,length:128},this._ctrKey,i);return new Uint8Array(n)}async _decryptCTR(i,t){const n=await window.crypto.subtle.decrypt({name:"AES-CTR",counter:t,length:128},this._ctrKey,i);return new Uint8Array(n)}async _computeCMAC(i,t){if(t.length!==16)return null;const n=Math.floor(i.length/16),d=Math.ceil(i.length/16),e=i.length-n*16,a=new Uint8Array((d+1)*16);if(a.set(t),a.set(i,16),e===0)for(let l=0;l<16;l++)a[n*16+l]^=this._k1[l];else{a[(n+1)*16+e]=128;for(let l=0;l<16;l++)a[(n+1)*16+l]^=this._k2[l]}let u=await window.crypto.subtle.encrypt({name:"AES-CBC",iv:this._zeroBlock},this._cbcKey,a);return u=new Uint8Array(u),u.slice(u.length-32,u.length-16)}static async importKey(i,t,n,d){const e=new Zn;return await e._importKey(i),e}async _importKey(i){this._rawKey=i,this._ctrKey=await window.crypto.subtle.importKey("raw",i,{name:"AES-CTR"},!1,["encrypt","decrypt"]),this._cbcKey=await window.crypto.subtle.importKey("raw",i,{name:"AES-CBC"},!1,["encrypt"]),await this._initCMAC()}async encrypt(i,t){const n=i.additionalData,d=i.iv,e=await this._computeCMAC(d,this._prefixBlock0),a=await this._encryptCTR(t,e),u=await this._computeCMAC(n,this._prefixBlock1),v=await this._computeCMAC(a,this._prefixBlock2);for(let _=0;_<16;_++)v[_]^=e[_]^u[_];const l=new Uint8Array(16+a.length);return l.set(a),l.set(v,a.length),l}async decrypt(i,t){const n=t.slice(0,t.length-16),d=i.additionalData,e=i.iv,a=t.slice(t.length-16),u=await this._computeCMAC(e,this._prefixBlock0),v=await this._computeCMAC(d,this._prefixBlock1),l=await this._computeCMAC(n,this._prefixBlock2);for(let S=0;S<16;S++)l[S]^=u[S]^v[S];if(l.length!==a.length)return null;for(let S=0;S<a.length;S++)if(l[S]!==a[S])return null;return await this._decryptCTR(n,u)}}const ro=[13,16,10,23,0,4,2,27,14,5,20,9,22,18,11,3,25,7,15,6,26,19,12,1,40,51,30,36,46,54,29,39,50,44,32,47,43,48,38,55,33,52,45,41,49,35,28,31],ul=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],K=0;let W,z,G,q,Q,Z;W=65536;z=1<<24;G=W|z;q=4;Q=1024;Z=q|Q;const no=[G|Q,K|K,W|K,G|Z,G|q,W|Z,K|q,W|K,K|Q,G|Q,G|Z,K|Q,z|Z,G|q,z|K,K|q,K|Z,z|Q,z|Q,W|Q,W|Q,G|K,G|K,z|Z,W|q,z|q,z|q,W|q,K|K,K|Z,W|Z,z|K,W|K,G|Z,K|q,G|K,G|Q,z|K,z|K,K|Q,G|q,W|K,W|Q,z|q,K|Q,K|q,z|Z,W|Z,G|Z,W|q,G|K,z|Z,z|q,K|Z,W|Z,G|Q,K|Z,z|Q,z|Q,K|K,W|q,W|Q,K|K,G|q];W=1<<20;z=1<<31;G=W|z;q=32;Q=32768;Z=q|Q;const so=[G|Z,z|Q,K|Q,W|Z,W|K,K|q,G|q,z|Z,z|q,G|Z,G|Q,z|K,z|Q,W|K,K|q,G|q,W|Q,W|q,z|Z,K|K,z|K,K|Q,W|Z,G|K,W|q,z|q,K|K,W|Q,K|Z,G|Q,G|K,K|Z,K|K,W|Z,G|q,W|K,z|Z,G|K,G|Q,K|Q,G|K,z|Q,K|q,G|Z,W|Z,K|q,K|Q,z|K,K|Z,G|Q,W|K,z|q,W|q,z|Z,z|q,W|q,W|Q,K|K,z|Q,K|Z,z|K,G|q,G|Z,W|Q];W=1<<17;z=1<<27;G=W|z;q=8;Q=512;Z=q|Q;const oo=[K|Z,G|Q,K|K,G|q,z|Q,K|K,W|Z,z|Q,W|q,z|q,z|q,W|K,G|Z,W|q,G|K,K|Z,z|K,K|q,G|Q,K|Q,W|Q,G|K,G|q,W|Z,z|Z,W|Q,W|K,z|Z,K|q,G|Z,K|Q,z|K,G|Q,z|K,W|q,K|Z,W|K,G|Q,z|Q,K|K,K|Q,W|q,G|Z,z|Q,z|q,K|Q,K|K,G|q,z|Z,W|K,z|K,G|Z,K|q,W|Z,W|Q,z|q,G|K,z|Z,K|Z,G|K,W|Z,K|q,G|q,W|Q];W=8192;z=1<<23;G=W|z;q=1;Q=128;Z=q|Q;const ao=[G|q,W|Z,W|Z,K|Q,G|Q,z|Z,z|q,W|q,K|K,G|K,G|K,G|Z,K|Z,K|K,z|Q,z|q,K|q,W|K,z|K,G|q,K|Q,z|K,W|q,W|Q,z|Z,K|q,W|Q,z|Q,W|K,G|Q,G|Z,K|Z,z|Q,z|q,G|K,G|Z,K|Z,K|K,K|K,G|K,W|Q,z|Q,z|Z,K|q,G|q,W|Z,W|Z,K|Q,G|Z,K|Z,K|q,W|K,z|q,W|q,G|Q,z|Z,W|q,W|Q,z|K,G|q,K|Q,z|K,W|K,G|Q];W=1<<25;z=1<<30;G=W|z;q=256;Q=1<<19;Z=q|Q;const co=[K|q,W|Z,W|Q,G|q,K|Q,K|q,z|K,W|Q,z|Z,K|Q,W|q,z|Z,G|q,G|Q,K|Z,z|K,W|K,z|Q,z|Q,K|K,z|q,G|Z,G|Z,W|q,G|Q,z|q,K|K,G|K,W|Z,W|K,G|K,K|Z,K|Q,G|q,K|q,W|K,z|K,W|Q,G|q,z|Z,W|q,z|K,G|Q,W|Z,z|Z,K|q,W|K,G|Q,G|Z,K|Z,G|K,G|Z,W|Q,K|K,z|Q,G|K,K|Z,W|q,z|q,K|Q,K|K,z|Q,W|Z,z|q];W=1<<22;z=1<<29;G=W|z;q=16;Q=16384;Z=q|Q;const lo=[z|q,G|K,K|Q,G|Z,G|K,K|q,G|Z,W|K,z|Q,W|Z,W|K,z|q,W|q,z|Q,z|K,K|Z,K|K,W|q,z|Z,K|Q,W|Q,z|Z,K|q,G|q,G|q,K|K,W|Z,G|Q,K|Z,W|Q,G|Q,z|K,z|Q,K|q,G|q,W|Q,G|Z,W|K,K|Z,z|q,W|K,z|Q,z|K,K|Z,z|q,G|Z,W|Q,G|K,W|Z,G|Q,K|K,G|q,K|q,K|Q,G|K,W|Z,K|Q,W|q,z|Z,K|K,G|Q,z|K,W|q,z|Z];W=1<<21;z=1<<26;G=W|z;q=2;Q=2048;Z=q|Q;const ho=[W|K,G|q,z|Z,K|K,K|Q,z|Z,W|Z,G|Q,G|Z,W|K,K|K,z|q,K|q,z|K,G|q,K|Z,z|Q,W|Z,W|q,z|Q,z|q,G|K,G|Q,W|q,G|K,K|Q,K|Z,G|Z,W|Q,K|q,z|K,W|Q,z|K,W|Q,W|K,z|Z,z|Z,G|q,G|q,K|q,W|q,z|K,z|Q,W|K,G|Q,K|Z,W|Z,G|Q,K|Z,z|q,G|Z,G|K,W|Q,K|K,K|q,G|Z,K|K,W|Z,G|K,K|Q,z|q,z|Q,K|Q,W|q];W=1<<18;z=1<<28;G=W|z;q=64;Q=4096;Z=q|Q;const uo=[z|Z,K|Q,W|K,G|Z,z|K,z|Z,K|q,z|K,W|q,G|K,G|Z,W|Q,G|Q,W|Z,K|Q,K|q,G|K,z|q,z|Q,K|Z,W|Q,W|q,G|q,G|Q,K|Z,K|K,K|K,G|q,z|q,z|Q,W|Z,W|K,W|Z,W|K,G|Q,K|Q,K|q,G|q,K|Q,W|Z,z|Q,K|q,z|q,G|K,G|q,z|K,W|K,z|Z,K|K,G|Z,W|q,z|q,G|K,z|Q,z|Z,K|K,G|Z,W|Q,W|Q,K|Z,K|Z,W|q,z|K,G|Q];class oa{constructor(i){this.keys=[];const t=[],n=[],d=[];for(let e=0,a=56;e<56;++e,a-=8){a+=a<-5?65:a<-3?31:a<-1?63:a===27?35:0;const u=a&7;t[e]=i[a>>>3]&1<<u?1:0}for(let e=0;e<16;++e){const a=e<<1,u=a+1;d[a]=d[u]=0;for(let v=28;v<59;v+=28)for(let l=v-28;l<v;++l){const _=l+ul[e];n[l]=_<v?t[_]:t[_-28]}for(let v=0;v<24;++v)n[ro[v]]!==0&&(d[a]|=1<<23-v),n[ro[v+24]]!==0&&(d[u]|=1<<23-v)}for(let e=0,a=0,u=0;e<16;++e){const v=d[a++],l=d[a++];this.keys[u]=(v&16515072)<<6,this.keys[u]|=(v&4032)<<10,this.keys[u]|=(l&16515072)>>>10,this.keys[u]|=(l&4032)>>>6,++u,this.keys[u]=(v&258048)<<12,this.keys[u]|=(v&63)<<16,this.keys[u]|=(l&258048)>>>4,this.keys[u]|=l&63,++u}}enc8(i){const t=i.slice();let n=0,d,e,a;d=t[n++]<<24|t[n++]<<16|t[n++]<<8|t[n++],e=t[n++]<<24|t[n++]<<16|t[n++]<<8|t[n++],a=(d>>>4^e)&252645135,e^=a,d^=a<<4,a=(d>>>16^e)&65535,e^=a,d^=a<<16,a=(e>>>2^d)&858993459,d^=a,e^=a<<2,a=(e>>>8^d)&16711935,d^=a,e^=a<<8,e=e<<1|e>>>31&1,a=(d^e)&2863311530,d^=a,e^=a,d=d<<1|d>>>31&1;for(let u=0,v=0;u<8;++u){a=e<<28|e>>>4,a^=this.keys[v++];let l=ho[a&63];l|=co[a>>>8&63],l|=oo[a>>>16&63],l|=no[a>>>24&63],a=e^this.keys[v++],l|=uo[a&63],l|=lo[a>>>8&63],l|=ao[a>>>16&63],l|=so[a>>>24&63],d^=l,a=d<<28|d>>>4,a^=this.keys[v++],l=ho[a&63],l|=co[a>>>8&63],l|=oo[a>>>16&63],l|=no[a>>>24&63],a=d^this.keys[v++],l|=uo[a&63],l|=lo[a>>>8&63],l|=ao[a>>>16&63],l|=so[a>>>24&63],e^=l}for(e=e<<31|e>>>1,a=(d^e)&2863311530,d^=a,e^=a,d=d<<31|d>>>1,a=(d>>>8^e)&16711935,e^=a,d^=a<<8,a=(d>>>2^e)&858993459,e^=a,d^=a<<2,a=(e>>>16^d)&65535,d^=a,e^=a<<16,a=(e>>>4^d)&252645135,d^=a,e^=a<<4,a=[e,d],n=0;n<8;n++)t[n]=(a[n>>>2]>>>8*(3-n%4))%256,t[n]<0&&(t[n]+=256);return t}}class Yn{constructor(){this._cipher=null}get algorithm(){return{name:"DES-ECB"}}static importKey(i,t,n,d){const e=new Yn;return e._importKey(i),e}_importKey(i,t,n){this._cipher=new oa(i)}encrypt(i,t){const n=new Uint8Array(t);if(n.length%8!==0||this._cipher===null)return null;const d=n.length/8;for(let e=0;e<d;e++)n.set(this._cipher.enc8(n.slice(e*8,e*8+8)),e*8);return n}}class Jn{constructor(){this._cipher=null}get algorithm(){return{name:"DES-CBC"}}static importKey(i,t,n,d){const e=new Jn;return e._importKey(i),e}_importKey(i){this._cipher=new oa(i)}encrypt(i,t){const n=new Uint8Array(t);let d=new Uint8Array(i.iv);if(n.length%8!==0||this._cipher===null)return null;const e=n.length/8;for(let a=0;a<e;a++){for(let u=0;u<8;u++)d[u]^=t[a*8+u];d=this._cipher.enc8(d),n.set(d,a*8)}return n}}function Hr(r,i,t){let n=1n;for(r=r%t;i>0n;)(i&1n)===1n&&(n=n*r%t),i=i>>1n,r=r*r%t;return n}function Ur(r,i=0){let t=r.toString(16);i===0&&(i=Math.ceil(t.length/2)),t=t.padStart(i*2,"0");const n=t.length/2,d=new Uint8Array(n);for(let e=0;e<n;e++)d[e]=parseInt(t.slice(e*2,e*2+2),16);return d}function rt(r){let i="0x";for(let t=0;t<r.length;t++)i+=r[t].toString(16).padStart(2,"0");return BigInt(i)}class jr{constructor(){this._keyLength=0,this._keyBytes=0,this._n=null,this._e=null,this._d=null,this._nBigInt=null,this._eBigInt=null,this._dBigInt=null,this._extractable=!1}get algorithm(){return{name:"RSA-PKCS1-v1_5"}}_base64urlDecode(i){return i=i.replace(/-/g,"+").replace(/_/g,"/"),i=i.padEnd(Math.ceil(i.length/4)*4,"="),Po.decode(i)}_padArray(i,t){const n=new Uint8Array(t);return n.set(i,t-i.length),n}static async generateKey(i,t,n){const d=new jr;return await d._generateKey(i,t),{privateKey:d}}async _generateKey(i,t){this._keyLength=i.modulusLength,this._keyBytes=Math.ceil(this._keyLength/8);const n=await window.crypto.subtle.generateKey({name:"RSA-OAEP",modulusLength:i.modulusLength,publicExponent:i.publicExponent,hash:{name:"SHA-256"}},!0,["encrypt","decrypt"]),d=await window.crypto.subtle.exportKey("jwk",n.privateKey);this._n=this._padArray(this._base64urlDecode(d.n),this._keyBytes),this._nBigInt=rt(this._n),this._e=this._padArray(this._base64urlDecode(d.e),this._keyBytes),this._eBigInt=rt(this._e),this._d=this._padArray(this._base64urlDecode(d.d),this._keyBytes),this._dBigInt=rt(this._d),this._extractable=t}static async importKey(i,t,n,d){if(d.length!==1||d[0]!=="encrypt")throw new Error("only support importing RSA public key");const e=new jr;return await e._importKey(i,n),e}async _importKey(i,t){const n=i.n,d=i.e;if(n.length!==d.length)throw new Error("the sizes of modulus and public exponent do not match");this._keyBytes=n.length,this._keyLength=this._keyBytes*8,this._n=new Uint8Array(this._keyBytes),this._e=new Uint8Array(this._keyBytes),this._n.set(n),this._e.set(d),this._nBigInt=rt(this._n),this._eBigInt=rt(this._e),this._extractable=t}async encrypt(i,t){if(t.length>this._keyBytes-11)return null;const n=new Uint8Array(this._keyBytes-t.length-3);window.crypto.getRandomValues(n);for(let u=0;u<n.length;u++)n[u]=Math.floor(n[u]*254/255+1);const d=new Uint8Array(this._keyBytes);d[1]=2,d.set(n,2),d.set(t,n.length+3);const e=rt(d),a=Hr(e,this._eBigInt,this._nBigInt);return Ur(a,this._keyBytes)}async decrypt(i,t){if(t.length!==this._keyBytes)return null;const n=rt(t),d=Hr(n,this._dBigInt,this._nBigInt),e=Ur(d,this._keyBytes);if(e[0]!==0||e[1]!==2)return null;let a=2;for(;a<e.length&&e[a]!==0;a++);return a===e.length?null:e.slice(a+1,e.length)}async exportKey(){if(!this._extractable)throw new Error("key is not extractable");return{n:this._n,e:this._e,d:this._d}}}class fl{constructor(i){this._key=i}get algorithm(){return{name:"DH"}}exportKey(){return this._key}}class $n{constructor(){this._g=null,this._p=null,this._gBigInt=null,this._pBigInt=null,this._privateKey=null}get algorithm(){return{name:"DH"}}static generateKey(i,t){const n=new $n;return n._generateKey(i),{privateKey:n,publicKey:new fl(n._publicKey)}}_generateKey(i){const t=i.g,n=i.p;this._keyBytes=n.length,this._gBigInt=rt(t),this._pBigInt=rt(n),this._privateKey=window.crypto.getRandomValues(new Uint8Array(this._keyBytes)),this._privateKeyBigInt=rt(this._privateKey),this._publicKey=Ur(Hr(this._gBigInt,this._privateKeyBigInt,this._pBigInt),this._keyBytes)}deriveBits(i,t){const n=Math.ceil(t/8),d=new Uint8Array(i.public),e=n>this._keyBytes?n:this._keyBytes,a=Hr(rt(d),this._privateKeyBigInt,this._pBigInt);return Ur(a,e).slice(0,e)}}async function _l(r){let i="";for(let t=0;t<r.length;t++)i+=String.fromCharCode(r[t]);return dl(vl(gl(pl(i),8*i.length)))}function dl(r){let i=new Uint8Array(r.length);for(let t=0;t<r.length;t++)i[t]=r.charCodeAt(t);return i}function pl(r){let i=Array(r.length>>2);for(let t=0;t<i.length;t++)i[t]=0;for(let t=0;t<8*r.length;t+=8)i[t>>5]|=(255&r.charCodeAt(t/8))<<t%32;return i}function vl(r){let i="";for(let t=0;t<32*r.length;t+=8)i+=String.fromCharCode(r[t>>5]>>>t%32&255);return i}function gl(r,i){r[i>>5]|=128<<i%32,r[14+(i+64>>>9<<4)]=i;let t=1732584193,n=-271733879,d=-1732584194,e=271733878;for(let a=0;a<r.length;a+=16){let u=t,v=n,l=d,_=e;n=je(n=je(n=je(n=je(n=Ue(n=Ue(n=Ue(n=Ue(n=He(n=He(n=He(n=He(n=Ie(n=Ie(n=Ie(n=Ie(n,d=Ie(d,e=Ie(e,t=Ie(t,n,d,e,r[a+0],7,-680876936),n,d,r[a+1],12,-389564586),t,n,r[a+2],17,606105819),e,t,r[a+3],22,-1044525330),d=Ie(d,e=Ie(e,t=Ie(t,n,d,e,r[a+4],7,-176418897),n,d,r[a+5],12,1200080426),t,n,r[a+6],17,-1473231341),e,t,r[a+7],22,-45705983),d=Ie(d,e=Ie(e,t=Ie(t,n,d,e,r[a+8],7,1770035416),n,d,r[a+9],12,-1958414417),t,n,r[a+10],17,-42063),e,t,r[a+11],22,-1990404162),d=Ie(d,e=Ie(e,t=Ie(t,n,d,e,r[a+12],7,1804603682),n,d,r[a+13],12,-40341101),t,n,r[a+14],17,-1502002290),e,t,r[a+15],22,1236535329),d=He(d,e=He(e,t=He(t,n,d,e,r[a+1],5,-165796510),n,d,r[a+6],9,-1069501632),t,n,r[a+11],14,643717713),e,t,r[a+0],20,-373897302),d=He(d,e=He(e,t=He(t,n,d,e,r[a+5],5,-701558691),n,d,r[a+10],9,38016083),t,n,r[a+15],14,-660478335),e,t,r[a+4],20,-405537848),d=He(d,e=He(e,t=He(t,n,d,e,r[a+9],5,568446438),n,d,r[a+14],9,-1019803690),t,n,r[a+3],14,-187363961),e,t,r[a+8],20,1163531501),d=He(d,e=He(e,t=He(t,n,d,e,r[a+13],5,-1444681467),n,d,r[a+2],9,-51403784),t,n,r[a+7],14,1735328473),e,t,r[a+12],20,-1926607734),d=Ue(d,e=Ue(e,t=Ue(t,n,d,e,r[a+5],4,-378558),n,d,r[a+8],11,-2022574463),t,n,r[a+11],16,1839030562),e,t,r[a+14],23,-35309556),d=Ue(d,e=Ue(e,t=Ue(t,n,d,e,r[a+1],4,-1530992060),n,d,r[a+4],11,1272893353),t,n,r[a+7],16,-155497632),e,t,r[a+10],23,-1094730640),d=Ue(d,e=Ue(e,t=Ue(t,n,d,e,r[a+13],4,681279174),n,d,r[a+0],11,-358537222),t,n,r[a+3],16,-722521979),e,t,r[a+6],23,76029189),d=Ue(d,e=Ue(e,t=Ue(t,n,d,e,r[a+9],4,-640364487),n,d,r[a+12],11,-421815835),t,n,r[a+15],16,530742520),e,t,r[a+2],23,-995338651),d=je(d,e=je(e,t=je(t,n,d,e,r[a+0],6,-198630844),n,d,r[a+7],10,1126891415),t,n,r[a+14],15,-1416354905),e,t,r[a+5],21,-57434055),d=je(d,e=je(e,t=je(t,n,d,e,r[a+12],6,1700485571),n,d,r[a+3],10,-1894986606),t,n,r[a+10],15,-1051523),e,t,r[a+1],21,-2054922799),d=je(d,e=je(e,t=je(t,n,d,e,r[a+8],6,1873313359),n,d,r[a+15],10,-30611744),t,n,r[a+6],15,-1560198380),e,t,r[a+13],21,1309151649),d=je(d,e=je(e,t=je(t,n,d,e,r[a+4],6,-145523070),n,d,r[a+11],10,-1120210379),t,n,r[a+2],15,718787259),e,t,r[a+9],21,-343485551),t=Lt(t,u),n=Lt(n,v),d=Lt(d,l),e=Lt(e,_)}return Array(t,n,d,e)}function zr(r,i,t,n,d,e){return Lt(yl(Lt(Lt(i,r),Lt(n,e)),d),t)}function Ie(r,i,t,n,d,e,a){return zr(i&t|~i&n,r,i,d,e,a)}function He(r,i,t,n,d,e,a){return zr(i&n|t&~n,r,i,d,e,a)}function Ue(r,i,t,n,d,e,a){return zr(i^t^n,r,i,d,e,a)}function je(r,i,t,n,d,e,a){return zr(t^(i|~n),r,i,d,e,a)}function Lt(r,i){let t=(65535&r)+(65535&i);return(r>>16)+(i>>16)+(t>>16)<<16|65535&t}function yl(r,i){return r<<i|r>>>32-i}class xl{constructor(){this._algorithms={"AES-ECB":Gn,"AES-EAX":Zn,"DES-ECB":Yn,"DES-CBC":Jn,"RSA-PKCS1-v1_5":jr,DH:$n,MD5:_l}}encrypt(i,t,n){if(t.algorithm.name!==i.name)throw new Error("algorithm does not match");if(typeof t.encrypt!="function")throw new Error("key does not support encryption");return t.encrypt(i,n)}decrypt(i,t,n){if(t.algorithm.name!==i.name)throw new Error("algorithm does not match");if(typeof t.decrypt!="function")throw new Error("key does not support encryption");return t.decrypt(i,n)}importKey(i,t,n,d,e){if(i!=="raw")throw new Error("key format is not supported");const a=this._algorithms[n.name];if(typeof a>"u"||typeof a.importKey!="function")throw new Error("algorithm is not supported");return a.importKey(t,n,d,e)}generateKey(i,t,n){const d=this._algorithms[i.name];if(typeof d>"u"||typeof d.generateKey!="function")throw new Error("algorithm is not supported");return d.generateKey(i,t,n)}exportKey(i,t){if(i!=="raw")throw new Error("key format is not supported");if(typeof t.exportKey!="function")throw new Error("key does not support exportKey");return t.exportKey()}digest(i,t){const n=this._algorithms[i];if(typeof n!="function")throw new Error("algorithm is not supported");return n(t)}deriveBits(i,t,n){if(t.algorithm.name!==i.name)throw new Error("algorithm does not match");if(typeof t.deriveBits!="function")throw new Error("key does not support deriveBits");return t.deriveBits(i,n)}}var Le=new xl;class fo{constructor(){this._cipher=null,this._counter=new Uint8Array(16)}async setKey(i){this._cipher=await Le.importKey("raw",i,{name:"AES-EAX"},!1,["encrypt, decrypt"])}async makeMessage(i){const t=new Uint8Array([(i.length&65280)>>>8,i.length&255]),n=await Le.encrypt({name:"AES-EAX",iv:this._counter,additionalData:t},this._cipher,i);for(let e=0;e<16&&this._counter[e]++===255;e++);const d=new Uint8Array(i.length+2+16);return d.set(t),d.set(n,2),d}async receiveMessage(i,t){const n=new Uint8Array([(i&65280)>>>8,i&255]),d=await Le.decrypt({name:"AES-EAX",iv:this._counter,additionalData:n},this._cipher,t);for(let e=0;e<16&&this._counter[e]++===255;e++);return d}}class bl extends Ko{constructor(i,t){super(),this._hasStarted=!1,this._checkSock=null,this._checkCredentials=null,this._approveServerResolve=null,this._sockReject=null,this._credentialsReject=null,this._approveServerReject=null,this._sock=i,this._getCredentials=t}_waitSockAsync(i){return new Promise((t,n)=>{const d=()=>!this._sock.rQwait("RA2",i);d()?t():(this._checkSock=()=>{d()&&(t(),this._checkSock=null,this._sockReject=null)},this._sockReject=n)})}_waitApproveKeyAsync(){return new Promise((i,t)=>{this._approveServerResolve=i,this._approveServerReject=t})}_waitCredentialsAsync(i){const t=()=>i===1&&this._getCredentials().username!==void 0&&this._getCredentials().password!==void 0?!0:i===2&&this._getCredentials().password!==void 0;return new Promise((n,d)=>{t()?n():(this._checkCredentials=()=>{t()&&(n(),this._checkCredentials=null,this._credentialsReject=null)},this._credentialsReject=d)})}checkInternalEvents(){this._checkSock!==null&&this._checkSock(),this._checkCredentials!==null&&this._checkCredentials()}approveServer(){this._approveServerResolve!==null&&(this._approveServerResolve(),this._approveServerResolve=null)}disconnect(){this._sockReject!==null&&(this._sockReject(new Error("disconnect normally")),this._sockReject=null),this._credentialsReject!==null&&(this._credentialsReject(new Error("disconnect normally")),this._credentialsReject=null),this._approveServerReject!==null&&(this._approveServerReject(new Error("disconnect normally")),this._approveServerReject=null)}async negotiateRA2neAuthAsync(){this._hasStarted=!0,await this._waitSockAsync(4);const i=this._sock.rQslice(0,4),t=this._sock.rQshift32();if(t<1024)throw new Error("RA2: server public key is too short: "+t);if(t>8192)throw new Error("RA2: server public key is too long: "+t);const n=Math.ceil(t/8);await this._waitSockAsync(n*2);const d=this._sock.rQshiftBytes(n),e=this._sock.rQshiftBytes(n),a=await Le.importKey("raw",{n:d,e},{name:"RSA-PKCS1-v1_5"},!1,["encrypt"]),u=new Uint8Array(4+n*2);u.set(i),u.set(d,4),u.set(e,4+n),this.dispatchEvent(new CustomEvent("serververification",{detail:{type:"RSA",publickey:u}})),await this._waitApproveKeyAsync();const v=2048,l=Math.ceil(v/8),_=(await Le.generateKey({name:"RSA-PKCS1-v1_5",modulusLength:v,publicExponent:new Uint8Array([1,0,1])},!0,["encrypt"])).privateKey,S=await Le.exportKey("raw",_),b=S.n,p=S.e,g=new Uint8Array(4+l*2);g[0]=(v&4278190080)>>>24,g[1]=(v&16711680)>>>16,g[2]=(v&65280)>>>8,g[3]=v&255,g.set(b,4),g.set(p,4+l),this._sock.send(g);const w=new Uint8Array(16);window.crypto.getRandomValues(w);const x=await Le.encrypt({name:"RSA-PKCS1-v1_5"},a,w),h=new Uint8Array(2+n);if(h[0]=(n&65280)>>>8,h[1]=n&255,h.set(x,2),this._sock.send(h),await this._waitSockAsync(2),this._sock.rQshift16()!==l)throw new Error("RA2: wrong encrypted message length");const s=this._sock.rQshiftBytes(l),c=await Le.decrypt({name:"RSA-PKCS1-v1_5"},_,s);if(c===null||c.length!==16)throw new Error("RA2: corrupted server encrypted random");let o=new Uint8Array(32),f=new Uint8Array(32);o.set(c),o.set(w,16),f.set(w),f.set(c,16),o=await window.crypto.subtle.digest("SHA-1",o),o=new Uint8Array(o).slice(0,16),f=await window.crypto.subtle.digest("SHA-1",f),f=new Uint8Array(f).slice(0,16);const m=new fo;await m.setKey(o);const y=new fo;await y.setKey(f);let C=new Uint8Array(8+n*2+l*2),L=new Uint8Array(8+n*2+l*2);if(C.set(u),C.set(g,4+n*2),L.set(g),L.set(u,4+l*2),C=await window.crypto.subtle.digest("SHA-1",C),L=await window.crypto.subtle.digest("SHA-1",L),C=new Uint8Array(C),L=new Uint8Array(L),this._sock.send(await m.makeMessage(L)),await this._waitSockAsync(38),this._sock.rQshift16()!==20)throw new Error("RA2: wrong server hash");const k=await y.receiveMessage(20,this._sock.rQshiftBytes(36));if(k===null)throw new Error("RA2: failed to authenticate the message");for(let F=0;F<20;F++)if(k[F]!==C[F])throw new Error("RA2: wrong server hash");if(await this._waitSockAsync(19),this._sock.rQshift16()!==1)throw new Error("RA2: wrong subtype");let E=await y.receiveMessage(1,this._sock.rQshiftBytes(17));if(E===null)throw new Error("RA2: failed to authenticate the message");if(E=E[0],E===1)(this._getCredentials().username===void 0||this._getCredentials().password===void 0)&&this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password"]}}));else if(E===2)this._getCredentials().password===void 0&&this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["password"]}}));else throw new Error("RA2: wrong subtype");await this._waitCredentialsAsync(E);let A;E===1?A=vt(this._getCredentials().username).slice(0,255):A="";const D=vt(this._getCredentials().password).slice(0,255),M=new Uint8Array(A.length+D.length+2);M[0]=A.length,M[A.length+1]=D.length;for(let F=0;F<A.length;F++)M[F+1]=A.charCodeAt(F);for(let F=0;F<D.length;F++)M[A.length+2+F]=D.charCodeAt(F);this._sock.send(await m.makeMessage(M))}get hasStarted(){return this._hasStarted}set hasStarted(i){this._hasStarted=i}}class ml{constructor(){this._lines=0}decodeRect(i,t,n,d,e,a,u){if(n===0||d===0)return!0;this._lines===0&&(this._lines=d);const v=u==8?1:4,l=n*v;if(e.rQwait("RAW",l))return!1;const _=t+(d-this._lines),S=Math.min(this._lines,Math.floor(e.rQlen/l)),b=n*S;let p=e.rQ,g=e.rQi;if(u==8){const w=new Uint8Array(b*4);for(let x=0;x<b;x++)w[x*4+0]=(p[g+x]>>0&3)*255/3,w[x*4+1]=(p[g+x]>>2&3)*255/3,w[x*4+2]=(p[g+x]>>4&3)*255/3,w[x*4+3]=255;p=w,g=0}for(let w=0;w<b;w++)p[g+w*4+3]=255;return a.blitImage(i,_,n,S,p,g),e.rQskipBytes(S*l),this._lines-=S,!(this._lines>0)}}class Sl{decodeRect(i,t,n,d,e,a,u){if(e.rQwait("COPYRECT",4))return!1;let v=e.rQshift16(),l=e.rQshift16();return n===0||d===0||a.copyImage(v,l,i,t,n,d),!0}}class wl{constructor(){this._subrects=0}decodeRect(i,t,n,d,e,a,u){if(this._subrects===0){if(e.rQwait("RRE",8))return!1;this._subrects=e.rQshift32();let v=e.rQshiftBytes(4);a.fillRect(i,t,n,d,v)}for(;this._subrects>0;){if(e.rQwait("RRE",12))return!1;let v=e.rQshiftBytes(4),l=e.rQshift16(),_=e.rQshift16(),S=e.rQshift16(),b=e.rQshift16();a.fillRect(i+l,t+_,S,b,v),this._subrects--}return!0}}class Cl{constructor(){this._tiles=0,this._lastsubencoding=0,this._tileBuffer=new Uint8Array(16*16*4)}decodeRect(i,t,n,d,e,a,u){for(this._tiles===0&&(this._tilesX=Math.ceil(n/16),this._tilesY=Math.ceil(d/16),this._totalTiles=this._tilesX*this._tilesY,this._tiles=this._totalTiles);this._tiles>0;){let v=1;if(e.rQwait("HEXTILE",v))return!1;let l=e.rQ,_=e.rQi,S=l[_];if(S>30)throw new Error("Illegal hextile subencoding (subencoding: "+S+")");const b=this._totalTiles-this._tiles,p=b%this._tilesX,g=Math.floor(b/this._tilesX),w=i+p*16,x=t+g*16,h=Math.min(16,i+n-w),s=Math.min(16,t+d-x);if(S&1)v+=h*s*4;else if(S&2&&(v+=4),S&4&&(v+=4),S&8){if(v++,e.rQwait("HEXTILE",v))return!1;let c=l[_+v-1];S&16?v+=c*6:v+=c*2}if(e.rQwait("HEXTILE",v))return!1;if(_++,S===0)this._lastsubencoding&1?ue("     Ignoring blank after RAW"):a.fillRect(w,x,h,s,this._background);else if(S&1){let c=h*s;for(let o=0;o<c;o++)l[_+o*4+3]=255;a.blitImage(w,x,h,s,l,_),_+=v-1}else{if(S&2&&(this._background=[l[_],l[_+1],l[_+2],l[_+3]],_+=4),S&4&&(this._foreground=[l[_],l[_+1],l[_+2],l[_+3]],_+=4),this._startTile(w,x,h,s,this._background),S&8){let c=l[_];_++;for(let o=0;o<c;o++){let f;S&16?(f=[l[_],l[_+1],l[_+2],l[_+3]],_+=4):f=this._foreground;const m=l[_];_++;const y=m>>4,C=m&15,L=l[_];_++;const k=(L>>4)+1,E=(L&15)+1;this._subTile(y,C,k,E,f)}}this._finishTile(a)}e.rQi=_,this._lastsubencoding=S,this._tiles--}return!0}_startTile(i,t,n,d,e){this._tileX=i,this._tileY=t,this._tileW=n,this._tileH=d;const a=e[0],u=e[1],v=e[2],l=this._tileBuffer;for(let _=0;_<n*d*4;_+=4)l[_]=a,l[_+1]=u,l[_+2]=v,l[_+3]=255}_subTile(i,t,n,d,e){const a=e[0],u=e[1],v=e[2],l=i+n,_=t+d,S=this._tileBuffer,b=this._tileW;for(let p=t;p<_;p++)for(let g=i;g<l;g++){const w=(g+p*b)*4;S[w]=a,S[w+1]=u,S[w+2]=v,S[w+3]=255}}_finishTile(i){i.blitImage(this._tileX,this._tileY,this._tileW,this._tileH,this._tileBuffer,0)}}class aa{constructor(){this._ctl=null,this._filter=null,this._numColors=0,this._palette=new Uint8Array(1024),this._len=0,this._zlibs=[];for(let i=0;i<4;i++)this._zlibs[i]=new Wn}decodeRect(i,t,n,d,e,a,u){if(this._ctl===null){if(e.rQwait("TIGHT compression-control",1))return!1;this._ctl=e.rQshift8();for(let l=0;l<4;l++)this._ctl>>l&1&&(this._zlibs[l].reset(),Ne("Reset zlib stream "+l));this._ctl=this._ctl>>4}let v;if(this._ctl===8)v=this._fillRect(i,t,n,d,e,a,u);else if(this._ctl===9)v=this._jpegRect(i,t,n,d,e,a,u);else if(this._ctl===10)v=this._pngRect(i,t,n,d,e,a,u);else if(!(this._ctl&8))v=this._basicRect(this._ctl,i,t,n,d,e,a,u);else throw new Error("Illegal tight compression received (ctl: "+this._ctl+")");return v&&(this._ctl=null),v}_fillRect(i,t,n,d,e,a,u){if(e.rQwait("TIGHT",3))return!1;const v=e.rQi,l=e.rQ;return a.fillRect(i,t,n,d,[l[v],l[v+1],l[v+2]],!1),e.rQskipBytes(3),!0}_jpegRect(i,t,n,d,e,a,u){let v=this._readData(e);return v===null?!1:(a.imageRect(i,t,n,d,"image/jpeg",v),!0)}_pngRect(i,t,n,d,e,a,u){throw new Error("PNG received in standard Tight rect")}_basicRect(i,t,n,d,e,a,u,v){if(this._filter===null)if(i&4){if(a.rQwait("TIGHT",1))return!1;this._filter=a.rQshift8()}else this._filter=0;let l=i&3,_;switch(this._filter){case 0:_=this._copyFilter(l,t,n,d,e,a,u,v);break;case 1:_=this._paletteFilter(l,t,n,d,e,a,u,v);break;case 2:_=this._gradientFilter(l,t,n,d,e,a,u,v);break;default:throw new Error("Illegal tight filter received (ctl: "+this._filter+")")}return _&&(this._filter=null),_}_copyFilter(i,t,n,d,e,a,u,v){const l=d*e*3;let _;if(l===0)return!0;if(l<12){if(a.rQwait("TIGHT",l))return!1;_=a.rQshiftBytes(l)}else{if(_=this._readData(a),_===null)return!1;this._zlibs[i].setInput(_),_=this._zlibs[i].inflate(l),this._zlibs[i].setInput(null)}let S=new Uint8Array(d*e*4);for(let b=0,p=0;b<d*e*4;b+=4,p+=3)S[b]=_[p],S[b+1]=_[p+1],S[b+2]=_[p+2],S[b+3]=255;return u.blitImage(t,n,d,e,S,0,!1),!0}_paletteFilter(i,t,n,d,e,a,u,v){if(this._numColors===0){if(a.rQwait("TIGHT palette",1))return!1;const p=a.rQpeek8()+1,g=p*3;if(a.rQwait("TIGHT palette",1+g))return!1;this._numColors=p,a.rQskipBytes(1),a.rQshiftTo(this._palette,g)}const l=this._numColors<=2?1:8,S=Math.floor((d*l+7)/8)*e;let b;if(S===0)return!0;if(S<12){if(a.rQwait("TIGHT",S))return!1;b=a.rQshiftBytes(S)}else{if(b=this._readData(a),b===null)return!1;this._zlibs[i].setInput(b),b=this._zlibs[i].inflate(S),this._zlibs[i].setInput(null)}return this._numColors==2?this._monoRect(t,n,d,e,b,this._palette,u):this._paletteRect(t,n,d,e,b,this._palette,u),this._numColors=0,!0}_monoRect(i,t,n,d,e,a,u){const v=this._getScratchBuffer(n*d*4),l=Math.floor((n+7)/8),_=Math.floor(n/8);for(let S=0;S<d;S++){let b,p,g;for(g=0;g<_;g++)for(let w=7;w>=0;w--)b=(S*n+g*8+7-w)*4,p=(e[S*l+g]>>w&1)*3,v[b]=a[p],v[b+1]=a[p+1],v[b+2]=a[p+2],v[b+3]=255;for(let w=7;w>=8-n%8;w--)b=(S*n+g*8+7-w)*4,p=(e[S*l+g]>>w&1)*3,v[b]=a[p],v[b+1]=a[p+1],v[b+2]=a[p+2],v[b+3]=255}u.blitImage(i,t,n,d,v,0,!1)}_paletteRect(i,t,n,d,e,a,u){const v=this._getScratchBuffer(n*d*4),l=n*d*4;for(let _=0,S=0;_<l;_+=4,S++){const b=e[S]*3;v[_]=a[b],v[_+1]=a[b+1],v[_+2]=a[b+2],v[_+3]=255}u.blitImage(i,t,n,d,v,0,!1)}_gradientFilter(i,t,n,d,e,a,u,v){throw new Error("Gradient filter not implemented")}_readData(i){if(this._len===0){if(i.rQwait("TIGHT",3))return null;let n;n=i.rQshift8(),this._len=n&127,n&128&&(n=i.rQshift8(),this._len|=(n&127)<<7,n&128&&(n=i.rQshift8(),this._len|=n<<14))}if(i.rQwait("TIGHT",this._len))return null;let t=i.rQshiftBytes(this._len);return this._len=0,t}_getScratchBuffer(i){return(!this._scratchBuffer||this._scratchBuffer.length<i)&&(this._scratchBuffer=new Uint8Array(i)),this._scratchBuffer}}class kl extends aa{_pngRect(i,t,n,d,e,a,u){let v=this._readData(e);return v===null?!1:(a.imageRect(i,t,n,d,"image/png",v),!0)}_basicRect(i,t,n,d,e,a,u,v){throw new Error("BasicCompression received in TightPNG rect")}}const Ar=64,Mr=64;class El{constructor(){this._length=0,this._inflator=new Wn,this._pixelBuffer=new Uint8Array(Ar*Mr*4),this._tileBuffer=new Uint8Array(Ar*Mr*4)}decodeRect(i,t,n,d,e,a,u){if(this._length===0){if(e.rQwait("ZLib data length",4))return!1;this._length=e.rQshift32()}if(e.rQwait("Zlib data",this._length))return!1;const v=e.rQshiftBytes(this._length);this._inflator.setInput(v);for(let l=t;l<t+d;l+=Mr){let _=Math.min(Mr,t+d-l);for(let S=i;S<i+n;S+=Ar){let b=Math.min(Ar,i+n-S);const p=b*_,g=this._inflator.inflate(1)[0];if(g===0){const w=this._readPixels(p);a.blitImage(S,l,b,_,w,0,!1)}else if(g===1){const w=this._readPixels(1);a.fillRect(S,l,b,_,[w[0],w[1],w[2]])}else if(g>=2&&g<=16){const w=this._decodePaletteTile(g,p,b,_);a.blitImage(S,l,b,_,w,0,!1)}else if(g===128){const w=this._decodeRLETile(p);a.blitImage(S,l,b,_,w,0,!1)}else if(g>=130&&g<=255){const w=this._decodeRLEPaletteTile(g-128,p);a.blitImage(S,l,b,_,w,0,!1)}else throw new Error("Unknown subencoding: "+g)}}return this._length=0,!0}_getBitsPerPixelInPalette(i){if(i<=2)return 1;if(i<=4)return 2;if(i<=16)return 4}_readPixels(i){let t=this._pixelBuffer;const n=this._inflator.inflate(3*i);for(let d=0,e=0;d<i*4;d+=4,e+=3)t[d]=n[e],t[d+1]=n[e+1],t[d+2]=n[e+2],t[d+3]=255;return t}_decodePaletteTile(i,t,n,d){const e=this._tileBuffer,a=this._readPixels(i),u=this._getBitsPerPixelInPalette(i),v=(1<<u)-1;let l=0,_=this._inflator.inflate(1)[0];for(let S=0;S<d;S++){let b=8-u;for(let p=0;p<n;p++){b<0&&(b=8-u,_=this._inflator.inflate(1)[0]);let g=_>>b&v;e[l]=a[g*4],e[l+1]=a[g*4+1],e[l+2]=a[g*4+2],e[l+3]=a[g*4+3],l+=4,b-=u}b<8-u&&S<d-1&&(_=this._inflator.inflate(1)[0])}return e}_decodeRLETile(i){const t=this._tileBuffer;let n=0;for(;n<i;){const d=this._readPixels(1),e=this._readRLELength();for(let a=0;a<e;a++)t[n*4]=d[0],t[n*4+1]=d[1],t[n*4+2]=d[2],t[n*4+3]=d[3],n++}return t}_decodeRLEPaletteTile(i,t){const n=this._tileBuffer,d=this._readPixels(i);let e=0;for(;e<t;){let a=this._inflator.inflate(1)[0],u=1;if(a>=128&&(a-=128,u=this._readRLELength()),a>i)throw new Error("Too big index in palette: "+a+", palette size: "+i);if(e+u>t)throw new Error("Too big rle length in palette mode: "+u+", allowed length is: "+(t-e));for(let v=0;v<u;v++)n[e*4]=d[a*4],n[e*4+1]=d[a*4+1],n[e*4+2]=d[a*4+2],n[e*4+3]=d[a*4+3],e++}return n}_readRLELength(){let i=0,t=0;do t=this._inflator.inflate(1)[0],i+=t;while(t===255);return i+1}}class Ll{constructor(){this._quantTables=[],this._huffmanTables=[],this._cachedQuantTables=[],this._cachedHuffmanTables=[],this._jpegLength=0,this._segments=[]}decodeRect(i,t,n,d,e,a,u){if(!this._parseJPEG(e.rQslice(0)))return!1;const v=e.rQshiftBytes(this._jpegLength);if(this._quantTables.length!=0&&this._huffmanTables.length!=0)return a.imageRect(i,t,n,d,"image/jpeg",v),!0;{const l=this._segments.findIndex(p=>p[1]==192||p[1]==194);if(l==-1)throw new Error("Illegal JPEG image without SOF");let _=this._segments.slice(0,l);_=_.concat(this._quantTables.length?this._quantTables:this._cachedQuantTables),_.push(this._segments[l]),_=_.concat(this._huffmanTables.length?this._huffmanTables:this._cachedHuffmanTables,this._segments.slice(l+1));let S=0;for(let p=0;p<_.length;p++)S+=_[p].length;const b=new Uint8Array(S);S=0;for(let p=0;p<_.length;p++)b.set(_[p],S),S+=_[p].length;return a.imageRect(i,t,n,d,"image/jpeg",b),!0}}_parseJPEG(i){this._quantTables.length!=0&&(this._cachedQuantTables=this._quantTables),this._huffmanTables.length!=0&&(this._cachedHuffmanTables=this._huffmanTables),this._quantTables=[],this._huffmanTables=[],this._segments=[];let t=0,n=i.length;for(;;){let d=t;if(d+2>n)return!1;if(i[d]!=255)throw new Error("Illegal JPEG marker received (byte: "+i[d]+")");const e=i[d+1];if(d+=2,e==217)return this._jpegLength=d,this._segments.push(i.slice(t,d)),!0;if(e==218){let v=!1;for(let l=d+3;l+1<n;l++)if(i[l]==255&&i[l+1]!=0&&!(i[l+1]>=208&&i[l+1]<=215)){d=l,v=!0;break}if(!v)return!1;this._segments.push(i.slice(t,d)),t=d;continue}else if(e>=208&&e<217||e==1){this._segments.push(i.slice(t,d)),t=d;continue}if(d+2>n)return!1;const a=(i[d]<<8)+i[d+1]-2;if(a<0)throw new Error("Illegal JPEG length received (length: "+a+")");if(d+=2,d+a>n)return!1;d+=a;const u=i.slice(t,d);e==196?this._huffmanTables.push(u):e==219&&this._quantTables.push(u),this._segments.push(u),t=d}}}const Al=3,Ml="rgb(40, 40, 40)",_o=17,po=50,vo=19,ci=75,Ct=50,Rl=1e3,Tl=50,go=1,Rr=2,yo=6,xo=16,Kn=19,bo=22,mo=30,So=113,wo=129,Co=256,ft=1,ko=1<<24,Dr=1<<25,Eo=1<<26,ui=1<<27,Br=1<<28;class pe extends Ko{constructor(i,t,n){if(!i)throw new Error("Must specify target");if(!t)throw new Error("Must specify URL, WebSocket or RTCDataChannel");window.isSecureContext||Ce("noVNC requires a secure context (TLS). Expect crashes!"),super(),this._target=i,typeof t=="string"?this._url=t:(this._url=null,this._rawChannel=t),n=n||{},this._rfbCredentials=n.credentials||{},this._shared="shared"in n?!!n.shared:!0,this._repeaterID=n.repeaterID||"",this._wsProtocols=n.wsProtocols||[],this._rfbConnectionState="",this._rfbInitState="",this._rfbAuthScheme=-1,this._rfbCleanDisconnect=!0,this._rfbRSAAESAuthenticationState=null,this._rfbVersion=0,this._rfbMaxVersion=3.8,this._rfbTightVNC=!1,this._rfbVeNCryptState=0,this._rfbXvpVer=0,this._fbWidth=0,this._fbHeight=0,this._fbName="",this._capabilities={power:!1},this._supportsFence=!1,this._supportsContinuousUpdates=!1,this._enabledContinuousUpdates=!1,this._supportsSetDesktopSize=!1,this._screenID=0,this._screenFlags=0,this._qemuExtKeyEventSupported=!1,this._clipboardText=null,this._clipboardServerCapabilitiesActions={},this._clipboardServerCapabilitiesFormats={},this._sock=null,this._display=null,this._flushing=!1,this._keyboard=null,this._gestures=null,this._resizeObserver=null,this._disconnTimer=null,this._resizeTimeout=null,this._mouseMoveTimer=null,this._decoders={},this._FBU={rects:0,x:0,y:0,width:0,height:0,encoding:null},this._mousePos={},this._mouseButtonMask=0,this._mouseLastMoveTime=0,this._viewportDragging=!1,this._viewportDragPos={},this._viewportHasMoved=!1,this._accumulatedWheelDeltaX=0,this._accumulatedWheelDeltaY=0,this._gestureLastTapTime=null,this._gestureFirstDoubleTapEv=null,this._gestureLastMagnitudeX=0,this._gestureLastMagnitudeY=0,this._eventHandlers={focusCanvas:this._focusCanvas.bind(this),handleResize:this._handleResize.bind(this),handleMouse:this._handleMouse.bind(this),handleWheel:this._handleWheel.bind(this),handleGesture:this._handleGesture.bind(this),handleRSAAESCredentialsRequired:this._handleRSAAESCredentialsRequired.bind(this),handleRSAAESServerVerification:this._handleRSAAESServerVerification.bind(this)},ue(">> RFB.constructor"),this._screen=document.createElement("div"),this._screen.style.display="flex",this._screen.style.width="100%",this._screen.style.height="100%",this._screen.style.overflow="auto",this._screen.style.background=Ml,this._canvas=document.createElement("canvas"),this._canvas.style.margin="auto",this._canvas.style.outline="none",this._canvas.width=0,this._canvas.height=0,this._canvas.tabIndex=-1,this._screen.appendChild(this._canvas),this._cursor=new cl,this._cursorImage=pe.cursors.none,this._decoders[de.encodingRaw]=new ml,this._decoders[de.encodingCopyRect]=new Sl,this._decoders[de.encodingRRE]=new wl,this._decoders[de.encodingHextile]=new Cl,this._decoders[de.encodingTight]=new aa,this._decoders[de.encodingTightPNG]=new kl,this._decoders[de.encodingZRLE]=new El,this._decoders[de.encodingJPEG]=new Ll;try{this._display=new Ma(this._canvas)}catch(d){throw Ce("Display exception: "+d),d}this._display.onflush=this._onFlush.bind(this),this._keyboard=new il(this._canvas),this._keyboard.onkeyevent=this._handleKeyEvent.bind(this),this._gestures=new al,this._sock=new ll,this._sock.on("open",this._socketOpen.bind(this)),this._sock.on("close",this._socketClose.bind(this)),this._sock.on("message",this._handleMessage.bind(this)),this._sock.on("error",this._socketError.bind(this)),this._expectedClientWidth=null,this._expectedClientHeight=null,this._resizeObserver=new ResizeObserver(this._eventHandlers.handleResize),this._updateConnectionState("connecting"),ue("<< RFB.constructor"),this.dragViewport=!1,this.focusOnClick=!0,this._viewOnly=!1,this._clipViewport=!1,this._clippingViewport=!1,this._scaleViewport=!1,this._resizeSession=!1,this._showDotCursor=!1,n.showDotCursor!==void 0&&(it("Specifying showDotCursor as a RFB constructor argument is deprecated"),this._showDotCursor=n.showDotCursor),this._qualityLevel=6,this._compressionLevel=2}get viewOnly(){return this._viewOnly}set viewOnly(i){this._viewOnly=i,(this._rfbConnectionState==="connecting"||this._rfbConnectionState==="connected")&&(i?this._keyboard.ungrab():this._keyboard.grab())}get capabilities(){return this._capabilities}get clippingViewport(){return this._clippingViewport}_setClippingViewport(i){i!==this._clippingViewport&&(this._clippingViewport=i,this.dispatchEvent(new CustomEvent("clippingviewport",{detail:this._clippingViewport})))}get touchButton(){return 0}set touchButton(i){it("Using old API!")}get clipViewport(){return this._clipViewport}set clipViewport(i){this._clipViewport=i,this._updateClip()}get scaleViewport(){return this._scaleViewport}set scaleViewport(i){this._scaleViewport=i,i&&this._clipViewport&&this._updateClip(),this._updateScale(),!i&&this._clipViewport&&this._updateClip()}get resizeSession(){return this._resizeSession}set resizeSession(i){this._resizeSession=i,i&&this._requestRemoteResize()}get showDotCursor(){return this._showDotCursor}set showDotCursor(i){this._showDotCursor=i,this._refreshCursor()}get background(){return this._screen.style.background}set background(i){this._screen.style.background=i}get qualityLevel(){return this._qualityLevel}set qualityLevel(i){if(!Number.isInteger(i)||i<0||i>9){Ce("qualityLevel must be an integer between 0 and 9");return}this._qualityLevel!==i&&(this._qualityLevel=i,this._rfbConnectionState==="connected"&&this._sendEncodings())}get compressionLevel(){return this._compressionLevel}set compressionLevel(i){if(!Number.isInteger(i)||i<0||i>9){Ce("compressionLevel must be an integer between 0 and 9");return}this._compressionLevel!==i&&(this._compressionLevel=i,this._rfbConnectionState==="connected"&&this._sendEncodings())}disconnect(){this._updateConnectionState("disconnecting"),this._sock.off("error"),this._sock.off("message"),this._sock.off("open"),this._rfbRSAAESAuthenticationState!==null&&this._rfbRSAAESAuthenticationState.disconnect()}approveServer(){this._rfbRSAAESAuthenticationState!==null&&this._rfbRSAAESAuthenticationState.approveServer()}sendCredentials(i){this._rfbCredentials=i,this._resumeAuthentication()}sendCtrlAltDel(){this._rfbConnectionState!=="connected"||this._viewOnly||(Ne("Sending Ctrl-Alt-Del"),this.sendKey(P.XK_Control_L,"ControlLeft",!0),this.sendKey(P.XK_Alt_L,"AltLeft",!0),this.sendKey(P.XK_Delete,"Delete",!0),this.sendKey(P.XK_Delete,"Delete",!1),this.sendKey(P.XK_Alt_L,"AltLeft",!1),this.sendKey(P.XK_Control_L,"ControlLeft",!1))}machineShutdown(){this._xvpOp(1,2)}machineReboot(){this._xvpOp(1,3)}machineReset(){this._xvpOp(1,4)}sendKey(i,t,n){if(this._rfbConnectionState!=="connected"||this._viewOnly)return;if(n===void 0){this.sendKey(i,t,!0),this.sendKey(i,t,!1);return}const d=hl[t];if(this._qemuExtKeyEventSupported&&d)i=i||0,Ne("Sending key ("+(n?"down":"up")+"): keysym "+i+", scancode "+d),pe.messages.QEMUExtendedKeyEvent(this._sock,i,n,d);else{if(!i)return;Ne("Sending keysym ("+(n?"down":"up")+"): "+i),pe.messages.keyEvent(this._sock,i,n?1:0)}}focus(i){this._canvas.focus(i)}blur(){this._canvas.blur()}clipboardPasteFrom(i){if(!(this._rfbConnectionState!=="connected"||this._viewOnly))if(this._clipboardServerCapabilitiesFormats[ft]&&this._clipboardServerCapabilitiesActions[ui])this._clipboardText=i,pe.messages.extendedClipboardNotify(this._sock,[ft]);else{let t,n,d;t=0;for(let e of i)t++;d=new Uint8Array(t),n=0;for(let e of i){let a=e.codePointAt(0);a>255&&(a=63),d[n++]=a}pe.messages.clientCutText(this._sock,d)}}getImageData(){return this._display.getImageData()}toDataURL(i,t){return this._display.toDataURL(i,t)}toBlob(i,t,n){return this._display.toBlob(i,t,n)}_connect(){if(ue(">> RFB.connect"),this._url)Ne(`connecting to ${this._url}`),this._sock.open(this._url,this._wsProtocols);else{if(Ne(`attaching ${this._rawChannel} to Websock`),this._sock.attach(this._rawChannel),this._sock.readyState==="closed")throw Error("Cannot use already closed WebSocket/RTCDataChannel");this._sock.readyState==="open"&&this._socketOpen()}this._target.appendChild(this._screen),this._gestures.attach(this._canvas),this._cursor.attach(this._canvas),this._refreshCursor(),this._resizeObserver.observe(this._screen),this._canvas.addEventListener("mousedown",this._eventHandlers.focusCanvas),this._canvas.addEventListener("touchstart",this._eventHandlers.focusCanvas),this._canvas.addEventListener("mousedown",this._eventHandlers.handleMouse),this._canvas.addEventListener("mouseup",this._eventHandlers.handleMouse),this._canvas.addEventListener("mousemove",this._eventHandlers.handleMouse),this._canvas.addEventListener("click",this._eventHandlers.handleMouse),this._canvas.addEventListener("contextmenu",this._eventHandlers.handleMouse),this._canvas.addEventListener("wheel",this._eventHandlers.handleWheel),this._canvas.addEventListener("gesturestart",this._eventHandlers.handleGesture),this._canvas.addEventListener("gesturemove",this._eventHandlers.handleGesture),this._canvas.addEventListener("gestureend",this._eventHandlers.handleGesture),ue("<< RFB.connect")}_disconnect(){ue(">> RFB.disconnect"),this._cursor.detach(),this._canvas.removeEventListener("gesturestart",this._eventHandlers.handleGesture),this._canvas.removeEventListener("gesturemove",this._eventHandlers.handleGesture),this._canvas.removeEventListener("gestureend",this._eventHandlers.handleGesture),this._canvas.removeEventListener("wheel",this._eventHandlers.handleWheel),this._canvas.removeEventListener("mousedown",this._eventHandlers.handleMouse),this._canvas.removeEventListener("mouseup",this._eventHandlers.handleMouse),this._canvas.removeEventListener("mousemove",this._eventHandlers.handleMouse),this._canvas.removeEventListener("click",this._eventHandlers.handleMouse),this._canvas.removeEventListener("contextmenu",this._eventHandlers.handleMouse),this._canvas.removeEventListener("mousedown",this._eventHandlers.focusCanvas),this._canvas.removeEventListener("touchstart",this._eventHandlers.focusCanvas),this._resizeObserver.disconnect(),this._keyboard.ungrab(),this._gestures.detach(),this._sock.close();try{this._target.removeChild(this._screen)}catch(i){if(i.name!=="NotFoundError")throw i}clearTimeout(this._resizeTimeout),clearTimeout(this._mouseMoveTimer),ue("<< RFB.disconnect")}_socketOpen(){this._rfbConnectionState==="connecting"&&this._rfbInitState===""?(this._rfbInitState="ProtocolVersion",ue("Starting VNC handshake")):this._fail("Unexpected server connection while "+this._rfbConnectionState)}_socketClose(i){ue("WebSocket on-close event");let t="";switch(i.code&&(t="(code: "+i.code,i.reason&&(t+=", reason: "+i.reason),t+=")"),this._rfbConnectionState){case"connecting":this._fail("Connection closed "+t);break;case"connected":this._updateConnectionState("disconnecting"),this._updateConnectionState("disconnected");break;case"disconnecting":this._updateConnectionState("disconnected");break;case"disconnected":this._fail("Unexpected server disconnect when already disconnected "+t);break;default:this._fail("Unexpected server disconnect before connecting "+t);break}this._sock.off("close"),this._rawChannel=null}_socketError(i){it("WebSocket on-error event")}_focusCanvas(i){this.focusOnClick&&this.focus({preventScroll:!0})}_setDesktopName(i){this._fbName=i,this.dispatchEvent(new CustomEvent("desktopname",{detail:{name:this._fbName}}))}_saveExpectedClientSize(){this._expectedClientWidth=this._screen.clientWidth,this._expectedClientHeight=this._screen.clientHeight}_currentClientSize(){return[this._screen.clientWidth,this._screen.clientHeight]}_clientHasExpectedSize(){const[i,t]=this._currentClientSize();return i==this._expectedClientWidth&&t==this._expectedClientHeight}_handleResize(){this._clientHasExpectedSize()||(window.requestAnimationFrame(()=>{this._updateClip(),this._updateScale()}),this._resizeSession&&(clearTimeout(this._resizeTimeout),this._resizeTimeout=setTimeout(this._requestRemoteResize.bind(this),500)))}_updateClip(){const i=this._display.clipViewport;let t=this._clipViewport;if(this._scaleViewport&&(t=!1),i!==t&&(this._display.clipViewport=t),t){const n=this._screenSize();this._display.viewportChangeSize(n.w,n.h),this._fixScrollbars(),this._setClippingViewport(n.w<this._display.width||n.h<this._display.height)}else this._setClippingViewport(!1);i!==t&&this._saveExpectedClientSize()}_updateScale(){if(!this._scaleViewport)this._display.scale=1;else{const i=this._screenSize();this._display.autoscale(i.w,i.h)}this._fixScrollbars()}_requestRemoteResize(){if(clearTimeout(this._resizeTimeout),this._resizeTimeout=null,!this._resizeSession||this._viewOnly||!this._supportsSetDesktopSize)return;const i=this._screenSize();pe.messages.setDesktopSize(this._sock,Math.floor(i.w),Math.floor(i.h),this._screenID,this._screenFlags),ue("Requested new desktop size: "+i.w+"x"+i.h)}_screenSize(){let i=this._screen.getBoundingClientRect();return{w:i.width,h:i.height}}_fixScrollbars(){const i=this._screen.style.overflow;this._screen.style.overflow="hidden",this._screen.getBoundingClientRect(),this._screen.style.overflow=i}_updateConnectionState(i){const t=this._rfbConnectionState;if(i===t){ue("Already in state '"+i+"', ignoring");return}if(t==="disconnected"){Ce("Tried changing state of a disconnected RFB object");return}switch(i){case"connected":if(t!=="connecting"){Ce("Bad transition to connected state, previous connection state: "+t);return}break;case"disconnected":if(t!=="disconnecting"){Ce("Bad transition to disconnected state, previous connection state: "+t);return}break;case"connecting":if(t!==""){Ce("Bad transition to connecting state, previous connection state: "+t);return}break;case"disconnecting":if(t!=="connected"&&t!=="connecting"){Ce("Bad transition to disconnecting state, previous connection state: "+t);return}break;default:Ce("Unknown connection state: "+i);return}switch(this._rfbConnectionState=i,ue("New state '"+i+"', was '"+t+"'."),this._disconnTimer&&i!=="disconnecting"&&(ue("Clearing disconnect timer"),clearTimeout(this._disconnTimer),this._disconnTimer=null,this._sock.off("close")),i){case"connecting":this._connect();break;case"connected":this.dispatchEvent(new CustomEvent("connect",{detail:{}}));break;case"disconnecting":this._disconnect(),this._disconnTimer=setTimeout(()=>{Ce("Disconnection timed out."),this._updateConnectionState("disconnected")},Al*1e3);break;case"disconnected":this.dispatchEvent(new CustomEvent("disconnect",{detail:{clean:this._rfbCleanDisconnect}}));break}}_fail(i){switch(this._rfbConnectionState){case"disconnecting":Ce("Failed when disconnecting: "+i);break;case"connected":Ce("Failed while connected: "+i);break;case"connecting":Ce("Failed when connecting: "+i);break;default:Ce("RFB failure: "+i);break}return this._rfbCleanDisconnect=!1,this._updateConnectionState("disconnecting"),this._updateConnectionState("disconnected"),!1}_setCapability(i,t){this._capabilities[i]=t,this.dispatchEvent(new CustomEvent("capabilities",{detail:{capabilities:this._capabilities}}))}_handleMessage(){if(this._sock.rQlen===0){it("handleMessage called on an empty receive queue");return}switch(this._rfbConnectionState){case"disconnected":Ce("Got data while disconnected");break;case"connected":for(;!(this._flushing||!this._normalMsg()||this._sock.rQlen===0););break;case"connecting":for(;this._rfbConnectionState==="connecting"&&this._initMsg(););break;default:Ce("Got data while in an invalid state");break}}_handleKeyEvent(i,t,n){this.sendKey(i,t,n)}_handleMouse(i){if(i.type==="click"&&i.target!==this._canvas||(i.stopPropagation(),i.preventDefault(),i.type==="click"||i.type==="contextmenu"))return;let t=ti(i.clientX,i.clientY,this._canvas);switch(i.type){case"mousedown":Aa(this._canvas),this._handleMouseButton(t.x,t.y,!0,1<<i.button);break;case"mouseup":this._handleMouseButton(t.x,t.y,!1,1<<i.button);break;case"mousemove":this._handleMouseMove(t.x,t.y);break}}_handleMouseButton(i,t,n,d){if(this.dragViewport)if(n&&!this._viewportDragging){this._viewportDragging=!0,this._viewportDragPos={x:i,y:t},this._viewportHasMoved=!1;return}else{if(this._viewportDragging=!1,this._viewportHasMoved)return;this._sendMouse(i,t,d)}this._mouseMoveTimer!==null&&(clearTimeout(this._mouseMoveTimer),this._mouseMoveTimer=null,this._sendMouse(i,t,this._mouseButtonMask)),n?this._mouseButtonMask|=d:this._mouseButtonMask&=~d,this._sendMouse(i,t,this._mouseButtonMask)}_handleMouseMove(i,t){if(this._viewportDragging){const n=this._viewportDragPos.x-i,d=this._viewportDragPos.y-t;(this._viewportHasMoved||Math.abs(n)>ls||Math.abs(d)>ls)&&(this._viewportHasMoved=!0,this._viewportDragPos={x:i,y:t},this._display.viewportChangePos(n,d));return}if(this._mousePos={x:i,y:t},this._mouseMoveTimer==null){const n=Date.now()-this._mouseLastMoveTime;n>_o?(this._sendMouse(i,t,this._mouseButtonMask),this._mouseLastMoveTime=Date.now()):this._mouseMoveTimer=setTimeout(()=>{this._handleDelayedMouseMove()},_o-n)}}_handleDelayedMouseMove(){this._mouseMoveTimer=null,this._sendMouse(this._mousePos.x,this._mousePos.y,this._mouseButtonMask),this._mouseLastMoveTime=Date.now()}_sendMouse(i,t,n){this._rfbConnectionState==="connected"&&(this._viewOnly||pe.messages.pointerEvent(this._sock,this._display.absX(i),this._display.absY(t),n))}_handleWheel(i){if(this._rfbConnectionState!=="connected"||this._viewOnly)return;i.stopPropagation(),i.preventDefault();let t=ti(i.clientX,i.clientY,this._canvas),n=i.deltaX,d=i.deltaY;i.deltaMode!==0&&(n*=vo,d*=vo),this._accumulatedWheelDeltaX+=n,this._accumulatedWheelDeltaY+=d,Math.abs(this._accumulatedWheelDeltaX)>=po&&(this._accumulatedWheelDeltaX<0?(this._handleMouseButton(t.x,t.y,!0,32),this._handleMouseButton(t.x,t.y,!1,32)):this._accumulatedWheelDeltaX>0&&(this._handleMouseButton(t.x,t.y,!0,64),this._handleMouseButton(t.x,t.y,!1,64)),this._accumulatedWheelDeltaX=0),Math.abs(this._accumulatedWheelDeltaY)>=po&&(this._accumulatedWheelDeltaY<0?(this._handleMouseButton(t.x,t.y,!0,8),this._handleMouseButton(t.x,t.y,!1,8)):this._accumulatedWheelDeltaY>0&&(this._handleMouseButton(t.x,t.y,!0,16),this._handleMouseButton(t.x,t.y,!1,16)),this._accumulatedWheelDeltaY=0)}_fakeMouseMove(i,t,n){this._handleMouseMove(t,n),this._cursor.move(i.detail.clientX,i.detail.clientY)}_handleTapEvent(i,t){let n=ti(i.detail.clientX,i.detail.clientY,this._canvas);if(this._gestureLastTapTime!==null&&Date.now()-this._gestureLastTapTime<Rl&&this._gestureFirstDoubleTapEv.detail.type===i.detail.type){let d=this._gestureFirstDoubleTapEv.detail.clientX-i.detail.clientX,e=this._gestureFirstDoubleTapEv.detail.clientY-i.detail.clientY;Math.hypot(d,e)<Tl?n=ti(this._gestureFirstDoubleTapEv.detail.clientX,this._gestureFirstDoubleTapEv.detail.clientY,this._canvas):this._gestureFirstDoubleTapEv=i}else this._gestureFirstDoubleTapEv=i;this._gestureLastTapTime=Date.now(),this._fakeMouseMove(this._gestureFirstDoubleTapEv,n.x,n.y),this._handleMouseButton(n.x,n.y,!0,t),this._handleMouseButton(n.x,n.y,!1,t)}_handleGesture(i){let t,n=ti(i.detail.clientX,i.detail.clientY,this._canvas);switch(i.type){case"gesturestart":switch(i.detail.type){case"onetap":this._handleTapEvent(i,1);break;case"twotap":this._handleTapEvent(i,4);break;case"threetap":this._handleTapEvent(i,2);break;case"drag":this._fakeMouseMove(i,n.x,n.y),this._handleMouseButton(n.x,n.y,!0,1);break;case"longpress":this._fakeMouseMove(i,n.x,n.y),this._handleMouseButton(n.x,n.y,!0,4);break;case"twodrag":this._gestureLastMagnitudeX=i.detail.magnitudeX,this._gestureLastMagnitudeY=i.detail.magnitudeY,this._fakeMouseMove(i,n.x,n.y);break;case"pinch":this._gestureLastMagnitudeX=Math.hypot(i.detail.magnitudeX,i.detail.magnitudeY),this._fakeMouseMove(i,n.x,n.y);break}break;case"gesturemove":switch(i.detail.type){case"onetap":case"twotap":case"threetap":break;case"drag":case"longpress":this._fakeMouseMove(i,n.x,n.y);break;case"twodrag":for(this._fakeMouseMove(i,n.x,n.y);i.detail.magnitudeY-this._gestureLastMagnitudeY>Ct;)this._handleMouseButton(n.x,n.y,!0,8),this._handleMouseButton(n.x,n.y,!1,8),this._gestureLastMagnitudeY+=Ct;for(;i.detail.magnitudeY-this._gestureLastMagnitudeY<-Ct;)this._handleMouseButton(n.x,n.y,!0,16),this._handleMouseButton(n.x,n.y,!1,16),this._gestureLastMagnitudeY-=Ct;for(;i.detail.magnitudeX-this._gestureLastMagnitudeX>Ct;)this._handleMouseButton(n.x,n.y,!0,32),this._handleMouseButton(n.x,n.y,!1,32),this._gestureLastMagnitudeX+=Ct;for(;i.detail.magnitudeX-this._gestureLastMagnitudeX<-Ct;)this._handleMouseButton(n.x,n.y,!0,64),this._handleMouseButton(n.x,n.y,!1,64),this._gestureLastMagnitudeX-=Ct;break;case"pinch":if(this._fakeMouseMove(i,n.x,n.y),t=Math.hypot(i.detail.magnitudeX,i.detail.magnitudeY),Math.abs(t-this._gestureLastMagnitudeX)>ci){for(this._handleKeyEvent(P.XK_Control_L,"ControlLeft",!0);t-this._gestureLastMagnitudeX>ci;)this._handleMouseButton(n.x,n.y,!0,8),this._handleMouseButton(n.x,n.y,!1,8),this._gestureLastMagnitudeX+=ci;for(;t-this._gestureLastMagnitudeX<-ci;)this._handleMouseButton(n.x,n.y,!0,16),this._handleMouseButton(n.x,n.y,!1,16),this._gestureLastMagnitudeX-=ci}this._handleKeyEvent(P.XK_Control_L,"ControlLeft",!1);break}break;case"gestureend":switch(i.detail.type){case"onetap":case"twotap":case"threetap":case"pinch":case"twodrag":break;case"drag":this._fakeMouseMove(i,n.x,n.y),this._handleMouseButton(n.x,n.y,!1,1);break;case"longpress":this._fakeMouseMove(i,n.x,n.y),this._handleMouseButton(n.x,n.y,!1,4);break}break}}_negotiateProtocolVersion(){if(this._sock.rQwait("version",12))return!1;const i=this._sock.rQshiftStr(12).substr(4,7);Ne("Server ProtocolVersion: "+i);let t=0;switch(i){case"000.000":t=1;break;case"003.003":case"003.006":this._rfbVersion=3.3;break;case"003.007":this._rfbVersion=3.7;break;case"003.008":case"003.889":case"004.000":case"004.001":case"005.000":this._rfbVersion=3.8;break;default:return this._fail("Invalid server version "+i)}if(t){let d="ID:"+this._repeaterID;for(;d.length<250;)d+="\0";return this._sock.sendString(d),!0}this._rfbVersion>this._rfbMaxVersion&&(this._rfbVersion=this._rfbMaxVersion);const n="00"+parseInt(this._rfbVersion,10)+".00"+this._rfbVersion*10%10;this._sock.sendString("RFB "+n+`
`),ue("Sent ProtocolVersion: "+n),this._rfbInitState="Security"}_isSupportedSecurityType(i){return[go,Rr,yo,xo,Kn,bo,mo,So,Co].includes(i)}_negotiateSecurity(){if(this._rfbVersion>=3.7){const i=this._sock.rQshift8();if(this._sock.rQwait("security type",i,1))return!1;if(i===0)return this._rfbInitState="SecurityReason",this._securityContext="no security types",this._securityStatus=1,!0;const t=this._sock.rQshiftBytes(i);ue("Server security types: "+t),this._rfbAuthScheme=-1;for(let n of t)if(this._isSupportedSecurityType(n)){this._rfbAuthScheme=n;break}if(this._rfbAuthScheme===-1)return this._fail("Unsupported security types (types: "+t+")");this._sock.send([this._rfbAuthScheme])}else{if(this._sock.rQwait("security scheme",4))return!1;if(this._rfbAuthScheme=this._sock.rQshift32(),this._rfbAuthScheme==0)return this._rfbInitState="SecurityReason",this._securityContext="authentication scheme",this._securityStatus=1,!0}return this._rfbInitState="Authentication",ue("Authenticating using scheme: "+this._rfbAuthScheme),!0}_handleSecurityReason(){if(this._sock.rQwait("reason length",4))return!1;const i=this._sock.rQshift32();let t="";if(i>0){if(this._sock.rQwait("reason",i,4))return!1;t=this._sock.rQshiftStr(i)}return t!==""?(this.dispatchEvent(new CustomEvent("securityfailure",{detail:{status:this._securityStatus,reason:t}})),this._fail("Security negotiation failed on "+this._securityContext+" (reason: "+t+")")):(this.dispatchEvent(new CustomEvent("securityfailure",{detail:{status:this._securityStatus}})),this._fail("Security negotiation failed on "+this._securityContext))}_negotiateXvpAuth(){if(this._rfbCredentials.username===void 0||this._rfbCredentials.password===void 0||this._rfbCredentials.target===void 0)return this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password","target"]}})),!1;const i=String.fromCharCode(this._rfbCredentials.username.length)+String.fromCharCode(this._rfbCredentials.target.length)+this._rfbCredentials.username+this._rfbCredentials.target;return this._sock.sendString(i),this._rfbAuthScheme=Rr,this._negotiateAuthentication()}_negotiateVeNCryptAuth(){if(this._rfbVeNCryptState==0){if(this._sock.rQwait("vencrypt version",2))return!1;const i=this._sock.rQshift8(),t=this._sock.rQshift8();if(!(i==0&&t==2))return this._fail("Unsupported VeNCrypt version "+i+"."+t);this._sock.send([0,2]),this._rfbVeNCryptState=1}if(this._rfbVeNCryptState==1){if(this._sock.rQwait("vencrypt ack",1))return!1;const i=this._sock.rQshift8();if(i!=0)return this._fail("VeNCrypt failure "+i);this._rfbVeNCryptState=2}if(this._rfbVeNCryptState==2){if(this._sock.rQwait("vencrypt subtypes length",1))return!1;const i=this._sock.rQshift8();if(i<1)return this._fail("VeNCrypt subtypes empty");this._rfbVeNCryptSubtypesLength=i,this._rfbVeNCryptState=3}if(this._rfbVeNCryptState==3){if(this._sock.rQwait("vencrypt subtypes",4*this._rfbVeNCryptSubtypesLength))return!1;const i=[];for(let t=0;t<this._rfbVeNCryptSubtypesLength;t++)i.push(this._sock.rQshift32());this._rfbAuthScheme=-1;for(let t of i)if(t!==Kn&&this._isSupportedSecurityType(t)){this._rfbAuthScheme=t;break}return this._rfbAuthScheme===-1?this._fail("Unsupported security types (types: "+i+")"):(this._sock.send([this._rfbAuthScheme>>24,this._rfbAuthScheme>>16,this._rfbAuthScheme>>8,this._rfbAuthScheme]),this._rfbVeNCryptState==4,!0)}}_negotiatePlainAuth(){if(this._rfbCredentials.username===void 0||this._rfbCredentials.password===void 0)return this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password"]}})),!1;const i=vt(this._rfbCredentials.username),t=vt(this._rfbCredentials.password);return this._sock.send([i.length>>24&255,i.length>>16&255,i.length>>8&255,i.length&255]),this._sock.send([t.length>>24&255,t.length>>16&255,t.length>>8&255,t.length&255]),this._sock.sendString(i),this._sock.sendString(t),this._rfbInitState="SecurityResult",!0}_negotiateStdVNCAuth(){if(this._sock.rQwait("auth challenge",16))return!1;if(this._rfbCredentials.password===void 0)return this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["password"]}})),!1;const i=Array.prototype.slice.call(this._sock.rQshiftBytes(16)),t=pe.genDES(this._rfbCredentials.password,i);return this._sock.send(t),this._rfbInitState="SecurityResult",!0}_negotiateARDAuth(){if(this._rfbCredentials.username===void 0||this._rfbCredentials.password===void 0)return this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password"]}})),!1;if(this._rfbCredentials.ardPublicKey!=null&&this._rfbCredentials.ardCredentials!=null)return this._sock.send(this._rfbCredentials.ardCredentials),this._sock.send(this._rfbCredentials.ardPublicKey),this._rfbCredentials.ardCredentials=null,this._rfbCredentials.ardPublicKey=null,this._rfbInitState="SecurityResult",!0;if(this._sock.rQwait("read ard",4))return!1;let i=this._sock.rQshiftBytes(2),t=this._sock.rQshift16();if(this._sock.rQwait("read ard keylength",t*2,4))return!1;let n=this._sock.rQshiftBytes(t),d=this._sock.rQshiftBytes(t),e=Le.generateKey({name:"DH",g:i,p:n},!1,["deriveBits"]);return this._negotiateARDAuthAsync(t,d,e),!1}async _negotiateARDAuthAsync(i,t,n){const d=Le.exportKey("raw",n.publicKey),e=Le.deriveBits({name:"DH",public:t},n.privateKey,i*8),a=vt(this._rfbCredentials.username).substring(0,63),u=vt(this._rfbCredentials.password).substring(0,63),v=window.crypto.getRandomValues(new Uint8Array(128));for(let b=0;b<a.length;b++)v[b]=a.charCodeAt(b);v[a.length]=0;for(let b=0;b<u.length;b++)v[64+b]=u.charCodeAt(b);v[64+u.length]=0;const l=await Le.digest("MD5",e),_=await Le.importKey("raw",l,{name:"AES-ECB"},!1,["encrypt"]),S=await Le.encrypt({name:"AES-ECB"},_,v);this._rfbCredentials.ardCredentials=S,this._rfbCredentials.ardPublicKey=d,this._resumeAuthentication()}_negotiateTightUnixAuth(){return this._rfbCredentials.username===void 0||this._rfbCredentials.password===void 0?(this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password"]}})),!1):(this._sock.send([0,0,0,this._rfbCredentials.username.length]),this._sock.send([0,0,0,this._rfbCredentials.password.length]),this._sock.sendString(this._rfbCredentials.username),this._sock.sendString(this._rfbCredentials.password),this._rfbInitState="SecurityResult",!0)}_negotiateTightTunnels(i){const t={0:{vendor:"TGHT",signature:"NOTUNNEL"}},n={};for(let d=0;d<i;d++){const e=this._sock.rQshift32(),a=this._sock.rQshiftStr(4),u=this._sock.rQshiftStr(8);n[e]={vendor:a,signature:u}}return ue("Server Tight tunnel types: "+n),n[1]&&n[1].vendor==="SICR"&&n[1].signature==="SCHANNEL"&&(ue("Detected Siemens server. Assuming NOTUNNEL support."),n[0]={vendor:"TGHT",signature:"NOTUNNEL"}),n[0]?n[0].vendor!=t[0].vendor||n[0].signature!=t[0].signature?this._fail("Client's tunnel type had the incorrect vendor or signature"):(ue("Selected tunnel type: "+t[0]),this._sock.send([0,0,0,0]),!1):this._fail("Server wanted tunnels, but doesn't support the notunnel type")}_negotiateTightAuth(){if(!this._rfbTightVNC){if(this._sock.rQwait("num tunnels",4))return!1;const d=this._sock.rQshift32();if(d>0&&this._sock.rQwait("tunnel capabilities",16*d,4))return!1;if(this._rfbTightVNC=!0,d>0)return this._negotiateTightTunnels(d),!1}if(this._sock.rQwait("sub auth count",4))return!1;const i=this._sock.rQshift32();if(i===0)return this._rfbInitState="SecurityResult",!0;if(this._sock.rQwait("sub auth capabilities",16*i,4))return!1;const t={STDVNOAUTH__:1,STDVVNCAUTH_:2,TGHTULGNAUTH:129},n=[];for(let d=0;d<i;d++){this._sock.rQshift32();const e=this._sock.rQshiftStr(12);n.push(e)}ue("Server Tight authentication types: "+n);for(let d in t)if(n.indexOf(d)!=-1)switch(this._sock.send([0,0,0,t[d]]),ue("Selected authentication type: "+d),d){case"STDVNOAUTH__":return this._rfbInitState="SecurityResult",!0;case"STDVVNCAUTH_":return this._rfbAuthScheme=Rr,!0;case"TGHTULGNAUTH":return this._rfbAuthScheme=wo,!0;default:return this._fail("Unsupported tiny auth scheme (scheme: "+d+")")}return this._fail("No supported sub-auth types!")}_handleRSAAESCredentialsRequired(i){this.dispatchEvent(i)}_handleRSAAESServerVerification(i){this.dispatchEvent(i)}_negotiateRA2neAuth(){return this._rfbRSAAESAuthenticationState===null&&(this._rfbRSAAESAuthenticationState=new bl(this._sock,()=>this._rfbCredentials),this._rfbRSAAESAuthenticationState.addEventListener("serververification",this._eventHandlers.handleRSAAESServerVerification),this._rfbRSAAESAuthenticationState.addEventListener("credentialsrequired",this._eventHandlers.handleRSAAESCredentialsRequired)),this._rfbRSAAESAuthenticationState.checkInternalEvents(),this._rfbRSAAESAuthenticationState.hasStarted||this._rfbRSAAESAuthenticationState.negotiateRA2neAuthAsync().catch(i=>{i.message!=="disconnect normally"&&this._fail(i.message)}).then(()=>(this.dispatchEvent(new CustomEvent("securityresult")),this._rfbInitState="SecurityResult",!0)).finally(()=>{this._rfbRSAAESAuthenticationState.removeEventListener("serververification",this._eventHandlers.handleRSAAESServerVerification),this._rfbRSAAESAuthenticationState.removeEventListener("credentialsrequired",this._eventHandlers.handleRSAAESCredentialsRequired),this._rfbRSAAESAuthenticationState=null}),!1}_negotiateMSLogonIIAuth(){if(this._sock.rQwait("mslogonii dh param",24))return!1;if(this._rfbCredentials.username===void 0||this._rfbCredentials.password===void 0)return this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password"]}})),!1;const i=this._sock.rQshiftBytes(8),t=this._sock.rQshiftBytes(8),n=this._sock.rQshiftBytes(8),d=Le.generateKey({name:"DH",g:i,p:t},!0,["deriveBits"]),e=Le.exportKey("raw",d.publicKey),a=Le.deriveBits({name:"DH",public:n},d.privateKey,64),u=Le.importKey("raw",a,{name:"DES-CBC"},!1,["encrypt"]),v=vt(this._rfbCredentials.username).substring(0,255),l=vt(this._rfbCredentials.password).substring(0,63);let _=new Uint8Array(256),S=new Uint8Array(64);window.crypto.getRandomValues(_),window.crypto.getRandomValues(S);for(let b=0;b<v.length;b++)_[b]=v.charCodeAt(b);_[v.length]=0;for(let b=0;b<l.length;b++)S[b]=l.charCodeAt(b);return S[l.length]=0,_=Le.encrypt({name:"DES-CBC",iv:a},u,_),S=Le.encrypt({name:"DES-CBC",iv:a},u,S),this._sock.send(e),this._sock.send(_),this._sock.send(S),this._rfbInitState="SecurityResult",!0}_negotiateAuthentication(){switch(this._rfbAuthScheme){case go:return this._rfbInitState="SecurityResult",!0;case bo:return this._negotiateXvpAuth();case mo:return this._negotiateARDAuth();case Rr:return this._negotiateStdVNCAuth();case xo:return this._negotiateTightAuth();case Kn:return this._negotiateVeNCryptAuth();case Co:return this._negotiatePlainAuth();case wo:return this._negotiateTightUnixAuth();case yo:return this._negotiateRA2neAuth();case So:return this._negotiateMSLogonIIAuth();default:return this._fail("Unsupported auth scheme (scheme: "+this._rfbAuthScheme+")")}}_handleSecurityResult(){if(this._rfbVersion<3.7)return this._rfbInitState="ClientInitialisation",!0;if(this._sock.rQwait("VNC auth response ",4))return!1;const i=this._sock.rQshift32();return i===0?(this._rfbInitState="ClientInitialisation",ue("Authentication OK"),!0):this._rfbVersion>=3.8?(this._rfbInitState="SecurityReason",this._securityContext="security result",this._securityStatus=i,!0):(this.dispatchEvent(new CustomEvent("securityfailure",{detail:{status:i}})),this._fail("Security handshake failed"))}_negotiateServerInit(){if(this._sock.rQwait("server initialization",24))return!1;const i=this._sock.rQshift16(),t=this._sock.rQshift16(),n=this._sock.rQshift8(),d=this._sock.rQshift8(),e=this._sock.rQshift8(),a=this._sock.rQshift8(),u=this._sock.rQshift16(),v=this._sock.rQshift16(),l=this._sock.rQshift16(),_=this._sock.rQshift8(),S=this._sock.rQshift8(),b=this._sock.rQshift8();this._sock.rQskipBytes(3);const p=this._sock.rQshift32();if(this._sock.rQwait("server init name",p,24))return!1;let g=this._sock.rQshiftStr(p);if(g=gn(g,!0),this._rfbTightVNC){if(this._sock.rQwait("TightVNC extended server init header",8,24+p))return!1;const w=this._sock.rQshift16(),x=this._sock.rQshift16(),h=this._sock.rQshift16();this._sock.rQskipBytes(2);const s=(w+x+h)*16;if(this._sock.rQwait("TightVNC extended server init header",s,32+p))return!1;this._sock.rQskipBytes(16*w),this._sock.rQskipBytes(16*x),this._sock.rQskipBytes(16*h)}return Ne("Screen: "+i+"x"+t+", bpp: "+n+", depth: "+d+", bigEndian: "+e+", trueColor: "+a+", redMax: "+u+", greenMax: "+v+", blueMax: "+l+", redShift: "+_+", greenShift: "+S+", blueShift: "+b),this._setDesktopName(g),this._resize(i,t),this._viewOnly||this._keyboard.grab(),this._fbDepth=24,this._fbName==="Intel(r) AMT KVM"&&(it("Intel AMT KVM only supports 8/16 bit depths. Using low color mode."),this._fbDepth=8),pe.messages.pixelFormat(this._sock,this._fbDepth,!0),this._sendEncodings(),pe.messages.fbUpdateRequest(this._sock,!1,0,0,this._fbWidth,this._fbHeight),this._updateConnectionState("connected"),!0}_sendEncodings(){const i=[];i.push(de.encodingCopyRect),this._fbDepth==24&&(i.push(de.encodingTight),i.push(de.encodingTightPNG),i.push(de.encodingZRLE),i.push(de.encodingJPEG),i.push(de.encodingHextile),i.push(de.encodingRRE)),i.push(de.encodingRaw),i.push(de.pseudoEncodingQualityLevel0+this._qualityLevel),i.push(de.pseudoEncodingCompressLevel0+this._compressionLevel),i.push(de.pseudoEncodingDesktopSize),i.push(de.pseudoEncodingLastRect),i.push(de.pseudoEncodingQEMUExtendedKeyEvent),i.push(de.pseudoEncodingExtendedDesktopSize),i.push(de.pseudoEncodingXvp),i.push(de.pseudoEncodingFence),i.push(de.pseudoEncodingContinuousUpdates),i.push(de.pseudoEncodingDesktopName),i.push(de.pseudoEncodingExtendedClipboard),this._fbDepth==24&&(i.push(de.pseudoEncodingVMwareCursor),i.push(de.pseudoEncodingCursor)),pe.messages.clientEncodings(this._sock,i)}_initMsg(){switch(this._rfbInitState){case"ProtocolVersion":return this._negotiateProtocolVersion();case"Security":return this._negotiateSecurity();case"Authentication":return this._negotiateAuthentication();case"SecurityResult":return this._handleSecurityResult();case"SecurityReason":return this._handleSecurityReason();case"ClientInitialisation":return this._sock.send([this._shared?1:0]),this._rfbInitState="ServerInitialisation",!0;case"ServerInitialisation":return this._negotiateServerInit();default:return this._fail("Unknown init state (state: "+this._rfbInitState+")")}}_resumeAuthentication(){setTimeout(this._initMsg.bind(this),0)}_handleSetColourMapMsg(){return ue("SetColorMapEntries"),this._fail("Unexpected SetColorMapEntries message")}_handleServerCutText(){if(ue("ServerCutText"),this._sock.rQwait("ServerCutText header",7,1))return!1;this._sock.rQskipBytes(3);let i=this._sock.rQshift32();if(i=Xn(i),this._sock.rQwait("ServerCutText content",Math.abs(i),8))return!1;if(i>=0){const t=this._sock.rQshiftStr(i);if(this._viewOnly)return!0;this.dispatchEvent(new CustomEvent("clipboard",{detail:{text:t}}))}else{i=Math.abs(i);const t=this._sock.rQshift32();let n=t&65535,d=t&4278190080;if(!!(d&ko)){this._clipboardServerCapabilitiesFormats={},this._clipboardServerCapabilitiesActions={};for(let u=0;u<=15;u++){let v=1<<u;n&v&&(this._clipboardServerCapabilitiesFormats[v]=!0,this._sock.rQshift32())}for(let u=24;u<=31;u++){let v=1<<u;this._clipboardServerCapabilitiesActions[v]=!!(d&v)}let a=[ko,Dr,Eo,ui,Br];pe.messages.extendedClipboardCaps(this._sock,a,{extendedClipboardFormatText:0})}else if(d===Dr){if(this._viewOnly)return!0;this._clipboardText!=null&&this._clipboardServerCapabilitiesActions[Br]&&n&ft&&pe.messages.extendedClipboardProvide(this._sock,[ft],[this._clipboardText])}else if(d===Eo){if(this._viewOnly)return!0;this._clipboardServerCapabilitiesActions[ui]&&(this._clipboardText!=null?pe.messages.extendedClipboardNotify(this._sock,[ft]):pe.messages.extendedClipboardNotify(this._sock,[]))}else if(d===ui){if(this._viewOnly)return!0;this._clipboardServerCapabilitiesActions[Dr]&&n&ft&&pe.messages.extendedClipboardRequest(this._sock,[ft])}else if(d===Br){if(this._viewOnly||!(n&ft))return!0;this._clipboardText=null;let a=this._sock.rQshiftBytes(i-4),u=new Wn,v=null;u.setInput(a);for(let l=0;l<=15;l++){let _=1<<l;if(n&_){let S=0,b=u.inflate(4);S|=b[0]<<24,S|=b[1]<<16,S|=b[2]<<8,S|=b[3];let p=u.inflate(S);_===ft&&(v=p)}}if(u.setInput(null),v!==null){let l="";for(let _=0;_<v.length;_++)l+=String.fromCharCode(v[_]);v=l,v=gn(v),v.length>0&&v.charAt(v.length-1)==="\0"&&(v=v.slice(0,-1)),v=v.replace(`\r
`,`
`),this.dispatchEvent(new CustomEvent("clipboard",{detail:{text:v}}))}}else return this._fail("Unexpected action in extended clipboard message: "+d)}return!0}_handleServerFenceMsg(){if(this._sock.rQwait("ServerFence header",8,1))return!1;this._sock.rQskipBytes(3);let i=this._sock.rQshift32(),t=this._sock.rQshift8();if(this._sock.rQwait("ServerFence payload",t,9))return!1;t>64&&(it("Bad payload length ("+t+") in fence response"),t=64);const n=this._sock.rQshiftStr(t);return this._supportsFence=!0,i&1<<31?(i&=3,pe.messages.clientFence(this._sock,i,n),!0):this._fail("Unexpected fence response")}_handleXvpMsg(){if(this._sock.rQwait("XVP version and message",3,1))return!1;this._sock.rQskipBytes(1);const i=this._sock.rQshift8(),t=this._sock.rQshift8();switch(t){case 0:Ce("XVP Operation Failed");break;case 1:this._rfbXvpVer=i,Ne("XVP extensions enabled (version "+this._rfbXvpVer+")"),this._setCapability("power",!0);break;default:this._fail("Illegal server XVP message (msg: "+t+")");break}return!0}_normalMsg(){let i;this._FBU.rects>0?i=0:i=this._sock.rQshift8();let t,n;switch(i){case 0:return n=this._framebufferUpdate(),n&&!this._enabledContinuousUpdates&&pe.messages.fbUpdateRequest(this._sock,!0,0,0,this._fbWidth,this._fbHeight),n;case 1:return this._handleSetColourMapMsg();case 2:return ue("Bell"),this.dispatchEvent(new CustomEvent("bell",{detail:{}})),!0;case 3:return this._handleServerCutText();case 150:return t=!this._supportsContinuousUpdates,this._supportsContinuousUpdates=!0,this._enabledContinuousUpdates=!1,t&&(this._enabledContinuousUpdates=!0,this._updateContinuousUpdates(),Ne("Enabling continuous updates.")),!0;case 248:return this._handleServerFenceMsg();case 250:return this._handleXvpMsg();default:return this._fail("Unexpected server message (type "+i+")"),ue("sock.rQslice(0, 30): "+this._sock.rQslice(0,30)),!0}}_onFlush(){this._flushing=!1,this._sock.rQlen>0&&this._handleMessage()}_framebufferUpdate(){if(this._FBU.rects===0){if(this._sock.rQwait("FBU header",3,1))return!1;if(this._sock.rQskipBytes(1),this._FBU.rects=this._sock.rQshift16(),this._display.pending())return this._flushing=!0,this._display.flush(),!1}for(;this._FBU.rects>0;){if(this._FBU.encoding===null){if(this._sock.rQwait("rect header",12))return!1;const i=this._sock.rQshiftBytes(12);this._FBU.x=(i[0]<<8)+i[1],this._FBU.y=(i[2]<<8)+i[3],this._FBU.width=(i[4]<<8)+i[5],this._FBU.height=(i[6]<<8)+i[7],this._FBU.encoding=parseInt((i[8]<<24)+(i[9]<<16)+(i[10]<<8)+i[11],10)}if(!this._handleRect())return!1;this._FBU.rects--,this._FBU.encoding=null}return this._display.flip(),!0}_handleRect(){switch(this._FBU.encoding){case de.pseudoEncodingLastRect:return this._FBU.rects=1,!0;case de.pseudoEncodingVMwareCursor:return this._handleVMwareCursor();case de.pseudoEncodingCursor:return this._handleCursor();case de.pseudoEncodingQEMUExtendedKeyEvent:return this._qemuExtKeyEventSupported=!0,!0;case de.pseudoEncodingDesktopName:return this._handleDesktopName();case de.pseudoEncodingDesktopSize:return this._resize(this._FBU.width,this._FBU.height),!0;case de.pseudoEncodingExtendedDesktopSize:return this._handleExtendedDesktopSize();default:return this._handleDataRect()}}_handleVMwareCursor(){const i=this._FBU.x,t=this._FBU.y,n=this._FBU.width,d=this._FBU.height;if(this._sock.rQwait("VMware cursor encoding",1))return!1;const e=this._sock.rQshift8();this._sock.rQshift8();let a;const u=4;if(e==0){if(a=new Array(n*d*u),this._sock.rQwait("VMware cursor classic encoding",n*d*u*2,2))return!1;let l=new Array(n*d);for(let S=0;S<n*d;S++)l[S]=this._sock.rQshift32();let _=new Array(n*d);for(let S=0;S<n*d;S++)_[S]=this._sock.rQshift32();for(let S=0;S<n*d;S++)if(l[S]==0){let b=_[S],p=b>>8&255,g=b>>16&255,w=b>>24&255;a[S*u]=p,a[S*u+1]=g,a[S*u+2]=w,a[S*u+3]=255}else(l[S]&-256)==-256?_[S]==0?(a[S*u]=0,a[S*u+1]=0,a[S*u+2]=0,a[S*u+3]=0):(_[S]&-256,a[S*u]=0,a[S*u+1]=0,a[S*u+2]=0,a[S*u+3]=255):(a[S*u]=0,a[S*u+1]=0,a[S*u+2]=0,a[S*u+3]=255)}else if(e==1){if(this._sock.rQwait("VMware cursor alpha encoding",n*d*4,2))return!1;a=new Array(n*d*u);for(let v=0;v<n*d;v++){let l=this._sock.rQshift32();a[v*4]=l>>24&255,a[v*4+1]=l>>16&255,a[v*4+2]=l>>8&255,a[v*4+3]=l&255}}else return it("The given cursor type is not supported: "+e+" given."),!1;return this._updateCursor(a,i,t,n,d),!0}_handleCursor(){const i=this._FBU.x,t=this._FBU.y,n=this._FBU.width,d=this._FBU.height,e=n*d*4,a=Math.ceil(n/8)*d;let u=e+a;if(this._sock.rQwait("cursor encoding",u))return!1;const v=this._sock.rQshiftBytes(e),l=this._sock.rQshiftBytes(a);let _=new Uint8Array(n*d*4),S=0;for(let b=0;b<d;b++)for(let p=0;p<n;p++){let g=b*Math.ceil(n/8)+Math.floor(p/8),w=l[g]<<p%8&128?255:0;_[S]=v[S+2],_[S+1]=v[S+1],_[S+2]=v[S],_[S+3]=w,S+=4}return this._updateCursor(_,i,t,n,d),!0}_handleDesktopName(){if(this._sock.rQwait("DesktopName",4))return!1;let i=this._sock.rQshift32();if(this._sock.rQwait("DesktopName",i,4))return!1;let t=this._sock.rQshiftStr(i);return t=gn(t,!0),this._setDesktopName(t),!0}_handleExtendedDesktopSize(){if(this._sock.rQwait("ExtendedDesktopSize",4))return!1;const i=this._sock.rQpeek8();let t=4+i*16;if(this._sock.rQwait("ExtendedDesktopSize",t))return!1;const n=!this._supportsSetDesktopSize;this._supportsSetDesktopSize=!0,n&&this._requestRemoteResize(),this._sock.rQskipBytes(1),this._sock.rQskipBytes(3);for(let d=0;d<i;d+=1)d===0?(this._screenID=this._sock.rQshiftBytes(4),this._sock.rQskipBytes(2),this._sock.rQskipBytes(2),this._sock.rQskipBytes(2),this._sock.rQskipBytes(2),this._screenFlags=this._sock.rQshiftBytes(4)):this._sock.rQskipBytes(16);if(this._FBU.x===1&&this._FBU.y!==0){let d="";switch(this._FBU.y){case 1:d="Resize is administratively prohibited";break;case 2:d="Out of resources";break;case 3:d="Invalid screen layout";break;default:d="Unknown reason";break}it("Server did not accept the resize request: "+d)}else this._resize(this._FBU.width,this._FBU.height);return!0}_handleDataRect(){let i=this._decoders[this._FBU.encoding];if(!i)return this._fail("Unsupported encoding (encoding: "+this._FBU.encoding+")"),!1;try{return i.decodeRect(this._FBU.x,this._FBU.y,this._FBU.width,this._FBU.height,this._sock,this._display,this._fbDepth)}catch(t){return this._fail("Error decoding rect: "+t),!1}}_updateContinuousUpdates(){this._enabledContinuousUpdates&&pe.messages.enableContinuousUpdates(this._sock,!0,0,0,this._fbWidth,this._fbHeight)}_resize(i,t){this._fbWidth=i,this._fbHeight=t,this._display.resize(this._fbWidth,this._fbHeight),this._updateClip(),this._updateScale(),this._updateContinuousUpdates(),this._saveExpectedClientSize()}_xvpOp(i,t){this._rfbXvpVer<i||(Ne("Sending XVP operation "+t+" (version "+i+")"),pe.messages.xvpOp(this._sock,i,t))}_updateCursor(i,t,n,d,e){this._cursorImage={rgbaPixels:i,hotx:t,hoty:n,w:d,h:e},this._refreshCursor()}_shouldShowDotCursor(){if(!this._showDotCursor)return!1;for(let i=3;i<this._cursorImage.rgbaPixels.length;i+=4)if(this._cursorImage.rgbaPixels[i])return!1;return!0}_refreshCursor(){if(this._rfbConnectionState!=="connecting"&&this._rfbConnectionState!=="connected")return;const i=this._shouldShowDotCursor()?pe.cursors.dot:this._cursorImage;this._cursor.change(i.rgbaPixels,i.hotx,i.hoty,i.w,i.h)}static genDES(i,t){const n=i.split("").map(e=>e.charCodeAt(0)),d=Le.importKey("raw",n,{name:"DES-ECB"},!1,["encrypt"]);return Le.encrypt({name:"DES-ECB"},d,t)}}pe.messages={keyEvent(r,i,t){const n=r._sQ,d=r._sQlen;n[d]=4,n[d+1]=t,n[d+2]=0,n[d+3]=0,n[d+4]=i>>24,n[d+5]=i>>16,n[d+6]=i>>8,n[d+7]=i,r._sQlen+=8,r.flush()},QEMUExtendedKeyEvent(r,i,t,n){function d(v){const l=n>>8,_=n&255;return l===224&&_<127?_|128:v}const e=r._sQ,a=r._sQlen;e[a]=255,e[a+1]=0,e[a+2]=t>>8,e[a+3]=t,e[a+4]=i>>24,e[a+5]=i>>16,e[a+6]=i>>8,e[a+7]=i;const u=d(n);e[a+8]=u>>24,e[a+9]=u>>16,e[a+10]=u>>8,e[a+11]=u,r._sQlen+=12,r.flush()},pointerEvent(r,i,t,n){const d=r._sQ,e=r._sQlen;d[e]=5,d[e+1]=n,d[e+2]=i>>8,d[e+3]=i,d[e+4]=t>>8,d[e+5]=t,r._sQlen+=6,r.flush()},_buildExtendedClipboardFlags(r,i){let t=new Uint8Array(4),n=0,d=0;for(let e=0;e<r.length;e++)d|=r[e];for(let e=0;e<i.length;e++)n|=i[e];return t[0]=d>>24,t[1]=0,t[2]=0,t[3]=n,t},extendedClipboardProvide(r,i,t){let n=new Yc,d=[];for(let u=0;u<i.length;u++){if(i[u]!=ft)throw new Error("Unsupported extended clipboard format for Provide message.");t[u]=t[u].replace(/\r\n|\r|\n/gm,`\r
`);let v=vt(t[u]+"\0");d.push(v.length>>24&255,v.length>>16&255,v.length>>8&255,v.length&255);for(let l=0;l<v.length;l++)d.push(v.charCodeAt(l))}let e=n.deflate(new Uint8Array(d)),a=new Uint8Array(4+e.length);a.set(pe.messages._buildExtendedClipboardFlags([Br],i)),a.set(e,4),pe.messages.clientCutText(r,a,!0)},extendedClipboardNotify(r,i){let t=pe.messages._buildExtendedClipboardFlags([ui],i);pe.messages.clientCutText(r,t,!0)},extendedClipboardRequest(r,i){let t=pe.messages._buildExtendedClipboardFlags([Dr],i);pe.messages.clientCutText(r,t,!0)},extendedClipboardCaps(r,i,t){let n=Object.keys(t),d=new Uint8Array(4+4*n.length);n.map(a=>parseInt(a)),n.sort((a,u)=>a-u),d.set(pe.messages._buildExtendedClipboardFlags(i,[]));let e=4;for(let a=0;a<n.length;a++)d[e]=t[n[a]]>>24,d[e+1]=t[n[a]]>>16,d[e+2]=t[n[a]]>>8,d[e+3]=t[n[a]]>>0,e+=4,d[3]|=1<<n[a];pe.messages.clientCutText(r,d,!0)},clientCutText(r,i,t=!1){const n=r._sQ,d=r._sQlen;n[d]=6,n[d+1]=0,n[d+2]=0,n[d+3]=0;let e;t?e=Ca(-i.length):e=i.length,n[d+4]=e>>24,n[d+5]=e>>16,n[d+6]=e>>8,n[d+7]=e,r._sQlen+=8;let a=0,u=i.length;for(;u>0;){let v=Math.min(u,r._sQbufferSize-r._sQlen);for(let l=0;l<v;l++)n[r._sQlen+l]=i[a+l];r._sQlen+=v,r.flush(),u-=v,a+=v}},setDesktopSize(r,i,t,n,d){const e=r._sQ,a=r._sQlen;e[a]=251,e[a+1]=0,e[a+2]=i>>8,e[a+3]=i,e[a+4]=t>>8,e[a+5]=t,e[a+6]=1,e[a+7]=0,e[a+8]=n>>24,e[a+9]=n>>16,e[a+10]=n>>8,e[a+11]=n,e[a+12]=0,e[a+13]=0,e[a+14]=0,e[a+15]=0,e[a+16]=i>>8,e[a+17]=i,e[a+18]=t>>8,e[a+19]=t,e[a+20]=d>>24,e[a+21]=d>>16,e[a+22]=d>>8,e[a+23]=d,r._sQlen+=24,r.flush()},clientFence(r,i,t){const n=r._sQ,d=r._sQlen;n[d]=248,n[d+1]=0,n[d+2]=0,n[d+3]=0,n[d+4]=i>>24,n[d+5]=i>>16,n[d+6]=i>>8,n[d+7]=i;const e=t.length;n[d+8]=e;for(let a=0;a<e;a++)n[d+9+a]=t.charCodeAt(a);r._sQlen+=9+e,r.flush()},enableContinuousUpdates(r,i,t,n,d,e){const a=r._sQ,u=r._sQlen;a[u]=150,a[u+1]=i,a[u+2]=t>>8,a[u+3]=t,a[u+4]=n>>8,a[u+5]=n,a[u+6]=d>>8,a[u+7]=d,a[u+8]=e>>8,a[u+9]=e,r._sQlen+=10,r.flush()},pixelFormat(r,i,t){const n=r._sQ,d=r._sQlen;let e;i>16?e=32:i>8?e=16:e=8;const a=Math.floor(i/3);n[d]=0,n[d+1]=0,n[d+2]=0,n[d+3]=0,n[d+4]=e,n[d+5]=i,n[d+6]=0,n[d+7]=t?1:0,n[d+8]=0,n[d+9]=(1<<a)-1,n[d+10]=0,n[d+11]=(1<<a)-1,n[d+12]=0,n[d+13]=(1<<a)-1,n[d+14]=a*0,n[d+15]=a*1,n[d+16]=a*2,n[d+17]=0,n[d+18]=0,n[d+19]=0,r._sQlen+=20,r.flush()},clientEncodings(r,i){const t=r._sQ,n=r._sQlen;t[n]=2,t[n+1]=0,t[n+2]=i.length>>8,t[n+3]=i.length;let d=n+4;for(let e=0;e<i.length;e++){const a=i[e];t[d]=a>>24,t[d+1]=a>>16,t[d+2]=a>>8,t[d+3]=a,d+=4}r._sQlen+=d-n,r.flush()},fbUpdateRequest(r,i,t,n,d,e){const a=r._sQ,u=r._sQlen;typeof t>"u"&&(t=0),typeof n>"u"&&(n=0),a[u]=3,a[u+1]=i?1:0,a[u+2]=t>>8&255,a[u+3]=t&255,a[u+4]=n>>8&255,a[u+5]=n&255,a[u+6]=d>>8&255,a[u+7]=d&255,a[u+8]=e>>8&255,a[u+9]=e&255,r._sQlen+=10,r.flush()},xvpOp(r,i,t){const n=r._sQ,d=r._sQlen;n[d]=250,n[d+1]=0,n[d+2]=i,n[d+3]=t,r._sQlen+=4,r.flush()}};pe.cursors={none:{rgbaPixels:new Uint8Array,w:0,h:0,hotx:0,hoty:0},dot:{rgbaPixels:new Uint8Array([255,255,255,255,0,0,0,255,255,255,255,255,0,0,0,255,0,0,0,0,0,0,0,255,255,255,255,255,0,0,0,255,255,255,255,255]),w:3,h:3,hotx:1,hoty:1}};var Lo;(function(r){r[r.connect=0]="connect",r[r.disconnect=1]="disconnect",r[r.credentialsrequired=2]="credentialsrequired",r[r.securityfailure=3]="securityfailure",r[r.clipboard=4]="clipboard",r[r.bell=5]="bell",r[r.desktopname=6]="desktopname",r[r.capabilities=7]="capabilities"})(Lo||(Lo={}));const Fl=(r,i)=>{var t;const n=ze.useRef(null),d=ze.useRef((t=r.autoConnect)!==null&&t!==void 0?t:!0),e=ze.useRef([]),a=ze.useRef({}),u=ze.useRef(null),[v,l]=ze.useState(!0),{url:_,style:S,className:b,viewOnly:p,rfbOptions:g,focusOnClick:w,clipViewport:x,dragViewport:h,scaleViewport:s,resizeSession:c,showDotCursor:o,background:f,qualityLevel:m,compressionLevel:y,autoConnect:C=!0,retryDuration:L=3e3,debug:k=!1,loadingUI:E,onConnect:A,onDisconnect:D,onCredentialsRequired:M,onSecurityFailure:F,onClipboard:T,onBell:R,onDesktopName:O,onCapabilities:H}=r,ee={log:(...te)=>{k&&console.log(...te)},info:(...te)=>{k&&console.info(...te)},error:(...te)=>{k&&console.error(...te)}},ie=()=>n.current,J=te=>{n.current=te},ne=()=>d.current,re=te=>{d.current=te},B=()=>{const te=ie();if(A){A(te??void 0),l(!1);return}ee.info("Connected to remote VNC."),l(!1)},he=()=>{const te=ie();if(D){D(te??void 0),l(!0);return}ne()?(ee.info(`Unexpectedly disconnected from remote VNC, retrying in ${L/1e3} seconds.`),e.current.push(setTimeout(xe,L))):ee.info("Disconnected from remote VNC."),l(!0)},le=()=>{var te,_e;const Te=ie();if(M){M(Te??void 0);return}const Ye=(_e=(te=g==null?void 0:g.credentials)===null||te===void 0?void 0:te.password)!==null&&_e!==void 0?_e:prompt("Password Required:");Te==null||Te.sendCredentials({password:Ye})},me=te=>{if(O){O(te);return}ee.info(`Desktop name is ${te.detail.name}`)},U=()=>{const te=ie();try{if(!te)return;e.current.forEach(clearTimeout),Object.keys(a.current).forEach(_e=>{a.current[_e]&&(te.removeEventListener(_e,a.current[_e]),a.current[_e]=void 0)}),te.disconnect(),J(null),re(!1),he()}catch(_e){ee.error(_e),J(null),re(!1)}},xe=()=>{try{if(d&&n&&U(),!u.current)return;u.current.innerHTML="";const te=new pe(u.current,_,g);te.viewOnly=p??!1,te.focusOnClick=w??!1,te.clipViewport=x??!1,te.dragViewport=h??!1,te.resizeSession=c??!1,te.scaleViewport=s??!1,te.showDotCursor=o??!1,te.background=f??"",te.qualityLevel=m??6,te.compressionLevel=y??2,J(te),a.current.connect=B,a.current.disconnect=he,a.current.credentialsrequired=le,a.current.securityfailure=F,a.current.clipboard=T,a.current.bell=R,a.current.desktopname=me,a.current.capabilities=H,Object.keys(a.current).forEach(_e=>{a.current[_e]&&te.addEventListener(_e,a.current[_e])}),re(!0)}catch(te){ee.error(te)}},ce=te=>{const _e=ie();_e==null||_e.sendCredentials(te)},$=(te,_e,Te)=>{const Ye=ie();Ye==null||Ye.sendKey(te,_e,Te)},X=()=>{const te=ie();te==null||te.sendCtrlAltDel()},I=()=>{const te=ie();te==null||te.focus()},Y=()=>{const te=ie();te==null||te.blur()},oe=()=>{const te=ie();te==null||te.machineShutdown()},ae=()=>{const te=ie();te==null||te.machineReboot()},fe=()=>{const te=ie();te==null||te.machineReset()},Se=te=>{const _e=ie();_e==null||_e.clipboardPasteFrom(te)};ze.useImperativeHandle(i,()=>({connect:xe,disconnect:U,connected:d.current,sendCredentials:ce,sendKey:$,sendCtrlAltDel:X,focus:I,blur:Y,machineShutdown:oe,machineReboot:ae,machineReset:fe,clipboardPaste:Se,rfb:n.current,eventListeners:a.current})),ze.useEffect(()=>(C&&xe(),U),[]);const Ae=()=>{const te=ie();te&&te.focus()},Me=()=>{document.activeElement&&document.activeElement instanceof HTMLElement&&document.activeElement.blur(),Ae()},se=()=>{const te=ie();te&&te.blur()};return Ee.jsxs(Ee.Fragment,{children:[Ee.jsx("div",{style:S,className:b,ref:u,onMouseEnter:Me,onMouseLeave:se},void 0),v&&(E??Ee.jsx("div",Object.assign({className:"text-white loading"},{children:"Loading..."}),void 0))]},void 0)};var Dl=ze.forwardRef(Fl);const Bl=_a()(()=>({container:{"& canvas":{display:"block",margin:"auto"}},errorState:{"& *":{color:"#f4f4f4 !important"}}}));let Ze;const Ol=r=>{const{classes:i}=Bl(),{linode:t,refreshToken:n,token:d}=r,e=ze.useRef(null),a=t.region,[u,v]=ze.useState(t.status==="running");ze.useEffect(()=>{Mo(1080,840);const S=setInterval(()=>{Ze.readyState===Ze.OPEN&&Ze.send(JSON.stringify({action:"status"}))},5*1e3),b=setInterval(()=>{Ze.readyState===Ze.OPEN&&Ze.send(JSON.stringify({action:"renew"}))},30*1e3);return document.addEventListener("paste",l),()=>{clearInterval(S),clearInterval(b),Ze.close()}},[]),ze.useEffect(()=>{var S;_(),(S=e.current)==null||S.connect()},[d]);const l=S=>{var p;if(S.preventDefault(),!((p=e.current)!=null&&p.rfb)||S.clipboardData===null||S.clipboardData.getData("text")===null)return;const b=S.clipboardData.getData("text/plain");ca(b,e)},_=()=>{Ze&&Ze.readyState===Ze.OPEN&&Ze.close();const S=`${Pn(a)}:8080/${d}/monitor`;Ze=new WebSocket(S),Ze.addEventListener("message",b=>{const p=JSON.parse(b.data);if(p.poweredStatus==="Running"&&u===!1){v(!0);return}else if(p.poweredStatus==="Powered Off"&&u===!0){v(!1);return}p.type==="error"&&p.reason==="Your session has expired."&&n(),p.type==="kick"&&n()})};return u?Ee.jsx(Dl,{autoConnect:!1,loadingUI:Ee.jsx(es,{}),ref:e,showDotCursor:!0,url:`${Pn(a)}:8080/${d}`}):Ee.jsx("div",{className:i.errorState,children:Ee.jsx(Or,{errorText:"Please power on your Linode to use Glish"})})},Kl=(r,i)=>{var u,v,l,_,S,b,p,g;const t=r[0],n=t.match(/[A-Z!@#$%^&*()_+{}:\"<>?~|]/),d=65293,e=65505,a=t.charCodeAt(0);if(r.match(/\n/)){(v=(u=i.current)==null?void 0:u.rfb)==null||v.sendKey(d,void 0,void 0);return}n&&((_=(l=i.current)==null?void 0:l.rfb)==null||_.sendKey(e,void 0,!0)),(b=(S=i.current)==null?void 0:S.rfb)==null||b.sendKey(a,void 0,void 0),n&&((g=(p=i==null?void 0:i.current)==null?void 0:p.rfb)==null||g.sendKey(e,void 0,!1))},ca=(r,i,t=10)=>{if(r.length<1)return;const n=r[0];setTimeout(()=>{Kl(n,i),ca(r.slice(1),i)},t)};var la={exports:{}};(function(r,i){(function(t,n){r.exports=n()})(self,function(){return(()=>{var t={4567:function(d,e,a){var u,v=this&&this.__extends||(u=function(h,s){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,o){c.__proto__=o}||function(c,o){for(var f in o)Object.prototype.hasOwnProperty.call(o,f)&&(c[f]=o[f])},u(h,s)},function(h,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function c(){this.constructor=h}u(h,s),h.prototype=s===null?Object.create(s):(c.prototype=s.prototype,new c)});Object.defineProperty(e,"__esModule",{value:!0}),e.AccessibilityManager=void 0;var l=a(9042),_=a(6114),S=a(9924),b=a(3656),p=a(844),g=a(5596),w=a(9631),x=function(h){function s(c,o){var f=h.call(this)||this;f._terminal=c,f._renderService=o,f._liveRegionLineCount=0,f._charsToConsume=[],f._charsToAnnounce="",f._accessibilityTreeRoot=document.createElement("div"),f._accessibilityTreeRoot.classList.add("xterm-accessibility"),f._accessibilityTreeRoot.tabIndex=0,f._rowContainer=document.createElement("div"),f._rowContainer.setAttribute("role","list"),f._rowContainer.classList.add("xterm-accessibility-tree"),f._rowElements=[];for(var m=0;m<f._terminal.rows;m++)f._rowElements[m]=f._createAccessibilityTreeNode(),f._rowContainer.appendChild(f._rowElements[m]);if(f._topBoundaryFocusListener=function(y){return f._onBoundaryFocus(y,0)},f._bottomBoundaryFocusListener=function(y){return f._onBoundaryFocus(y,1)},f._rowElements[0].addEventListener("focus",f._topBoundaryFocusListener),f._rowElements[f._rowElements.length-1].addEventListener("focus",f._bottomBoundaryFocusListener),f._refreshRowsDimensions(),f._accessibilityTreeRoot.appendChild(f._rowContainer),f._renderRowsDebouncer=new S.TimeBasedDebouncer(f._renderRows.bind(f)),f._refreshRows(),f._liveRegion=document.createElement("div"),f._liveRegion.classList.add("live-region"),f._liveRegion.setAttribute("aria-live","assertive"),f._accessibilityTreeRoot.appendChild(f._liveRegion),!f._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");return f._terminal.element.insertAdjacentElement("afterbegin",f._accessibilityTreeRoot),f.register(f._renderRowsDebouncer),f.register(f._terminal.onResize(function(y){return f._onResize(y.rows)})),f.register(f._terminal.onRender(function(y){return f._refreshRows(y.start,y.end)})),f.register(f._terminal.onScroll(function(){return f._refreshRows()})),f.register(f._terminal.onA11yChar(function(y){return f._onChar(y)})),f.register(f._terminal.onLineFeed(function(){return f._onChar(`
`)})),f.register(f._terminal.onA11yTab(function(y){return f._onTab(y)})),f.register(f._terminal.onKey(function(y){return f._onKey(y.key)})),f.register(f._terminal.onBlur(function(){return f._clearLiveRegion()})),f.register(f._renderService.onDimensionsChange(function(){return f._refreshRowsDimensions()})),f._screenDprMonitor=new g.ScreenDprMonitor,f.register(f._screenDprMonitor),f._screenDprMonitor.setListener(function(){return f._refreshRowsDimensions()}),f.register((0,b.addDisposableDomListener)(window,"resize",function(){return f._refreshRowsDimensions()})),f}return v(s,h),s.prototype.dispose=function(){h.prototype.dispose.call(this),(0,w.removeElementFromParent)(this._accessibilityTreeRoot),this._rowElements.length=0},s.prototype._onBoundaryFocus=function(c,o){var f=c.target,m=this._rowElements[o===0?1:this._rowElements.length-2];if(f.getAttribute("aria-posinset")!==(o===0?"1":""+this._terminal.buffer.lines.length)&&c.relatedTarget===m){var y,C;if(o===0?(y=f,C=this._rowElements.pop(),this._rowContainer.removeChild(C)):(y=this._rowElements.shift(),C=f,this._rowContainer.removeChild(y)),y.removeEventListener("focus",this._topBoundaryFocusListener),C.removeEventListener("focus",this._bottomBoundaryFocusListener),o===0){var L=this._createAccessibilityTreeNode();this._rowElements.unshift(L),this._rowContainer.insertAdjacentElement("afterbegin",L)}else L=this._createAccessibilityTreeNode(),this._rowElements.push(L),this._rowContainer.appendChild(L);this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(o===0?-1:1),this._rowElements[o===0?1:this._rowElements.length-2].focus(),c.preventDefault(),c.stopImmediatePropagation()}},s.prototype._onResize=function(c){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(var o=this._rowContainer.children.length;o<this._terminal.rows;o++)this._rowElements[o]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[o]);for(;this._rowElements.length>c;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()},s.prototype._createAccessibilityTreeNode=function(){var c=document.createElement("div");return c.setAttribute("role","listitem"),c.tabIndex=-1,this._refreshRowDimensions(c),c},s.prototype._onTab=function(c){for(var o=0;o<c;o++)this._onChar(" ")},s.prototype._onChar=function(c){var o=this;this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==c&&(this._charsToAnnounce+=c):this._charsToAnnounce+=c,c===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=l.tooMuchOutput)),_.isMac&&this._liveRegion.textContent&&this._liveRegion.textContent.length>0&&!this._liveRegion.parentNode&&setTimeout(function(){o._accessibilityTreeRoot.appendChild(o._liveRegion)},0))},s.prototype._clearLiveRegion=function(){this._liveRegion.textContent="",this._liveRegionLineCount=0,_.isMac&&(0,w.removeElementFromParent)(this._liveRegion)},s.prototype._onKey=function(c){this._clearLiveRegion(),this._charsToConsume.push(c)},s.prototype._refreshRows=function(c,o){this._renderRowsDebouncer.refresh(c,o,this._terminal.rows)},s.prototype._renderRows=function(c,o){for(var f=this._terminal.buffer,m=f.lines.length.toString(),y=c;y<=o;y++){var C=f.translateBufferLineToString(f.ydisp+y,!0),L=(f.ydisp+y+1).toString(),k=this._rowElements[y];k&&(C.length===0?k.innerText="":k.textContent=C,k.setAttribute("aria-posinset",L),k.setAttribute("aria-setsize",m))}this._announceCharacters()},s.prototype._refreshRowsDimensions=function(){if(this._renderService.dimensions.actualCellHeight){this._rowElements.length!==this._terminal.rows&&this._onResize(this._terminal.rows);for(var c=0;c<this._terminal.rows;c++)this._refreshRowDimensions(this._rowElements[c])}},s.prototype._refreshRowDimensions=function(c){c.style.height=this._renderService.dimensions.actualCellHeight+"px"},s.prototype._announceCharacters=function(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")},s}(p.Disposable);e.AccessibilityManager=x},3614:(d,e)=>{function a(_){return _.replace(/\r?\n/g,"\r")}function u(_,S){return S?"\x1B[200~"+_+"\x1B[201~":_}function v(_,S,b){_=u(_=a(_),b.decPrivateModes.bracketedPasteMode),b.triggerDataEvent(_,!0),S.value=""}function l(_,S,b){var p=b.getBoundingClientRect(),g=_.clientX-p.left-10,w=_.clientY-p.top-10;S.style.width="20px",S.style.height="20px",S.style.left=g+"px",S.style.top=w+"px",S.style.zIndex="1000",S.focus()}Object.defineProperty(e,"__esModule",{value:!0}),e.rightClickHandler=e.moveTextAreaUnderMouseCursor=e.paste=e.handlePasteEvent=e.copyHandler=e.bracketTextForPaste=e.prepareTextForTerminal=void 0,e.prepareTextForTerminal=a,e.bracketTextForPaste=u,e.copyHandler=function(_,S){_.clipboardData&&_.clipboardData.setData("text/plain",S.selectionText),_.preventDefault()},e.handlePasteEvent=function(_,S,b){_.stopPropagation(),_.clipboardData&&v(_.clipboardData.getData("text/plain"),S,b)},e.paste=v,e.moveTextAreaUnderMouseCursor=l,e.rightClickHandler=function(_,S,b,p,g){l(_,S,b),g&&p.rightClickSelect(_),S.value=p.selectionText,S.select()}},7239:(d,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ColorContrastCache=void 0;var a=function(){function u(){this._color={},this._rgba={}}return u.prototype.clear=function(){this._color={},this._rgba={}},u.prototype.setCss=function(v,l,_){this._rgba[v]||(this._rgba[v]={}),this._rgba[v][l]=_},u.prototype.getCss=function(v,l){return this._rgba[v]?this._rgba[v][l]:void 0},u.prototype.setColor=function(v,l,_){this._color[v]||(this._color[v]={}),this._color[v][l]=_},u.prototype.getColor=function(v,l){return this._color[v]?this._color[v][l]:void 0},u}();e.ColorContrastCache=a},5680:function(d,e,a){var u=this&&this.__read||function(x,h){var s=typeof Symbol=="function"&&x[Symbol.iterator];if(!s)return x;var c,o,f=s.call(x),m=[];try{for(;(h===void 0||h-- >0)&&!(c=f.next()).done;)m.push(c.value)}catch(y){o={error:y}}finally{try{c&&!c.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}return m};Object.defineProperty(e,"__esModule",{value:!0}),e.ColorManager=e.DEFAULT_ANSI_COLORS=void 0;var v=a(8055),l=a(7239),_=v.css.toColor("#ffffff"),S=v.css.toColor("#000000"),b=v.css.toColor("#ffffff"),p=v.css.toColor("#000000"),g={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};e.DEFAULT_ANSI_COLORS=Object.freeze(function(){for(var x=[v.css.toColor("#2e3436"),v.css.toColor("#cc0000"),v.css.toColor("#4e9a06"),v.css.toColor("#c4a000"),v.css.toColor("#3465a4"),v.css.toColor("#75507b"),v.css.toColor("#06989a"),v.css.toColor("#d3d7cf"),v.css.toColor("#555753"),v.css.toColor("#ef2929"),v.css.toColor("#8ae234"),v.css.toColor("#fce94f"),v.css.toColor("#729fcf"),v.css.toColor("#ad7fa8"),v.css.toColor("#34e2e2"),v.css.toColor("#eeeeec")],h=[0,95,135,175,215,255],s=0;s<216;s++){var c=h[s/36%6|0],o=h[s/6%6|0],f=h[s%6];x.push({css:v.channels.toCss(c,o,f),rgba:v.channels.toRgba(c,o,f)})}for(s=0;s<24;s++){var m=8+10*s;x.push({css:v.channels.toCss(m,m,m),rgba:v.channels.toRgba(m,m,m)})}return x}());var w=function(){function x(h,s){this.allowTransparency=s;var c=h.createElement("canvas");c.width=1,c.height=1;var o=c.getContext("2d");if(!o)throw new Error("Could not get rendering context");this._ctx=o,this._ctx.globalCompositeOperation="copy",this._litmusColor=this._ctx.createLinearGradient(0,0,1,1),this._contrastCache=new l.ColorContrastCache,this.colors={foreground:_,background:S,cursor:b,cursorAccent:p,selectionTransparent:g,selectionOpaque:v.color.blend(S,g),selectionForeground:void 0,ansi:e.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache},this._updateRestoreColors()}return x.prototype.onOptionsChange=function(h){h==="minimumContrastRatio"&&this._contrastCache.clear()},x.prototype.setTheme=function(h){h===void 0&&(h={}),this.colors.foreground=this._parseColor(h.foreground,_),this.colors.background=this._parseColor(h.background,S),this.colors.cursor=this._parseColor(h.cursor,b,!0),this.colors.cursorAccent=this._parseColor(h.cursorAccent,p,!0),this.colors.selectionTransparent=this._parseColor(h.selection,g,!0),this.colors.selectionOpaque=v.color.blend(this.colors.background,this.colors.selectionTransparent);var s={css:"",rgba:0};this.colors.selectionForeground=h.selectionForeground?this._parseColor(h.selectionForeground,s):void 0,this.colors.selectionForeground===s&&(this.colors.selectionForeground=void 0),v.color.isOpaque(this.colors.selectionTransparent)&&(this.colors.selectionTransparent=v.color.opacity(this.colors.selectionTransparent,.3)),this.colors.ansi[0]=this._parseColor(h.black,e.DEFAULT_ANSI_COLORS[0]),this.colors.ansi[1]=this._parseColor(h.red,e.DEFAULT_ANSI_COLORS[1]),this.colors.ansi[2]=this._parseColor(h.green,e.DEFAULT_ANSI_COLORS[2]),this.colors.ansi[3]=this._parseColor(h.yellow,e.DEFAULT_ANSI_COLORS[3]),this.colors.ansi[4]=this._parseColor(h.blue,e.DEFAULT_ANSI_COLORS[4]),this.colors.ansi[5]=this._parseColor(h.magenta,e.DEFAULT_ANSI_COLORS[5]),this.colors.ansi[6]=this._parseColor(h.cyan,e.DEFAULT_ANSI_COLORS[6]),this.colors.ansi[7]=this._parseColor(h.white,e.DEFAULT_ANSI_COLORS[7]),this.colors.ansi[8]=this._parseColor(h.brightBlack,e.DEFAULT_ANSI_COLORS[8]),this.colors.ansi[9]=this._parseColor(h.brightRed,e.DEFAULT_ANSI_COLORS[9]),this.colors.ansi[10]=this._parseColor(h.brightGreen,e.DEFAULT_ANSI_COLORS[10]),this.colors.ansi[11]=this._parseColor(h.brightYellow,e.DEFAULT_ANSI_COLORS[11]),this.colors.ansi[12]=this._parseColor(h.brightBlue,e.DEFAULT_ANSI_COLORS[12]),this.colors.ansi[13]=this._parseColor(h.brightMagenta,e.DEFAULT_ANSI_COLORS[13]),this.colors.ansi[14]=this._parseColor(h.brightCyan,e.DEFAULT_ANSI_COLORS[14]),this.colors.ansi[15]=this._parseColor(h.brightWhite,e.DEFAULT_ANSI_COLORS[15]),this._contrastCache.clear(),this._updateRestoreColors()},x.prototype.restoreColor=function(h){if(h!==void 0)switch(h){case 256:this.colors.foreground=this._restoreColors.foreground;break;case 257:this.colors.background=this._restoreColors.background;break;case 258:this.colors.cursor=this._restoreColors.cursor;break;default:this.colors.ansi[h]=this._restoreColors.ansi[h]}else for(var s=0;s<this._restoreColors.ansi.length;++s)this.colors.ansi[s]=this._restoreColors.ansi[s]},x.prototype._updateRestoreColors=function(){this._restoreColors={foreground:this.colors.foreground,background:this.colors.background,cursor:this.colors.cursor,ansi:this.colors.ansi.slice()}},x.prototype._parseColor=function(h,s,c){if(c===void 0&&(c=this.allowTransparency),h===void 0)return s;if(this._ctx.fillStyle=this._litmusColor,this._ctx.fillStyle=h,typeof this._ctx.fillStyle!="string")return console.warn("Color: "+h+" is invalid using fallback "+s.css),s;this._ctx.fillRect(0,0,1,1);var o=this._ctx.getImageData(0,0,1,1).data;if(o[3]!==255){if(!c)return console.warn("Color: "+h+" is using transparency, but allowTransparency is false. Using fallback "+s.css+"."),s;var f=u(this._ctx.fillStyle.substring(5,this._ctx.fillStyle.length-1).split(",").map(function(E){return Number(E)}),4),m=f[0],y=f[1],C=f[2],L=f[3],k=Math.round(255*L);return{rgba:v.channels.toRgba(m,y,C,k),css:h}}return{css:this._ctx.fillStyle,rgba:v.channels.toRgba(o[0],o[1],o[2],o[3])}},x}();e.ColorManager=w},9631:function(d,e){var a=this&&this.__values||function(u){var v=typeof Symbol=="function"&&Symbol.iterator,l=v&&u[v],_=0;if(l)return l.call(u);if(u&&typeof u.length=="number")return{next:function(){return u&&_>=u.length&&(u=void 0),{value:u&&u[_++],done:!u}}};throw new TypeError(v?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.removeElementFromParent=void 0,e.removeElementFromParent=function(){for(var u,v,l,_=[],S=0;S<arguments.length;S++)_[S]=arguments[S];try{for(var b=a(_),p=b.next();!p.done;p=b.next()){var g=p.value;(l=g==null?void 0:g.parentElement)===null||l===void 0||l.removeChild(g)}}catch(w){u={error:w}}finally{try{p&&!p.done&&(v=b.return)&&v.call(b)}finally{if(u)throw u.error}}}},3656:(d,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.addDisposableDomListener=void 0,e.addDisposableDomListener=function(a,u,v,l){a.addEventListener(u,v,l);var _=!1;return{dispose:function(){_||(_=!0,a.removeEventListener(u,v,l))}}}},3551:function(d,e,a){var u=this&&this.__decorate||function(p,g,w,x){var h,s=arguments.length,c=s<3?g:x===null?x=Object.getOwnPropertyDescriptor(g,w):x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(p,g,w,x);else for(var o=p.length-1;o>=0;o--)(h=p[o])&&(c=(s<3?h(c):s>3?h(g,w,c):h(g,w))||c);return s>3&&c&&Object.defineProperty(g,w,c),c},v=this&&this.__param||function(p,g){return function(w,x){g(w,x,p)}};Object.defineProperty(e,"__esModule",{value:!0}),e.MouseZone=e.Linkifier=void 0;var l=a(8460),_=a(2585),S=function(){function p(g,w,x){this._bufferService=g,this._logService=w,this._unicodeService=x,this._linkMatchers=[],this._nextLinkMatcherId=0,this._onShowLinkUnderline=new l.EventEmitter,this._onHideLinkUnderline=new l.EventEmitter,this._onLinkTooltip=new l.EventEmitter,this._rowsToLinkify={start:void 0,end:void 0}}return Object.defineProperty(p.prototype,"onShowLinkUnderline",{get:function(){return this._onShowLinkUnderline.event},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"onHideLinkUnderline",{get:function(){return this._onHideLinkUnderline.event},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"onLinkTooltip",{get:function(){return this._onLinkTooltip.event},enumerable:!1,configurable:!0}),p.prototype.attachToDom=function(g,w){this._element=g,this._mouseZoneManager=w},p.prototype.linkifyRows=function(g,w){var x=this;this._mouseZoneManager&&(this._rowsToLinkify.start===void 0||this._rowsToLinkify.end===void 0?(this._rowsToLinkify.start=g,this._rowsToLinkify.end=w):(this._rowsToLinkify.start=Math.min(this._rowsToLinkify.start,g),this._rowsToLinkify.end=Math.max(this._rowsToLinkify.end,w)),this._mouseZoneManager.clearAll(g,w),this._rowsTimeoutId&&clearTimeout(this._rowsTimeoutId),this._rowsTimeoutId=setTimeout(function(){return x._linkifyRows()},p._timeBeforeLatency))},p.prototype._linkifyRows=function(){this._rowsTimeoutId=void 0;var g=this._bufferService.buffer;if(this._rowsToLinkify.start!==void 0&&this._rowsToLinkify.end!==void 0){var w=g.ydisp+this._rowsToLinkify.start;if(!(w>=g.lines.length)){for(var x=g.ydisp+Math.min(this._rowsToLinkify.end,this._bufferService.rows)+1,h=Math.ceil(2e3/this._bufferService.cols),s=this._bufferService.buffer.iterator(!1,w,x,h,h);s.hasNext();)for(var c=s.next(),o=0;o<this._linkMatchers.length;o++)this._doLinkifyRow(c.range.first,c.content,this._linkMatchers[o]);this._rowsToLinkify.start=void 0,this._rowsToLinkify.end=void 0}}else this._logService.debug("_rowToLinkify was unset before _linkifyRows was called")},p.prototype.registerLinkMatcher=function(g,w,x){if(x===void 0&&(x={}),!w)throw new Error("handler must be defined");var h={id:this._nextLinkMatcherId++,regex:g,handler:w,matchIndex:x.matchIndex,validationCallback:x.validationCallback,hoverTooltipCallback:x.tooltipCallback,hoverLeaveCallback:x.leaveCallback,willLinkActivate:x.willLinkActivate,priority:x.priority||0};return this._addLinkMatcherToList(h),h.id},p.prototype._addLinkMatcherToList=function(g){if(this._linkMatchers.length!==0){for(var w=this._linkMatchers.length-1;w>=0;w--)if(g.priority<=this._linkMatchers[w].priority)return void this._linkMatchers.splice(w+1,0,g);this._linkMatchers.splice(0,0,g)}else this._linkMatchers.push(g)},p.prototype.deregisterLinkMatcher=function(g){for(var w=0;w<this._linkMatchers.length;w++)if(this._linkMatchers[w].id===g)return this._linkMatchers.splice(w,1),!0;return!1},p.prototype._doLinkifyRow=function(g,w,x){for(var h,s=this,c=new RegExp(x.regex.source,(x.regex.flags||"")+"g"),o=-1,f=function(){var y=h[typeof x.matchIndex!="number"?0:x.matchIndex];if(!y)return m._logService.debug("match found without corresponding matchIndex",h,x),"break";if(o=w.indexOf(y,o+1),c.lastIndex=o+y.length,o<0)return"break";var C=m._bufferService.buffer.stringIndexToBufferIndex(g,o);if(C[0]<0)return"break";var L=m._bufferService.buffer.lines.get(C[0]);if(!L)return"break";var k=L.getFg(C[1]),E=k?k>>9&511:void 0;x.validationCallback?x.validationCallback(y,function(A){s._rowsTimeoutId||A&&s._addLink(C[1],C[0]-s._bufferService.buffer.ydisp,y,x,E)}):m._addLink(C[1],C[0]-m._bufferService.buffer.ydisp,y,x,E)},m=this;(h=c.exec(w))!==null&&f()!=="break";);},p.prototype._addLink=function(g,w,x,h,s){var c=this;if(this._mouseZoneManager&&this._element){var o=this._unicodeService.getStringCellWidth(x),f=g%this._bufferService.cols,m=w+Math.floor(g/this._bufferService.cols),y=(f+o)%this._bufferService.cols,C=m+Math.floor((f+o)/this._bufferService.cols);y===0&&(y=this._bufferService.cols,C--),this._mouseZoneManager.add(new b(f+1,m+1,y+1,C+1,function(L){if(h.handler)return h.handler(L,x);var k=window.open();k?(k.opener=null,k.location.href=x):console.warn("Opening link blocked as opener could not be cleared")},function(){c._onShowLinkUnderline.fire(c._createLinkHoverEvent(f,m,y,C,s)),c._element.classList.add("xterm-cursor-pointer")},function(L){c._onLinkTooltip.fire(c._createLinkHoverEvent(f,m,y,C,s)),h.hoverTooltipCallback&&h.hoverTooltipCallback(L,x,{start:{x:f,y:m},end:{x:y,y:C}})},function(){c._onHideLinkUnderline.fire(c._createLinkHoverEvent(f,m,y,C,s)),c._element.classList.remove("xterm-cursor-pointer"),h.hoverLeaveCallback&&h.hoverLeaveCallback()},function(L){return!h.willLinkActivate||h.willLinkActivate(L,x)}))}},p.prototype._createLinkHoverEvent=function(g,w,x,h,s){return{x1:g,y1:w,x2:x,y2:h,cols:this._bufferService.cols,fg:s}},p._timeBeforeLatency=200,p=u([v(0,_.IBufferService),v(1,_.ILogService),v(2,_.IUnicodeService)],p)}();e.Linkifier=S;var b=function(p,g,w,x,h,s,c,o,f){this.x1=p,this.y1=g,this.x2=w,this.y2=x,this.clickCallback=h,this.hoverCallback=s,this.tooltipCallback=c,this.leaveCallback=o,this.willLinkActivate=f};e.MouseZone=b},6465:function(d,e,a){var u,v=this&&this.__extends||(u=function(s,c){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,f){o.__proto__=f}||function(o,f){for(var m in f)Object.prototype.hasOwnProperty.call(f,m)&&(o[m]=f[m])},u(s,c)},function(s,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");function o(){this.constructor=s}u(s,c),s.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}),l=this&&this.__decorate||function(s,c,o,f){var m,y=arguments.length,C=y<3?c:f===null?f=Object.getOwnPropertyDescriptor(c,o):f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(s,c,o,f);else for(var L=s.length-1;L>=0;L--)(m=s[L])&&(C=(y<3?m(C):y>3?m(c,o,C):m(c,o))||C);return y>3&&C&&Object.defineProperty(c,o,C),C},_=this&&this.__param||function(s,c){return function(o,f){c(o,f,s)}},S=this&&this.__values||function(s){var c=typeof Symbol=="function"&&Symbol.iterator,o=c&&s[c],f=0;if(o)return o.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&f>=s.length&&(s=void 0),{value:s&&s[f++],done:!s}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")},b=this&&this.__read||function(s,c){var o=typeof Symbol=="function"&&s[Symbol.iterator];if(!o)return s;var f,m,y=o.call(s),C=[];try{for(;(c===void 0||c-- >0)&&!(f=y.next()).done;)C.push(f.value)}catch(L){m={error:L}}finally{try{f&&!f.done&&(o=y.return)&&o.call(y)}finally{if(m)throw m.error}}return C};Object.defineProperty(e,"__esModule",{value:!0}),e.Linkifier2=void 0;var p=a(2585),g=a(8460),w=a(844),x=a(3656),h=function(s){function c(o){var f=s.call(this)||this;return f._bufferService=o,f._linkProviders=[],f._linkCacheDisposables=[],f._isMouseOut=!0,f._activeLine=-1,f._onShowLinkUnderline=f.register(new g.EventEmitter),f._onHideLinkUnderline=f.register(new g.EventEmitter),f.register((0,w.getDisposeArrayDisposable)(f._linkCacheDisposables)),f}return v(c,s),Object.defineProperty(c.prototype,"currentLink",{get:function(){return this._currentLink},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"onShowLinkUnderline",{get:function(){return this._onShowLinkUnderline.event},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"onHideLinkUnderline",{get:function(){return this._onHideLinkUnderline.event},enumerable:!1,configurable:!0}),c.prototype.registerLinkProvider=function(o){var f=this;return this._linkProviders.push(o),{dispose:function(){var m=f._linkProviders.indexOf(o);m!==-1&&f._linkProviders.splice(m,1)}}},c.prototype.attachToDom=function(o,f,m){var y=this;this._element=o,this._mouseService=f,this._renderService=m,this.register((0,x.addDisposableDomListener)(this._element,"mouseleave",function(){y._isMouseOut=!0,y._clearCurrentLink()})),this.register((0,x.addDisposableDomListener)(this._element,"mousemove",this._onMouseMove.bind(this))),this.register((0,x.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,x.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))},c.prototype._onMouseMove=function(o){if(this._lastMouseEvent=o,this._element&&this._mouseService){var f=this._positionFromMouseEvent(o,this._element,this._mouseService);if(f){this._isMouseOut=!1;for(var m=o.composedPath(),y=0;y<m.length;y++){var C=m[y];if(C.classList.contains("xterm"))break;if(C.classList.contains("xterm-hover"))return}this._lastBufferCell&&f.x===this._lastBufferCell.x&&f.y===this._lastBufferCell.y||(this._onHover(f),this._lastBufferCell=f)}}},c.prototype._onHover=function(o){if(this._activeLine!==o.y)return this._clearCurrentLink(),void this._askForLink(o,!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,o)||(this._clearCurrentLink(),this._askForLink(o,!0))},c.prototype._askForLink=function(o,f){var m,y,C,L,k=this;this._activeProviderReplies&&f||((C=this._activeProviderReplies)===null||C===void 0||C.forEach(function(R){R==null||R.forEach(function(O){O.link.dispose&&O.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=o.y);var E=!1,A=function(R,O){f?!((L=D._activeProviderReplies)===null||L===void 0)&&L.get(R)&&(E=D._checkLinkProviderResult(R,o,E)):O.provideLinks(o.y,function(H){var ee,ie;if(!k._isMouseOut){var J=H==null?void 0:H.map(function(ne){return{link:ne}});(ee=k._activeProviderReplies)===null||ee===void 0||ee.set(R,J),E=k._checkLinkProviderResult(R,o,E),((ie=k._activeProviderReplies)===null||ie===void 0?void 0:ie.size)===k._linkProviders.length&&k._removeIntersectingLinks(o.y,k._activeProviderReplies)}})},D=this;try{for(var M=S(this._linkProviders.entries()),F=M.next();!F.done;F=M.next()){var T=b(F.value,2);A(T[0],T[1])}}catch(R){m={error:R}}finally{try{F&&!F.done&&(y=M.return)&&y.call(M)}finally{if(m)throw m.error}}},c.prototype._removeIntersectingLinks=function(o,f){for(var m=new Set,y=0;y<f.size;y++){var C=f.get(y);if(C)for(var L=0;L<C.length;L++)for(var k=C[L],E=k.link.range.start.y<o?0:k.link.range.start.x,A=k.link.range.end.y>o?this._bufferService.cols:k.link.range.end.x,D=E;D<=A;D++){if(m.has(D)){C.splice(L--,1);break}m.add(D)}}},c.prototype._checkLinkProviderResult=function(o,f,m){var y,C=this;if(!this._activeProviderReplies)return m;for(var L=this._activeProviderReplies.get(o),k=!1,E=0;E<o;E++)this._activeProviderReplies.has(E)&&!this._activeProviderReplies.get(E)||(k=!0);if(!k&&L){var A=L.find(function(M){return C._linkAtPosition(M.link,f)});A&&(m=!0,this._handleNewLink(A))}if(this._activeProviderReplies.size===this._linkProviders.length&&!m)for(E=0;E<this._activeProviderReplies.size;E++){var D=(y=this._activeProviderReplies.get(E))===null||y===void 0?void 0:y.find(function(M){return C._linkAtPosition(M.link,f)});if(D){m=!0,this._handleNewLink(D);break}}return m},c.prototype._handleMouseDown=function(){this._mouseDownLink=this._currentLink},c.prototype._handleMouseUp=function(o){if(this._element&&this._mouseService&&this._currentLink){var f=this._positionFromMouseEvent(o,this._element,this._mouseService);f&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,f)&&this._currentLink.link.activate(o,this._currentLink.link.text)}},c.prototype._clearCurrentLink=function(o,f){this._element&&this._currentLink&&this._lastMouseEvent&&(!o||!f||this._currentLink.link.range.start.y>=o&&this._currentLink.link.range.end.y<=f)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,w.disposeArray)(this._linkCacheDisposables))},c.prototype._handleNewLink=function(o){var f=this;if(this._element&&this._lastMouseEvent&&this._mouseService){var m=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);m&&this._linkAtPosition(o.link,m)&&(this._currentLink=o,this._currentLink.state={decorations:{underline:o.link.decorations===void 0||o.link.decorations.underline,pointerCursor:o.link.decorations===void 0||o.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,o.link,this._lastMouseEvent),o.link.decorations={},Object.defineProperties(o.link.decorations,{pointerCursor:{get:function(){var y,C;return(C=(y=f._currentLink)===null||y===void 0?void 0:y.state)===null||C===void 0?void 0:C.decorations.pointerCursor},set:function(y){var C,L;!((C=f._currentLink)===null||C===void 0)&&C.state&&f._currentLink.state.decorations.pointerCursor!==y&&(f._currentLink.state.decorations.pointerCursor=y,f._currentLink.state.isHovered&&((L=f._element)===null||L===void 0||L.classList.toggle("xterm-cursor-pointer",y)))}},underline:{get:function(){var y,C;return(C=(y=f._currentLink)===null||y===void 0?void 0:y.state)===null||C===void 0?void 0:C.decorations.underline},set:function(y){var C,L,k;!((C=f._currentLink)===null||C===void 0)&&C.state&&((k=(L=f._currentLink)===null||L===void 0?void 0:L.state)===null||k===void 0?void 0:k.decorations.underline)!==y&&(f._currentLink.state.decorations.underline=y,f._currentLink.state.isHovered&&f._fireUnderlineEvent(o.link,y))}}}),this._renderService&&this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(function(y){var C=y.start===0?0:y.start+1+f._bufferService.buffer.ydisp;f._clearCurrentLink(C,y.end+1+f._bufferService.buffer.ydisp)})))}},c.prototype._linkHover=function(o,f,m){var y;!((y=this._currentLink)===null||y===void 0)&&y.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(f,!0),this._currentLink.state.decorations.pointerCursor&&o.classList.add("xterm-cursor-pointer")),f.hover&&f.hover(m,f.text)},c.prototype._fireUnderlineEvent=function(o,f){var m=o.range,y=this._bufferService.buffer.ydisp,C=this._createLinkUnderlineEvent(m.start.x-1,m.start.y-y-1,m.end.x,m.end.y-y-1,void 0);(f?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(C)},c.prototype._linkLeave=function(o,f,m){var y;!((y=this._currentLink)===null||y===void 0)&&y.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(f,!1),this._currentLink.state.decorations.pointerCursor&&o.classList.remove("xterm-cursor-pointer")),f.leave&&f.leave(m,f.text)},c.prototype._linkAtPosition=function(o,f){var m=o.range.start.y===o.range.end.y,y=o.range.start.y<f.y,C=o.range.end.y>f.y;return(m&&o.range.start.x<=f.x&&o.range.end.x>=f.x||y&&o.range.end.x>=f.x||C&&o.range.start.x<=f.x||y&&C)&&o.range.start.y<=f.y&&o.range.end.y>=f.y},c.prototype._positionFromMouseEvent=function(o,f,m){var y=m.getCoords(o,f,this._bufferService.cols,this._bufferService.rows);if(y)return{x:y[0],y:y[1]+this._bufferService.buffer.ydisp}},c.prototype._createLinkUnderlineEvent=function(o,f,m,y,C){return{x1:o,y1:f,x2:m,y2:y,cols:this._bufferService.cols,fg:C}},l([_(0,p.IBufferService)],c)}(w.Disposable);e.Linkifier2=h},9042:(d,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.tooMuchOutput=e.promptLabel=void 0,e.promptLabel="Terminal input",e.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},6954:function(d,e,a){var u,v=this&&this.__extends||(u=function(x,h){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var o in c)Object.prototype.hasOwnProperty.call(c,o)&&(s[o]=c[o])},u(x,h)},function(x,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");function s(){this.constructor=x}u(x,h),x.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}),l=this&&this.__decorate||function(x,h,s,c){var o,f=arguments.length,m=f<3?h:c===null?c=Object.getOwnPropertyDescriptor(h,s):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(x,h,s,c);else for(var y=x.length-1;y>=0;y--)(o=x[y])&&(m=(f<3?o(m):f>3?o(h,s,m):o(h,s))||m);return f>3&&m&&Object.defineProperty(h,s,m),m},_=this&&this.__param||function(x,h){return function(s,c){h(s,c,x)}};Object.defineProperty(e,"__esModule",{value:!0}),e.MouseZoneManager=void 0;var S=a(844),b=a(3656),p=a(4725),g=a(2585),w=function(x){function h(s,c,o,f,m,y){var C=x.call(this)||this;return C._element=s,C._screenElement=c,C._bufferService=o,C._mouseService=f,C._selectionService=m,C._optionsService=y,C._zones=[],C._areZonesActive=!1,C._lastHoverCoords=[void 0,void 0],C._initialSelectionLength=0,C.register((0,b.addDisposableDomListener)(C._element,"mousedown",function(L){return C._onMouseDown(L)})),C._mouseMoveListener=function(L){return C._onMouseMove(L)},C._mouseLeaveListener=function(L){return C._onMouseLeave(L)},C._clickListener=function(L){return C._onClick(L)},C}return v(h,x),h.prototype.dispose=function(){x.prototype.dispose.call(this),this._deactivate()},h.prototype.add=function(s){this._zones.push(s),this._zones.length===1&&this._activate()},h.prototype.clearAll=function(s,c){if(this._zones.length!==0){s&&c||(s=0,c=this._bufferService.rows-1);for(var o=0;o<this._zones.length;o++){var f=this._zones[o];(f.y1>s&&f.y1<=c+1||f.y2>s&&f.y2<=c+1||f.y1<s&&f.y2>c+1)&&(this._currentZone&&this._currentZone===f&&(this._currentZone.leaveCallback(),this._currentZone=void 0),this._zones.splice(o--,1))}this._zones.length===0&&this._deactivate()}},h.prototype._activate=function(){this._areZonesActive||(this._areZonesActive=!0,this._element.addEventListener("mousemove",this._mouseMoveListener),this._element.addEventListener("mouseleave",this._mouseLeaveListener),this._element.addEventListener("click",this._clickListener))},h.prototype._deactivate=function(){this._areZonesActive&&(this._areZonesActive=!1,this._element.removeEventListener("mousemove",this._mouseMoveListener),this._element.removeEventListener("mouseleave",this._mouseLeaveListener),this._element.removeEventListener("click",this._clickListener))},h.prototype._onMouseMove=function(s){this._lastHoverCoords[0]===s.pageX&&this._lastHoverCoords[1]===s.pageY||(this._onHover(s),this._lastHoverCoords=[s.pageX,s.pageY])},h.prototype._onHover=function(s){var c=this,o=this._findZoneEventAt(s);o!==this._currentZone&&(this._currentZone&&(this._currentZone.leaveCallback(),this._currentZone=void 0,this._tooltipTimeout&&clearTimeout(this._tooltipTimeout)),o&&(this._currentZone=o,o.hoverCallback&&o.hoverCallback(s),this._tooltipTimeout=window.setTimeout(function(){return c._onTooltip(s)},this._optionsService.rawOptions.linkTooltipHoverDuration)))},h.prototype._onTooltip=function(s){this._tooltipTimeout=void 0;var c=this._findZoneEventAt(s);c==null||c.tooltipCallback(s)},h.prototype._onMouseDown=function(s){if(this._initialSelectionLength=this._getSelectionLength(),this._areZonesActive){var c=this._findZoneEventAt(s);c!=null&&c.willLinkActivate(s)&&(s.preventDefault(),s.stopImmediatePropagation())}},h.prototype._onMouseLeave=function(s){this._currentZone&&(this._currentZone.leaveCallback(),this._currentZone=void 0,this._tooltipTimeout&&clearTimeout(this._tooltipTimeout))},h.prototype._onClick=function(s){var c=this._findZoneEventAt(s),o=this._getSelectionLength();c&&o===this._initialSelectionLength&&(c.clickCallback(s),s.preventDefault(),s.stopImmediatePropagation())},h.prototype._getSelectionLength=function(){var s=this._selectionService.selectionText;return s?s.length:0},h.prototype._findZoneEventAt=function(s){var c=this._mouseService.getCoords(s,this._screenElement,this._bufferService.cols,this._bufferService.rows);if(c)for(var o=c[0],f=c[1],m=0;m<this._zones.length;m++){var y=this._zones[m];if(y.y1===y.y2){if(f===y.y1&&o>=y.x1&&o<y.x2)return y}else if(f===y.y1&&o>=y.x1||f===y.y2&&o<y.x2||f>y.y1&&f<y.y2)return y}},l([_(2,g.IBufferService),_(3,p.IMouseService),_(4,p.ISelectionService),_(5,g.IOptionsService)],h)}(S.Disposable);e.MouseZoneManager=w},6193:function(d,e){var a=this&&this.__values||function(v){var l=typeof Symbol=="function"&&Symbol.iterator,_=l&&v[l],S=0;if(_)return _.call(v);if(v&&typeof v.length=="number")return{next:function(){return v&&S>=v.length&&(v=void 0),{value:v&&v[S++],done:!v}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.RenderDebouncer=void 0;var u=function(){function v(l){this._renderCallback=l,this._refreshCallbacks=[]}return v.prototype.dispose=function(){this._animationFrame&&(window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)},v.prototype.addRefreshCallback=function(l){var _=this;return this._refreshCallbacks.push(l),this._animationFrame||(this._animationFrame=window.requestAnimationFrame(function(){return _._innerRefresh()})),this._animationFrame},v.prototype.refresh=function(l,_,S){var b=this;this._rowCount=S,l=l!==void 0?l:0,_=_!==void 0?_:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,l):l,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,_):_,this._animationFrame||(this._animationFrame=window.requestAnimationFrame(function(){return b._innerRefresh()}))},v.prototype._innerRefresh=function(){if(this._animationFrame=void 0,this._rowStart!==void 0&&this._rowEnd!==void 0&&this._rowCount!==void 0){var l=Math.max(this._rowStart,0),_=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(l,_),this._runRefreshCallbacks()}else this._runRefreshCallbacks()},v.prototype._runRefreshCallbacks=function(){var l,_;try{for(var S=a(this._refreshCallbacks),b=S.next();!b.done;b=S.next())(0,b.value)(0)}catch(p){l={error:p}}finally{try{b&&!b.done&&(_=S.return)&&_.call(S)}finally{if(l)throw l.error}}this._refreshCallbacks=[]},v}();e.RenderDebouncer=u},5596:function(d,e,a){var u,v=this&&this.__extends||(u=function(_,S){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,p){b.__proto__=p}||function(b,p){for(var g in p)Object.prototype.hasOwnProperty.call(p,g)&&(b[g]=p[g])},u(_,S)},function(_,S){if(typeof S!="function"&&S!==null)throw new TypeError("Class extends value "+String(S)+" is not a constructor or null");function b(){this.constructor=_}u(_,S),_.prototype=S===null?Object.create(S):(b.prototype=S.prototype,new b)});Object.defineProperty(e,"__esModule",{value:!0}),e.ScreenDprMonitor=void 0;var l=function(_){function S(){var b=_!==null&&_.apply(this,arguments)||this;return b._currentDevicePixelRatio=window.devicePixelRatio,b}return v(S,_),S.prototype.setListener=function(b){var p=this;this._listener&&this.clearListener(),this._listener=b,this._outerListener=function(){p._listener&&(p._listener(window.devicePixelRatio,p._currentDevicePixelRatio),p._updateDpr())},this._updateDpr()},S.prototype.dispose=function(){_.prototype.dispose.call(this),this.clearListener()},S.prototype._updateDpr=function(){var b;this._outerListener&&((b=this._resolutionMediaMatchList)===null||b===void 0||b.removeListener(this._outerListener),this._currentDevicePixelRatio=window.devicePixelRatio,this._resolutionMediaMatchList=window.matchMedia("screen and (resolution: "+window.devicePixelRatio+"dppx)"),this._resolutionMediaMatchList.addListener(this._outerListener))},S.prototype.clearListener=function(){this._resolutionMediaMatchList&&this._listener&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._listener=void 0,this._outerListener=void 0)},S}(a(844).Disposable);e.ScreenDprMonitor=l},3236:function(d,e,a){var u,v=this&&this.__extends||(u=function(ce,$){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(X,I){X.__proto__=I}||function(X,I){for(var Y in I)Object.prototype.hasOwnProperty.call(I,Y)&&(X[Y]=I[Y])},u(ce,$)},function(ce,$){if(typeof $!="function"&&$!==null)throw new TypeError("Class extends value "+String($)+" is not a constructor or null");function X(){this.constructor=ce}u(ce,$),ce.prototype=$===null?Object.create($):(X.prototype=$.prototype,new X)}),l=this&&this.__values||function(ce){var $=typeof Symbol=="function"&&Symbol.iterator,X=$&&ce[$],I=0;if(X)return X.call(ce);if(ce&&typeof ce.length=="number")return{next:function(){return ce&&I>=ce.length&&(ce=void 0),{value:ce&&ce[I++],done:!ce}}};throw new TypeError($?"Object is not iterable.":"Symbol.iterator is not defined.")},_=this&&this.__read||function(ce,$){var X=typeof Symbol=="function"&&ce[Symbol.iterator];if(!X)return ce;var I,Y,oe=X.call(ce),ae=[];try{for(;($===void 0||$-- >0)&&!(I=oe.next()).done;)ae.push(I.value)}catch(fe){Y={error:fe}}finally{try{I&&!I.done&&(X=oe.return)&&X.call(oe)}finally{if(Y)throw Y.error}}return ae},S=this&&this.__spreadArray||function(ce,$,X){if(X||arguments.length===2)for(var I,Y=0,oe=$.length;Y<oe;Y++)!I&&Y in $||(I||(I=Array.prototype.slice.call($,0,Y)),I[Y]=$[Y]);return ce.concat(I||Array.prototype.slice.call($))};Object.defineProperty(e,"__esModule",{value:!0}),e.Terminal=void 0;var b=a(2950),p=a(1680),g=a(3614),w=a(2584),x=a(5435),h=a(3525),s=a(3551),c=a(9312),o=a(6114),f=a(3656),m=a(9042),y=a(357),C=a(6954),L=a(4567),k=a(1296),E=a(7399),A=a(8460),D=a(8437),M=a(5680),F=a(3230),T=a(4725),R=a(428),O=a(8934),H=a(6465),ee=a(5114),ie=a(8969),J=a(8055),ne=a(4269),re=a(5941),B=a(3107),he=a(5744),le=a(9074),me=a(2585),U=typeof window<"u"?window.document:null,xe=function(ce){function $(X){X===void 0&&(X={});var I=ce.call(this,X)||this;return I.browser=o,I._keyDownHandled=!1,I._keyDownSeen=!1,I._keyPressHandled=!1,I._unprocessedDeadKey=!1,I._onCursorMove=new A.EventEmitter,I._onKey=new A.EventEmitter,I._onRender=new A.EventEmitter,I._onSelectionChange=new A.EventEmitter,I._onTitleChange=new A.EventEmitter,I._onBell=new A.EventEmitter,I._onFocus=new A.EventEmitter,I._onBlur=new A.EventEmitter,I._onA11yCharEmitter=new A.EventEmitter,I._onA11yTabEmitter=new A.EventEmitter,I._setup(),I.linkifier=I._instantiationService.createInstance(s.Linkifier),I.linkifier2=I.register(I._instantiationService.createInstance(H.Linkifier2)),I._decorationService=I._instantiationService.createInstance(le.DecorationService),I._instantiationService.setService(me.IDecorationService,I._decorationService),I.register(I._inputHandler.onRequestBell(function(){return I.bell()})),I.register(I._inputHandler.onRequestRefreshRows(function(Y,oe){return I.refresh(Y,oe)})),I.register(I._inputHandler.onRequestSendFocus(function(){return I._reportFocus()})),I.register(I._inputHandler.onRequestReset(function(){return I.reset()})),I.register(I._inputHandler.onRequestWindowsOptionsReport(function(Y){return I._reportWindowsOptions(Y)})),I.register(I._inputHandler.onColor(function(Y){return I._handleColorEvent(Y)})),I.register((0,A.forwardEvent)(I._inputHandler.onCursorMove,I._onCursorMove)),I.register((0,A.forwardEvent)(I._inputHandler.onTitleChange,I._onTitleChange)),I.register((0,A.forwardEvent)(I._inputHandler.onA11yChar,I._onA11yCharEmitter)),I.register((0,A.forwardEvent)(I._inputHandler.onA11yTab,I._onA11yTabEmitter)),I.register(I._bufferService.onResize(function(Y){return I._afterResize(Y.cols,Y.rows)})),I}return v($,ce),Object.defineProperty($.prototype,"onCursorMove",{get:function(){return this._onCursorMove.event},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"onKey",{get:function(){return this._onKey.event},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"onRender",{get:function(){return this._onRender.event},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"onSelectionChange",{get:function(){return this._onSelectionChange.event},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"onTitleChange",{get:function(){return this._onTitleChange.event},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"onBell",{get:function(){return this._onBell.event},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"onFocus",{get:function(){return this._onFocus.event},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"onBlur",{get:function(){return this._onBlur.event},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"onA11yChar",{get:function(){return this._onA11yCharEmitter.event},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"onA11yTab",{get:function(){return this._onA11yTabEmitter.event},enumerable:!1,configurable:!0}),$.prototype._handleColorEvent=function(X){var I,Y,oe,ae;if(this._colorManager){try{for(var fe=l(X),Se=fe.next();!Se.done;Se=fe.next()){var Ae=Se.value,Me=void 0,se="";switch(Ae.index){case 256:Me="foreground",se="10";break;case 257:Me="background",se="11";break;case 258:Me="cursor",se="12";break;default:Me="ansi",se="4;"+Ae.index}if(Me)switch(Ae.type){case 0:var te=J.color.toColorRGB(Me==="ansi"?this._colorManager.colors.ansi[Ae.index]:this._colorManager.colors[Me]);this.coreService.triggerDataEvent(w.C0.ESC+"]"+se+";"+(0,re.toRgbString)(te)+w.C1_ESCAPED.ST);break;case 1:Me==="ansi"?this._colorManager.colors.ansi[Ae.index]=J.rgba.toColor.apply(J.rgba,S([],_(Ae.color),!1)):this._colorManager.colors[Me]=J.rgba.toColor.apply(J.rgba,S([],_(Ae.color),!1));break;case 2:this._colorManager.restoreColor(Ae.index)}}}catch(_e){I={error:_e}}finally{try{Se&&!Se.done&&(Y=fe.return)&&Y.call(fe)}finally{if(I)throw I.error}}(oe=this._renderService)===null||oe===void 0||oe.setColors(this._colorManager.colors),(ae=this.viewport)===null||ae===void 0||ae.onThemeChange(this._colorManager.colors)}},$.prototype.dispose=function(){var X,I,Y;this._isDisposed||(ce.prototype.dispose.call(this),(X=this._renderService)===null||X===void 0||X.dispose(),this._customKeyEventHandler=void 0,this.write=function(){},(Y=(I=this.element)===null||I===void 0?void 0:I.parentNode)===null||Y===void 0||Y.removeChild(this.element))},$.prototype._setup=function(){ce.prototype._setup.call(this),this._customKeyEventHandler=void 0},Object.defineProperty($.prototype,"buffer",{get:function(){return this.buffers.active},enumerable:!1,configurable:!0}),$.prototype.focus=function(){this.textarea&&this.textarea.focus({preventScroll:!0})},$.prototype._updateOptions=function(X){var I,Y,oe,ae;switch(ce.prototype._updateOptions.call(this,X),X){case"fontFamily":case"fontSize":(I=this._renderService)===null||I===void 0||I.clear(),(Y=this._charSizeService)===null||Y===void 0||Y.measure();break;case"cursorBlink":case"cursorStyle":this.refresh(this.buffer.y,this.buffer.y);break;case"customGlyphs":case"drawBoldTextInBrightColors":case"letterSpacing":case"lineHeight":case"fontWeight":case"fontWeightBold":case"minimumContrastRatio":this._renderService&&(this._renderService.clear(),this._renderService.onResize(this.cols,this.rows),this.refresh(0,this.rows-1));break;case"rendererType":this._renderService&&(this._renderService.setRenderer(this._createRenderer()),this._renderService.onResize(this.cols,this.rows));break;case"scrollback":(oe=this.viewport)===null||oe===void 0||oe.syncScrollArea();break;case"screenReaderMode":this.optionsService.rawOptions.screenReaderMode?!this._accessibilityManager&&this._renderService&&(this._accessibilityManager=new L.AccessibilityManager(this,this._renderService)):((ae=this._accessibilityManager)===null||ae===void 0||ae.dispose(),this._accessibilityManager=void 0);break;case"tabStopWidth":this.buffers.setupTabStops();break;case"theme":this._setTheme(this.optionsService.rawOptions.theme)}},$.prototype._onTextAreaFocus=function(X){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(w.C0.ESC+"[I"),this.updateCursorStyle(X),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()},$.prototype.blur=function(){var X;return(X=this.textarea)===null||X===void 0?void 0:X.blur()},$.prototype._onTextAreaBlur=function(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(w.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()},$.prototype._syncTextArea=function(){if(this.textarea&&this.buffer.isCursorInViewport&&!this._compositionHelper.isComposing&&this._renderService){var X=this.buffer.ybase+this.buffer.y,I=this.buffer.lines.get(X);if(I){var Y=Math.min(this.buffer.x,this.cols-1),oe=this._renderService.dimensions.actualCellHeight,ae=I.getWidth(Y),fe=this._renderService.dimensions.actualCellWidth*ae,Se=this.buffer.y*this._renderService.dimensions.actualCellHeight,Ae=Y*this._renderService.dimensions.actualCellWidth;this.textarea.style.left=Ae+"px",this.textarea.style.top=Se+"px",this.textarea.style.width=fe+"px",this.textarea.style.height=oe+"px",this.textarea.style.lineHeight=oe+"px",this.textarea.style.zIndex="-5"}}},$.prototype._initGlobal=function(){var X=this;this._bindKeys(),this.register((0,f.addDisposableDomListener)(this.element,"copy",function(Y){X.hasSelection()&&(0,g.copyHandler)(Y,X._selectionService)}));var I=function(Y){return(0,g.handlePasteEvent)(Y,X.textarea,X.coreService)};this.register((0,f.addDisposableDomListener)(this.textarea,"paste",I)),this.register((0,f.addDisposableDomListener)(this.element,"paste",I)),o.isFirefox?this.register((0,f.addDisposableDomListener)(this.element,"mousedown",function(Y){Y.button===2&&(0,g.rightClickHandler)(Y,X.textarea,X.screenElement,X._selectionService,X.options.rightClickSelectsWord)})):this.register((0,f.addDisposableDomListener)(this.element,"contextmenu",function(Y){(0,g.rightClickHandler)(Y,X.textarea,X.screenElement,X._selectionService,X.options.rightClickSelectsWord)})),o.isLinux&&this.register((0,f.addDisposableDomListener)(this.element,"auxclick",function(Y){Y.button===1&&(0,g.moveTextAreaUnderMouseCursor)(Y,X.textarea,X.screenElement)}))},$.prototype._bindKeys=function(){var X=this;this.register((0,f.addDisposableDomListener)(this.textarea,"keyup",function(I){return X._keyUp(I)},!0)),this.register((0,f.addDisposableDomListener)(this.textarea,"keydown",function(I){return X._keyDown(I)},!0)),this.register((0,f.addDisposableDomListener)(this.textarea,"keypress",function(I){return X._keyPress(I)},!0)),this.register((0,f.addDisposableDomListener)(this.textarea,"compositionstart",function(){return X._compositionHelper.compositionstart()})),this.register((0,f.addDisposableDomListener)(this.textarea,"compositionupdate",function(I){return X._compositionHelper.compositionupdate(I)})),this.register((0,f.addDisposableDomListener)(this.textarea,"compositionend",function(){return X._compositionHelper.compositionend()})),this.register((0,f.addDisposableDomListener)(this.textarea,"input",function(I){return X._inputEvent(I)},!0)),this.register(this.onRender(function(){return X._compositionHelper.updateCompositionElements()})),this.register(this.onRender(function(I){return X._queueLinkification(I.start,I.end)}))},$.prototype.open=function(X){var I=this;if(!X)throw new Error("Terminal requires a parent element.");X.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this._document=X.ownerDocument,this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),this.element.setAttribute("tabindex","0"),X.appendChild(this.element);var Y=U.createDocumentFragment();this._viewportElement=U.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),Y.appendChild(this._viewportElement),this._viewportScrollArea=U.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=U.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._helperContainer=U.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),Y.appendChild(this.screenElement),this.textarea=U.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",m.promptLabel),this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this.register((0,f.addDisposableDomListener)(this.textarea,"focus",function(fe){return I._onTextAreaFocus(fe)})),this.register((0,f.addDisposableDomListener)(this.textarea,"blur",function(){return I._onTextAreaBlur()})),this._helperContainer.appendChild(this.textarea);var oe=this._instantiationService.createInstance(ee.CoreBrowserService,this.textarea);this._instantiationService.setService(T.ICoreBrowserService,oe),this._charSizeService=this._instantiationService.createInstance(R.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(T.ICharSizeService,this._charSizeService),this._theme=this.options.theme||this._theme,this._colorManager=new M.ColorManager(U,this.options.allowTransparency),this.register(this.optionsService.onOptionChange(function(fe){return I._colorManager.onOptionsChange(fe)})),this._colorManager.setTheme(this._theme),this._characterJoinerService=this._instantiationService.createInstance(ne.CharacterJoinerService),this._instantiationService.setService(T.ICharacterJoinerService,this._characterJoinerService);var ae=this._createRenderer();this._renderService=this.register(this._instantiationService.createInstance(F.RenderService,ae,this.rows,this.screenElement)),this._instantiationService.setService(T.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange(function(fe){return I._onRender.fire(fe)})),this.onResize(function(fe){return I._renderService.resize(fe.cols,fe.rows)}),this._compositionView=U.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(b.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this.element.appendChild(Y),this._soundService=this._instantiationService.createInstance(y.SoundService),this._instantiationService.setService(T.ISoundService,this._soundService),this._mouseService=this._instantiationService.createInstance(O.MouseService),this._instantiationService.setService(T.IMouseService,this._mouseService),this.viewport=this._instantiationService.createInstance(p.Viewport,function(fe){return I.scrollLines(fe,!0,1)},this._viewportElement,this._viewportScrollArea,this.element),this.viewport.onThemeChange(this._colorManager.colors),this.register(this._inputHandler.onRequestSyncScrollBar(function(){return I.viewport.syncScrollArea()})),this.register(this.viewport),this.register(this.onCursorMove(function(){I._renderService.onCursorMove(),I._syncTextArea()})),this.register(this.onResize(function(){return I._renderService.onResize(I.cols,I.rows)})),this.register(this.onBlur(function(){return I._renderService.onBlur()})),this.register(this.onFocus(function(){return I._renderService.onFocus()})),this.register(this._renderService.onDimensionsChange(function(){return I.viewport.syncScrollArea()})),this._selectionService=this.register(this._instantiationService.createInstance(c.SelectionService,this.element,this.screenElement,this.linkifier2)),this._instantiationService.setService(T.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines(function(fe){return I.scrollLines(fe.amount,fe.suppressScrollEvent)})),this.register(this._selectionService.onSelectionChange(function(){return I._onSelectionChange.fire()})),this.register(this._selectionService.onRequestRedraw(function(fe){return I._renderService.onSelectionChanged(fe.start,fe.end,fe.columnSelectMode)})),this.register(this._selectionService.onLinuxMouseSelection(function(fe){I.textarea.value=fe,I.textarea.focus(),I.textarea.select()})),this.register(this._onScroll.event(function(fe){I.viewport.syncScrollArea(),I._selectionService.refresh()})),this.register((0,f.addDisposableDomListener)(this._viewportElement,"scroll",function(){return I._selectionService.refresh()})),this._mouseZoneManager=this._instantiationService.createInstance(C.MouseZoneManager,this.element,this.screenElement),this.register(this._mouseZoneManager),this.register(this.onScroll(function(){return I._mouseZoneManager.clearAll()})),this.linkifier.attachToDom(this.element,this._mouseZoneManager),this.linkifier2.attachToDom(this.screenElement,this._mouseService,this._renderService),this.register(this._instantiationService.createInstance(B.BufferDecorationRenderer,this.screenElement)),this.register((0,f.addDisposableDomListener)(this.element,"mousedown",function(fe){return I._selectionService.onMouseDown(fe)})),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager=new L.AccessibilityManager(this,this._renderService)),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this._instantiationService.createInstance(he.OverviewRulerRenderer,this._viewportElement,this.screenElement)),this.optionsService.onOptionChange(function(){!I._overviewRulerRenderer&&I.options.overviewRulerWidth&&I._viewportElement&&I.screenElement&&(I._overviewRulerRenderer=I._instantiationService.createInstance(he.OverviewRulerRenderer,I._viewportElement,I.screenElement))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()},$.prototype._createRenderer=function(){switch(this.options.rendererType){case"canvas":return this._instantiationService.createInstance(h.Renderer,this._colorManager.colors,this.screenElement,this.linkifier,this.linkifier2);case"dom":return this._instantiationService.createInstance(k.DomRenderer,this._colorManager.colors,this.element,this.screenElement,this._viewportElement,this.linkifier,this.linkifier2);default:throw new Error('Unrecognized rendererType "'+this.options.rendererType+'"')}},$.prototype._setTheme=function(X){var I,Y,oe;this._theme=X,(I=this._colorManager)===null||I===void 0||I.setTheme(X),(Y=this._renderService)===null||Y===void 0||Y.setColors(this._colorManager.colors),(oe=this.viewport)===null||oe===void 0||oe.onThemeChange(this._colorManager.colors)},$.prototype.bindMouse=function(){var X=this,I=this,Y=this.element;function oe(se){var te,_e,Te=I._mouseService.getRawByteCoords(se,I.screenElement,I.cols,I.rows);if(!Te)return!1;switch(se.overrideType||se.type){case"mousemove":_e=32,se.buttons===void 0?(te=3,se.button!==void 0&&(te=se.button<3?se.button:3)):te=1&se.buttons?0:4&se.buttons?1:2&se.buttons?2:3;break;case"mouseup":_e=0,te=se.button<3?se.button:3;break;case"mousedown":_e=1,te=se.button<3?se.button:3;break;case"wheel":if(I.viewport.getLinesScrolled(se)===0)return!1;_e=se.deltaY<0?0:1,te=4;break;default:return!1}return!(_e===void 0||te===void 0||te>4)&&I.coreMouseService.triggerMouseEvent({col:Te.x-33,row:Te.y-33,button:te,action:_e,ctrl:se.ctrlKey,alt:se.altKey,shift:se.shiftKey})}var ae={mouseup:null,wheel:null,mousedrag:null,mousemove:null},fe=function(se){return oe(se),se.buttons||(X._document.removeEventListener("mouseup",ae.mouseup),ae.mousedrag&&X._document.removeEventListener("mousemove",ae.mousedrag)),X.cancel(se)},Se=function(se){return oe(se),X.cancel(se,!0)},Ae=function(se){se.buttons&&oe(se)},Me=function(se){se.buttons||oe(se)};this.register(this.coreMouseService.onProtocolChange(function(se){se?(X.optionsService.rawOptions.logLevel==="debug"&&X._logService.debug("Binding to mouse events:",X.coreMouseService.explainEvents(se)),X.element.classList.add("enable-mouse-events"),X._selectionService.disable()):(X._logService.debug("Unbinding from mouse events."),X.element.classList.remove("enable-mouse-events"),X._selectionService.enable()),8&se?ae.mousemove||(Y.addEventListener("mousemove",Me),ae.mousemove=Me):(Y.removeEventListener("mousemove",ae.mousemove),ae.mousemove=null),16&se?ae.wheel||(Y.addEventListener("wheel",Se,{passive:!1}),ae.wheel=Se):(Y.removeEventListener("wheel",ae.wheel),ae.wheel=null),2&se?ae.mouseup||(ae.mouseup=fe):(X._document.removeEventListener("mouseup",ae.mouseup),ae.mouseup=null),4&se?ae.mousedrag||(ae.mousedrag=Ae):(X._document.removeEventListener("mousemove",ae.mousedrag),ae.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,f.addDisposableDomListener)(Y,"mousedown",function(se){if(se.preventDefault(),X.focus(),X.coreMouseService.areMouseEventsActive&&!X._selectionService.shouldForceSelection(se))return oe(se),ae.mouseup&&X._document.addEventListener("mouseup",ae.mouseup),ae.mousedrag&&X._document.addEventListener("mousemove",ae.mousedrag),X.cancel(se)})),this.register((0,f.addDisposableDomListener)(Y,"wheel",function(se){if(!ae.wheel){if(!X.buffer.hasScrollback){var te=X.viewport.getLinesScrolled(se);if(te===0)return;for(var _e=w.C0.ESC+(X.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(se.deltaY<0?"A":"B"),Te="",Ye=0;Ye<Math.abs(te);Ye++)Te+=_e;return X.coreService.triggerDataEvent(Te,!0),X.cancel(se,!0)}return X.viewport.onWheel(se)?X.cancel(se):void 0}},{passive:!1})),this.register((0,f.addDisposableDomListener)(Y,"touchstart",function(se){if(!X.coreMouseService.areMouseEventsActive)return X.viewport.onTouchStart(se),X.cancel(se)},{passive:!0})),this.register((0,f.addDisposableDomListener)(Y,"touchmove",function(se){if(!X.coreMouseService.areMouseEventsActive)return X.viewport.onTouchMove(se)?void 0:X.cancel(se)},{passive:!1}))},$.prototype.refresh=function(X,I){var Y;(Y=this._renderService)===null||Y===void 0||Y.refreshRows(X,I)},$.prototype._queueLinkification=function(X,I){var Y;(Y=this.linkifier)===null||Y===void 0||Y.linkifyRows(X,I)},$.prototype.updateCursorStyle=function(X){var I;!((I=this._selectionService)===null||I===void 0)&&I.shouldColumnSelect(X)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")},$.prototype._showCursor=function(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))},$.prototype.scrollLines=function(X,I,Y){Y===void 0&&(Y=0),ce.prototype.scrollLines.call(this,X,I,Y),this.refresh(0,this.rows-1)},$.prototype.paste=function(X){(0,g.paste)(X,this.textarea,this.coreService)},$.prototype.attachCustomKeyEventHandler=function(X){this._customKeyEventHandler=X},$.prototype.registerLinkMatcher=function(X,I,Y){var oe=this.linkifier.registerLinkMatcher(X,I,Y);return this.refresh(0,this.rows-1),oe},$.prototype.deregisterLinkMatcher=function(X){this.linkifier.deregisterLinkMatcher(X)&&this.refresh(0,this.rows-1)},$.prototype.registerLinkProvider=function(X){return this.linkifier2.registerLinkProvider(X)},$.prototype.registerCharacterJoiner=function(X){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");var I=this._characterJoinerService.register(X);return this.refresh(0,this.rows-1),I},$.prototype.deregisterCharacterJoiner=function(X){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(X)&&this.refresh(0,this.rows-1)},Object.defineProperty($.prototype,"markers",{get:function(){return this.buffer.markers},enumerable:!1,configurable:!0}),$.prototype.addMarker=function(X){if(this.buffer===this.buffers.normal)return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+X)},$.prototype.registerDecoration=function(X){return this._decorationService.registerDecoration(X)},$.prototype.hasSelection=function(){return!!this._selectionService&&this._selectionService.hasSelection},$.prototype.select=function(X,I,Y){this._selectionService.setSelection(X,I,Y)},$.prototype.getSelection=function(){return this._selectionService?this._selectionService.selectionText:""},$.prototype.getSelectionPosition=function(){if(this._selectionService&&this._selectionService.hasSelection)return{startColumn:this._selectionService.selectionStart[0],startRow:this._selectionService.selectionStart[1],endColumn:this._selectionService.selectionEnd[0],endRow:this._selectionService.selectionEnd[1]}},$.prototype.clearSelection=function(){var X;(X=this._selectionService)===null||X===void 0||X.clearSelection()},$.prototype.selectAll=function(){var X;(X=this._selectionService)===null||X===void 0||X.selectAll()},$.prototype.selectLines=function(X,I){var Y;(Y=this._selectionService)===null||Y===void 0||Y.selectLines(X,I)},$.prototype._keyDown=function(X){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(X)===!1)return!1;var I=this.browser.isMac&&this.options.macOptionIsMeta&&X.altKey;if(!I&&!this._compositionHelper.keydown(X))return this.buffer.ybase!==this.buffer.ydisp&&this._bufferService.scrollToBottom(),!1;I||X.key!=="Dead"&&X.key!=="AltGraph"||(this._unprocessedDeadKey=!0);var Y=(0,E.evaluateKeyboardEvent)(X,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(X),Y.type===3||Y.type===2){var oe=this.rows-1;return this.scrollLines(Y.type===2?-oe:oe),this.cancel(X,!0)}return Y.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,X)||(Y.cancel&&this.cancel(X,!0),!Y.key||!!(X.key&&!X.ctrlKey&&!X.altKey&&!X.metaKey&&X.key.length===1&&X.key.charCodeAt(0)>=65&&X.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(Y.key!==w.C0.ETX&&Y.key!==w.C0.CR||(this.textarea.value=""),this._onKey.fire({key:Y.key,domEvent:X}),this._showCursor(),this.coreService.triggerDataEvent(Y.key,!0),this.optionsService.rawOptions.screenReaderMode?void(this._keyDownHandled=!0):this.cancel(X,!0))))},$.prototype._isThirdLevelShift=function(X,I){var Y=X.isMac&&!this.options.macOptionIsMeta&&I.altKey&&!I.ctrlKey&&!I.metaKey||X.isWindows&&I.altKey&&I.ctrlKey&&!I.metaKey||X.isWindows&&I.getModifierState("AltGraph");return I.type==="keypress"?Y:Y&&(!I.keyCode||I.keyCode>47)},$.prototype._keyUp=function(X){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(X)===!1||(function(I){return I.keyCode===16||I.keyCode===17||I.keyCode===18}(X)||this.focus(),this.updateCursorStyle(X),this._keyPressHandled=!1)},$.prototype._keyPress=function(X){var I;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(X)===!1)return!1;if(this.cancel(X),X.charCode)I=X.charCode;else if(X.which===null||X.which===void 0)I=X.keyCode;else{if(X.which===0||X.charCode===0)return!1;I=X.which}return!(!I||(X.altKey||X.ctrlKey||X.metaKey)&&!this._isThirdLevelShift(this.browser,X)||(I=String.fromCharCode(I),this._onKey.fire({key:I,domEvent:X}),this._showCursor(),this.coreService.triggerDataEvent(I,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))},$.prototype._inputEvent=function(X){if(X.data&&X.inputType==="insertText"&&(!X.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;var I=X.data;return this.coreService.triggerDataEvent(I,!0),this.cancel(X),!0}return!1},$.prototype.bell=function(){var X;this._soundBell()&&((X=this._soundService)===null||X===void 0||X.playBellSound()),this._onBell.fire()},$.prototype.resize=function(X,I){X!==this.cols||I!==this.rows?ce.prototype.resize.call(this,X,I):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()},$.prototype._afterResize=function(X,I){var Y,oe;(Y=this._charSizeService)===null||Y===void 0||Y.measure(),(oe=this.viewport)===null||oe===void 0||oe.syncScrollArea(!0)},$.prototype.clear=function(){if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(var X=1;X<this.rows;X++)this.buffer.lines.push(this.buffer.getBlankLine(D.DEFAULT_ATTR_DATA));this.refresh(0,this.rows-1),this._onScroll.fire({position:this.buffer.ydisp,source:0})}},$.prototype.reset=function(){var X,I;this.options.rows=this.rows,this.options.cols=this.cols;var Y=this._customKeyEventHandler;this._setup(),ce.prototype.reset.call(this),(X=this._selectionService)===null||X===void 0||X.reset(),this._decorationService.reset(),this._customKeyEventHandler=Y,this.refresh(0,this.rows-1),(I=this.viewport)===null||I===void 0||I.syncScrollArea()},$.prototype.clearTextureAtlas=function(){var X;(X=this._renderService)===null||X===void 0||X.clearTextureAtlas()},$.prototype._reportFocus=function(){var X;!((X=this.element)===null||X===void 0)&&X.classList.contains("focus")?this.coreService.triggerDataEvent(w.C0.ESC+"[I"):this.coreService.triggerDataEvent(w.C0.ESC+"[O")},$.prototype._reportWindowsOptions=function(X){if(this._renderService)switch(X){case x.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:var I=this._renderService.dimensions.scaledCanvasWidth.toFixed(0),Y=this._renderService.dimensions.scaledCanvasHeight.toFixed(0);this.coreService.triggerDataEvent(w.C0.ESC+"[4;"+Y+";"+I+"t");break;case x.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:var oe=this._renderService.dimensions.scaledCellWidth.toFixed(0),ae=this._renderService.dimensions.scaledCellHeight.toFixed(0);this.coreService.triggerDataEvent(w.C0.ESC+"[6;"+ae+";"+oe+"t")}},$.prototype.cancel=function(X,I){if(this.options.cancelEvents||I)return X.preventDefault(),X.stopPropagation(),!1},$.prototype._visualBell=function(){return!1},$.prototype._soundBell=function(){return this.options.bellStyle==="sound"},$}(ie.CoreTerminal);e.Terminal=xe},9924:(d,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TimeBasedDebouncer=void 0;var a=function(){function u(v,l){l===void 0&&(l=1e3),this._renderCallback=v,this._debounceThresholdMS=l,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}return u.prototype.dispose=function(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)},u.prototype.refresh=function(v,l,_){var S=this;this._rowCount=_,v=v!==void 0?v:0,l=l!==void 0?l:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,v):v,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,l):l;var b=Date.now();if(b-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=b,this._innerRefresh();else if(!this._additionalRefreshRequested){var p=b-this._lastRefreshMs,g=this._debounceThresholdMS-p;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(function(){S._lastRefreshMs=Date.now(),S._innerRefresh(),S._additionalRefreshRequested=!1,S._refreshTimeoutID=void 0},g)}},u.prototype._innerRefresh=function(){if(this._rowStart!==void 0&&this._rowEnd!==void 0&&this._rowCount!==void 0){var v=Math.max(this._rowStart,0),l=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(v,l)}},u}();e.TimeBasedDebouncer=a},1680:function(d,e,a){var u,v=this&&this.__extends||(u=function(x,h){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var o in c)Object.prototype.hasOwnProperty.call(c,o)&&(s[o]=c[o])},u(x,h)},function(x,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");function s(){this.constructor=x}u(x,h),x.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}),l=this&&this.__decorate||function(x,h,s,c){var o,f=arguments.length,m=f<3?h:c===null?c=Object.getOwnPropertyDescriptor(h,s):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(x,h,s,c);else for(var y=x.length-1;y>=0;y--)(o=x[y])&&(m=(f<3?o(m):f>3?o(h,s,m):o(h,s))||m);return f>3&&m&&Object.defineProperty(h,s,m),m},_=this&&this.__param||function(x,h){return function(s,c){h(s,c,x)}};Object.defineProperty(e,"__esModule",{value:!0}),e.Viewport=void 0;var S=a(844),b=a(3656),p=a(4725),g=a(2585),w=function(x){function h(s,c,o,f,m,y,C,L){var k=x.call(this)||this;return k._scrollLines=s,k._viewportElement=c,k._scrollArea=o,k._element=f,k._bufferService=m,k._optionsService=y,k._charSizeService=C,k._renderService=L,k.scrollBarWidth=0,k._currentRowHeight=0,k._currentScaledCellHeight=0,k._lastRecordedBufferLength=0,k._lastRecordedViewportHeight=0,k._lastRecordedBufferHeight=0,k._lastTouchY=0,k._lastScrollTop=0,k._wheelPartialScroll=0,k._refreshAnimationFrame=null,k._ignoreNextScrollEvent=!1,k.scrollBarWidth=k._viewportElement.offsetWidth-k._scrollArea.offsetWidth||15,k.register((0,b.addDisposableDomListener)(k._viewportElement,"scroll",k._onScroll.bind(k))),k._activeBuffer=k._bufferService.buffer,k.register(k._bufferService.buffers.onBufferActivate(function(E){return k._activeBuffer=E.activeBuffer})),k._renderDimensions=k._renderService.dimensions,k.register(k._renderService.onDimensionsChange(function(E){return k._renderDimensions=E})),setTimeout(function(){return k.syncScrollArea()},0),k}return v(h,x),h.prototype.onThemeChange=function(s){this._viewportElement.style.backgroundColor=s.background.css},h.prototype._refresh=function(s){var c=this;if(s)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=requestAnimationFrame(function(){return c._innerRefresh()}))},h.prototype._innerRefresh=function(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderService.dimensions.scaledCellHeight/window.devicePixelRatio,this._currentScaledCellHeight=this._renderService.dimensions.scaledCellHeight,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;var s=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderService.dimensions.canvasHeight);this._lastRecordedBufferHeight!==s&&(this._lastRecordedBufferHeight=s,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}var c=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==c&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=c),this._refreshAnimationFrame=null},h.prototype.syncScrollArea=function(s){if(s===void 0&&(s=!1),this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(s);this._lastRecordedViewportHeight===this._renderService.dimensions.canvasHeight&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.scaledCellHeight===this._currentScaledCellHeight||this._refresh(s)},h.prototype._onScroll=function(s){if(this._lastScrollTop=this._viewportElement.scrollTop,this._viewportElement.offsetParent){if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._scrollLines(0);var c=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._scrollLines(c)}},h.prototype._bubbleScroll=function(s,c){var o=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(c<0&&this._viewportElement.scrollTop!==0||c>0&&o<this._lastRecordedBufferHeight)||(s.cancelable&&s.preventDefault(),!1)},h.prototype.onWheel=function(s){var c=this._getPixelsScrolled(s);return c!==0&&(this._viewportElement.scrollTop+=c,this._bubbleScroll(s,c))},h.prototype._getPixelsScrolled=function(s){if(s.deltaY===0||s.shiftKey)return 0;var c=this._applyScrollModifier(s.deltaY,s);return s.deltaMode===WheelEvent.DOM_DELTA_LINE?c*=this._currentRowHeight:s.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(c*=this._currentRowHeight*this._bufferService.rows),c},h.prototype.getLinesScrolled=function(s){if(s.deltaY===0||s.shiftKey)return 0;var c=this._applyScrollModifier(s.deltaY,s);return s.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(c/=this._currentRowHeight+0,this._wheelPartialScroll+=c,c=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):s.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(c*=this._bufferService.rows),c},h.prototype._applyScrollModifier=function(s,c){var o=this._optionsService.rawOptions.fastScrollModifier;return o==="alt"&&c.altKey||o==="ctrl"&&c.ctrlKey||o==="shift"&&c.shiftKey?s*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:s*this._optionsService.rawOptions.scrollSensitivity},h.prototype.onTouchStart=function(s){this._lastTouchY=s.touches[0].pageY},h.prototype.onTouchMove=function(s){var c=this._lastTouchY-s.touches[0].pageY;return this._lastTouchY=s.touches[0].pageY,c!==0&&(this._viewportElement.scrollTop+=c,this._bubbleScroll(s,c))},l([_(4,g.IBufferService),_(5,g.IOptionsService),_(6,p.ICharSizeService),_(7,p.IRenderService)],h)}(S.Disposable);e.Viewport=w},3107:function(d,e,a){var u,v=this&&this.__extends||(u=function(h,s){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,o){c.__proto__=o}||function(c,o){for(var f in o)Object.prototype.hasOwnProperty.call(o,f)&&(c[f]=o[f])},u(h,s)},function(h,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function c(){this.constructor=h}u(h,s),h.prototype=s===null?Object.create(s):(c.prototype=s.prototype,new c)}),l=this&&this.__decorate||function(h,s,c,o){var f,m=arguments.length,y=m<3?s:o===null?o=Object.getOwnPropertyDescriptor(s,c):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(h,s,c,o);else for(var C=h.length-1;C>=0;C--)(f=h[C])&&(y=(m<3?f(y):m>3?f(s,c,y):f(s,c))||y);return m>3&&y&&Object.defineProperty(s,c,y),y},_=this&&this.__param||function(h,s){return function(c,o){s(c,o,h)}},S=this&&this.__values||function(h){var s=typeof Symbol=="function"&&Symbol.iterator,c=s&&h[s],o=0;if(c)return c.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&o>=h.length&&(h=void 0),{value:h&&h[o++],done:!h}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.BufferDecorationRenderer=void 0;var b=a(3656),p=a(4725),g=a(844),w=a(2585),x=function(h){function s(c,o,f,m){var y=h.call(this)||this;return y._screenElement=c,y._bufferService=o,y._decorationService=f,y._renderService=m,y._decorationElements=new Map,y._altBufferIsActive=!1,y._dimensionsChanged=!1,y._container=document.createElement("div"),y._container.classList.add("xterm-decoration-container"),y._screenElement.appendChild(y._container),y.register(y._renderService.onRenderedViewportChange(function(){return y._queueRefresh()})),y.register(y._renderService.onDimensionsChange(function(){y._dimensionsChanged=!0,y._queueRefresh()})),y.register((0,b.addDisposableDomListener)(window,"resize",function(){return y._queueRefresh()})),y.register(y._bufferService.buffers.onBufferActivate(function(){y._altBufferIsActive=y._bufferService.buffer===y._bufferService.buffers.alt})),y.register(y._decorationService.onDecorationRegistered(function(){return y._queueRefresh()})),y.register(y._decorationService.onDecorationRemoved(function(C){return y._removeDecoration(C)})),y}return v(s,h),s.prototype.dispose=function(){this._container.remove(),this._decorationElements.clear(),h.prototype.dispose.call(this)},s.prototype._queueRefresh=function(){var c=this;this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(function(){c.refreshDecorations(),c._animationFrame=void 0}))},s.prototype.refreshDecorations=function(){var c,o;try{for(var f=S(this._decorationService.decorations),m=f.next();!m.done;m=f.next()){var y=m.value;this._renderDecoration(y)}}catch(C){c={error:C}}finally{try{m&&!m.done&&(o=f.return)&&o.call(f)}finally{if(c)throw c.error}}this._dimensionsChanged=!1},s.prototype._renderDecoration=function(c){this._refreshStyle(c),this._dimensionsChanged&&this._refreshXPosition(c)},s.prototype._createElement=function(c){var o,f=document.createElement("div");f.classList.add("xterm-decoration"),f.style.width=Math.round((c.options.width||1)*this._renderService.dimensions.actualCellWidth)+"px",f.style.height=(c.options.height||1)*this._renderService.dimensions.actualCellHeight+"px",f.style.top=(c.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.actualCellHeight+"px",f.style.lineHeight=this._renderService.dimensions.actualCellHeight+"px";var m=(o=c.options.x)!==null&&o!==void 0?o:0;return m&&m>this._bufferService.cols&&(f.style.display="none"),this._refreshXPosition(c,f),f},s.prototype._refreshStyle=function(c){var o=this,f=c.marker.line-this._bufferService.buffers.active.ydisp;if(f<0||f>=this._bufferService.rows)c.element&&(c.element.style.display="none",c.onRenderEmitter.fire(c.element));else{var m=this._decorationElements.get(c);m||(c.onDispose(function(){return o._removeDecoration(c)}),m=this._createElement(c),c.element=m,this._decorationElements.set(c,m),this._container.appendChild(m)),m.style.top=f*this._renderService.dimensions.actualCellHeight+"px",m.style.display=this._altBufferIsActive?"none":"block",c.onRenderEmitter.fire(m)}},s.prototype._refreshXPosition=function(c,o){var f;if(o===void 0&&(o=c.element),o){var m=(f=c.options.x)!==null&&f!==void 0?f:0;(c.options.anchor||"left")==="right"?o.style.right=m?m*this._renderService.dimensions.actualCellWidth+"px":"":o.style.left=m?m*this._renderService.dimensions.actualCellWidth+"px":""}},s.prototype._removeDecoration=function(c){var o;(o=this._decorationElements.get(c))===null||o===void 0||o.remove(),this._decorationElements.delete(c)},l([_(1,w.IBufferService),_(2,w.IDecorationService),_(3,p.IRenderService)],s)}(g.Disposable);e.BufferDecorationRenderer=x},5871:function(d,e){var a=this&&this.__values||function(v){var l=typeof Symbol=="function"&&Symbol.iterator,_=l&&v[l],S=0;if(_)return _.call(v);if(v&&typeof v.length=="number")return{next:function(){return v&&S>=v.length&&(v=void 0),{value:v&&v[S++],done:!v}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.ColorZoneStore=void 0;var u=function(){function v(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}return Object.defineProperty(v.prototype,"zones",{get:function(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones},enumerable:!1,configurable:!0}),v.prototype.clear=function(){this._zones.length=0,this._zonePoolIndex=0},v.prototype.addDecoration=function(l){var _,S;if(l.options.overviewRulerOptions){try{for(var b=a(this._zones),p=b.next();!p.done;p=b.next()){var g=p.value;if(g.color===l.options.overviewRulerOptions.color&&g.position===l.options.overviewRulerOptions.position){if(this._lineIntersectsZone(g,l.marker.line))return;if(this._lineAdjacentToZone(g,l.marker.line,l.options.overviewRulerOptions.position))return void this._addLineToZone(g,l.marker.line)}}}catch(w){_={error:w}}finally{try{p&&!p.done&&(S=b.return)&&S.call(b)}finally{if(_)throw _.error}}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=l.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=l.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=l.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=l.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:l.options.overviewRulerOptions.color,position:l.options.overviewRulerOptions.position,startBufferLine:l.marker.line,endBufferLine:l.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}},v.prototype.setPadding=function(l){this._linePadding=l},v.prototype._lineIntersectsZone=function(l,_){return _>=l.startBufferLine&&_<=l.endBufferLine},v.prototype._lineAdjacentToZone=function(l,_,S){return _>=l.startBufferLine-this._linePadding[S||"full"]&&_<=l.endBufferLine+this._linePadding[S||"full"]},v.prototype._addLineToZone=function(l,_){l.startBufferLine=Math.min(l.startBufferLine,_),l.endBufferLine=Math.max(l.endBufferLine,_)},v}();e.ColorZoneStore=u},5744:function(d,e,a){var u,v=this&&this.__extends||(u=function(f,m){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,C){y.__proto__=C}||function(y,C){for(var L in C)Object.prototype.hasOwnProperty.call(C,L)&&(y[L]=C[L])},u(f,m)},function(f,m){if(typeof m!="function"&&m!==null)throw new TypeError("Class extends value "+String(m)+" is not a constructor or null");function y(){this.constructor=f}u(f,m),f.prototype=m===null?Object.create(m):(y.prototype=m.prototype,new y)}),l=this&&this.__decorate||function(f,m,y,C){var L,k=arguments.length,E=k<3?m:C===null?C=Object.getOwnPropertyDescriptor(m,y):C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(f,m,y,C);else for(var A=f.length-1;A>=0;A--)(L=f[A])&&(E=(k<3?L(E):k>3?L(m,y,E):L(m,y))||E);return k>3&&E&&Object.defineProperty(m,y,E),E},_=this&&this.__param||function(f,m){return function(y,C){m(y,C,f)}},S=this&&this.__values||function(f){var m=typeof Symbol=="function"&&Symbol.iterator,y=m&&f[m],C=0;if(y)return y.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&C>=f.length&&(f=void 0),{value:f&&f[C++],done:!f}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.OverviewRulerRenderer=void 0;var b=a(5871),p=a(3656),g=a(4725),w=a(844),x=a(2585),h={full:0,left:0,center:0,right:0},s={full:0,left:0,center:0,right:0},c={full:0,left:0,center:0,right:0},o=function(f){function m(y,C,L,k,E,A){var D,M=f.call(this)||this;M._viewportElement=y,M._screenElement=C,M._bufferService=L,M._decorationService=k,M._renderService=E,M._optionsService=A,M._colorZoneStore=new b.ColorZoneStore,M._shouldUpdateDimensions=!0,M._shouldUpdateAnchor=!0,M._lastKnownBufferLength=0,M._canvas=document.createElement("canvas"),M._canvas.classList.add("xterm-decoration-overview-ruler"),M._refreshCanvasDimensions(),(D=M._viewportElement.parentElement)===null||D===void 0||D.insertBefore(M._canvas,M._viewportElement);var F=M._canvas.getContext("2d");if(!F)throw new Error("Ctx cannot be null");return M._ctx=F,M._registerDecorationListeners(),M._registerBufferChangeListeners(),M._registerDimensionChangeListeners(),M}return v(m,f),Object.defineProperty(m.prototype,"_width",{get:function(){return this._optionsService.options.overviewRulerWidth||0},enumerable:!1,configurable:!0}),m.prototype._registerDecorationListeners=function(){var y=this;this.register(this._decorationService.onDecorationRegistered(function(){return y._queueRefresh(void 0,!0)})),this.register(this._decorationService.onDecorationRemoved(function(){return y._queueRefresh(void 0,!0)}))},m.prototype._registerBufferChangeListeners=function(){var y=this;this.register(this._renderService.onRenderedViewportChange(function(){return y._queueRefresh()})),this.register(this._bufferService.buffers.onBufferActivate(function(){y._canvas.style.display=y._bufferService.buffer===y._bufferService.buffers.alt?"none":"block"})),this.register(this._bufferService.onScroll(function(){y._lastKnownBufferLength!==y._bufferService.buffers.normal.lines.length&&(y._refreshDrawHeightConstants(),y._refreshColorZonePadding())}))},m.prototype._registerDimensionChangeListeners=function(){var y=this;this.register(this._renderService.onRender(function(){y._containerHeight&&y._containerHeight===y._screenElement.clientHeight||(y._queueRefresh(!0),y._containerHeight=y._screenElement.clientHeight)})),this.register(this._optionsService.onOptionChange(function(C){C==="overviewRulerWidth"&&y._queueRefresh(!0)})),this.register((0,p.addDisposableDomListener)(window,"resize",function(){y._queueRefresh(!0)})),this._queueRefresh(!0)},m.prototype.dispose=function(){var y;(y=this._canvas)===null||y===void 0||y.remove(),f.prototype.dispose.call(this)},m.prototype._refreshDrawConstants=function(){var y=Math.floor(this._canvas.width/3),C=Math.ceil(this._canvas.width/3);s.full=this._canvas.width,s.left=y,s.center=C,s.right=y,this._refreshDrawHeightConstants(),c.full=0,c.left=0,c.center=s.left,c.right=s.left+s.center},m.prototype._refreshDrawHeightConstants=function(){h.full=Math.round(2*window.devicePixelRatio);var y=this._canvas.height/this._bufferService.buffer.lines.length,C=Math.round(Math.max(Math.min(y,12),6)*window.devicePixelRatio);h.left=C,h.center=C,h.right=C},m.prototype._refreshColorZonePadding=function(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*h.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*h.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*h.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*h.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length},m.prototype._refreshCanvasDimensions=function(){this._canvas.style.width=this._width+"px",this._canvas.width=Math.round(this._width*window.devicePixelRatio),this._canvas.style.height=this._screenElement.clientHeight+"px",this._canvas.height=Math.round(this._screenElement.clientHeight*window.devicePixelRatio),this._refreshDrawConstants(),this._refreshColorZonePadding()},m.prototype._refreshDecorations=function(){var y,C,L,k,E,A;this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();try{for(var D=S(this._decorationService.decorations),M=D.next();!M.done;M=D.next()){var F=M.value;this._colorZoneStore.addDecoration(F)}}catch(J){y={error:J}}finally{try{M&&!M.done&&(C=D.return)&&C.call(D)}finally{if(y)throw y.error}}this._ctx.lineWidth=1;var T=this._colorZoneStore.zones;try{for(var R=S(T),O=R.next();!O.done;O=R.next())(ie=O.value).position!=="full"&&this._renderColorZone(ie)}catch(J){L={error:J}}finally{try{O&&!O.done&&(k=R.return)&&k.call(R)}finally{if(L)throw L.error}}try{for(var H=S(T),ee=H.next();!ee.done;ee=H.next()){var ie;(ie=ee.value).position==="full"&&this._renderColorZone(ie)}}catch(J){E={error:J}}finally{try{ee&&!ee.done&&(A=H.return)&&A.call(H)}finally{if(E)throw E.error}}this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1},m.prototype._renderColorZone=function(y){this._ctx.fillStyle=y.color,this._ctx.fillRect(c[y.position||"full"],Math.round((this._canvas.height-1)*(y.startBufferLine/this._bufferService.buffers.active.lines.length)-h[y.position||"full"]/2),s[y.position||"full"],Math.round((this._canvas.height-1)*((y.endBufferLine-y.startBufferLine)/this._bufferService.buffers.active.lines.length)+h[y.position||"full"]))},m.prototype._queueRefresh=function(y,C){var L=this;this._shouldUpdateDimensions=y||this._shouldUpdateDimensions,this._shouldUpdateAnchor=C||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=window.requestAnimationFrame(function(){L._refreshDecorations(),L._animationFrame=void 0}))},l([_(2,x.IBufferService),_(3,x.IDecorationService),_(4,g.IRenderService),_(5,x.IOptionsService)],m)}(w.Disposable);e.OverviewRulerRenderer=o},2950:function(d,e,a){var u=this&&this.__decorate||function(b,p,g,w){var x,h=arguments.length,s=h<3?p:w===null?w=Object.getOwnPropertyDescriptor(p,g):w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(b,p,g,w);else for(var c=b.length-1;c>=0;c--)(x=b[c])&&(s=(h<3?x(s):h>3?x(p,g,s):x(p,g))||s);return h>3&&s&&Object.defineProperty(p,g,s),s},v=this&&this.__param||function(b,p){return function(g,w){p(g,w,b)}};Object.defineProperty(e,"__esModule",{value:!0}),e.CompositionHelper=void 0;var l=a(4725),_=a(2585),S=function(){function b(p,g,w,x,h,s){this._textarea=p,this._compositionView=g,this._bufferService=w,this._optionsService=x,this._coreService=h,this._renderService=s,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}return Object.defineProperty(b.prototype,"isComposing",{get:function(){return this._isComposing},enumerable:!1,configurable:!0}),b.prototype.compositionstart=function(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")},b.prototype.compositionupdate=function(p){var g=this;this._compositionView.textContent=p.data,this.updateCompositionElements(),setTimeout(function(){g._compositionPosition.end=g._textarea.value.length},0)},b.prototype.compositionend=function(){this._finalizeComposition(!0)},b.prototype.keydown=function(p){if(this._isComposing||this._isSendingComposition){if(p.keyCode===229||p.keyCode===16||p.keyCode===17||p.keyCode===18)return!1;this._finalizeComposition(!1)}return p.keyCode!==229||(this._handleAnyTextareaChanges(),!1)},b.prototype._finalizeComposition=function(p){var g=this;if(this._compositionView.classList.remove("active"),this._isComposing=!1,p){var w={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(function(){if(g._isSendingComposition){g._isSendingComposition=!1;var h;w.start+=g._dataAlreadySent.length,(h=g._isComposing?g._textarea.value.substring(w.start,w.end):g._textarea.value.substring(w.start)).length>0&&g._coreService.triggerDataEvent(h,!0)}},0)}else{this._isSendingComposition=!1;var x=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(x,!0)}},b.prototype._handleAnyTextareaChanges=function(){var p=this,g=this._textarea.value;setTimeout(function(){if(!p._isComposing){var w=p._textarea.value.replace(g,"");w.length>0&&(p._dataAlreadySent=w,p._coreService.triggerDataEvent(w,!0))}},0)},b.prototype.updateCompositionElements=function(p){var g=this;if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){var w=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),x=this._renderService.dimensions.actualCellHeight,h=this._bufferService.buffer.y*this._renderService.dimensions.actualCellHeight,s=w*this._renderService.dimensions.actualCellWidth;this._compositionView.style.left=s+"px",this._compositionView.style.top=h+"px",this._compositionView.style.height=x+"px",this._compositionView.style.lineHeight=x+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";var c=this._compositionView.getBoundingClientRect();this._textarea.style.left=s+"px",this._textarea.style.top=h+"px",this._textarea.style.width=Math.max(c.width,1)+"px",this._textarea.style.height=Math.max(c.height,1)+"px",this._textarea.style.lineHeight=c.height+"px"}p||setTimeout(function(){return g.updateCompositionElements(!0)},0)}},u([v(2,_.IBufferService),v(3,_.IOptionsService),v(4,_.ICoreService),v(5,l.IRenderService)],b)}();e.CompositionHelper=S},9806:(d,e)=>{function a(u,v,l){var _=l.getBoundingClientRect(),S=u.getComputedStyle(l),b=parseInt(S.getPropertyValue("padding-left")),p=parseInt(S.getPropertyValue("padding-top"));return[v.clientX-_.left-b,v.clientY-_.top-p]}Object.defineProperty(e,"__esModule",{value:!0}),e.getRawByteCoords=e.getCoords=e.getCoordsRelativeToElement=void 0,e.getCoordsRelativeToElement=a,e.getCoords=function(u,v,l,_,S,b,p,g,w){if(b){var x=a(u,v,l);if(x)return x[0]=Math.ceil((x[0]+(w?p/2:0))/p),x[1]=Math.ceil(x[1]/g),x[0]=Math.min(Math.max(x[0],1),_+(w?1:0)),x[1]=Math.min(Math.max(x[1],1),S),x}},e.getRawByteCoords=function(u){if(u)return{x:u[0]+32,y:u[1]+32}}},9504:(d,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.moveToCellSequence=void 0;var u=a(2584);function v(g,w,x,h){var s=g-l(x,g),c=w-l(x,w),o=Math.abs(s-c)-function(f,m,y){for(var C=0,L=f-l(y,f),k=m-l(y,m),E=0;E<Math.abs(L-k);E++){var A=_(f,m)==="A"?-1:1,D=y.buffer.lines.get(L+A*E);D!=null&&D.isWrapped&&C++}return C}(g,w,x);return p(o,b(_(g,w),h))}function l(g,w){for(var x=0,h=g.buffer.lines.get(w),s=h==null?void 0:h.isWrapped;s&&w>=0&&w<g.rows;)x++,s=(h=g.buffer.lines.get(--w))==null?void 0:h.isWrapped;return x}function _(g,w){return g>w?"A":"B"}function S(g,w,x,h,s,c){for(var o=g,f=w,m="";o!==x||f!==h;)o+=s?1:-1,s&&o>c.cols-1?(m+=c.buffer.translateBufferLineToString(f,!1,g,o),o=0,g=0,f++):!s&&o<0&&(m+=c.buffer.translateBufferLineToString(f,!1,0,g+1),g=o=c.cols-1,f--);return m+c.buffer.translateBufferLineToString(f,!1,g,o)}function b(g,w){var x=w?"O":"[";return u.C0.ESC+x+g}function p(g,w){g=Math.floor(g);for(var x="",h=0;h<g;h++)x+=w;return x}e.moveToCellSequence=function(g,w,x,h){var s,c=x.buffer.x,o=x.buffer.y;if(!x.buffer.hasScrollback)return function(m,y,C,L,k,E){return v(y,L,k,E).length===0?"":p(S(m,y,m,y-l(k,y),!1,k).length,b("D",E))}(c,o,0,w,x,h)+v(o,w,x,h)+function(m,y,C,L,k,E){var A;A=v(y,L,k,E).length>0?L-l(k,L):y;var D=L,M=function(F,T,R,O,H,ee){var ie;return ie=v(R,O,H,ee).length>0?O-l(H,O):T,F<R&&ie<=O||F>=R&&ie<O?"C":"D"}(m,y,C,L,k,E);return p(S(m,A,C,D,M==="C",k).length,b(M,E))}(c,o,g,w,x,h);if(o===w)return s=c>g?"D":"C",p(Math.abs(c-g),b(s,h));s=o>w?"D":"C";var f=Math.abs(o-w);return p(function(m,y){return y.cols-m}(o>w?g:c,x)+(f-1)*x.cols+1+((o>w?c:g)-1),b(s,h))}},4389:function(d,e,a){var u=this&&this.__assign||function(){return u=Object.assign||function(h){for(var s,c=1,o=arguments.length;c<o;c++)for(var f in s=arguments[c])Object.prototype.hasOwnProperty.call(s,f)&&(h[f]=s[f]);return h},u.apply(this,arguments)},v=this&&this.__values||function(h){var s=typeof Symbol=="function"&&Symbol.iterator,c=s&&h[s],o=0;if(c)return c.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&o>=h.length&&(h=void 0),{value:h&&h[o++],done:!h}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.Terminal=void 0;var l=a(3236),_=a(9042),S=a(7975),b=a(7090),p=a(5741),g=a(8285),w=["cols","rows"],x=function(){function h(s){var c=this;this._core=new l.Terminal(s),this._addonManager=new p.AddonManager,this._publicOptions=u({},this._core.options);var o=function(C){return c._core.options[C]},f=function(C,L){c._checkReadonlyOptions(C),c._core.options[C]=L};for(var m in this._core.options){var y={get:o.bind(this,m),set:f.bind(this,m)};Object.defineProperty(this._publicOptions,m,y)}}return h.prototype._checkReadonlyOptions=function(s){if(w.includes(s))throw new Error('Option "'+s+'" can only be set in the constructor')},h.prototype._checkProposedApi=function(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")},Object.defineProperty(h.prototype,"onBell",{get:function(){return this._core.onBell},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onBinary",{get:function(){return this._core.onBinary},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onCursorMove",{get:function(){return this._core.onCursorMove},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onData",{get:function(){return this._core.onData},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onKey",{get:function(){return this._core.onKey},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onLineFeed",{get:function(){return this._core.onLineFeed},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onRender",{get:function(){return this._core.onRender},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onResize",{get:function(){return this._core.onResize},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onScroll",{get:function(){return this._core.onScroll},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onSelectionChange",{get:function(){return this._core.onSelectionChange},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onTitleChange",{get:function(){return this._core.onTitleChange},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onWriteParsed",{get:function(){return this._core.onWriteParsed},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"element",{get:function(){return this._core.element},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"parser",{get:function(){return this._checkProposedApi(),this._parser||(this._parser=new S.ParserApi(this._core)),this._parser},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"unicode",{get:function(){return this._checkProposedApi(),new b.UnicodeApi(this._core)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"textarea",{get:function(){return this._core.textarea},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"rows",{get:function(){return this._core.rows},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"cols",{get:function(){return this._core.cols},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"buffer",{get:function(){return this._checkProposedApi(),this._buffer||(this._buffer=new g.BufferNamespaceApi(this._core)),this._buffer},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"markers",{get:function(){return this._checkProposedApi(),this._core.markers},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"modes",{get:function(){var s=this._core.coreService.decPrivateModes,c="none";switch(this._core.coreMouseService.activeProtocol){case"X10":c="x10";break;case"VT200":c="vt200";break;case"DRAG":c="drag";break;case"ANY":c="any"}return{applicationCursorKeysMode:s.applicationCursorKeys,applicationKeypadMode:s.applicationKeypad,bracketedPasteMode:s.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:c,originMode:s.origin,reverseWraparoundMode:s.reverseWraparound,sendFocusMode:s.sendFocus,wraparoundMode:s.wraparound}},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"options",{get:function(){return this._publicOptions},set:function(s){for(var c in s)this._publicOptions[c]=s[c]},enumerable:!1,configurable:!0}),h.prototype.blur=function(){this._core.blur()},h.prototype.focus=function(){this._core.focus()},h.prototype.resize=function(s,c){this._verifyIntegers(s,c),this._core.resize(s,c)},h.prototype.open=function(s){this._core.open(s)},h.prototype.attachCustomKeyEventHandler=function(s){this._core.attachCustomKeyEventHandler(s)},h.prototype.registerLinkMatcher=function(s,c,o){return this._checkProposedApi(),this._core.registerLinkMatcher(s,c,o)},h.prototype.deregisterLinkMatcher=function(s){this._checkProposedApi(),this._core.deregisterLinkMatcher(s)},h.prototype.registerLinkProvider=function(s){return this._checkProposedApi(),this._core.registerLinkProvider(s)},h.prototype.registerCharacterJoiner=function(s){return this._checkProposedApi(),this._core.registerCharacterJoiner(s)},h.prototype.deregisterCharacterJoiner=function(s){this._checkProposedApi(),this._core.deregisterCharacterJoiner(s)},h.prototype.registerMarker=function(s){return s===void 0&&(s=0),this._checkProposedApi(),this._verifyIntegers(s),this._core.addMarker(s)},h.prototype.registerDecoration=function(s){var c,o,f;return this._checkProposedApi(),this._verifyPositiveIntegers((c=s.x)!==null&&c!==void 0?c:0,(o=s.width)!==null&&o!==void 0?o:0,(f=s.height)!==null&&f!==void 0?f:0),this._core.registerDecoration(s)},h.prototype.addMarker=function(s){return this.registerMarker(s)},h.prototype.hasSelection=function(){return this._core.hasSelection()},h.prototype.select=function(s,c,o){this._verifyIntegers(s,c,o),this._core.select(s,c,o)},h.prototype.getSelection=function(){return this._core.getSelection()},h.prototype.getSelectionPosition=function(){return this._core.getSelectionPosition()},h.prototype.clearSelection=function(){this._core.clearSelection()},h.prototype.selectAll=function(){this._core.selectAll()},h.prototype.selectLines=function(s,c){this._verifyIntegers(s,c),this._core.selectLines(s,c)},h.prototype.dispose=function(){this._addonManager.dispose(),this._core.dispose()},h.prototype.scrollLines=function(s){this._verifyIntegers(s),this._core.scrollLines(s)},h.prototype.scrollPages=function(s){this._verifyIntegers(s),this._core.scrollPages(s)},h.prototype.scrollToTop=function(){this._core.scrollToTop()},h.prototype.scrollToBottom=function(){this._core.scrollToBottom()},h.prototype.scrollToLine=function(s){this._verifyIntegers(s),this._core.scrollToLine(s)},h.prototype.clear=function(){this._core.clear()},h.prototype.write=function(s,c){this._core.write(s,c)},h.prototype.writeUtf8=function(s,c){this._core.write(s,c)},h.prototype.writeln=function(s,c){this._core.write(s),this._core.write(`\r
`,c)},h.prototype.paste=function(s){this._core.paste(s)},h.prototype.getOption=function(s){return this._core.optionsService.getOption(s)},h.prototype.setOption=function(s,c){this._checkReadonlyOptions(s),this._core.optionsService.setOption(s,c)},h.prototype.refresh=function(s,c){this._verifyIntegers(s,c),this._core.refresh(s,c)},h.prototype.reset=function(){this._core.reset()},h.prototype.clearTextureAtlas=function(){this._core.clearTextureAtlas()},h.prototype.loadAddon=function(s){return this._addonManager.loadAddon(this,s)},Object.defineProperty(h,"strings",{get:function(){return _},enumerable:!1,configurable:!0}),h.prototype._verifyIntegers=function(){for(var s,c,o=[],f=0;f<arguments.length;f++)o[f]=arguments[f];try{for(var m=v(o),y=m.next();!y.done;y=m.next()){var C=y.value;if(C===1/0||isNaN(C)||C%1!=0)throw new Error("This API only accepts integers")}}catch(L){s={error:L}}finally{try{y&&!y.done&&(c=m.return)&&c.call(m)}finally{if(s)throw s.error}}},h.prototype._verifyPositiveIntegers=function(){for(var s,c,o=[],f=0;f<arguments.length;f++)o[f]=arguments[f];try{for(var m=v(o),y=m.next();!y.done;y=m.next()){var C=y.value;if(C&&(C===1/0||isNaN(C)||C%1!=0||C<0))throw new Error("This API only accepts positive integers")}}catch(L){s={error:L}}finally{try{y&&!y.done&&(c=m.return)&&c.call(m)}finally{if(s)throw s.error}}},h}();e.Terminal=x},1546:function(d,e,a){var u=this&&this.__values||function(h){var s=typeof Symbol=="function"&&Symbol.iterator,c=s&&h[s],o=0;if(c)return c.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&o>=h.length&&(h=void 0),{value:h&&h[o++],done:!h}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.BaseRenderLayer=void 0;var v=a(643),l=a(8803),_=a(1420),S=a(3734),b=a(1752),p=a(8055),g=a(9631),w=a(8978),x=function(){function h(s,c,o,f,m,y,C,L,k){this._container=s,this._alpha=f,this._colors=m,this._rendererId=y,this._bufferService=C,this._optionsService=L,this._decorationService=k,this._scaledCharWidth=0,this._scaledCharHeight=0,this._scaledCellWidth=0,this._scaledCellHeight=0,this._scaledCharLeft=0,this._scaledCharTop=0,this._columnSelectMode=!1,this._currentGlyphIdentifier={chars:"",code:0,bg:0,fg:0,bold:!1,dim:!1,italic:!1},this._canvas=document.createElement("canvas"),this._canvas.classList.add("xterm-"+c+"-layer"),this._canvas.style.zIndex=o.toString(),this._initCanvas(),this._container.appendChild(this._canvas)}return h.prototype.dispose=function(){var s;(0,g.removeElementFromParent)(this._canvas),(s=this._charAtlas)===null||s===void 0||s.dispose()},h.prototype._initCanvas=function(){this._ctx=(0,b.throwIfFalsy)(this._canvas.getContext("2d",{alpha:this._alpha})),this._alpha||this._clearAll()},h.prototype.onOptionsChanged=function(){},h.prototype.onBlur=function(){},h.prototype.onFocus=function(){},h.prototype.onCursorMove=function(){},h.prototype.onGridChanged=function(s,c){},h.prototype.onSelectionChanged=function(s,c,o){o===void 0&&(o=!1),this._selectionStart=s,this._selectionEnd=c,this._columnSelectMode=o},h.prototype.setColors=function(s){this._refreshCharAtlas(s)},h.prototype._setTransparency=function(s){if(s!==this._alpha){var c=this._canvas;this._alpha=s,this._canvas=this._canvas.cloneNode(),this._initCanvas(),this._container.replaceChild(this._canvas,c),this._refreshCharAtlas(this._colors),this.onGridChanged(0,this._bufferService.rows-1)}},h.prototype._refreshCharAtlas=function(s){this._scaledCharWidth<=0&&this._scaledCharHeight<=0||(this._charAtlas=(0,_.acquireCharAtlas)(this._optionsService.rawOptions,this._rendererId,s,this._scaledCharWidth,this._scaledCharHeight),this._charAtlas.warmUp())},h.prototype.resize=function(s){this._scaledCellWidth=s.scaledCellWidth,this._scaledCellHeight=s.scaledCellHeight,this._scaledCharWidth=s.scaledCharWidth,this._scaledCharHeight=s.scaledCharHeight,this._scaledCharLeft=s.scaledCharLeft,this._scaledCharTop=s.scaledCharTop,this._canvas.width=s.scaledCanvasWidth,this._canvas.height=s.scaledCanvasHeight,this._canvas.style.width=s.canvasWidth+"px",this._canvas.style.height=s.canvasHeight+"px",this._alpha||this._clearAll(),this._refreshCharAtlas(this._colors)},h.prototype.clearTextureAtlas=function(){var s;(s=this._charAtlas)===null||s===void 0||s.clear()},h.prototype._fillCells=function(s,c,o,f){this._ctx.fillRect(s*this._scaledCellWidth,c*this._scaledCellHeight,o*this._scaledCellWidth,f*this._scaledCellHeight)},h.prototype._fillMiddleLineAtCells=function(s,c,o){o===void 0&&(o=1);var f=Math.ceil(.5*this._scaledCellHeight);this._ctx.fillRect(s*this._scaledCellWidth,(c+1)*this._scaledCellHeight-f-window.devicePixelRatio,o*this._scaledCellWidth,window.devicePixelRatio)},h.prototype._fillBottomLineAtCells=function(s,c,o){o===void 0&&(o=1),this._ctx.fillRect(s*this._scaledCellWidth,(c+1)*this._scaledCellHeight-window.devicePixelRatio-1,o*this._scaledCellWidth,window.devicePixelRatio)},h.prototype._fillLeftLineAtCell=function(s,c,o){this._ctx.fillRect(s*this._scaledCellWidth,c*this._scaledCellHeight,window.devicePixelRatio*o,this._scaledCellHeight)},h.prototype._strokeRectAtCell=function(s,c,o,f){this._ctx.lineWidth=window.devicePixelRatio,this._ctx.strokeRect(s*this._scaledCellWidth+window.devicePixelRatio/2,c*this._scaledCellHeight+window.devicePixelRatio/2,o*this._scaledCellWidth-window.devicePixelRatio,f*this._scaledCellHeight-window.devicePixelRatio)},h.prototype._clearAll=function(){this._alpha?this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height):(this._ctx.fillStyle=this._colors.background.css,this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height))},h.prototype._clearCells=function(s,c,o,f){this._alpha?this._ctx.clearRect(s*this._scaledCellWidth,c*this._scaledCellHeight,o*this._scaledCellWidth,f*this._scaledCellHeight):(this._ctx.fillStyle=this._colors.background.css,this._ctx.fillRect(s*this._scaledCellWidth,c*this._scaledCellHeight,o*this._scaledCellWidth,f*this._scaledCellHeight))},h.prototype._fillCharTrueColor=function(s,c,o){this._ctx.font=this._getFont(!1,!1),this._ctx.textBaseline=l.TEXT_BASELINE,this._clipRow(o);var f=!1;this._optionsService.rawOptions.customGlyphs!==!1&&(f=(0,w.tryDrawCustomChar)(this._ctx,s.getChars(),c*this._scaledCellWidth,o*this._scaledCellHeight,this._scaledCellWidth,this._scaledCellHeight)),f||this._ctx.fillText(s.getChars(),c*this._scaledCellWidth+this._scaledCharLeft,o*this._scaledCellHeight+this._scaledCharTop+this._scaledCharHeight)},h.prototype._drawChars=function(s,c,o){var f,m,y,C=this._getContrastColor(s,c,o);if(C||s.isFgRGB()||s.isBgRGB())this._drawUncachedChars(s,c,o,C);else{var L,k;s.isInverse()?(L=s.isBgDefault()?l.INVERTED_DEFAULT_COLOR:s.getBgColor(),k=s.isFgDefault()?l.INVERTED_DEFAULT_COLOR:s.getFgColor()):(k=s.isBgDefault()?v.DEFAULT_COLOR:s.getBgColor(),L=s.isFgDefault()?v.DEFAULT_COLOR:s.getFgColor()),L+=this._optionsService.rawOptions.drawBoldTextInBrightColors&&s.isBold()&&L<8?8:0,this._currentGlyphIdentifier.chars=s.getChars()||v.WHITESPACE_CELL_CHAR,this._currentGlyphIdentifier.code=s.getCode()||v.WHITESPACE_CELL_CODE,this._currentGlyphIdentifier.bg=k,this._currentGlyphIdentifier.fg=L,this._currentGlyphIdentifier.bold=!!s.isBold(),this._currentGlyphIdentifier.dim=!!s.isDim(),this._currentGlyphIdentifier.italic=!!s.isItalic();var E=!1;try{for(var A=u(this._decorationService.getDecorationsAtCell(c,o)),D=A.next();!D.done;D=A.next()){var M=D.value;if(M.backgroundColorRGB||M.foregroundColorRGB){E=!0;break}}}catch(F){f={error:F}}finally{try{D&&!D.done&&(m=A.return)&&m.call(A)}finally{if(f)throw f.error}}!E&&(!((y=this._charAtlas)===null||y===void 0)&&y.draw(this._ctx,this._currentGlyphIdentifier,c*this._scaledCellWidth+this._scaledCharLeft,o*this._scaledCellHeight+this._scaledCharTop))||this._drawUncachedChars(s,c,o)}},h.prototype._drawUncachedChars=function(s,c,o,f){if(this._ctx.save(),this._ctx.font=this._getFont(!!s.isBold(),!!s.isItalic()),this._ctx.textBaseline=l.TEXT_BASELINE,s.isInverse())if(f)this._ctx.fillStyle=f.css;else if(s.isBgDefault())this._ctx.fillStyle=p.color.opaque(this._colors.background).css;else if(s.isBgRGB())this._ctx.fillStyle="rgb("+S.AttributeData.toColorRGB(s.getBgColor()).join(",")+")";else{var m=s.getBgColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&s.isBold()&&m<8&&(m+=8),this._ctx.fillStyle=this._colors.ansi[m].css}else if(f)this._ctx.fillStyle=f.css;else if(s.isFgDefault())this._ctx.fillStyle=this._colors.foreground.css;else if(s.isFgRGB())this._ctx.fillStyle="rgb("+S.AttributeData.toColorRGB(s.getFgColor()).join(",")+")";else{var y=s.getFgColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&s.isBold()&&y<8&&(y+=8),this._ctx.fillStyle=this._colors.ansi[y].css}this._clipRow(o),s.isDim()&&(this._ctx.globalAlpha=l.DIM_OPACITY);var C=!1;this._optionsService.rawOptions.customGlyphs!==!1&&(C=(0,w.tryDrawCustomChar)(this._ctx,s.getChars(),c*this._scaledCellWidth,o*this._scaledCellHeight,this._scaledCellWidth,this._scaledCellHeight)),C||this._ctx.fillText(s.getChars(),c*this._scaledCellWidth+this._scaledCharLeft,o*this._scaledCellHeight+this._scaledCharTop+this._scaledCharHeight),this._ctx.restore()},h.prototype._clipRow=function(s){this._ctx.beginPath(),this._ctx.rect(0,s*this._scaledCellHeight,this._bufferService.cols*this._scaledCellWidth,this._scaledCellHeight),this._ctx.clip()},h.prototype._getFont=function(s,c){return(c?"italic":"")+" "+(s?this._optionsService.rawOptions.fontWeightBold:this._optionsService.rawOptions.fontWeight)+" "+this._optionsService.rawOptions.fontSize*window.devicePixelRatio+"px "+this._optionsService.rawOptions.fontFamily},h.prototype._getContrastColor=function(s,c,o){var f,m,y,C,L=!1;try{for(var k=u(this._decorationService.getDecorationsAtCell(c,o)),E=k.next();!E.done;E=k.next()){var A=E.value;A.options.layer!=="top"&&L||(A.backgroundColorRGB&&(y=A.backgroundColorRGB.rgba),A.foregroundColorRGB&&(C=A.foregroundColorRGB.rgba),L=A.options.layer==="top")}}catch(he){f={error:he}}finally{try{E&&!E.done&&(m=k.return)&&m.call(k)}finally{if(f)throw f.error}}if(L||this._colors.selectionForeground&&this._isCellInSelection(c,o)&&(C=this._colors.selectionForeground.rgba),y||C||this._optionsService.rawOptions.minimumContrastRatio!==1&&!(0,b.excludeFromContrastRatioDemands)(s.getCode())){if(!y&&!C){var D=this._colors.contrastCache.getColor(s.bg,s.fg);if(D!==void 0)return D||void 0}var M=s.getFgColor(),F=s.getFgColorMode(),T=s.getBgColor(),R=s.getBgColorMode(),O=!!s.isInverse(),H=!!s.isInverse();if(O){var ee=M;M=T,T=ee;var ie=F;F=R,R=ie}var J=this._resolveBackgroundRgba(y!==void 0?50331648:R,y??T,O),ne=this._resolveForegroundRgba(F,M,O,H),re=p.rgba.ensureContrastRatio(y??J,C??ne,this._optionsService.rawOptions.minimumContrastRatio);if(!re){if(!C)return void this._colors.contrastCache.setColor(s.bg,s.fg,null);re=C}var B={css:p.channels.toCss(re>>24&255,re>>16&255,re>>8&255),rgba:re};return y||C||this._colors.contrastCache.setColor(s.bg,s.fg,B),B}},h.prototype._resolveBackgroundRgba=function(s,c,o){switch(s){case 16777216:case 33554432:return this._colors.ansi[c].rgba;case 50331648:return c<<8;default:return o?this._colors.foreground.rgba:this._colors.background.rgba}},h.prototype._resolveForegroundRgba=function(s,c,o,f){switch(s){case 16777216:case 33554432:return this._optionsService.rawOptions.drawBoldTextInBrightColors&&f&&c<8&&(c+=8),this._colors.ansi[c].rgba;case 50331648:return c<<8;default:return o?this._colors.background.rgba:this._colors.foreground.rgba}},h.prototype._isCellInSelection=function(s,c){var o=this._selectionStart,f=this._selectionEnd;return!(!o||!f)&&(this._columnSelectMode?s>=o[0]&&c>=o[1]&&s<f[0]&&c<f[1]:c>o[1]&&c<f[1]||o[1]===f[1]&&c===o[1]&&s>=o[0]&&s<f[0]||o[1]<f[1]&&c===f[1]&&s<f[0]||o[1]<f[1]&&c===o[1]&&s>=o[0])},h}();e.BaseRenderLayer=x},2512:function(d,e,a){var u,v=this&&this.__extends||(u=function(s,c){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,f){o.__proto__=f}||function(o,f){for(var m in f)Object.prototype.hasOwnProperty.call(f,m)&&(o[m]=f[m])},u(s,c)},function(s,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");function o(){this.constructor=s}u(s,c),s.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}),l=this&&this.__decorate||function(s,c,o,f){var m,y=arguments.length,C=y<3?c:f===null?f=Object.getOwnPropertyDescriptor(c,o):f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(s,c,o,f);else for(var L=s.length-1;L>=0;L--)(m=s[L])&&(C=(y<3?m(C):y>3?m(c,o,C):m(c,o))||C);return y>3&&C&&Object.defineProperty(c,o,C),C},_=this&&this.__param||function(s,c){return function(o,f){c(o,f,s)}};Object.defineProperty(e,"__esModule",{value:!0}),e.CursorRenderLayer=void 0;var S=a(1546),b=a(511),p=a(2585),g=a(4725),w=600,x=function(s){function c(o,f,m,y,C,L,k,E,A,D){var M=s.call(this,o,"cursor",f,!0,m,y,L,k,D)||this;return M._onRequestRedraw=C,M._coreService=E,M._coreBrowserService=A,M._cell=new b.CellData,M._state={x:0,y:0,isFocused:!1,style:"",width:0},M._cursorRenderers={bar:M._renderBarCursor.bind(M),block:M._renderBlockCursor.bind(M),underline:M._renderUnderlineCursor.bind(M)},M}return v(c,s),c.prototype.dispose=function(){this._cursorBlinkStateManager&&(this._cursorBlinkStateManager.dispose(),this._cursorBlinkStateManager=void 0),s.prototype.dispose.call(this)},c.prototype.resize=function(o){s.prototype.resize.call(this,o),this._state={x:0,y:0,isFocused:!1,style:"",width:0}},c.prototype.reset=function(){var o;this._clearCursor(),(o=this._cursorBlinkStateManager)===null||o===void 0||o.restartBlinkAnimation(),this.onOptionsChanged()},c.prototype.onBlur=function(){var o;(o=this._cursorBlinkStateManager)===null||o===void 0||o.pause(),this._onRequestRedraw.fire({start:this._bufferService.buffer.y,end:this._bufferService.buffer.y})},c.prototype.onFocus=function(){var o;(o=this._cursorBlinkStateManager)===null||o===void 0||o.resume(),this._onRequestRedraw.fire({start:this._bufferService.buffer.y,end:this._bufferService.buffer.y})},c.prototype.onOptionsChanged=function(){var o,f=this;this._optionsService.rawOptions.cursorBlink?this._cursorBlinkStateManager||(this._cursorBlinkStateManager=new h(this._coreBrowserService.isFocused,function(){f._render(!0)})):((o=this._cursorBlinkStateManager)===null||o===void 0||o.dispose(),this._cursorBlinkStateManager=void 0),this._onRequestRedraw.fire({start:this._bufferService.buffer.y,end:this._bufferService.buffer.y})},c.prototype.onCursorMove=function(){var o;(o=this._cursorBlinkStateManager)===null||o===void 0||o.restartBlinkAnimation()},c.prototype.onGridChanged=function(o,f){!this._cursorBlinkStateManager||this._cursorBlinkStateManager.isPaused?this._render(!1):this._cursorBlinkStateManager.restartBlinkAnimation()},c.prototype._render=function(o){if(this._coreService.isCursorInitialized&&!this._coreService.isCursorHidden){var f=this._bufferService.buffer.ybase+this._bufferService.buffer.y,m=f-this._bufferService.buffer.ydisp;if(m<0||m>=this._bufferService.rows)this._clearCursor();else{var y=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1);if(this._bufferService.buffer.lines.get(f).loadCell(y,this._cell),this._cell.content!==void 0){if(!this._coreBrowserService.isFocused){this._clearCursor(),this._ctx.save(),this._ctx.fillStyle=this._colors.cursor.css;var C=this._optionsService.rawOptions.cursorStyle;return C&&C!=="block"?this._cursorRenderers[C](y,m,this._cell):this._renderBlurCursor(y,m,this._cell),this._ctx.restore(),this._state.x=y,this._state.y=m,this._state.isFocused=!1,this._state.style=C,void(this._state.width=this._cell.getWidth())}if(!this._cursorBlinkStateManager||this._cursorBlinkStateManager.isCursorVisible){if(this._state){if(this._state.x===y&&this._state.y===m&&this._state.isFocused===this._coreBrowserService.isFocused&&this._state.style===this._optionsService.rawOptions.cursorStyle&&this._state.width===this._cell.getWidth())return;this._clearCursor()}this._ctx.save(),this._cursorRenderers[this._optionsService.rawOptions.cursorStyle||"block"](y,m,this._cell),this._ctx.restore(),this._state.x=y,this._state.y=m,this._state.isFocused=!1,this._state.style=this._optionsService.rawOptions.cursorStyle,this._state.width=this._cell.getWidth()}else this._clearCursor()}}}else this._clearCursor()},c.prototype._clearCursor=function(){this._state&&(window.devicePixelRatio<1?this._clearAll():this._clearCells(this._state.x,this._state.y,this._state.width,1),this._state={x:0,y:0,isFocused:!1,style:"",width:0})},c.prototype._renderBarCursor=function(o,f,m){this._ctx.save(),this._ctx.fillStyle=this._colors.cursor.css,this._fillLeftLineAtCell(o,f,this._optionsService.rawOptions.cursorWidth),this._ctx.restore()},c.prototype._renderBlockCursor=function(o,f,m){this._ctx.save(),this._ctx.fillStyle=this._colors.cursor.css,this._fillCells(o,f,m.getWidth(),1),this._ctx.fillStyle=this._colors.cursorAccent.css,this._fillCharTrueColor(m,o,f),this._ctx.restore()},c.prototype._renderUnderlineCursor=function(o,f,m){this._ctx.save(),this._ctx.fillStyle=this._colors.cursor.css,this._fillBottomLineAtCells(o,f),this._ctx.restore()},c.prototype._renderBlurCursor=function(o,f,m){this._ctx.save(),this._ctx.strokeStyle=this._colors.cursor.css,this._strokeRectAtCell(o,f,m.getWidth(),1),this._ctx.restore()},l([_(5,p.IBufferService),_(6,p.IOptionsService),_(7,p.ICoreService),_(8,g.ICoreBrowserService),_(9,p.IDecorationService)],c)}(S.BaseRenderLayer);e.CursorRenderLayer=x;var h=function(){function s(c,o){this._renderCallback=o,this.isCursorVisible=!0,c&&this._restartInterval()}return Object.defineProperty(s.prototype,"isPaused",{get:function(){return!(this._blinkStartTimeout||this._blinkInterval)},enumerable:!1,configurable:!0}),s.prototype.dispose=function(){this._blinkInterval&&(window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)},s.prototype.restartBlinkAnimation=function(){var c=this;this.isPaused||(this._animationTimeRestarted=Date.now(),this.isCursorVisible=!0,this._animationFrame||(this._animationFrame=window.requestAnimationFrame(function(){c._renderCallback(),c._animationFrame=void 0})))},s.prototype._restartInterval=function(c){var o=this;c===void 0&&(c=w),this._blinkInterval&&(window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout=window.setTimeout(function(){if(o._animationTimeRestarted){var f=w-(Date.now()-o._animationTimeRestarted);if(o._animationTimeRestarted=void 0,f>0)return void o._restartInterval(f)}o.isCursorVisible=!1,o._animationFrame=window.requestAnimationFrame(function(){o._renderCallback(),o._animationFrame=void 0}),o._blinkInterval=window.setInterval(function(){if(o._animationTimeRestarted){var m=w-(Date.now()-o._animationTimeRestarted);return o._animationTimeRestarted=void 0,void o._restartInterval(m)}o.isCursorVisible=!o.isCursorVisible,o._animationFrame=window.requestAnimationFrame(function(){o._renderCallback(),o._animationFrame=void 0})},w)},c)},s.prototype.pause=function(){this.isCursorVisible=!0,this._blinkInterval&&(window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)},s.prototype.resume=function(){this.pause(),this._animationTimeRestarted=void 0,this._restartInterval(),this.restartBlinkAnimation()},s}()},8978:function(d,e,a){var u,v,l,_,S,b,p,g,w,x,h,s,c,o,f,m,y,C,L,k,E,A,D,M,F,T,R,O,H,ee,ie,J,ne,re,B,he,le,me,U,xe,ce,$,X,I,Y,oe,ae,fe,Se,Ae,Me,se,te,_e,Te,Ye,qr,Qr,Vr,Gr,Zr,Yr,Si,wi,Ci,ki,Ei,Li,Ai,Mi,Ri,Ti,Fi,Di,Bi,Oi,Ki,Pi,Xi,Ii,Hi,Ui,ji,Ni,Wi,zi,qi,Qi,Vi,Gi,Zi,Yi,Ji,$i,er,tr,ir,rr,nr,sr,or,ar,cr,lr,hr,ur,fr,_r,dr,pr,vr,gr,Jr,$r,en,tn,rn,nn,sn,on,an,cn,ln,hn,un,fn,_n,dn,ts=this&&this.__read||function(j,N){var Fe=typeof Symbol=="function"&&j[Symbol.iterator];if(!Fe)return j;var qe,st,Ge=Fe.call(j),Re=[];try{for(;(N===void 0||N-- >0)&&!(qe=Ge.next()).done;)Re.push(qe.value)}catch(Je){st={error:Je}}finally{try{qe&&!qe.done&&(Fe=Ge.return)&&Fe.call(Ge)}finally{if(st)throw st.error}}return Re},pn=this&&this.__values||function(j){var N=typeof Symbol=="function"&&Symbol.iterator,Fe=N&&j[N],qe=0;if(Fe)return Fe.call(j);if(j&&typeof j.length=="number")return{next:function(){return j&&qe>=j.length&&(j=void 0),{value:j&&j[qe++],done:!j}}};throw new TypeError(N?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.tryDrawCustomChar=e.powerlineDefinitions=e.boxDrawingDefinitions=e.blockElementDefinitions=void 0;var is=a(1752);e.blockElementDefinitions={"":[{x:0,y:0,w:8,h:4}],"":[{x:0,y:7,w:8,h:1}],"":[{x:0,y:6,w:8,h:2}],"":[{x:0,y:5,w:8,h:3}],"":[{x:0,y:4,w:8,h:4}],"":[{x:0,y:3,w:8,h:5}],"":[{x:0,y:2,w:8,h:6}],"":[{x:0,y:1,w:8,h:7}],"":[{x:0,y:0,w:8,h:8}],"":[{x:0,y:0,w:7,h:8}],"":[{x:0,y:0,w:6,h:8}],"":[{x:0,y:0,w:5,h:8}],"":[{x:0,y:0,w:4,h:8}],"":[{x:0,y:0,w:3,h:8}],"":[{x:0,y:0,w:2,h:8}],"":[{x:0,y:0,w:1,h:8}],"":[{x:4,y:0,w:4,h:8}],"":[{x:0,y:0,w:9,h:1}],"":[{x:7,y:0,w:1,h:8}],"":[{x:0,y:4,w:4,h:4}],"":[{x:4,y:4,w:4,h:4}],"":[{x:0,y:0,w:4,h:4}],"":[{x:0,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"":[{x:0,y:0,w:4,h:4},{x:4,y:4,w:4,h:4}],"":[{x:0,y:0,w:4,h:8},{x:0,y:0,w:4,h:8}],"":[{x:0,y:0,w:8,h:4},{x:4,y:0,w:4,h:8}],"":[{x:4,y:0,w:4,h:4}],"":[{x:4,y:0,w:4,h:4},{x:0,y:4,w:4,h:4}],"":[{x:4,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"":[{x:1,y:0,w:1,h:8}],"":[{x:2,y:0,w:1,h:8}],"":[{x:3,y:0,w:1,h:8}],"":[{x:4,y:0,w:1,h:8}],"":[{x:5,y:0,w:1,h:8}],"":[{x:6,y:0,w:1,h:8}],"":[{x:0,y:1,w:8,h:1}],"":[{x:0,y:2,w:8,h:1}],"":[{x:0,y:3,w:8,h:1}],"":[{x:0,y:4,w:8,h:1}],"":[{x:0,y:5,w:8,h:1}],"":[{x:0,y:6,w:8,h:1}],"":[{x:0,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"":[{x:0,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"":[{x:7,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"":[{x:7,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"":[{x:0,y:0,w:8,h:1},{x:0,y:7,w:8,h:1}],"":[{x:0,y:0,w:8,h:1},{x:0,y:2,w:8,h:1},{x:0,y:4,w:8,h:1},{x:0,y:7,w:8,h:1}],"":[{x:0,y:0,w:8,h:2}],"":[{x:0,y:0,w:8,h:3}],"":[{x:0,y:0,w:8,h:5}],"":[{x:0,y:0,w:8,h:6}],"":[{x:0,y:0,w:8,h:7}],"":[{x:6,y:0,w:2,h:8}],"":[{x:5,y:0,w:3,h:8}],"":[{x:3,y:0,w:5,h:8}],"":[{x:2,y:0,w:6,h:8}],"":[{x:1,y:0,w:7,h:8}],"":[{x:0,y:0,w:2,h:2},{x:4,y:0,w:2,h:2},{x:2,y:2,w:2,h:2},{x:6,y:2,w:2,h:2},{x:0,y:4,w:2,h:2},{x:4,y:4,w:2,h:2},{x:2,y:6,w:2,h:2},{x:6,y:6,w:2,h:2}],"":[{x:2,y:0,w:2,h:2},{x:6,y:0,w:2,h:2},{x:0,y:2,w:2,h:2},{x:4,y:2,w:2,h:2},{x:2,y:4,w:2,h:2},{x:6,y:4,w:2,h:2},{x:0,y:6,w:2,h:2},{x:4,y:6,w:2,h:2}],"":[{x:0,y:2,w:8,h:2},{x:0,y:6,w:8,h:2}]};var ha={"":[[1,0,0,0],[0,0,0,0],[0,0,1,0],[0,0,0,0]],"":[[1,0],[0,0],[0,1],[0,0]],"":[[0,1],[1,1],[1,0],[1,1]]};e.boxDrawingDefinitions={"":(u={},u[1]="M0,.5 L1,.5",u),"":(v={},v[3]="M0,.5 L1,.5",v),"":(l={},l[1]="M.5,0 L.5,1",l),"":(_={},_[3]="M.5,0 L.5,1",_),"":(S={},S[1]="M0.5,1 L.5,.5 L1,.5",S),"":(b={},b[3]="M0.5,1 L.5,.5 L1,.5",b),"":(p={},p[1]="M0,.5 L.5,.5 L.5,1",p),"":(g={},g[3]="M0,.5 L.5,.5 L.5,1",g),"":(w={},w[1]="M.5,0 L.5,.5 L1,.5",w),"":(x={},x[3]="M.5,0 L.5,.5 L1,.5",x),"":(h={},h[1]="M.5,0 L.5,.5 L0,.5",h),"":(s={},s[3]="M.5,0 L.5,.5 L0,.5",s),"":(c={},c[1]="M.5,0 L.5,1 M.5,.5 L1,.5",c),"":(o={},o[3]="M.5,0 L.5,1 M.5,.5 L1,.5",o),"":(f={},f[1]="M.5,0 L.5,1 M.5,.5 L0,.5",f),"":(m={},m[3]="M.5,0 L.5,1 M.5,.5 L0,.5",m),"":(y={},y[1]="M0,.5 L1,.5 M.5,.5 L.5,1",y),"":(C={},C[3]="M0,.5 L1,.5 M.5,.5 L.5,1",C),"":(L={},L[1]="M0,.5 L1,.5 M.5,.5 L.5,0",L),"":(k={},k[3]="M0,.5 L1,.5 M.5,.5 L.5,0",k),"":(E={},E[1]="M0,.5 L1,.5 M.5,0 L.5,1",E),"":(A={},A[3]="M0,.5 L1,.5 M.5,0 L.5,1",A),"":(D={},D[1]="M.5,.5 L0,.5",D),"":(M={},M[3]="M.5,.5 L0,.5",M),"":(F={},F[1]="M.5,.5 L.5,0",F),"":(T={},T[3]="M.5,.5 L.5,0",T),"":(R={},R[1]="M.5,.5 L1,.5",R),"":(O={},O[3]="M.5,.5 L1,.5",O),"":(H={},H[1]="M.5,.5 L.5,1",H),"":(ee={},ee[3]="M.5,.5 L.5,1",ee),"":(ie={},ie[1]=function(j,N){return"M0,"+(.5-N)+" L1,"+(.5-N)+" M0,"+(.5+N)+" L1,"+(.5+N)},ie),"":(J={},J[1]=function(j,N){return"M"+(.5-j)+",0 L"+(.5-j)+",1 M"+(.5+j)+",0 L"+(.5+j)+",1"},J),"":(ne={},ne[1]=function(j,N){return"M.5,1 L.5,"+(.5-N)+" L1,"+(.5-N)+" M.5,"+(.5+N)+" L1,"+(.5+N)},ne),"":(re={},re[1]=function(j,N){return"M"+(.5-j)+",1 L"+(.5-j)+",.5 L1,.5 M"+(.5+j)+",.5 L"+(.5+j)+",1"},re),"":(B={},B[1]=function(j,N){return"M1,"+(.5-N)+" L"+(.5-j)+","+(.5-N)+" L"+(.5-j)+",1 M1,"+(.5+N)+" L"+(.5+j)+","+(.5+N)+" L"+(.5+j)+",1"},B),"":(he={},he[1]=function(j,N){return"M0,"+(.5-N)+" L.5,"+(.5-N)+" L.5,1 M0,"+(.5+N)+" L.5,"+(.5+N)},he),"":(le={},le[1]=function(j,N){return"M"+(.5+j)+",1 L"+(.5+j)+",.5 L0,.5 M"+(.5-j)+",.5 L"+(.5-j)+",1"},le),"":(me={},me[1]=function(j,N){return"M0,"+(.5+N)+" L"+(.5-j)+","+(.5+N)+" L"+(.5-j)+",1 M0,"+(.5-N)+" L"+(.5+j)+","+(.5-N)+" L"+(.5+j)+",1"},me),"":(U={},U[1]=function(j,N){return"M.5,0 L.5,"+(.5+N)+" L1,"+(.5+N)+" M.5,"+(.5-N)+" L1,"+(.5-N)},U),"":(xe={},xe[1]=function(j,N){return"M1,.5 L"+(.5-j)+",.5 L"+(.5-j)+",0 M"+(.5+j)+",.5 L"+(.5+j)+",0"},xe),"":(ce={},ce[1]=function(j,N){return"M1,"+(.5-N)+" L"+(.5+j)+","+(.5-N)+" L"+(.5+j)+",0 M1,"+(.5+N)+" L"+(.5-j)+","+(.5+N)+" L"+(.5-j)+",0"},ce),"":($={},$[1]=function(j,N){return"M0,"+(.5+N)+" L.5,"+(.5+N)+" L.5,0 M0,"+(.5-N)+" L.5,"+(.5-N)},$),"":(X={},X[1]=function(j,N){return"M0,.5 L"+(.5+j)+",.5 L"+(.5+j)+",0 M"+(.5-j)+",.5 L"+(.5-j)+",0"},X),"":(I={},I[1]=function(j,N){return"M0,"+(.5-N)+" L"+(.5-j)+","+(.5-N)+" L"+(.5-j)+",0 M0,"+(.5+N)+" L"+(.5+j)+","+(.5+N)+" L"+(.5+j)+",0"},I),"":(Y={},Y[1]=function(j,N){return"M.5,0 L.5,1 M.5,"+(.5-N)+" L1,"+(.5-N)+" M.5,"+(.5+N)+" L1,"+(.5+N)},Y),"":(oe={},oe[1]=function(j,N){return"M"+(.5-j)+",0 L"+(.5-j)+",1 M"+(.5+j)+",0 L"+(.5+j)+",1 M"+(.5+j)+",.5 L1,.5"},oe),"":(ae={},ae[1]=function(j,N){return"M"+(.5-j)+",0 L"+(.5-j)+",1 M1,"+(.5+N)+" L"+(.5+j)+","+(.5+N)+" L"+(.5+j)+",1 M1,"+(.5-N)+" L"+(.5+j)+","+(.5-N)+" L"+(.5+j)+",0"},ae),"":(fe={},fe[1]=function(j,N){return"M.5,0 L.5,1 M0,"+(.5-N)+" L.5,"+(.5-N)+" M0,"+(.5+N)+" L.5,"+(.5+N)},fe),"":(Se={},Se[1]=function(j,N){return"M0,.5 L"+(.5-j)+",.5 M"+(.5-j)+",0 L"+(.5-j)+",1 M"+(.5+j)+",0 L"+(.5+j)+",1"},Se),"":(Ae={},Ae[1]=function(j,N){return"M"+(.5+j)+",0 L"+(.5+j)+",1 M0,"+(.5+N)+" L"+(.5-j)+","+(.5+N)+" L"+(.5-j)+",1 M0,"+(.5-N)+" L"+(.5-j)+","+(.5-N)+" L"+(.5-j)+",0"},Ae),"":(Me={},Me[1]=function(j,N){return"M0,"+(.5-N)+" L1,"+(.5-N)+" M0,"+(.5+N)+" L1,"+(.5+N)+" M.5,"+(.5+N)+" L.5,1"},Me),"":(se={},se[1]=function(j,N){return"M0,.5 L1,.5 M"+(.5-j)+",.5 L"+(.5-j)+",1 M"+(.5+j)+",.5 L"+(.5+j)+",1"},se),"":(te={},te[1]=function(j,N){return"M0,"+(.5-N)+" L1,"+(.5-N)+" M0,"+(.5+N)+" L"+(.5-j)+","+(.5+N)+" L"+(.5-j)+",1 M1,"+(.5+N)+" L"+(.5+j)+","+(.5+N)+" L"+(.5+j)+",1"},te),"":(_e={},_e[1]=function(j,N){return"M.5,0 L.5,"+(.5-N)+" M0,"+(.5-N)+" L1,"+(.5-N)+" M0,"+(.5+N)+" L1,"+(.5+N)},_e),"":(Te={},Te[1]=function(j,N){return"M0,.5 L1,.5 M"+(.5-j)+",.5 L"+(.5-j)+",0 M"+(.5+j)+",.5 L"+(.5+j)+",0"},Te),"":(Ye={},Ye[1]=function(j,N){return"M0,"+(.5+N)+" L1,"+(.5+N)+" M0,"+(.5-N)+" L"+(.5-j)+","+(.5-N)+" L"+(.5-j)+",0 M1,"+(.5-N)+" L"+(.5+j)+","+(.5-N)+" L"+(.5+j)+",0"},Ye),"":(qr={},qr[1]=function(j,N){return"M.5,0 L.5,1 M0,"+(.5-N)+" L1,"+(.5-N)+" M0,"+(.5+N)+" L1,"+(.5+N)},qr),"":(Qr={},Qr[1]=function(j,N){return"M0,.5 L1,.5 M"+(.5-j)+",0 L"+(.5-j)+",1 M"+(.5+j)+",0 L"+(.5+j)+",1"},Qr),"":(Vr={},Vr[1]=function(j,N){return"M0,"+(.5+N)+" L"+(.5-j)+","+(.5+N)+" L"+(.5-j)+",1 M1,"+(.5+N)+" L"+(.5+j)+","+(.5+N)+" L"+(.5+j)+",1 M0,"+(.5-N)+" L"+(.5-j)+","+(.5-N)+" L"+(.5-j)+",0 M1,"+(.5-N)+" L"+(.5+j)+","+(.5-N)+" L"+(.5+j)+",0"},Vr),"":(Gr={},Gr[1]="M1,0 L0,1",Gr),"":(Zr={},Zr[1]="M0,0 L1,1",Zr),"":(Yr={},Yr[1]="M1,0 L0,1 M0,0 L1,1",Yr),"":(Si={},Si[1]="M.5,.5 L0,.5",Si[3]="M.5,.5 L1,.5",Si),"":(wi={},wi[1]="M.5,.5 L.5,0",wi[3]="M.5,.5 L.5,1",wi),"":(Ci={},Ci[1]="M.5,.5 L1,.5",Ci[3]="M.5,.5 L0,.5",Ci),"":(ki={},ki[1]="M.5,.5 L.5,1",ki[3]="M.5,.5 L.5,0",ki),"":(Ei={},Ei[1]="M.5,.5 L.5,1",Ei[3]="M.5,.5 L1,.5",Ei),"":(Li={},Li[1]="M.5,.5 L1,.5",Li[3]="M.5,.5 L.5,1",Li),"":(Ai={},Ai[1]="M.5,.5 L.5,1",Ai[3]="M.5,.5 L0,.5",Ai),"":(Mi={},Mi[1]="M.5,.5 L0,.5",Mi[3]="M.5,.5 L.5,1",Mi),"":(Ri={},Ri[1]="M.5,.5 L.5,0",Ri[3]="M.5,.5 L1,.5",Ri),"":(Ti={},Ti[1]="M.5,.5 L1,.5",Ti[3]="M.5,.5 L.5,0",Ti),"":(Fi={},Fi[1]="M.5,.5 L.5,0",Fi[3]="M.5,.5 L0,.5",Fi),"":(Di={},Di[1]="M.5,.5 L0,.5",Di[3]="M.5,.5 L.5,0",Di),"":(Bi={},Bi[1]="M.5,0 L.5,1",Bi[3]="M.5,.5 L1,.5",Bi),"":(Oi={},Oi[1]="M0.5,1 L.5,.5 L1,.5",Oi[3]="M.5,.5 L.5,0",Oi),"":(Ki={},Ki[1]="M.5,0 L.5,.5 L1,.5",Ki[3]="M.5,.5 L.5,1",Ki),"":(Pi={},Pi[1]="M.5,.5 L1,.5",Pi[3]="M.5,0 L.5,1",Pi),"":(Xi={},Xi[1]="M.5,.5 L.5,1",Xi[3]="M.5,0 L.5,.5 L1,.5",Xi),"":(Ii={},Ii[1]="M.5,.5 L.5,0",Ii[3]="M0.5,1 L.5,.5 L1,.5",Ii),"":(Hi={},Hi[1]="M.5,0 L.5,1",Hi[3]="M.5,.5 L0,.5",Hi),"":(Ui={},Ui[1]="M0,.5 L.5,.5 L.5,1",Ui[3]="M.5,.5 L.5,0",Ui),"":(ji={},ji[1]="M.5,0 L.5,.5 L0,.5",ji[3]="M.5,.5 L.5,1",ji),"":(Ni={},Ni[1]="M.5,.5 L0,.5",Ni[3]="M.5,0 L.5,1",Ni),"":(Wi={},Wi[1]="M.5,.5 L.5,1",Wi[3]="M.5,0 L.5,.5 L0,.5",Wi),"":(zi={},zi[1]="M.5,.5 L.5,0",zi[3]="M0,.5 L.5,.5 L.5,1",zi),"":(qi={},qi[1]="M0.5,1 L.5,.5 L1,.5",qi[3]="M.5,.5 L0,.5",qi),"":(Qi={},Qi[1]="M0,.5 L.5,.5 L.5,1",Qi[3]="M.5,.5 L1,.5",Qi),"":(Vi={},Vi[1]="M.5,.5 L.5,1",Vi[3]="M0,.5 L1,.5",Vi),"":(Gi={},Gi[1]="M0,.5 L1,.5",Gi[3]="M.5,.5 L.5,1",Gi),"":(Zi={},Zi[1]="M.5,.5 L1,.5",Zi[3]="M0,.5 L.5,.5 L.5,1",Zi),"":(Yi={},Yi[1]="M.5,.5 L0,.5",Yi[3]="M0.5,1 L.5,.5 L1,.5",Yi),"":(Ji={},Ji[1]="M.5,0 L.5,.5 L1,.5",Ji[3]="M.5,.5 L0,.5",Ji),"":($i={},$i[1]="M.5,0 L.5,.5 L0,.5",$i[3]="M.5,.5 L1,.5",$i),"":(er={},er[1]="M.5,.5 L.5,0",er[3]="M0,.5 L1,.5",er),"":(tr={},tr[1]="M0,.5 L1,.5",tr[3]="M.5,.5 L.5,0",tr),"":(ir={},ir[1]="M.5,.5 L1,.5",ir[3]="M.5,0 L.5,.5 L0,.5",ir),"":(rr={},rr[1]="M.5,.5 L0,.5",rr[3]="M.5,0 L.5,.5 L1,.5",rr),"":(nr={},nr[1]="M.5,0 L.5,1 M.5,.5 L1,.5",nr[3]="M.5,.5 L0,.5",nr),"":(sr={},sr[1]="M.5,0 L.5,1 M.5,.5 L0,.5",sr[3]="M.5,.5 L1,.5",sr),"":(or={},or[1]="M.5,0 L.5,1",or[3]="M0,.5 L1,.5",or),"":(ar={},ar[1]="M0,.5 L1,.5 M.5,.5 L.5,1",ar[3]="M.5,.5 L.5,0",ar),"":(cr={},cr[1]="M.5,.5 L.5,0 M0,.5 L1,.5",cr[3]="M.5,.5 L.5,1",cr),"":(lr={},lr[1]="M0,.5 L1,.5",lr[3]="M.5,0 L.5,1",lr),"":(hr={},hr[1]="M0.5,1 L.5,.5 L1,.5",hr[3]="M.5,0 L.5,.5 L0,.5",hr),"":(ur={},ur[1]="M0,.5 L.5,.5 L.5,1",ur[3]="M.5,0 L.5,.5 L1,.5",ur),"":(fr={},fr[1]="M.5,0 L.5,.5 L1,.5",fr[3]="M0,.5 L.5,.5 L.5,1",fr),"":(_r={},_r[1]="M.5,0 L.5,.5 L0,.5",_r[3]="M0.5,1 L.5,.5 L1,.5",_r),"":(dr={},dr[1]="M.5,.5 L.5,1",dr[3]="M.5,.5 L.5,0 M0,.5 L1,.5",dr),"":(pr={},pr[1]="M.5,.5 L.5,0",pr[3]="M0,.5 L1,.5 M.5,.5 L.5,1",pr),"":(vr={},vr[1]="M.5,.5 L1,.5",vr[3]="M.5,0 L.5,1 M.5,.5 L0,.5",vr),"":(gr={},gr[1]="M.5,.5 L0,.5",gr[3]="M.5,0 L.5,1 M.5,.5 L1,.5",gr),"":(Jr={},Jr[1]="M.1,.5 L.4,.5 M.6,.5 L.9,.5",Jr),"":($r={},$r[3]="M.1,.5 L.4,.5 M.6,.5 L.9,.5",$r),"":(en={},en[1]="M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5",en),"":(tn={},tn[3]="M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5",tn),"":(rn={},rn[1]="M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5",rn),"":(nn={},nn[3]="M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5",nn),"":(sn={},sn[1]="M.5,.1 L.5,.4 M.5,.6 L.5,.9",sn),"":(on={},on[3]="M.5,.1 L.5,.4 M.5,.6 L.5,.9",on),"":(an={},an[1]="M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333",an),"":(cn={},cn[3]="M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333",cn),"":(ln={},ln[1]="M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95",ln),"":(hn={},hn[3]="M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95",hn),"":(un={},un[1]="C.5,1,.5,.5,1,.5",un),"":(fn={},fn[1]="C.5,1,.5,.5,0,.5",fn),"":(_n={},_n[1]="C.5,0,.5,.5,0,.5",_n),"":(dn={},dn[1]="C.5,0,.5,.5,1,.5",dn)},e.powerlineDefinitions={"":{d:"M0,0 L1,.5 L0,1",type:0},"":{d:"M0,0 L1,.5 L0,1",type:1,horizontalPadding:.5},"":{d:"M1,0 L0,.5 L1,1",type:0},"":{d:"M1,0 L0,.5 L1,1",type:1,horizontalPadding:.5}},e.tryDrawCustomChar=function(j,N,Fe,qe,st,Ge){var Re=e.blockElementDefinitions[N];if(Re)return function(ke,Qe,Tt,Ft,xt,bt){for(var Ke=0;Ke<Qe.length;Ke++){var Pe=Qe[Ke],be=xt/8,Xe=bt/8;ke.fillRect(Tt+Pe.x*be,Ft+Pe.y*Xe,Pe.w*be,Pe.h*Xe)}}(j,Re,Fe,qe,st,Ge),!0;var Je=ha[N];if(Je)return function(ke,Qe,Tt,Ft,xt,bt){var Ke,Pe=rs.get(Qe);Pe||(Pe=new Map,rs.set(Qe,Pe));var be=ke.fillStyle;if(typeof be!="string")throw new Error('Unexpected fillStyle type "'+be+'"');var Xe=Pe.get(be);if(!Xe){var We=Qe[0].length,$e=Qe.length,at=document.createElement("canvas");at.width=We,at.height=$e;var Dt=(0,is.throwIfFalsy)(at.getContext("2d")),tt=new ImageData(We,$e),Ut=void 0,mt=void 0,dt=void 0,jt=void 0;if(be.startsWith("#"))Ut=parseInt(be.slice(1,3),16),mt=parseInt(be.slice(3,5),16),dt=parseInt(be.slice(5,7),16),jt=be.length>7&&parseInt(be.slice(7,9),16)||1;else{if(!be.startsWith("rgba"))throw new Error('Unexpected fillStyle color format "'+be+'" when drawing pattern glyph');Ut=(Ke=ts(be.substring(5,be.length-1).split(",").map(function($t){return parseFloat($t)}),4))[0],mt=Ke[1],dt=Ke[2],jt=Ke[3]}for(var ct=0;ct<$e;ct++)for(var lt=0;lt<We;lt++)tt.data[4*(ct*We+lt)]=Ut,tt.data[4*(ct*We+lt)+1]=mt,tt.data[4*(ct*We+lt)+2]=dt,tt.data[4*(ct*We+lt)+3]=Qe[ct][lt]*(255*jt);Dt.putImageData(tt,0,0),Xe=(0,is.throwIfFalsy)(ke.createPattern(at,null)),Pe.set(be,Xe)}ke.fillStyle=Xe,ke.fillRect(Tt,Ft,xt,bt)}(j,Je,Fe,qe,st,Ge),!0;var ot=e.boxDrawingDefinitions[N];if(ot)return function(ke,Qe,Tt,Ft,xt,bt){var Ke,Pe,be,Xe;ke.strokeStyle=ke.fillStyle;try{for(var We=pn(Object.entries(Qe)),$e=We.next();!$e.done;$e=We.next()){var at=ts($e.value,2),Dt=at[0],tt=at[1];ke.beginPath(),ke.lineWidth=window.devicePixelRatio*Number.parseInt(Dt);var Ut=void 0;Ut=typeof tt=="function"?tt(.15,.15/bt*xt):tt;try{for(var mt=(be=void 0,pn(Ut.split(" "))),dt=mt.next();!dt.done;dt=mt.next()){var jt=dt.value,ct=jt[0],lt=ss[ct];if(lt){var $t=jt.substring(1).split(",");$t[0]&&$t[1]&&lt(ke,os($t,xt,bt,Tt,Ft))}else console.error('Could not find drawing instructions for "'+ct+'"')}}catch(vn){be={error:vn}}finally{try{dt&&!dt.done&&(Xe=mt.return)&&Xe.call(mt)}finally{if(be)throw be.error}}ke.stroke(),ke.closePath()}}catch(vn){Ke={error:vn}}finally{try{$e&&!$e.done&&(Pe=We.return)&&Pe.call(We)}finally{if(Ke)throw Ke.error}}}(j,ot,Fe,qe,st,Ge),!0;var Jt=e.powerlineDefinitions[N];return!!Jt&&(function(ke,Qe,Tt,Ft,xt,bt){var Ke,Pe;ke.beginPath(),ke.lineWidth=window.devicePixelRatio;try{for(var be=pn(Qe.d.split(" ")),Xe=be.next();!Xe.done;Xe=be.next()){var We=Xe.value,$e=We[0],at=ss[$e];if(at){var Dt=We.substring(1).split(",");Dt[0]&&Dt[1]&&at(ke,os(Dt,xt,bt,Tt,Ft,Qe.horizontalPadding))}else console.error('Could not find drawing instructions for "'+$e+'"')}}catch(tt){Ke={error:tt}}finally{try{Xe&&!Xe.done&&(Pe=be.return)&&Pe.call(be)}finally{if(Ke)throw Ke.error}}Qe.type===1?(ke.strokeStyle=ke.fillStyle,ke.stroke()):ke.fill(),ke.closePath()}(j,Jt,Fe,qe,st,Ge),!0)};var rs=new Map;function ns(j,N,Fe){return Fe===void 0&&(Fe=0),Math.max(Math.min(j,N),Fe)}var ss={C:function(j,N){return j.bezierCurveTo(N[0],N[1],N[2],N[3],N[4],N[5])},L:function(j,N){return j.lineTo(N[0],N[1])},M:function(j,N){return j.moveTo(N[0],N[1])}};function os(j,N,Fe,qe,st,Ge){Ge===void 0&&(Ge=0);var Re=j.map(function(Jt){return parseFloat(Jt)||parseInt(Jt)});if(Re.length<2)throw new Error("Too few arguments for instruction");for(var Je=0;Je<Re.length;Je+=2)Re[Je]*=N-2*Ge*window.devicePixelRatio,Re[Je]!==0&&(Re[Je]=ns(Math.round(Re[Je]+.5)-.5,N,0)),Re[Je]+=qe+Ge*window.devicePixelRatio;for(var ot=1;ot<Re.length;ot+=2)Re[ot]*=Fe,Re[ot]!==0&&(Re[ot]=ns(Math.round(Re[ot]+.5)-.5,Fe,0)),Re[ot]+=st;return Re}},3700:(d,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GridCache=void 0;var a=function(){function u(){this.cache=[]}return u.prototype.resize=function(v,l){for(var _=0;_<v;_++){this.cache.length<=_&&this.cache.push([]);for(var S=this.cache[_].length;S<l;S++)this.cache[_].push(void 0);this.cache[_].length=l}this.cache.length=v},u.prototype.clear=function(){for(var v=0;v<this.cache.length;v++)for(var l=0;l<this.cache[v].length;l++)this.cache[v][l]=void 0},u}();e.GridCache=a},5098:function(d,e,a){var u,v=this&&this.__extends||(u=function(x,h){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var o in c)Object.prototype.hasOwnProperty.call(c,o)&&(s[o]=c[o])},u(x,h)},function(x,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");function s(){this.constructor=x}u(x,h),x.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}),l=this&&this.__decorate||function(x,h,s,c){var o,f=arguments.length,m=f<3?h:c===null?c=Object.getOwnPropertyDescriptor(h,s):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(x,h,s,c);else for(var y=x.length-1;y>=0;y--)(o=x[y])&&(m=(f<3?o(m):f>3?o(h,s,m):o(h,s))||m);return f>3&&m&&Object.defineProperty(h,s,m),m},_=this&&this.__param||function(x,h){return function(s,c){h(s,c,x)}};Object.defineProperty(e,"__esModule",{value:!0}),e.LinkRenderLayer=void 0;var S=a(1546),b=a(8803),p=a(2040),g=a(2585),w=function(x){function h(s,c,o,f,m,y,C,L,k){var E=x.call(this,s,"link",c,!0,o,f,C,L,k)||this;return m.onShowLinkUnderline(function(A){return E._onShowLinkUnderline(A)}),m.onHideLinkUnderline(function(A){return E._onHideLinkUnderline(A)}),y.onShowLinkUnderline(function(A){return E._onShowLinkUnderline(A)}),y.onHideLinkUnderline(function(A){return E._onHideLinkUnderline(A)}),E}return v(h,x),h.prototype.resize=function(s){x.prototype.resize.call(this,s),this._state=void 0},h.prototype.reset=function(){this._clearCurrentLink()},h.prototype._clearCurrentLink=function(){if(this._state){this._clearCells(this._state.x1,this._state.y1,this._state.cols-this._state.x1,1);var s=this._state.y2-this._state.y1-1;s>0&&this._clearCells(0,this._state.y1+1,this._state.cols,s),this._clearCells(0,this._state.y2,this._state.x2,1),this._state=void 0}},h.prototype._onShowLinkUnderline=function(s){if(s.fg===b.INVERTED_DEFAULT_COLOR?this._ctx.fillStyle=this._colors.background.css:s.fg&&(0,p.is256Color)(s.fg)?this._ctx.fillStyle=this._colors.ansi[s.fg].css:this._ctx.fillStyle=this._colors.foreground.css,s.y1===s.y2)this._fillBottomLineAtCells(s.x1,s.y1,s.x2-s.x1);else{this._fillBottomLineAtCells(s.x1,s.y1,s.cols-s.x1);for(var c=s.y1+1;c<s.y2;c++)this._fillBottomLineAtCells(0,c,s.cols);this._fillBottomLineAtCells(0,s.y2,s.x2)}this._state=s},h.prototype._onHideLinkUnderline=function(s){this._clearCurrentLink()},l([_(6,g.IBufferService),_(7,g.IOptionsService),_(8,g.IDecorationService)],h)}(S.BaseRenderLayer);e.LinkRenderLayer=w},3525:function(d,e,a){var u,v=this&&this.__extends||(u=function(y,C){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,k){L.__proto__=k}||function(L,k){for(var E in k)Object.prototype.hasOwnProperty.call(k,E)&&(L[E]=k[E])},u(y,C)},function(y,C){if(typeof C!="function"&&C!==null)throw new TypeError("Class extends value "+String(C)+" is not a constructor or null");function L(){this.constructor=y}u(y,C),y.prototype=C===null?Object.create(C):(L.prototype=C.prototype,new L)}),l=this&&this.__decorate||function(y,C,L,k){var E,A=arguments.length,D=A<3?C:k===null?k=Object.getOwnPropertyDescriptor(C,L):k;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")D=Reflect.decorate(y,C,L,k);else for(var M=y.length-1;M>=0;M--)(E=y[M])&&(D=(A<3?E(D):A>3?E(C,L,D):E(C,L))||D);return A>3&&D&&Object.defineProperty(C,L,D),D},_=this&&this.__param||function(y,C){return function(L,k){C(L,k,y)}},S=this&&this.__values||function(y){var C=typeof Symbol=="function"&&Symbol.iterator,L=C&&y[C],k=0;if(L)return L.call(y);if(y&&typeof y.length=="number")return{next:function(){return y&&k>=y.length&&(y=void 0),{value:y&&y[k++],done:!y}}};throw new TypeError(C?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.Renderer=void 0;var b=a(9596),p=a(4149),g=a(2512),w=a(5098),x=a(844),h=a(4725),s=a(2585),c=a(1420),o=a(8460),f=1,m=function(y){function C(L,k,E,A,D,M,F,T){var R=y.call(this)||this;R._colors=L,R._screenElement=k,R._bufferService=M,R._charSizeService=F,R._optionsService=T,R._id=f++,R._onRequestRedraw=new o.EventEmitter;var O=R._optionsService.rawOptions.allowTransparency;return R._renderLayers=[D.createInstance(b.TextRenderLayer,R._screenElement,0,R._colors,O,R._id),D.createInstance(p.SelectionRenderLayer,R._screenElement,1,R._colors,R._id),D.createInstance(w.LinkRenderLayer,R._screenElement,2,R._colors,R._id,E,A),D.createInstance(g.CursorRenderLayer,R._screenElement,3,R._colors,R._id,R._onRequestRedraw)],R.dimensions={scaledCharWidth:0,scaledCharHeight:0,scaledCellWidth:0,scaledCellHeight:0,scaledCharLeft:0,scaledCharTop:0,scaledCanvasWidth:0,scaledCanvasHeight:0,canvasWidth:0,canvasHeight:0,actualCellWidth:0,actualCellHeight:0},R._devicePixelRatio=window.devicePixelRatio,R._updateDimensions(),R.onOptionsChanged(),R}return v(C,y),Object.defineProperty(C.prototype,"onRequestRedraw",{get:function(){return this._onRequestRedraw.event},enumerable:!1,configurable:!0}),C.prototype.dispose=function(){var L,k;try{for(var E=S(this._renderLayers),A=E.next();!A.done;A=E.next())A.value.dispose()}catch(D){L={error:D}}finally{try{A&&!A.done&&(k=E.return)&&k.call(E)}finally{if(L)throw L.error}}y.prototype.dispose.call(this),(0,c.removeTerminalFromCache)(this._id)},C.prototype.onDevicePixelRatioChange=function(){this._devicePixelRatio!==window.devicePixelRatio&&(this._devicePixelRatio=window.devicePixelRatio,this.onResize(this._bufferService.cols,this._bufferService.rows))},C.prototype.setColors=function(L){var k,E;this._colors=L;try{for(var A=S(this._renderLayers),D=A.next();!D.done;D=A.next()){var M=D.value;M.setColors(this._colors),M.reset()}}catch(F){k={error:F}}finally{try{D&&!D.done&&(E=A.return)&&E.call(A)}finally{if(k)throw k.error}}},C.prototype.onResize=function(L,k){var E,A;this._updateDimensions();try{for(var D=S(this._renderLayers),M=D.next();!M.done;M=D.next())M.value.resize(this.dimensions)}catch(F){E={error:F}}finally{try{M&&!M.done&&(A=D.return)&&A.call(D)}finally{if(E)throw E.error}}this._screenElement.style.width=this.dimensions.canvasWidth+"px",this._screenElement.style.height=this.dimensions.canvasHeight+"px"},C.prototype.onCharSizeChanged=function(){this.onResize(this._bufferService.cols,this._bufferService.rows)},C.prototype.onBlur=function(){this._runOperation(function(L){return L.onBlur()})},C.prototype.onFocus=function(){this._runOperation(function(L){return L.onFocus()})},C.prototype.onSelectionChanged=function(L,k,E){E===void 0&&(E=!1),this._runOperation(function(A){return A.onSelectionChanged(L,k,E)}),this._colors.selectionForeground&&this._onRequestRedraw.fire({start:0,end:this._bufferService.rows-1})},C.prototype.onCursorMove=function(){this._runOperation(function(L){return L.onCursorMove()})},C.prototype.onOptionsChanged=function(){this._runOperation(function(L){return L.onOptionsChanged()})},C.prototype.clear=function(){this._runOperation(function(L){return L.reset()})},C.prototype._runOperation=function(L){var k,E;try{for(var A=S(this._renderLayers),D=A.next();!D.done;D=A.next())L(D.value)}catch(M){k={error:M}}finally{try{D&&!D.done&&(E=A.return)&&E.call(A)}finally{if(k)throw k.error}}},C.prototype.renderRows=function(L,k){var E,A;try{for(var D=S(this._renderLayers),M=D.next();!M.done;M=D.next())M.value.onGridChanged(L,k)}catch(F){E={error:F}}finally{try{M&&!M.done&&(A=D.return)&&A.call(D)}finally{if(E)throw E.error}}},C.prototype.clearTextureAtlas=function(){var L,k;try{for(var E=S(this._renderLayers),A=E.next();!A.done;A=E.next())A.value.clearTextureAtlas()}catch(D){L={error:D}}finally{try{A&&!A.done&&(k=E.return)&&k.call(E)}finally{if(L)throw L.error}}},C.prototype._updateDimensions=function(){this._charSizeService.hasValidSize&&(this.dimensions.scaledCharWidth=Math.floor(this._charSizeService.width*window.devicePixelRatio),this.dimensions.scaledCharHeight=Math.ceil(this._charSizeService.height*window.devicePixelRatio),this.dimensions.scaledCellHeight=Math.floor(this.dimensions.scaledCharHeight*this._optionsService.rawOptions.lineHeight),this.dimensions.scaledCharTop=this._optionsService.rawOptions.lineHeight===1?0:Math.round((this.dimensions.scaledCellHeight-this.dimensions.scaledCharHeight)/2),this.dimensions.scaledCellWidth=this.dimensions.scaledCharWidth+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.scaledCharLeft=Math.floor(this._optionsService.rawOptions.letterSpacing/2),this.dimensions.scaledCanvasHeight=this._bufferService.rows*this.dimensions.scaledCellHeight,this.dimensions.scaledCanvasWidth=this._bufferService.cols*this.dimensions.scaledCellWidth,this.dimensions.canvasHeight=Math.round(this.dimensions.scaledCanvasHeight/window.devicePixelRatio),this.dimensions.canvasWidth=Math.round(this.dimensions.scaledCanvasWidth/window.devicePixelRatio),this.dimensions.actualCellHeight=this.dimensions.canvasHeight/this._bufferService.rows,this.dimensions.actualCellWidth=this.dimensions.canvasWidth/this._bufferService.cols)},l([_(4,s.IInstantiationService),_(5,s.IBufferService),_(6,h.ICharSizeService),_(7,s.IOptionsService)],C)}(x.Disposable);e.Renderer=m},1752:(d,e)=>{function a(u){return 57508<=u&&u<=57558}Object.defineProperty(e,"__esModule",{value:!0}),e.excludeFromContrastRatioDemands=e.isPowerlineGlyph=e.throwIfFalsy=void 0,e.throwIfFalsy=function(u){if(!u)throw new Error("value must not be falsy");return u},e.isPowerlineGlyph=a,e.excludeFromContrastRatioDemands=function(u){return a(u)||function(v){return 9472<=v&&v<=9631}(u)}},4149:function(d,e,a){var u,v=this&&this.__extends||(u=function(g,w){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,h){x.__proto__=h}||function(x,h){for(var s in h)Object.prototype.hasOwnProperty.call(h,s)&&(x[s]=h[s])},u(g,w)},function(g,w){if(typeof w!="function"&&w!==null)throw new TypeError("Class extends value "+String(w)+" is not a constructor or null");function x(){this.constructor=g}u(g,w),g.prototype=w===null?Object.create(w):(x.prototype=w.prototype,new x)}),l=this&&this.__decorate||function(g,w,x,h){var s,c=arguments.length,o=c<3?w:h===null?h=Object.getOwnPropertyDescriptor(w,x):h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(g,w,x,h);else for(var f=g.length-1;f>=0;f--)(s=g[f])&&(o=(c<3?s(o):c>3?s(w,x,o):s(w,x))||o);return c>3&&o&&Object.defineProperty(w,x,o),o},_=this&&this.__param||function(g,w){return function(x,h){w(x,h,g)}};Object.defineProperty(e,"__esModule",{value:!0}),e.SelectionRenderLayer=void 0;var S=a(1546),b=a(2585),p=function(g){function w(x,h,s,c,o,f,m){var y=g.call(this,x,"selection",h,!0,s,c,o,f,m)||this;return y._clearState(),y}return v(w,g),w.prototype._clearState=function(){this._state={start:void 0,end:void 0,columnSelectMode:void 0,ydisp:void 0}},w.prototype.resize=function(x){g.prototype.resize.call(this,x),this._clearState()},w.prototype.reset=function(){this._state.start&&this._state.end&&(this._clearState(),this._clearAll())},w.prototype.onSelectionChanged=function(x,h,s){if(g.prototype.onSelectionChanged.call(this,x,h,s),this._didStateChange(x,h,s,this._bufferService.buffer.ydisp))if(this._clearAll(),x&&h){var c=x[1]-this._bufferService.buffer.ydisp,o=h[1]-this._bufferService.buffer.ydisp,f=Math.max(c,0),m=Math.min(o,this._bufferService.rows-1);if(f>=this._bufferService.rows||m<0)this._state.ydisp=this._bufferService.buffer.ydisp;else{if(this._ctx.fillStyle=this._colors.selectionTransparent.css,s){var y=x[0],C=h[0]-y,L=m-f+1;this._fillCells(y,f,C,L)}else{y=c===f?x[0]:0;var k=f===o?h[0]:this._bufferService.cols;this._fillCells(y,f,k-y,1);var E=Math.max(m-f-1,0);if(this._fillCells(0,f+1,this._bufferService.cols,E),f!==m){var A=o===m?h[0]:this._bufferService.cols;this._fillCells(0,m,A,1)}}this._state.start=[x[0],x[1]],this._state.end=[h[0],h[1]],this._state.columnSelectMode=s,this._state.ydisp=this._bufferService.buffer.ydisp}}else this._clearState()},w.prototype._didStateChange=function(x,h,s,c){return!this._areCoordinatesEqual(x,this._state.start)||!this._areCoordinatesEqual(h,this._state.end)||s!==this._state.columnSelectMode||c!==this._state.ydisp},w.prototype._areCoordinatesEqual=function(x,h){return!(!x||!h)&&x[0]===h[0]&&x[1]===h[1]},l([_(4,b.IBufferService),_(5,b.IOptionsService),_(6,b.IDecorationService)],w)}(S.BaseRenderLayer);e.SelectionRenderLayer=p},9596:function(d,e,a){var u,v=this&&this.__extends||(u=function(f,m){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,C){y.__proto__=C}||function(y,C){for(var L in C)Object.prototype.hasOwnProperty.call(C,L)&&(y[L]=C[L])},u(f,m)},function(f,m){if(typeof m!="function"&&m!==null)throw new TypeError("Class extends value "+String(m)+" is not a constructor or null");function y(){this.constructor=f}u(f,m),f.prototype=m===null?Object.create(m):(y.prototype=m.prototype,new y)}),l=this&&this.__decorate||function(f,m,y,C){var L,k=arguments.length,E=k<3?m:C===null?C=Object.getOwnPropertyDescriptor(m,y):C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(f,m,y,C);else for(var A=f.length-1;A>=0;A--)(L=f[A])&&(E=(k<3?L(E):k>3?L(m,y,E):L(m,y))||E);return k>3&&E&&Object.defineProperty(m,y,E),E},_=this&&this.__param||function(f,m){return function(y,C){m(y,C,f)}},S=this&&this.__values||function(f){var m=typeof Symbol=="function"&&Symbol.iterator,y=m&&f[m],C=0;if(y)return y.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&C>=f.length&&(f=void 0),{value:f&&f[C++],done:!f}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.TextRenderLayer=void 0;var b=a(3700),p=a(1546),g=a(3734),w=a(643),x=a(511),h=a(2585),s=a(4725),c=a(4269),o=function(f){function m(y,C,L,k,E,A,D,M,F){var T=f.call(this,y,"text",C,k,L,E,A,D,F)||this;return T._characterJoinerService=M,T._characterWidth=0,T._characterFont="",T._characterOverlapCache={},T._workCell=new x.CellData,T._state=new b.GridCache,T}return v(m,f),m.prototype.resize=function(y){f.prototype.resize.call(this,y);var C=this._getFont(!1,!1);this._characterWidth===y.scaledCharWidth&&this._characterFont===C||(this._characterWidth=y.scaledCharWidth,this._characterFont=C,this._characterOverlapCache={}),this._state.clear(),this._state.resize(this._bufferService.cols,this._bufferService.rows)},m.prototype.reset=function(){this._state.clear(),this._clearAll()},m.prototype._forEachCell=function(y,C,L){for(var k=y;k<=C;k++)for(var E=k+this._bufferService.buffer.ydisp,A=this._bufferService.buffer.lines.get(E),D=this._characterJoinerService.getJoinedCharacters(E),M=0;M<this._bufferService.cols;M++){A.loadCell(M,this._workCell);var F=this._workCell,T=!1,R=M;if(F.getWidth()!==0){if(D.length>0&&M===D[0][0]){T=!0;var O=D.shift();F=new c.JoinedCellData(this._workCell,A.translateToString(!0,O[0],O[1]),O[1]-O[0]),R=O[1]-1}!T&&this._isOverlapping(F)&&R<A.length-1&&A.getCodePoint(R+1)===w.NULL_CELL_CODE&&(F.content&=-12582913,F.content|=2<<22),L(F,M,k),M=R}}},m.prototype._drawBackground=function(y,C){var L=this,k=this._ctx,E=this._bufferService.cols,A=0,D=0,M=null;k.save(),this._forEachCell(y,C,function(F,T,R){var O,H,ee=null;F.isInverse()?ee=F.isFgDefault()?L._colors.foreground.css:F.isFgRGB()?"rgb("+g.AttributeData.toColorRGB(F.getFgColor()).join(",")+")":L._colors.ansi[F.getFgColor()].css:F.isBgRGB()?ee="rgb("+g.AttributeData.toColorRGB(F.getBgColor()).join(",")+")":F.isBgPalette()&&(ee=L._colors.ansi[F.getBgColor()].css);var ie=!1;try{for(var J=S(L._decorationService.getDecorationsAtCell(T,L._bufferService.buffer.ydisp+R)),ne=J.next();!ne.done;ne=J.next()){var re=ne.value;re.options.layer!=="top"&&ie||(re.backgroundColorRGB&&(ee=re.backgroundColorRGB.css),ie=re.options.layer==="top")}}catch(B){O={error:B}}finally{try{ne&&!ne.done&&(H=J.return)&&H.call(J)}finally{if(O)throw O.error}}M===null&&(A=T,D=R),R!==D?(k.fillStyle=M||"",L._fillCells(A,D,E-A,1),A=T,D=R):M!==ee&&(k.fillStyle=M||"",L._fillCells(A,D,T-A,1),A=T,D=R),M=ee}),M!==null&&(k.fillStyle=M,this._fillCells(A,D,E-A,1)),k.restore()},m.prototype._drawForeground=function(y,C){var L=this;this._forEachCell(y,C,function(k,E,A){if(!k.isInvisible()&&(L._drawChars(k,E,A),k.isUnderline()||k.isStrikethrough())){if(L._ctx.save(),k.isInverse())if(k.isBgDefault())L._ctx.fillStyle=L._colors.background.css;else if(k.isBgRGB())L._ctx.fillStyle="rgb("+g.AttributeData.toColorRGB(k.getBgColor()).join(",")+")";else{var D=k.getBgColor();L._optionsService.rawOptions.drawBoldTextInBrightColors&&k.isBold()&&D<8&&(D+=8),L._ctx.fillStyle=L._colors.ansi[D].css}else if(k.isFgDefault())L._ctx.fillStyle=L._colors.foreground.css;else if(k.isFgRGB())L._ctx.fillStyle="rgb("+g.AttributeData.toColorRGB(k.getFgColor()).join(",")+")";else{var M=k.getFgColor();L._optionsService.rawOptions.drawBoldTextInBrightColors&&k.isBold()&&M<8&&(M+=8),L._ctx.fillStyle=L._colors.ansi[M].css}k.isStrikethrough()&&L._fillMiddleLineAtCells(E,A,k.getWidth()),k.isUnderline()&&L._fillBottomLineAtCells(E,A,k.getWidth()),L._ctx.restore()}})},m.prototype.onGridChanged=function(y,C){this._state.cache.length!==0&&(this._charAtlas&&this._charAtlas.beginFrame(),this._clearCells(0,y,this._bufferService.cols,C-y+1),this._drawBackground(y,C),this._drawForeground(y,C))},m.prototype.onOptionsChanged=function(){this._setTransparency(this._optionsService.rawOptions.allowTransparency)},m.prototype._isOverlapping=function(y){if(y.getWidth()!==1||y.getCode()<256)return!1;var C=y.getChars();if(this._characterOverlapCache.hasOwnProperty(C))return this._characterOverlapCache[C];this._ctx.save(),this._ctx.font=this._characterFont;var L=Math.floor(this._ctx.measureText(C).width)>this._characterWidth;return this._ctx.restore(),this._characterOverlapCache[C]=L,L},l([_(5,h.IBufferService),_(6,h.IOptionsService),_(7,s.ICharacterJoinerService),_(8,h.IDecorationService)],m)}(p.BaseRenderLayer);e.TextRenderLayer=o},9616:(d,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BaseCharAtlas=void 0;var a=function(){function u(){this._didWarmUp=!1}return u.prototype.dispose=function(){},u.prototype.warmUp=function(){this._didWarmUp||(this._doWarmUp(),this._didWarmUp=!0)},u.prototype._doWarmUp=function(){},u.prototype.clear=function(){},u.prototype.beginFrame=function(){},u}();e.BaseCharAtlas=a},1420:(d,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.removeTerminalFromCache=e.acquireCharAtlas=void 0;var u=a(2040),v=a(1906),l=[];e.acquireCharAtlas=function(_,S,b,p,g){for(var w=(0,u.generateConfig)(p,g,_,b),x=0;x<l.length;x++){var h=(s=l[x]).ownedBy.indexOf(S);if(h>=0){if((0,u.configEquals)(s.config,w))return s.atlas;s.ownedBy.length===1?(s.atlas.dispose(),l.splice(x,1)):s.ownedBy.splice(h,1);break}}for(x=0;x<l.length;x++){var s=l[x];if((0,u.configEquals)(s.config,w))return s.ownedBy.push(S),s.atlas}var c={atlas:new v.DynamicCharAtlas(document,w),config:w,ownedBy:[S]};return l.push(c),c.atlas},e.removeTerminalFromCache=function(_){for(var S=0;S<l.length;S++){var b=l[S].ownedBy.indexOf(_);if(b!==-1){l[S].ownedBy.length===1?(l[S].atlas.dispose(),l.splice(S,1)):l[S].ownedBy.splice(b,1);break}}}},2040:(d,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.is256Color=e.configEquals=e.generateConfig=void 0;var u=a(643);e.generateConfig=function(v,l,_,S){var b={foreground:S.foreground,background:S.background,cursor:void 0,cursorAccent:void 0,selection:void 0,ansi:S.ansi.slice()};return{devicePixelRatio:window.devicePixelRatio,scaledCharWidth:v,scaledCharHeight:l,fontFamily:_.fontFamily,fontSize:_.fontSize,fontWeight:_.fontWeight,fontWeightBold:_.fontWeightBold,allowTransparency:_.allowTransparency,colors:b}},e.configEquals=function(v,l){for(var _=0;_<v.colors.ansi.length;_++)if(v.colors.ansi[_].rgba!==l.colors.ansi[_].rgba)return!1;return v.devicePixelRatio===l.devicePixelRatio&&v.fontFamily===l.fontFamily&&v.fontSize===l.fontSize&&v.fontWeight===l.fontWeight&&v.fontWeightBold===l.fontWeightBold&&v.allowTransparency===l.allowTransparency&&v.scaledCharWidth===l.scaledCharWidth&&v.scaledCharHeight===l.scaledCharHeight&&v.colors.foreground===l.colors.foreground&&v.colors.background===l.colors.background},e.is256Color=function(v){return v<u.DEFAULT_COLOR}},8803:(d,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CHAR_ATLAS_CELL_SPACING=e.TEXT_BASELINE=e.DIM_OPACITY=e.INVERTED_DEFAULT_COLOR=void 0;var u=a(6114);e.INVERTED_DEFAULT_COLOR=257,e.DIM_OPACITY=.5,e.TEXT_BASELINE=u.isFirefox||u.isLegacyEdge?"bottom":"ideographic",e.CHAR_ATLAS_CELL_SPACING=1},1906:function(d,e,a){var u,v=this&&this.__extends||(u=function(y,C){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,k){L.__proto__=k}||function(L,k){for(var E in k)Object.prototype.hasOwnProperty.call(k,E)&&(L[E]=k[E])},u(y,C)},function(y,C){if(typeof C!="function"&&C!==null)throw new TypeError("Class extends value "+String(C)+" is not a constructor or null");function L(){this.constructor=y}u(y,C),y.prototype=C===null?Object.create(C):(L.prototype=C.prototype,new L)});Object.defineProperty(e,"__esModule",{value:!0}),e.NoneCharAtlas=e.DynamicCharAtlas=e.getGlyphCacheKey=void 0;var l=a(8803),_=a(9616),S=a(5680),b=a(7001),p=a(6114),g=a(1752),w=a(8055),x=1024,h=1024,s={css:"rgba(0, 0, 0, 0)",rgba:0};function c(y){return y.code<<21|y.bg<<12|y.fg<<3|(y.bold?0:4)+(y.dim?0:2)+(y.italic?0:1)}e.getGlyphCacheKey=c;var o=function(y){function C(L,k){var E=y.call(this)||this;E._config=k,E._drawToCacheCount=0,E._glyphsWaitingOnBitmap=[],E._bitmapCommitTimeout=null,E._bitmap=null,E._cacheCanvas=L.createElement("canvas"),E._cacheCanvas.width=x,E._cacheCanvas.height=h,E._cacheCtx=(0,g.throwIfFalsy)(E._cacheCanvas.getContext("2d",{alpha:!0}));var A=L.createElement("canvas");A.width=E._config.scaledCharWidth,A.height=E._config.scaledCharHeight,E._tmpCtx=(0,g.throwIfFalsy)(A.getContext("2d",{alpha:E._config.allowTransparency})),E._width=Math.floor(x/E._config.scaledCharWidth),E._height=Math.floor(h/E._config.scaledCharHeight);var D=E._width*E._height;return E._cacheMap=new b.LRUMap(D),E._cacheMap.prealloc(D),E}return v(C,y),C.prototype.dispose=function(){this._bitmapCommitTimeout!==null&&(window.clearTimeout(this._bitmapCommitTimeout),this._bitmapCommitTimeout=null)},C.prototype.beginFrame=function(){this._drawToCacheCount=0},C.prototype.clear=function(){if(this._cacheMap.size>0){var L=this._width*this._height;this._cacheMap=new b.LRUMap(L),this._cacheMap.prealloc(L)}this._cacheCtx.clearRect(0,0,x,h),this._tmpCtx.clearRect(0,0,this._config.scaledCharWidth,this._config.scaledCharHeight)},C.prototype.draw=function(L,k,E,A){if(k.code===32)return!0;if(!this._canCache(k))return!1;var D=c(k),M=this._cacheMap.get(D);if(M!=null)return this._drawFromCache(L,M,E,A),!0;if(this._drawToCacheCount<100){var F;F=this._cacheMap.size<this._cacheMap.capacity?this._cacheMap.size:this._cacheMap.peek().index;var T=this._drawToCache(k,F);return this._cacheMap.set(D,T),this._drawFromCache(L,T,E,A),!0}return!1},C.prototype._canCache=function(L){return L.code<256},C.prototype._toCoordinateX=function(L){return L%this._width*this._config.scaledCharWidth},C.prototype._toCoordinateY=function(L){return Math.floor(L/this._width)*this._config.scaledCharHeight},C.prototype._drawFromCache=function(L,k,E,A){if(!k.isEmpty){var D=this._toCoordinateX(k.index),M=this._toCoordinateY(k.index);L.drawImage(k.inBitmap?this._bitmap:this._cacheCanvas,D,M,this._config.scaledCharWidth,this._config.scaledCharHeight,E,A,this._config.scaledCharWidth,this._config.scaledCharHeight)}},C.prototype._getColorFromAnsiIndex=function(L){return L<this._config.colors.ansi.length?this._config.colors.ansi[L]:S.DEFAULT_ANSI_COLORS[L]},C.prototype._getBackgroundColor=function(L){return this._config.allowTransparency?s:L.bg===l.INVERTED_DEFAULT_COLOR?this._config.colors.foreground:L.bg<256?this._getColorFromAnsiIndex(L.bg):this._config.colors.background},C.prototype._getForegroundColor=function(L){return L.fg===l.INVERTED_DEFAULT_COLOR?w.color.opaque(this._config.colors.background):L.fg<256?this._getColorFromAnsiIndex(L.fg):this._config.colors.foreground},C.prototype._drawToCache=function(L,k){this._drawToCacheCount++,this._tmpCtx.save();var E=this._getBackgroundColor(L);this._tmpCtx.globalCompositeOperation="copy",this._tmpCtx.fillStyle=E.css,this._tmpCtx.fillRect(0,0,this._config.scaledCharWidth,this._config.scaledCharHeight),this._tmpCtx.globalCompositeOperation="source-over";var A=L.bold?this._config.fontWeightBold:this._config.fontWeight,D=L.italic?"italic":"";this._tmpCtx.font=D+" "+A+" "+this._config.fontSize*this._config.devicePixelRatio+"px "+this._config.fontFamily,this._tmpCtx.textBaseline=l.TEXT_BASELINE,this._tmpCtx.fillStyle=this._getForegroundColor(L).css,L.dim&&(this._tmpCtx.globalAlpha=l.DIM_OPACITY),this._tmpCtx.fillText(L.chars,0,this._config.scaledCharHeight);var M=this._tmpCtx.getImageData(0,0,this._config.scaledCharWidth,this._config.scaledCharHeight),F=!1;if(this._config.allowTransparency||(F=m(M,E)),F&&L.chars==="_"&&!this._config.allowTransparency)for(var T=1;T<=5&&(this._tmpCtx.fillText(L.chars,0,this._config.scaledCharHeight-T),F=m(M=this._tmpCtx.getImageData(0,0,this._config.scaledCharWidth,this._config.scaledCharHeight),E));T++);this._tmpCtx.restore();var R=this._toCoordinateX(k),O=this._toCoordinateY(k);this._cacheCtx.putImageData(M,R,O);var H={index:k,isEmpty:F,inBitmap:!1};return this._addGlyphToBitmap(H),H},C.prototype._addGlyphToBitmap=function(L){var k=this;!("createImageBitmap"in window)||p.isFirefox||p.isSafari||(this._glyphsWaitingOnBitmap.push(L),this._bitmapCommitTimeout===null&&(this._bitmapCommitTimeout=window.setTimeout(function(){return k._generateBitmap()},100)))},C.prototype._generateBitmap=function(){var L=this,k=this._glyphsWaitingOnBitmap;this._glyphsWaitingOnBitmap=[],window.createImageBitmap(this._cacheCanvas).then(function(E){L._bitmap=E;for(var A=0;A<k.length;A++)k[A].inBitmap=!0}),this._bitmapCommitTimeout=null},C}(_.BaseCharAtlas);e.DynamicCharAtlas=o;var f=function(y){function C(L,k){return y.call(this)||this}return v(C,y),C.prototype.draw=function(L,k,E,A){return!1},C}(_.BaseCharAtlas);function m(y,C){for(var L=!0,k=C.rgba>>>24,E=C.rgba>>>16&255,A=C.rgba>>>8&255,D=0;D<y.data.length;D+=4)y.data[D]===k&&y.data[D+1]===E&&y.data[D+2]===A?y.data[D+3]=0:L=!1;return L}e.NoneCharAtlas=f},7001:(d,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.LRUMap=void 0;var a=function(){function u(v){this.capacity=v,this._map={},this._head=null,this._tail=null,this._nodePool=[],this.size=0}return u.prototype._unlinkNode=function(v){var l=v.prev,_=v.next;v===this._head&&(this._head=_),v===this._tail&&(this._tail=l),l!==null&&(l.next=_),_!==null&&(_.prev=l)},u.prototype._appendNode=function(v){var l=this._tail;l!==null&&(l.next=v),v.prev=l,v.next=null,this._tail=v,this._head===null&&(this._head=v)},u.prototype.prealloc=function(v){for(var l=this._nodePool,_=0;_<v;_++)l.push({prev:null,next:null,key:null,value:null})},u.prototype.get=function(v){var l=this._map[v];return l!==void 0?(this._unlinkNode(l),this._appendNode(l),l.value):null},u.prototype.peekValue=function(v){var l=this._map[v];return l!==void 0?l.value:null},u.prototype.peek=function(){var v=this._head;return v===null?null:v.value},u.prototype.set=function(v,l){var _=this._map[v];if(_!==void 0)_=this._map[v],this._unlinkNode(_),_.value=l;else if(this.size>=this.capacity)_=this._head,this._unlinkNode(_),delete this._map[_.key],_.key=v,_.value=l,this._map[v]=_;else{var S=this._nodePool;S.length>0?((_=S.pop()).key=v,_.value=l):_={prev:null,next:null,key:v,value:l},this._map[v]=_,this.size++}this._appendNode(_)},u}();e.LRUMap=a},1296:function(d,e,a){var u,v=this&&this.__extends||(u=function(k,E){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,D){A.__proto__=D}||function(A,D){for(var M in D)Object.prototype.hasOwnProperty.call(D,M)&&(A[M]=D[M])},u(k,E)},function(k,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");function A(){this.constructor=k}u(k,E),k.prototype=E===null?Object.create(E):(A.prototype=E.prototype,new A)}),l=this&&this.__decorate||function(k,E,A,D){var M,F=arguments.length,T=F<3?E:D===null?D=Object.getOwnPropertyDescriptor(E,A):D;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")T=Reflect.decorate(k,E,A,D);else for(var R=k.length-1;R>=0;R--)(M=k[R])&&(T=(F<3?M(T):F>3?M(E,A,T):M(E,A))||T);return F>3&&T&&Object.defineProperty(E,A,T),T},_=this&&this.__param||function(k,E){return function(A,D){E(A,D,k)}},S=this&&this.__values||function(k){var E=typeof Symbol=="function"&&Symbol.iterator,A=E&&k[E],D=0;if(A)return A.call(k);if(k&&typeof k.length=="number")return{next:function(){return k&&D>=k.length&&(k=void 0),{value:k&&k[D++],done:!k}}};throw new TypeError(E?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.DomRenderer=void 0;var b=a(3787),p=a(8803),g=a(844),w=a(4725),x=a(2585),h=a(8460),s=a(8055),c=a(9631),o="xterm-dom-renderer-owner-",f="xterm-fg-",m="xterm-bg-",y="xterm-focus",C=1,L=function(k){function E(A,D,M,F,T,R,O,H,ee,ie){var J=k.call(this)||this;return J._colors=A,J._element=D,J._screenElement=M,J._viewportElement=F,J._linkifier=T,J._linkifier2=R,J._charSizeService=H,J._optionsService=ee,J._bufferService=ie,J._terminalClass=C++,J._rowElements=[],J._rowContainer=document.createElement("div"),J._rowContainer.classList.add("xterm-rows"),J._rowContainer.style.lineHeight="normal",J._rowContainer.setAttribute("aria-hidden","true"),J._refreshRowElements(J._bufferService.cols,J._bufferService.rows),J._selectionContainer=document.createElement("div"),J._selectionContainer.classList.add("xterm-selection"),J._selectionContainer.setAttribute("aria-hidden","true"),J.dimensions={scaledCharWidth:0,scaledCharHeight:0,scaledCellWidth:0,scaledCellHeight:0,scaledCharLeft:0,scaledCharTop:0,scaledCanvasWidth:0,scaledCanvasHeight:0,canvasWidth:0,canvasHeight:0,actualCellWidth:0,actualCellHeight:0},J._updateDimensions(),J._injectCss(),J._rowFactory=O.createInstance(b.DomRendererRowFactory,document,J._colors),J._element.classList.add(o+J._terminalClass),J._screenElement.appendChild(J._rowContainer),J._screenElement.appendChild(J._selectionContainer),J.register(J._linkifier.onShowLinkUnderline(function(ne){return J._onLinkHover(ne)})),J.register(J._linkifier.onHideLinkUnderline(function(ne){return J._onLinkLeave(ne)})),J.register(J._linkifier2.onShowLinkUnderline(function(ne){return J._onLinkHover(ne)})),J.register(J._linkifier2.onHideLinkUnderline(function(ne){return J._onLinkLeave(ne)})),J}return v(E,k),Object.defineProperty(E.prototype,"onRequestRedraw",{get:function(){return new h.EventEmitter().event},enumerable:!1,configurable:!0}),E.prototype.dispose=function(){this._element.classList.remove(o+this._terminalClass),(0,c.removeElementFromParent)(this._rowContainer,this._selectionContainer,this._themeStyleElement,this._dimensionsStyleElement),k.prototype.dispose.call(this)},E.prototype._updateDimensions=function(){var A,D;this.dimensions.scaledCharWidth=this._charSizeService.width*window.devicePixelRatio,this.dimensions.scaledCharHeight=Math.ceil(this._charSizeService.height*window.devicePixelRatio),this.dimensions.scaledCellWidth=this.dimensions.scaledCharWidth+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.scaledCellHeight=Math.floor(this.dimensions.scaledCharHeight*this._optionsService.rawOptions.lineHeight),this.dimensions.scaledCharLeft=0,this.dimensions.scaledCharTop=0,this.dimensions.scaledCanvasWidth=this.dimensions.scaledCellWidth*this._bufferService.cols,this.dimensions.scaledCanvasHeight=this.dimensions.scaledCellHeight*this._bufferService.rows,this.dimensions.canvasWidth=Math.round(this.dimensions.scaledCanvasWidth/window.devicePixelRatio),this.dimensions.canvasHeight=Math.round(this.dimensions.scaledCanvasHeight/window.devicePixelRatio),this.dimensions.actualCellWidth=this.dimensions.canvasWidth/this._bufferService.cols,this.dimensions.actualCellHeight=this.dimensions.canvasHeight/this._bufferService.rows;try{for(var M=S(this._rowElements),F=M.next();!F.done;F=M.next()){var T=F.value;T.style.width=this.dimensions.canvasWidth+"px",T.style.height=this.dimensions.actualCellHeight+"px",T.style.lineHeight=this.dimensions.actualCellHeight+"px",T.style.overflow="hidden"}}catch(O){A={error:O}}finally{try{F&&!F.done&&(D=M.return)&&D.call(M)}finally{if(A)throw A.error}}this._dimensionsStyleElement||(this._dimensionsStyleElement=document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));var R=this._terminalSelector+" .xterm-rows span { display: inline-block; height: 100%; vertical-align: top; width: "+this.dimensions.actualCellWidth+"px}";this._dimensionsStyleElement.textContent=R,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=this.dimensions.canvasWidth+"px",this._screenElement.style.height=this.dimensions.canvasHeight+"px"},E.prototype.setColors=function(A){this._colors=A,this._injectCss()},E.prototype._injectCss=function(){var A=this;this._themeStyleElement||(this._themeStyleElement=document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));var D=this._terminalSelector+" .xterm-rows { color: "+this._colors.foreground.css+"; font-family: "+this._optionsService.rawOptions.fontFamily+"; font-size: "+this._optionsService.rawOptions.fontSize+"px;}";D+=this._terminalSelector+" span:not(."+b.BOLD_CLASS+") { font-weight: "+this._optionsService.rawOptions.fontWeight+";}"+this._terminalSelector+" span."+b.BOLD_CLASS+" { font-weight: "+this._optionsService.rawOptions.fontWeightBold+";}"+this._terminalSelector+" span."+b.ITALIC_CLASS+" { font-style: italic;}",D+="@keyframes blink_box_shadow_"+this._terminalClass+" { 50% {  box-shadow: none; }}",D+="@keyframes blink_block_"+this._terminalClass+" { 0% {  background-color: "+this._colors.cursor.css+";  color: "+this._colors.cursorAccent.css+"; } 50% {  background-color: "+this._colors.cursorAccent.css+";  color: "+this._colors.cursor.css+"; }}",D+=this._terminalSelector+" .xterm-rows:not(.xterm-focus) ."+b.CURSOR_CLASS+"."+b.CURSOR_STYLE_BLOCK_CLASS+" { outline: 1px solid "+this._colors.cursor.css+"; outline-offset: -1px;}"+this._terminalSelector+" .xterm-rows.xterm-focus ."+b.CURSOR_CLASS+"."+b.CURSOR_BLINK_CLASS+":not(."+b.CURSOR_STYLE_BLOCK_CLASS+") { animation: blink_box_shadow_"+this._terminalClass+" 1s step-end infinite;}"+this._terminalSelector+" .xterm-rows.xterm-focus ."+b.CURSOR_CLASS+"."+b.CURSOR_BLINK_CLASS+"."+b.CURSOR_STYLE_BLOCK_CLASS+" { animation: blink_block_"+this._terminalClass+" 1s step-end infinite;}"+this._terminalSelector+" .xterm-rows.xterm-focus ."+b.CURSOR_CLASS+"."+b.CURSOR_STYLE_BLOCK_CLASS+" { background-color: "+this._colors.cursor.css+"; color: "+this._colors.cursorAccent.css+";}"+this._terminalSelector+" .xterm-rows ."+b.CURSOR_CLASS+"."+b.CURSOR_STYLE_BAR_CLASS+" { box-shadow: "+this._optionsService.rawOptions.cursorWidth+"px 0 0 "+this._colors.cursor.css+" inset;}"+this._terminalSelector+" .xterm-rows ."+b.CURSOR_CLASS+"."+b.CURSOR_STYLE_UNDERLINE_CLASS+" { box-shadow: 0 -1px 0 "+this._colors.cursor.css+" inset;}",D+=this._terminalSelector+" .xterm-selection { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}"+this._terminalSelector+" .xterm-selection div { position: absolute; background-color: "+this._colors.selectionOpaque.css+";}",this._colors.ansi.forEach(function(M,F){D+=A._terminalSelector+" ."+f+F+" { color: "+M.css+"; }"+A._terminalSelector+" ."+m+F+" { background-color: "+M.css+"; }"}),D+=this._terminalSelector+" ."+f+p.INVERTED_DEFAULT_COLOR+" { color: "+s.color.opaque(this._colors.background).css+"; }"+this._terminalSelector+" ."+m+p.INVERTED_DEFAULT_COLOR+" { background-color: "+this._colors.foreground.css+"; }",this._themeStyleElement.textContent=D},E.prototype.onDevicePixelRatioChange=function(){this._updateDimensions()},E.prototype._refreshRowElements=function(A,D){for(var M=this._rowElements.length;M<=D;M++){var F=document.createElement("div");this._rowContainer.appendChild(F),this._rowElements.push(F)}for(;this._rowElements.length>D;)this._rowContainer.removeChild(this._rowElements.pop())},E.prototype.onResize=function(A,D){this._refreshRowElements(A,D),this._updateDimensions()},E.prototype.onCharSizeChanged=function(){this._updateDimensions()},E.prototype.onBlur=function(){this._rowContainer.classList.remove(y)},E.prototype.onFocus=function(){this._rowContainer.classList.add(y)},E.prototype.onSelectionChanged=function(A,D,M){for(;this._selectionContainer.children.length;)this._selectionContainer.removeChild(this._selectionContainer.children[0]);if(this._rowFactory.onSelectionChanged(A,D,M),this.renderRows(0,this._bufferService.rows-1),A&&D){var F=A[1]-this._bufferService.buffer.ydisp,T=D[1]-this._bufferService.buffer.ydisp,R=Math.max(F,0),O=Math.min(T,this._bufferService.rows-1);if(!(R>=this._bufferService.rows||O<0)){var H=document.createDocumentFragment();if(M){var ee=A[0]>D[0];H.appendChild(this._createSelectionElement(R,ee?D[0]:A[0],ee?A[0]:D[0],O-R+1))}else{var ie=F===R?A[0]:0,J=R===T?D[0]:this._bufferService.cols;H.appendChild(this._createSelectionElement(R,ie,J));var ne=O-R-1;if(H.appendChild(this._createSelectionElement(R+1,0,this._bufferService.cols,ne)),R!==O){var re=T===O?D[0]:this._bufferService.cols;H.appendChild(this._createSelectionElement(O,0,re))}}this._selectionContainer.appendChild(H)}}},E.prototype._createSelectionElement=function(A,D,M,F){F===void 0&&(F=1);var T=document.createElement("div");return T.style.height=F*this.dimensions.actualCellHeight+"px",T.style.top=A*this.dimensions.actualCellHeight+"px",T.style.left=D*this.dimensions.actualCellWidth+"px",T.style.width=this.dimensions.actualCellWidth*(M-D)+"px",T},E.prototype.onCursorMove=function(){},E.prototype.onOptionsChanged=function(){this._updateDimensions(),this._injectCss()},E.prototype.clear=function(){var A,D;try{for(var M=S(this._rowElements),F=M.next();!F.done;F=M.next())F.value.innerText=""}catch(T){A={error:T}}finally{try{F&&!F.done&&(D=M.return)&&D.call(M)}finally{if(A)throw A.error}}},E.prototype.renderRows=function(A,D){for(var M=this._bufferService.buffer.ybase+this._bufferService.buffer.y,F=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),T=this._optionsService.rawOptions.cursorBlink,R=A;R<=D;R++){var O=this._rowElements[R];O.innerText="";var H=R+this._bufferService.buffer.ydisp,ee=this._bufferService.buffer.lines.get(H),ie=this._optionsService.rawOptions.cursorStyle;O.appendChild(this._rowFactory.createRow(ee,H,H===M,ie,F,T,this.dimensions.actualCellWidth,this._bufferService.cols))}},Object.defineProperty(E.prototype,"_terminalSelector",{get:function(){return"."+o+this._terminalClass},enumerable:!1,configurable:!0}),E.prototype._onLinkHover=function(A){this._setCellUnderline(A.x1,A.x2,A.y1,A.y2,A.cols,!0)},E.prototype._onLinkLeave=function(A){this._setCellUnderline(A.x1,A.x2,A.y1,A.y2,A.cols,!1)},E.prototype._setCellUnderline=function(A,D,M,F,T,R){for(;A!==D||M!==F;){var O=this._rowElements[M];if(!O)return;var H=O.children[A];H&&(H.style.textDecoration=R?"underline":"none"),++A>=T&&(A=0,M++)}},l([_(6,x.IInstantiationService),_(7,w.ICharSizeService),_(8,x.IOptionsService),_(9,x.IBufferService)],E)}(g.Disposable);e.DomRenderer=L},3787:function(d,e,a){var u=this&&this.__decorate||function(o,f,m,y){var C,L=arguments.length,k=L<3?f:y===null?y=Object.getOwnPropertyDescriptor(f,m):y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")k=Reflect.decorate(o,f,m,y);else for(var E=o.length-1;E>=0;E--)(C=o[E])&&(k=(L<3?C(k):L>3?C(f,m,k):C(f,m))||k);return L>3&&k&&Object.defineProperty(f,m,k),k},v=this&&this.__param||function(o,f){return function(m,y){f(m,y,o)}},l=this&&this.__values||function(o){var f=typeof Symbol=="function"&&Symbol.iterator,m=f&&o[f],y=0;if(m)return m.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&y>=o.length&&(o=void 0),{value:o&&o[y++],done:!o}}};throw new TypeError(f?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.DomRendererRowFactory=e.CURSOR_STYLE_UNDERLINE_CLASS=e.CURSOR_STYLE_BAR_CLASS=e.CURSOR_STYLE_BLOCK_CLASS=e.CURSOR_BLINK_CLASS=e.CURSOR_CLASS=e.STRIKETHROUGH_CLASS=e.UNDERLINE_CLASS=e.ITALIC_CLASS=e.DIM_CLASS=e.BOLD_CLASS=void 0;var _=a(8803),S=a(643),b=a(511),p=a(2585),g=a(8055),w=a(4725),x=a(4269),h=a(1752);e.BOLD_CLASS="xterm-bold",e.DIM_CLASS="xterm-dim",e.ITALIC_CLASS="xterm-italic",e.UNDERLINE_CLASS="xterm-underline",e.STRIKETHROUGH_CLASS="xterm-strikethrough",e.CURSOR_CLASS="xterm-cursor",e.CURSOR_BLINK_CLASS="xterm-cursor-blink",e.CURSOR_STYLE_BLOCK_CLASS="xterm-cursor-block",e.CURSOR_STYLE_BAR_CLASS="xterm-cursor-bar",e.CURSOR_STYLE_UNDERLINE_CLASS="xterm-cursor-underline";var s=function(){function o(f,m,y,C,L,k){this._document=f,this._colors=m,this._characterJoinerService=y,this._optionsService=C,this._coreService=L,this._decorationService=k,this._workCell=new b.CellData,this._columnSelectMode=!1}return o.prototype.setColors=function(f){this._colors=f},o.prototype.onSelectionChanged=function(f,m,y){this._selectionStart=f,this._selectionEnd=m,this._columnSelectMode=y},o.prototype.createRow=function(f,m,y,C,L,k,E,A){for(var D,M,F=this._document.createDocumentFragment(),T=this._characterJoinerService.getJoinedCharacters(m),R=0,O=Math.min(f.length,A)-1;O>=0;O--)if(f.loadCell(O,this._workCell).getCode()!==S.NULL_CELL_CODE||y&&O===L){R=O+1;break}for(O=0;O<R;O++){f.loadCell(O,this._workCell);var H=this._workCell.getWidth();if(H!==0){var ee=!1,ie=O,J=this._workCell;if(T.length>0&&O===T[0][0]){ee=!0;var ne=T.shift();J=new x.JoinedCellData(this._workCell,f.translateToString(!0,ne[0],ne[1]),ne[1]-ne[0]),ie=ne[1]-1,H=J.getWidth()}var re=this._document.createElement("span");if(H>1&&(re.style.width=E*H+"px"),ee&&(re.style.display="inline",L>=O&&L<=ie&&(L=O)),!this._coreService.isCursorHidden&&y&&O===L)switch(re.classList.add(e.CURSOR_CLASS),k&&re.classList.add(e.CURSOR_BLINK_CLASS),C){case"bar":re.classList.add(e.CURSOR_STYLE_BAR_CLASS);break;case"underline":re.classList.add(e.CURSOR_STYLE_UNDERLINE_CLASS);break;default:re.classList.add(e.CURSOR_STYLE_BLOCK_CLASS)}J.isBold()&&re.classList.add(e.BOLD_CLASS),J.isItalic()&&re.classList.add(e.ITALIC_CLASS),J.isDim()&&re.classList.add(e.DIM_CLASS),J.isUnderline()&&re.classList.add(e.UNDERLINE_CLASS),J.isInvisible()?re.textContent=S.WHITESPACE_CELL_CHAR:re.textContent=J.getChars()||S.WHITESPACE_CELL_CHAR,J.isStrikethrough()&&re.classList.add(e.STRIKETHROUGH_CLASS);var B=J.getFgColor(),he=J.getFgColorMode(),le=J.getBgColor(),me=J.getBgColorMode(),U=!!J.isInverse();if(U){var xe=B;B=le,le=xe;var ce=he;he=me,me=ce}var $=void 0,X=void 0,I=!1;try{for(var Y=(D=void 0,l(this._decorationService.getDecorationsAtCell(O,m))),oe=Y.next();!oe.done;oe=Y.next()){var ae=oe.value;ae.options.layer!=="top"&&I||(ae.backgroundColorRGB&&(me=50331648,le=ae.backgroundColorRGB.rgba>>8&16777215,$=ae.backgroundColorRGB),ae.foregroundColorRGB&&(he=50331648,B=ae.foregroundColorRGB.rgba>>8&16777215,X=ae.foregroundColorRGB),I=ae.options.layer==="top")}}catch(Me){D={error:Me}}finally{try{oe&&!oe.done&&(M=Y.return)&&M.call(Y)}finally{if(D)throw D.error}}var fe=this._isCellInSelection(O,m);I||this._colors.selectionForeground&&fe&&(he=50331648,B=this._colors.selectionForeground.rgba>>8&16777215,X=this._colors.selectionForeground),fe&&($=this._colors.selectionOpaque,I=!0),I&&re.classList.add("xterm-decoration-top");var Se=void 0;switch(me){case 16777216:case 33554432:Se=this._colors.ansi[le],re.classList.add("xterm-bg-"+le);break;case 50331648:Se=g.rgba.toColor(le>>16,le>>8&255,255&le),this._addStyle(re,"background-color:#"+c((le>>>0).toString(16),"0",6));break;default:U?(Se=this._colors.foreground,re.classList.add("xterm-bg-"+_.INVERTED_DEFAULT_COLOR)):Se=this._colors.background}switch(he){case 16777216:case 33554432:J.isBold()&&B<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(B+=8),this._applyMinimumContrast(re,Se,this._colors.ansi[B],J,$,void 0)||re.classList.add("xterm-fg-"+B);break;case 50331648:var Ae=g.rgba.toColor(B>>16&255,B>>8&255,255&B);this._applyMinimumContrast(re,Se,Ae,J,$,X)||this._addStyle(re,"color:#"+c(B.toString(16),"0",6));break;default:this._applyMinimumContrast(re,Se,this._colors.foreground,J,$,void 0)||U&&re.classList.add("xterm-fg-"+_.INVERTED_DEFAULT_COLOR)}F.appendChild(re),O=ie}}return F},o.prototype._applyMinimumContrast=function(f,m,y,C,L,k){if(this._optionsService.rawOptions.minimumContrastRatio===1||(0,h.excludeFromContrastRatioDemands)(C.getCode()))return!1;var E=void 0;return L||k||(E=this._colors.contrastCache.getColor(m.rgba,y.rgba)),E===void 0&&(E=g.color.ensureContrastRatio(L||m,k||y,this._optionsService.rawOptions.minimumContrastRatio),this._colors.contrastCache.setColor((L||m).rgba,(k||y).rgba,E??null)),!!E&&(this._addStyle(f,"color:"+E.css),!0)},o.prototype._addStyle=function(f,m){f.setAttribute("style",""+(f.getAttribute("style")||"")+m+";")},o.prototype._isCellInSelection=function(f,m){var y=this._selectionStart,C=this._selectionEnd;return!(!y||!C)&&(this._columnSelectMode?y[0]<=C[0]?f>=y[0]&&m>=y[1]&&f<C[0]&&m<=C[1]:f<y[0]&&m>=y[1]&&f>=C[0]&&m<=C[1]:m>y[1]&&m<C[1]||y[1]===C[1]&&m===y[1]&&f>=y[0]&&f<C[0]||y[1]<C[1]&&m===C[1]&&f<C[0]||y[1]<C[1]&&m===y[1]&&f>=y[0])},u([v(2,w.ICharacterJoinerService),v(3,p.IOptionsService),v(4,p.ICoreService),v(5,p.IDecorationService)],o)}();function c(o,f,m){for(;o.length<m;)o=f+o;return o}e.DomRendererRowFactory=s},456:(d,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SelectionModel=void 0;var a=function(){function u(v){this._bufferService=v,this.isSelectAllActive=!1,this.selectionStartLength=0}return u.prototype.clearSelection=function(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0},Object.defineProperty(u.prototype,"finalSelectionStart",{get:function(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"finalSelectionEnd",{get:function(){return this.isSelectAllActive?[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1]:this.selectionStart?!this.selectionEnd||this.areSelectionValuesReversed()?(v=this.selectionStart[0]+this.selectionStartLength)>this._bufferService.cols?v%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(v/this._bufferService.cols)-1]:[v%this._bufferService.cols,this.selectionStart[1]+Math.floor(v/this._bufferService.cols)]:[v,this.selectionStart[1]]:this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]?(v=this.selectionStart[0]+this.selectionStartLength)>this._bufferService.cols?[v%this._bufferService.cols,this.selectionStart[1]+Math.floor(v/this._bufferService.cols)]:[Math.max(v,this.selectionEnd[0]),this.selectionEnd[1]]:this.selectionEnd:void 0;var v},enumerable:!1,configurable:!0}),u.prototype.areSelectionValuesReversed=function(){var v=this.selectionStart,l=this.selectionEnd;return!(!v||!l)&&(v[1]>l[1]||v[1]===l[1]&&v[0]>l[0])},u.prototype.onTrim=function(v){return this.selectionStart&&(this.selectionStart[1]-=v),this.selectionEnd&&(this.selectionEnd[1]-=v),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)},u}();e.SelectionModel=a},428:function(d,e,a){var u=this&&this.__decorate||function(p,g,w,x){var h,s=arguments.length,c=s<3?g:x===null?x=Object.getOwnPropertyDescriptor(g,w):x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(p,g,w,x);else for(var o=p.length-1;o>=0;o--)(h=p[o])&&(c=(s<3?h(c):s>3?h(g,w,c):h(g,w))||c);return s>3&&c&&Object.defineProperty(g,w,c),c},v=this&&this.__param||function(p,g){return function(w,x){g(w,x,p)}};Object.defineProperty(e,"__esModule",{value:!0}),e.CharSizeService=void 0;var l=a(2585),_=a(8460),S=function(){function p(g,w,x){this._optionsService=x,this.width=0,this.height=0,this._onCharSizeChange=new _.EventEmitter,this._measureStrategy=new b(g,w,this._optionsService)}return Object.defineProperty(p.prototype,"hasValidSize",{get:function(){return this.width>0&&this.height>0},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"onCharSizeChange",{get:function(){return this._onCharSizeChange.event},enumerable:!1,configurable:!0}),p.prototype.measure=function(){var g=this._measureStrategy.measure();g.width===this.width&&g.height===this.height||(this.width=g.width,this.height=g.height,this._onCharSizeChange.fire())},u([v(2,l.IOptionsService)],p)}();e.CharSizeService=S;var b=function(){function p(g,w,x){this._document=g,this._parentElement=w,this._optionsService=x,this._result={width:0,height:0},this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W",this._measureElement.setAttribute("aria-hidden","true"),this._parentElement.appendChild(this._measureElement)}return p.prototype.measure=function(){this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=this._optionsService.rawOptions.fontSize+"px";var g=this._measureElement.getBoundingClientRect();return g.width!==0&&g.height!==0&&(this._result.width=g.width,this._result.height=Math.ceil(g.height)),this._result},p}()},4269:function(d,e,a){var u,v=this&&this.__extends||(u=function(h,s){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,o){c.__proto__=o}||function(c,o){for(var f in o)Object.prototype.hasOwnProperty.call(o,f)&&(c[f]=o[f])},u(h,s)},function(h,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function c(){this.constructor=h}u(h,s),h.prototype=s===null?Object.create(s):(c.prototype=s.prototype,new c)}),l=this&&this.__decorate||function(h,s,c,o){var f,m=arguments.length,y=m<3?s:o===null?o=Object.getOwnPropertyDescriptor(s,c):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(h,s,c,o);else for(var C=h.length-1;C>=0;C--)(f=h[C])&&(y=(m<3?f(y):m>3?f(s,c,y):f(s,c))||y);return m>3&&y&&Object.defineProperty(s,c,y),y},_=this&&this.__param||function(h,s){return function(c,o){s(c,o,h)}};Object.defineProperty(e,"__esModule",{value:!0}),e.CharacterJoinerService=e.JoinedCellData=void 0;var S=a(3734),b=a(643),p=a(511),g=a(2585),w=function(h){function s(c,o,f){var m=h.call(this)||this;return m.content=0,m.combinedData="",m.fg=c.fg,m.bg=c.bg,m.combinedData=o,m._width=f,m}return v(s,h),s.prototype.isCombined=function(){return 2097152},s.prototype.getWidth=function(){return this._width},s.prototype.getChars=function(){return this.combinedData},s.prototype.getCode=function(){return 2097151},s.prototype.setFromCharData=function(c){throw new Error("not implemented")},s.prototype.getAsCharData=function(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]},s}(S.AttributeData);e.JoinedCellData=w;var x=function(){function h(s){this._bufferService=s,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new p.CellData}return h.prototype.register=function(s){var c={id:this._nextCharacterJoinerId++,handler:s};return this._characterJoiners.push(c),c.id},h.prototype.deregister=function(s){for(var c=0;c<this._characterJoiners.length;c++)if(this._characterJoiners[c].id===s)return this._characterJoiners.splice(c,1),!0;return!1},h.prototype.getJoinedCharacters=function(s){if(this._characterJoiners.length===0)return[];var c=this._bufferService.buffer.lines.get(s);if(!c||c.length===0)return[];for(var o=[],f=c.translateToString(!0),m=0,y=0,C=0,L=c.getFg(0),k=c.getBg(0),E=0;E<c.getTrimmedLength();E++)if(c.loadCell(E,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==L||this._workCell.bg!==k){if(E-m>1)for(var A=this._getJoinedRanges(f,C,y,c,m),D=0;D<A.length;D++)o.push(A[D]);m=E,C=y,L=this._workCell.fg,k=this._workCell.bg}y+=this._workCell.getChars().length||b.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-m>1)for(A=this._getJoinedRanges(f,C,y,c,m),D=0;D<A.length;D++)o.push(A[D]);return o},h.prototype._getJoinedRanges=function(s,c,o,f,m){var y=s.substring(c,o),C=[];try{C=this._characterJoiners[0].handler(y)}catch(A){console.error(A)}for(var L=1;L<this._characterJoiners.length;L++)try{for(var k=this._characterJoiners[L].handler(y),E=0;E<k.length;E++)h._mergeRanges(C,k[E])}catch(A){console.error(A)}return this._stringRangesToCellRanges(C,f,m),C},h.prototype._stringRangesToCellRanges=function(s,c,o){var f=0,m=!1,y=0,C=s[f];if(C){for(var L=o;L<this._bufferService.cols;L++){var k=c.getWidth(L),E=c.getString(L).length||b.WHITESPACE_CELL_CHAR.length;if(k!==0){if(!m&&C[0]<=y&&(C[0]=L,m=!0),C[1]<=y){if(C[1]=L,!(C=s[++f]))break;C[0]<=y?(C[0]=L,m=!0):m=!1}y+=E}}C&&(C[1]=this._bufferService.cols)}},h._mergeRanges=function(s,c){for(var o=!1,f=0;f<s.length;f++){var m=s[f];if(o){if(c[1]<=m[0])return s[f-1][1]=c[1],s;if(c[1]<=m[1])return s[f-1][1]=Math.max(c[1],m[1]),s.splice(f,1),s;s.splice(f,1),f--}else{if(c[1]<=m[0])return s.splice(f,0,c),s;if(c[1]<=m[1])return m[0]=Math.min(c[0],m[0]),s;c[0]<m[1]&&(m[0]=Math.min(c[0],m[0]),o=!0)}}return o?s[s.length-1][1]=c[1]:s.push(c),s},h=l([_(0,g.IBufferService)],h)}();e.CharacterJoinerService=x},5114:(d,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CoreBrowserService=void 0;var a=function(){function u(v){this._textarea=v}return Object.defineProperty(u.prototype,"isFocused",{get:function(){return(this._textarea.getRootNode?this._textarea.getRootNode():document).activeElement===this._textarea&&document.hasFocus()},enumerable:!1,configurable:!0}),u}();e.CoreBrowserService=a},8934:function(d,e,a){var u=this&&this.__decorate||function(b,p,g,w){var x,h=arguments.length,s=h<3?p:w===null?w=Object.getOwnPropertyDescriptor(p,g):w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(b,p,g,w);else for(var c=b.length-1;c>=0;c--)(x=b[c])&&(s=(h<3?x(s):h>3?x(p,g,s):x(p,g))||s);return h>3&&s&&Object.defineProperty(p,g,s),s},v=this&&this.__param||function(b,p){return function(g,w){p(g,w,b)}};Object.defineProperty(e,"__esModule",{value:!0}),e.MouseService=void 0;var l=a(4725),_=a(9806),S=function(){function b(p,g){this._renderService=p,this._charSizeService=g}return b.prototype.getCoords=function(p,g,w,x,h){return(0,_.getCoords)(window,p,g,w,x,this._charSizeService.hasValidSize,this._renderService.dimensions.actualCellWidth,this._renderService.dimensions.actualCellHeight,h)},b.prototype.getRawByteCoords=function(p,g,w,x){var h=this.getCoords(p,g,w,x);return(0,_.getRawByteCoords)(h)},u([v(0,l.IRenderService),v(1,l.ICharSizeService)],b)}();e.MouseService=S},3230:function(d,e,a){var u,v=this&&this.__extends||(u=function(c,o){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,m){f.__proto__=m}||function(f,m){for(var y in m)Object.prototype.hasOwnProperty.call(m,y)&&(f[y]=m[y])},u(c,o)},function(c,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function f(){this.constructor=c}u(c,o),c.prototype=o===null?Object.create(o):(f.prototype=o.prototype,new f)}),l=this&&this.__decorate||function(c,o,f,m){var y,C=arguments.length,L=C<3?o:m===null?m=Object.getOwnPropertyDescriptor(o,f):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")L=Reflect.decorate(c,o,f,m);else for(var k=c.length-1;k>=0;k--)(y=c[k])&&(L=(C<3?y(L):C>3?y(o,f,L):y(o,f))||L);return C>3&&L&&Object.defineProperty(o,f,L),L},_=this&&this.__param||function(c,o){return function(f,m){o(f,m,c)}};Object.defineProperty(e,"__esModule",{value:!0}),e.RenderService=void 0;var S=a(6193),b=a(8460),p=a(844),g=a(5596),w=a(3656),x=a(2585),h=a(4725),s=function(c){function o(f,m,y,C,L,k,E){var A=c.call(this)||this;if(A._renderer=f,A._rowCount=m,A._charSizeService=L,A._isPaused=!1,A._needsFullRefresh=!1,A._isNextRenderRedrawOnly=!0,A._needsSelectionRefresh=!1,A._canvasWidth=0,A._canvasHeight=0,A._selectionState={start:void 0,end:void 0,columnSelectMode:!1},A._onDimensionsChange=new b.EventEmitter,A._onRenderedViewportChange=new b.EventEmitter,A._onRender=new b.EventEmitter,A._onRefreshRequest=new b.EventEmitter,A.register({dispose:function(){return A._renderer.dispose()}}),A._renderDebouncer=new S.RenderDebouncer(function(M,F){return A._renderRows(M,F)}),A.register(A._renderDebouncer),A._screenDprMonitor=new g.ScreenDprMonitor,A._screenDprMonitor.setListener(function(){return A.onDevicePixelRatioChange()}),A.register(A._screenDprMonitor),A.register(E.onResize(function(){return A._fullRefresh()})),A.register(E.buffers.onBufferActivate(function(){var M;return(M=A._renderer)===null||M===void 0?void 0:M.clear()})),A.register(C.onOptionChange(function(){return A._handleOptionsChanged()})),A.register(A._charSizeService.onCharSizeChange(function(){return A.onCharSizeChanged()})),A.register(k.onDecorationRegistered(function(){return A._fullRefresh()})),A.register(k.onDecorationRemoved(function(){return A._fullRefresh()})),A._renderer.onRequestRedraw(function(M){return A.refreshRows(M.start,M.end,!0)}),A.register((0,w.addDisposableDomListener)(window,"resize",function(){return A.onDevicePixelRatioChange()})),"IntersectionObserver"in window){var D=new IntersectionObserver(function(M){return A._onIntersectionChange(M[M.length-1])},{threshold:0});D.observe(y),A.register({dispose:function(){return D.disconnect()}})}return A}return v(o,c),Object.defineProperty(o.prototype,"onDimensionsChange",{get:function(){return this._onDimensionsChange.event},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onRenderedViewportChange",{get:function(){return this._onRenderedViewportChange.event},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onRender",{get:function(){return this._onRender.event},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onRefreshRequest",{get:function(){return this._onRefreshRequest.event},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"dimensions",{get:function(){return this._renderer.dimensions},enumerable:!1,configurable:!0}),o.prototype._onIntersectionChange=function(f){this._isPaused=f.isIntersecting===void 0?f.intersectionRatio===0:!f.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)},o.prototype.refreshRows=function(f,m,y){y===void 0&&(y=!1),this._isPaused?this._needsFullRefresh=!0:(y||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(f,m,this._rowCount))},o.prototype._renderRows=function(f,m){this._renderer.renderRows(f,m),this._needsSelectionRefresh&&(this._renderer.onSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:f,end:m}),this._onRender.fire({start:f,end:m}),this._isNextRenderRedrawOnly=!0},o.prototype.resize=function(f,m){this._rowCount=m,this._fireOnCanvasResize()},o.prototype._handleOptionsChanged=function(){this._renderer.onOptionsChanged(),this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize()},o.prototype._fireOnCanvasResize=function(){this._renderer.dimensions.canvasWidth===this._canvasWidth&&this._renderer.dimensions.canvasHeight===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.dimensions)},o.prototype.dispose=function(){c.prototype.dispose.call(this)},o.prototype.setRenderer=function(f){var m=this;this._renderer.dispose(),this._renderer=f,this._renderer.onRequestRedraw(function(y){return m.refreshRows(y.start,y.end,!0)}),this._needsSelectionRefresh=!0,this._fullRefresh()},o.prototype.addRefreshCallback=function(f){return this._renderDebouncer.addRefreshCallback(f)},o.prototype._fullRefresh=function(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)},o.prototype.clearTextureAtlas=function(){var f,m;(m=(f=this._renderer)===null||f===void 0?void 0:f.clearTextureAtlas)===null||m===void 0||m.call(f),this._fullRefresh()},o.prototype.setColors=function(f){this._renderer.setColors(f),this._fullRefresh()},o.prototype.onDevicePixelRatioChange=function(){this._charSizeService.measure(),this._renderer.onDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1)},o.prototype.onResize=function(f,m){this._renderer.onResize(f,m),this._fullRefresh()},o.prototype.onCharSizeChanged=function(){this._renderer.onCharSizeChanged()},o.prototype.onBlur=function(){this._renderer.onBlur()},o.prototype.onFocus=function(){this._renderer.onFocus()},o.prototype.onSelectionChanged=function(f,m,y){this._selectionState.start=f,this._selectionState.end=m,this._selectionState.columnSelectMode=y,this._renderer.onSelectionChanged(f,m,y)},o.prototype.onCursorMove=function(){this._renderer.onCursorMove()},o.prototype.clear=function(){this._renderer.clear()},l([_(3,x.IOptionsService),_(4,h.ICharSizeService),_(5,x.IDecorationService),_(6,x.IBufferService)],o)}(p.Disposable);e.RenderService=s},9312:function(d,e,a){var u,v=this&&this.__extends||(u=function(C,L){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,E){k.__proto__=E}||function(k,E){for(var A in E)Object.prototype.hasOwnProperty.call(E,A)&&(k[A]=E[A])},u(C,L)},function(C,L){if(typeof L!="function"&&L!==null)throw new TypeError("Class extends value "+String(L)+" is not a constructor or null");function k(){this.constructor=C}u(C,L),C.prototype=L===null?Object.create(L):(k.prototype=L.prototype,new k)}),l=this&&this.__decorate||function(C,L,k,E){var A,D=arguments.length,M=D<3?L:E===null?E=Object.getOwnPropertyDescriptor(L,k):E;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")M=Reflect.decorate(C,L,k,E);else for(var F=C.length-1;F>=0;F--)(A=C[F])&&(M=(D<3?A(M):D>3?A(L,k,M):A(L,k))||M);return D>3&&M&&Object.defineProperty(L,k,M),M},_=this&&this.__param||function(C,L){return function(k,E){L(k,E,C)}};Object.defineProperty(e,"__esModule",{value:!0}),e.SelectionService=void 0;var S=a(6114),b=a(456),p=a(511),g=a(8460),w=a(4725),x=a(2585),h=a(9806),s=a(9504),c=a(844),o=a(4841),f="",m=new RegExp(f,"g"),y=function(C){function L(k,E,A,D,M,F,T,R){var O=C.call(this)||this;return O._element=k,O._screenElement=E,O._linkifier=A,O._bufferService=D,O._coreService=M,O._mouseService=F,O._optionsService=T,O._renderService=R,O._dragScrollAmount=0,O._enabled=!0,O._workCell=new p.CellData,O._mouseDownTimeStamp=0,O._oldHasSelection=!1,O._oldSelectionStart=void 0,O._oldSelectionEnd=void 0,O._onLinuxMouseSelection=O.register(new g.EventEmitter),O._onRedrawRequest=O.register(new g.EventEmitter),O._onSelectionChange=O.register(new g.EventEmitter),O._onRequestScrollLines=O.register(new g.EventEmitter),O._mouseMoveListener=function(H){return O._onMouseMove(H)},O._mouseUpListener=function(H){return O._onMouseUp(H)},O._coreService.onUserInput(function(){O.hasSelection&&O.clearSelection()}),O._trimListener=O._bufferService.buffer.lines.onTrim(function(H){return O._onTrim(H)}),O.register(O._bufferService.buffers.onBufferActivate(function(H){return O._onBufferActivate(H)})),O.enable(),O._model=new b.SelectionModel(O._bufferService),O._activeSelectionMode=0,O}return v(L,C),Object.defineProperty(L.prototype,"onLinuxMouseSelection",{get:function(){return this._onLinuxMouseSelection.event},enumerable:!1,configurable:!0}),Object.defineProperty(L.prototype,"onRequestRedraw",{get:function(){return this._onRedrawRequest.event},enumerable:!1,configurable:!0}),Object.defineProperty(L.prototype,"onSelectionChange",{get:function(){return this._onSelectionChange.event},enumerable:!1,configurable:!0}),Object.defineProperty(L.prototype,"onRequestScrollLines",{get:function(){return this._onRequestScrollLines.event},enumerable:!1,configurable:!0}),L.prototype.dispose=function(){this._removeMouseDownListeners()},L.prototype.reset=function(){this.clearSelection()},L.prototype.disable=function(){this.clearSelection(),this._enabled=!1},L.prototype.enable=function(){this._enabled=!0},Object.defineProperty(L.prototype,"selectionStart",{get:function(){return this._model.finalSelectionStart},enumerable:!1,configurable:!0}),Object.defineProperty(L.prototype,"selectionEnd",{get:function(){return this._model.finalSelectionEnd},enumerable:!1,configurable:!0}),Object.defineProperty(L.prototype,"hasSelection",{get:function(){var k=this._model.finalSelectionStart,E=this._model.finalSelectionEnd;return!(!k||!E||k[0]===E[0]&&k[1]===E[1])},enumerable:!1,configurable:!0}),Object.defineProperty(L.prototype,"selectionText",{get:function(){var k=this._model.finalSelectionStart,E=this._model.finalSelectionEnd;if(!k||!E)return"";var A=this._bufferService.buffer,D=[];if(this._activeSelectionMode===3){if(k[0]===E[0])return"";for(var M=k[0]<E[0]?k[0]:E[0],F=k[0]<E[0]?E[0]:k[0],T=k[1];T<=E[1];T++){var R=A.translateBufferLineToString(T,!0,M,F);D.push(R)}}else{var O=k[1]===E[1]?E[0]:void 0;for(D.push(A.translateBufferLineToString(k[1],!0,k[0],O)),T=k[1]+1;T<=E[1]-1;T++){var H=A.lines.get(T);R=A.translateBufferLineToString(T,!0),H!=null&&H.isWrapped?D[D.length-1]+=R:D.push(R)}k[1]!==E[1]&&(H=A.lines.get(E[1]),R=A.translateBufferLineToString(E[1],!0,0,E[0]),H&&H.isWrapped?D[D.length-1]+=R:D.push(R))}return D.map(function(ee){return ee.replace(m," ")}).join(S.isWindows?`\r
`:`
`)},enumerable:!1,configurable:!0}),L.prototype.clearSelection=function(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()},L.prototype.refresh=function(k){var E=this;this._refreshAnimationFrame||(this._refreshAnimationFrame=window.requestAnimationFrame(function(){return E._refresh()})),S.isLinux&&k&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)},L.prototype._refresh=function(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})},L.prototype._isClickInSelection=function(k){var E=this._getMouseBufferCoords(k),A=this._model.finalSelectionStart,D=this._model.finalSelectionEnd;return!!(A&&D&&E)&&this._areCoordsInSelection(E,A,D)},L.prototype.isCellInSelection=function(k,E){var A=this._model.finalSelectionStart,D=this._model.finalSelectionEnd;return!(!A||!D)&&this._areCoordsInSelection([k,E],A,D)},L.prototype._areCoordsInSelection=function(k,E,A){return k[1]>E[1]&&k[1]<A[1]||E[1]===A[1]&&k[1]===E[1]&&k[0]>=E[0]&&k[0]<A[0]||E[1]<A[1]&&k[1]===A[1]&&k[0]<A[0]||E[1]<A[1]&&k[1]===E[1]&&k[0]>=E[0]},L.prototype._selectWordAtCursor=function(k,E){var A,D,M=(D=(A=this._linkifier.currentLink)===null||A===void 0?void 0:A.link)===null||D===void 0?void 0:D.range;if(M)return this._model.selectionStart=[M.start.x-1,M.start.y-1],this._model.selectionStartLength=(0,o.getRangeLength)(M,this._bufferService.cols),this._model.selectionEnd=void 0,!0;var F=this._getMouseBufferCoords(k);return!!F&&(this._selectWordAt(F,E),this._model.selectionEnd=void 0,!0)},L.prototype.selectAll=function(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()},L.prototype.selectLines=function(k,E){this._model.clearSelection(),k=Math.max(k,0),E=Math.min(E,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,k],this._model.selectionEnd=[this._bufferService.cols,E],this.refresh(),this._onSelectionChange.fire()},L.prototype._onTrim=function(k){this._model.onTrim(k)&&this.refresh()},L.prototype._getMouseBufferCoords=function(k){var E=this._mouseService.getCoords(k,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(E)return E[0]--,E[1]--,E[1]+=this._bufferService.buffer.ydisp,E},L.prototype._getMouseEventScrollAmount=function(k){var E=(0,h.getCoordsRelativeToElement)(window,k,this._screenElement)[1],A=this._renderService.dimensions.canvasHeight;return E>=0&&E<=A?0:(E>A&&(E-=A),E=Math.min(Math.max(E,-50),50),(E/=50)/Math.abs(E)+Math.round(14*E))},L.prototype.shouldForceSelection=function(k){return S.isMac?k.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:k.shiftKey},L.prototype.onMouseDown=function(k){if(this._mouseDownTimeStamp=k.timeStamp,(k.button!==2||!this.hasSelection)&&k.button===0){if(!this._enabled){if(!this.shouldForceSelection(k))return;k.stopPropagation()}k.preventDefault(),this._dragScrollAmount=0,this._enabled&&k.shiftKey?this._onIncrementalClick(k):k.detail===1?this._onSingleClick(k):k.detail===2?this._onDoubleClick(k):k.detail===3&&this._onTripleClick(k),this._addMouseDownListeners(),this.refresh(!0)}},L.prototype._addMouseDownListeners=function(){var k=this;this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=window.setInterval(function(){return k._dragScroll()},50)},L.prototype._removeMouseDownListeners=function(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0},L.prototype._onIncrementalClick=function(k){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(k))},L.prototype._onSingleClick=function(k){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(k)?3:0,this._model.selectionStart=this._getMouseBufferCoords(k),this._model.selectionStart){this._model.selectionEnd=void 0;var E=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);E&&E.length!==this._model.selectionStart[0]&&E.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}},L.prototype._onDoubleClick=function(k){this._selectWordAtCursor(k,!0)&&(this._activeSelectionMode=1)},L.prototype._onTripleClick=function(k){var E=this._getMouseBufferCoords(k);E&&(this._activeSelectionMode=2,this._selectLineAt(E[1]))},L.prototype.shouldColumnSelect=function(k){return k.altKey&&!(S.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)},L.prototype._onMouseMove=function(k){if(k.stopImmediatePropagation(),this._model.selectionStart){var E=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(k),this._model.selectionEnd){this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(k),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));var A=this._bufferService.buffer;if(this._model.selectionEnd[1]<A.lines.length){var D=A.lines.get(this._model.selectionEnd[1]);D&&D.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]++}E&&E[0]===this._model.selectionEnd[0]&&E[1]===this._model.selectionEnd[1]||this.refresh(!0)}else this.refresh(!0)}},L.prototype._dragScroll=function(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});var k=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(k.ydisp+this._bufferService.rows,k.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=k.ydisp),this.refresh()}},L.prototype._onMouseUp=function(k){var E=k.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&E<500&&k.altKey&&this._optionsService.getOption("altClickMovesCursor")){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){var A=this._mouseService.getCoords(k,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(A&&A[0]!==void 0&&A[1]!==void 0){var D=(0,s.moveToCellSequence)(A[0]-1,A[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(D,!0)}}}else this._fireEventIfSelectionChanged()},L.prototype._fireEventIfSelectionChanged=function(){var k=this._model.finalSelectionStart,E=this._model.finalSelectionEnd,A=!(!k||!E||k[0]===E[0]&&k[1]===E[1]);A?k&&E&&(this._oldSelectionStart&&this._oldSelectionEnd&&k[0]===this._oldSelectionStart[0]&&k[1]===this._oldSelectionStart[1]&&E[0]===this._oldSelectionEnd[0]&&E[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(k,E,A)):this._oldHasSelection&&this._fireOnSelectionChange(k,E,A)},L.prototype._fireOnSelectionChange=function(k,E,A){this._oldSelectionStart=k,this._oldSelectionEnd=E,this._oldHasSelection=A,this._onSelectionChange.fire()},L.prototype._onBufferActivate=function(k){var E=this;this.clearSelection(),this._trimListener.dispose(),this._trimListener=k.activeBuffer.lines.onTrim(function(A){return E._onTrim(A)})},L.prototype._convertViewportColToCharacterIndex=function(k,E){for(var A=E[0],D=0;E[0]>=D;D++){var M=k.loadCell(D,this._workCell).getChars().length;this._workCell.getWidth()===0?A--:M>1&&E[0]!==D&&(A+=M-1)}return A},L.prototype.setSelection=function(k,E,A){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[k,E],this._model.selectionStartLength=A,this.refresh(),this._fireEventIfSelectionChanged()},L.prototype.rightClickSelect=function(k){this._isClickInSelection(k)||(this._selectWordAtCursor(k,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())},L.prototype._getWordAt=function(k,E,A,D){if(A===void 0&&(A=!0),D===void 0&&(D=!0),!(k[0]>=this._bufferService.cols)){var M=this._bufferService.buffer,F=M.lines.get(k[1]);if(F){var T=M.translateBufferLineToString(k[1],!1),R=this._convertViewportColToCharacterIndex(F,k),O=R,H=k[0]-R,ee=0,ie=0,J=0,ne=0;if(T.charAt(R)===" "){for(;R>0&&T.charAt(R-1)===" ";)R--;for(;O<T.length&&T.charAt(O+1)===" ";)O++}else{var re=k[0],B=k[0];F.getWidth(re)===0&&(ee++,re--),F.getWidth(B)===2&&(ie++,B++);var he=F.getString(B).length;for(he>1&&(ne+=he-1,O+=he-1);re>0&&R>0&&!this._isCharWordSeparator(F.loadCell(re-1,this._workCell));){F.loadCell(re-1,this._workCell);var le=this._workCell.getChars().length;this._workCell.getWidth()===0?(ee++,re--):le>1&&(J+=le-1,R-=le-1),R--,re--}for(;B<F.length&&O+1<T.length&&!this._isCharWordSeparator(F.loadCell(B+1,this._workCell));){F.loadCell(B+1,this._workCell);var me=this._workCell.getChars().length;this._workCell.getWidth()===2?(ie++,B++):me>1&&(ne+=me-1,O+=me-1),O++,B++}}O++;var U=R+H-ee+J,xe=Math.min(this._bufferService.cols,O-R+ee+ie-J-ne);if(E||T.slice(R,O).trim()!==""){if(A&&U===0&&F.getCodePoint(0)!==32){var ce=M.lines.get(k[1]-1);if(ce&&F.isWrapped&&ce.getCodePoint(this._bufferService.cols-1)!==32){var $=this._getWordAt([this._bufferService.cols-1,k[1]-1],!1,!0,!1);if($){var X=this._bufferService.cols-$.start;U-=X,xe+=X}}}if(D&&U+xe===this._bufferService.cols&&F.getCodePoint(this._bufferService.cols-1)!==32){var I=M.lines.get(k[1]+1);if(I!=null&&I.isWrapped&&I.getCodePoint(0)!==32){var Y=this._getWordAt([0,k[1]+1],!1,!1,!0);Y&&(xe+=Y.length)}}return{start:U,length:xe}}}}},L.prototype._selectWordAt=function(k,E){var A=this._getWordAt(k,E);if(A){for(;A.start<0;)A.start+=this._bufferService.cols,k[1]--;this._model.selectionStart=[A.start,k[1]],this._model.selectionStartLength=A.length}},L.prototype._selectToWordAt=function(k){var E=this._getWordAt(k,!0);if(E){for(var A=k[1];E.start<0;)E.start+=this._bufferService.cols,A--;if(!this._model.areSelectionValuesReversed())for(;E.start+E.length>this._bufferService.cols;)E.length-=this._bufferService.cols,A++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?E.start:E.start+E.length,A]}},L.prototype._isCharWordSeparator=function(k){return k.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(k.getChars())>=0},L.prototype._selectLineAt=function(k){var E=this._bufferService.buffer.getWrappedRangeForLine(k),A={start:{x:0,y:E.first},end:{x:this._bufferService.cols-1,y:E.last}};this._model.selectionStart=[0,E.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,o.getRangeLength)(A,this._bufferService.cols)},l([_(3,x.IBufferService),_(4,x.ICoreService),_(5,w.IMouseService),_(6,x.IOptionsService),_(7,w.IRenderService)],L)}(c.Disposable);e.SelectionService=y},4725:(d,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ICharacterJoinerService=e.ISoundService=e.ISelectionService=e.IRenderService=e.IMouseService=e.ICoreBrowserService=e.ICharSizeService=void 0;var u=a(8343);e.ICharSizeService=(0,u.createDecorator)("CharSizeService"),e.ICoreBrowserService=(0,u.createDecorator)("CoreBrowserService"),e.IMouseService=(0,u.createDecorator)("MouseService"),e.IRenderService=(0,u.createDecorator)("RenderService"),e.ISelectionService=(0,u.createDecorator)("SelectionService"),e.ISoundService=(0,u.createDecorator)("SoundService"),e.ICharacterJoinerService=(0,u.createDecorator)("CharacterJoinerService")},357:function(d,e,a){var u=this&&this.__decorate||function(S,b,p,g){var w,x=arguments.length,h=x<3?b:g===null?g=Object.getOwnPropertyDescriptor(b,p):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(S,b,p,g);else for(var s=S.length-1;s>=0;s--)(w=S[s])&&(h=(x<3?w(h):x>3?w(b,p,h):w(b,p))||h);return x>3&&h&&Object.defineProperty(b,p,h),h},v=this&&this.__param||function(S,b){return function(p,g){b(p,g,S)}};Object.defineProperty(e,"__esModule",{value:!0}),e.SoundService=void 0;var l=a(2585),_=function(){function S(b){this._optionsService=b}return Object.defineProperty(S,"audioContext",{get:function(){if(!S._audioContext){var b=window.AudioContext||window.webkitAudioContext;if(!b)return console.warn("Web Audio API is not supported by this browser. Consider upgrading to the latest version"),null;S._audioContext=new b}return S._audioContext},enumerable:!1,configurable:!0}),S.prototype.playBellSound=function(){var b=S.audioContext;if(b){var p=b.createBufferSource();b.decodeAudioData(this._base64ToArrayBuffer(this._removeMimeType(this._optionsService.rawOptions.bellSound)),function(g){p.buffer=g,p.connect(b.destination),p.start(0)})}},S.prototype._base64ToArrayBuffer=function(b){for(var p=window.atob(b),g=p.length,w=new Uint8Array(g),x=0;x<g;x++)w[x]=p.charCodeAt(x);return w.buffer},S.prototype._removeMimeType=function(b){return b.split(",")[1]},S=u([v(0,l.IOptionsService)],S)}();e.SoundService=_},6349:(d,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CircularList=void 0;var u=a(8460),v=function(){function l(_){this._maxLength=_,this.onDeleteEmitter=new u.EventEmitter,this.onInsertEmitter=new u.EventEmitter,this.onTrimEmitter=new u.EventEmitter,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}return Object.defineProperty(l.prototype,"onDelete",{get:function(){return this.onDeleteEmitter.event},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"onInsert",{get:function(){return this.onInsertEmitter.event},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"onTrim",{get:function(){return this.onTrimEmitter.event},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"maxLength",{get:function(){return this._maxLength},set:function(_){if(this._maxLength!==_){for(var S=new Array(_),b=0;b<Math.min(_,this.length);b++)S[b]=this._array[this._getCyclicIndex(b)];this._array=S,this._maxLength=_,this._startIndex=0}},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"length",{get:function(){return this._length},set:function(_){if(_>this._length)for(var S=this._length;S<_;S++)this._array[S]=void 0;this._length=_},enumerable:!1,configurable:!0}),l.prototype.get=function(_){return this._array[this._getCyclicIndex(_)]},l.prototype.set=function(_,S){this._array[this._getCyclicIndex(_)]=S},l.prototype.push=function(_){this._array[this._getCyclicIndex(this._length)]=_,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++},l.prototype.recycle=function(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]},Object.defineProperty(l.prototype,"isFull",{get:function(){return this._length===this._maxLength},enumerable:!1,configurable:!0}),l.prototype.pop=function(){return this._array[this._getCyclicIndex(this._length---1)]},l.prototype.splice=function(_,S){for(var b=[],p=2;p<arguments.length;p++)b[p-2]=arguments[p];if(S){for(var g=_;g<this._length-S;g++)this._array[this._getCyclicIndex(g)]=this._array[this._getCyclicIndex(g+S)];this._length-=S,this.onDeleteEmitter.fire({index:_,amount:S})}for(g=this._length-1;g>=_;g--)this._array[this._getCyclicIndex(g+b.length)]=this._array[this._getCyclicIndex(g)];for(g=0;g<b.length;g++)this._array[this._getCyclicIndex(_+g)]=b[g];if(b.length&&this.onInsertEmitter.fire({index:_,amount:b.length}),this._length+b.length>this._maxLength){var w=this._length+b.length-this._maxLength;this._startIndex+=w,this._length=this._maxLength,this.onTrimEmitter.fire(w)}else this._length+=b.length},l.prototype.trimStart=function(_){_>this._length&&(_=this._length),this._startIndex+=_,this._length-=_,this.onTrimEmitter.fire(_)},l.prototype.shiftElements=function(_,S,b){if(!(S<=0)){if(_<0||_>=this._length)throw new Error("start argument out of range");if(_+b<0)throw new Error("Cannot shift elements in list beyond index 0");if(b>0){for(var p=S-1;p>=0;p--)this.set(_+p+b,this.get(_+p));var g=_+S+b-this._length;if(g>0)for(this._length+=g;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(p=0;p<S;p++)this.set(_+p+b,this.get(_+p))}},l.prototype._getCyclicIndex=function(_){return(this._startIndex+_)%this._maxLength},l}();e.CircularList=v},1439:(d,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.clone=void 0,e.clone=function a(u,v){if(v===void 0&&(v=5),typeof u!="object")return u;var l=Array.isArray(u)?[]:{};for(var _ in u)l[_]=v<=1?u[_]:u[_]&&a(u[_],v-1);return l}},8055:function(d,e){var a,u,v,l,_=this&&this.__read||function(p,g){var w=typeof Symbol=="function"&&p[Symbol.iterator];if(!w)return p;var x,h,s=w.call(p),c=[];try{for(;(g===void 0||g-- >0)&&!(x=s.next()).done;)c.push(x.value)}catch(o){h={error:o}}finally{try{x&&!x.done&&(w=s.return)&&w.call(s)}finally{if(h)throw h.error}}return c};function S(p){var g=p.toString(16);return g.length<2?"0"+g:g}function b(p,g){return p<g?(g+.05)/(p+.05):(p+.05)/(g+.05)}Object.defineProperty(e,"__esModule",{value:!0}),e.contrastRatio=e.toPaddedHex=e.rgba=e.rgb=e.css=e.color=e.channels=void 0,function(p){p.toCss=function(g,w,x,h){return h!==void 0?"#"+S(g)+S(w)+S(x)+S(h):"#"+S(g)+S(w)+S(x)},p.toRgba=function(g,w,x,h){return h===void 0&&(h=255),(g<<24|w<<16|x<<8|h)>>>0}}(a=e.channels||(e.channels={})),(u=e.color||(e.color={})).blend=function(p,g){var w=(255&g.rgba)/255;if(w===1)return{css:g.css,rgba:g.rgba};var x=g.rgba>>24&255,h=g.rgba>>16&255,s=g.rgba>>8&255,c=p.rgba>>24&255,o=p.rgba>>16&255,f=p.rgba>>8&255,m=c+Math.round((x-c)*w),y=o+Math.round((h-o)*w),C=f+Math.round((s-f)*w);return{css:a.toCss(m,y,C),rgba:a.toRgba(m,y,C)}},u.isOpaque=function(p){return(255&p.rgba)==255},u.ensureContrastRatio=function(p,g,w){var x=l.ensureContrastRatio(p.rgba,g.rgba,w);if(x)return l.toColor(x>>24&255,x>>16&255,x>>8&255)},u.opaque=function(p){var g=(255|p.rgba)>>>0,w=_(l.toChannels(g),3),x=w[0],h=w[1],s=w[2];return{css:a.toCss(x,h,s),rgba:g}},u.opacity=function(p,g){var w=Math.round(255*g),x=_(l.toChannels(p.rgba),3),h=x[0],s=x[1],c=x[2];return{css:a.toCss(h,s,c,w),rgba:a.toRgba(h,s,c,w)}},u.toColorRGB=function(p){return[p.rgba>>24&255,p.rgba>>16&255,p.rgba>>8&255]},(e.css||(e.css={})).toColor=function(p){if(p.match(/#[0-9a-f]{3,8}/i))switch(p.length){case 4:var g=parseInt(p.slice(1,2).repeat(2),16),w=parseInt(p.slice(2,3).repeat(2),16),x=parseInt(p.slice(3,4).repeat(2),16);return l.toColor(g,w,x);case 5:g=parseInt(p.slice(1,2).repeat(2),16),w=parseInt(p.slice(2,3).repeat(2),16),x=parseInt(p.slice(3,4).repeat(2),16);var h=parseInt(p.slice(4,5).repeat(2),16);return l.toColor(g,w,x,h);case 7:return{css:p,rgba:(parseInt(p.slice(1),16)<<8|255)>>>0};case 9:return{css:p,rgba:parseInt(p.slice(1),16)>>>0}}var s=p.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(s)return g=parseInt(s[1]),w=parseInt(s[2]),x=parseInt(s[3]),h=Math.round(255*(s[5]===void 0?1:parseFloat(s[5]))),l.toColor(g,w,x,h);throw new Error("css.toColor: Unsupported css format")},function(p){function g(w,x,h){var s=w/255,c=x/255,o=h/255;return .2126*(s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4))+.7152*(c<=.03928?c/12.92:Math.pow((c+.055)/1.055,2.4))+.0722*(o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4))}p.relativeLuminance=function(w){return g(w>>16&255,w>>8&255,255&w)},p.relativeLuminance2=g}(v=e.rgb||(e.rgb={})),function(p){function g(x,h,s){for(var c=x>>24&255,o=x>>16&255,f=x>>8&255,m=h>>24&255,y=h>>16&255,C=h>>8&255,L=b(v.relativeLuminance2(m,y,C),v.relativeLuminance2(c,o,f));L<s&&(m>0||y>0||C>0);)m-=Math.max(0,Math.ceil(.1*m)),y-=Math.max(0,Math.ceil(.1*y)),C-=Math.max(0,Math.ceil(.1*C)),L=b(v.relativeLuminance2(m,y,C),v.relativeLuminance2(c,o,f));return(m<<24|y<<16|C<<8|255)>>>0}function w(x,h,s){for(var c=x>>24&255,o=x>>16&255,f=x>>8&255,m=h>>24&255,y=h>>16&255,C=h>>8&255,L=b(v.relativeLuminance2(m,y,C),v.relativeLuminance2(c,o,f));L<s&&(m<255||y<255||C<255);)m=Math.min(255,m+Math.ceil(.1*(255-m))),y=Math.min(255,y+Math.ceil(.1*(255-y))),C=Math.min(255,C+Math.ceil(.1*(255-C))),L=b(v.relativeLuminance2(m,y,C),v.relativeLuminance2(c,o,f));return(m<<24|y<<16|C<<8|255)>>>0}p.ensureContrastRatio=function(x,h,s){var c=v.relativeLuminance(x>>8),o=v.relativeLuminance(h>>8);if(b(c,o)<s){if(o<c){var f=g(x,h,s),m=b(c,v.relativeLuminance(f>>8));if(m<s){var y=w(x,x,s);return m>b(c,v.relativeLuminance(y>>8))?f:y}return f}var C=w(x,h,s),L=b(c,v.relativeLuminance(C>>8));return L<s?(y=g(x,x,s),L>b(c,v.relativeLuminance(y>>8))?C:y):C}},p.reduceLuminance=g,p.increaseLuminance=w,p.toChannels=function(x){return[x>>24&255,x>>16&255,x>>8&255,255&x]},p.toColor=function(x,h,s,c){return{css:a.toCss(x,h,s,c),rgba:a.toRgba(x,h,s,c)}}}(l=e.rgba||(e.rgba={})),e.toPaddedHex=S,e.contrastRatio=b},8969:function(d,e,a){var u,v=this&&this.__extends||(u=function(E,A){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,M){D.__proto__=M}||function(D,M){for(var F in M)Object.prototype.hasOwnProperty.call(M,F)&&(D[F]=M[F])},u(E,A)},function(E,A){if(typeof A!="function"&&A!==null)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");function D(){this.constructor=E}u(E,A),E.prototype=A===null?Object.create(A):(D.prototype=A.prototype,new D)}),l=this&&this.__values||function(E){var A=typeof Symbol=="function"&&Symbol.iterator,D=A&&E[A],M=0;if(D)return D.call(E);if(E&&typeof E.length=="number")return{next:function(){return E&&M>=E.length&&(E=void 0),{value:E&&E[M++],done:!E}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.CoreTerminal=void 0;var _=a(844),S=a(2585),b=a(4348),p=a(7866),g=a(744),w=a(7302),x=a(6975),h=a(8460),s=a(1753),c=a(3730),o=a(1480),f=a(7994),m=a(9282),y=a(5435),C=a(5981),L=!1,k=function(E){function A(D){var M=E.call(this)||this;return M._onBinary=new h.EventEmitter,M._onData=new h.EventEmitter,M._onLineFeed=new h.EventEmitter,M._onResize=new h.EventEmitter,M._onScroll=new h.EventEmitter,M._onWriteParsed=new h.EventEmitter,M._instantiationService=new b.InstantiationService,M.optionsService=new w.OptionsService(D),M._instantiationService.setService(S.IOptionsService,M.optionsService),M._bufferService=M.register(M._instantiationService.createInstance(g.BufferService)),M._instantiationService.setService(S.IBufferService,M._bufferService),M._logService=M._instantiationService.createInstance(p.LogService),M._instantiationService.setService(S.ILogService,M._logService),M.coreService=M.register(M._instantiationService.createInstance(x.CoreService,function(){return M.scrollToBottom()})),M._instantiationService.setService(S.ICoreService,M.coreService),M.coreMouseService=M._instantiationService.createInstance(s.CoreMouseService),M._instantiationService.setService(S.ICoreMouseService,M.coreMouseService),M._dirtyRowService=M._instantiationService.createInstance(c.DirtyRowService),M._instantiationService.setService(S.IDirtyRowService,M._dirtyRowService),M.unicodeService=M._instantiationService.createInstance(o.UnicodeService),M._instantiationService.setService(S.IUnicodeService,M.unicodeService),M._charsetService=M._instantiationService.createInstance(f.CharsetService),M._instantiationService.setService(S.ICharsetService,M._charsetService),M._inputHandler=new y.InputHandler(M._bufferService,M._charsetService,M.coreService,M._dirtyRowService,M._logService,M.optionsService,M.coreMouseService,M.unicodeService),M.register((0,h.forwardEvent)(M._inputHandler.onLineFeed,M._onLineFeed)),M.register(M._inputHandler),M.register((0,h.forwardEvent)(M._bufferService.onResize,M._onResize)),M.register((0,h.forwardEvent)(M.coreService.onData,M._onData)),M.register((0,h.forwardEvent)(M.coreService.onBinary,M._onBinary)),M.register(M.optionsService.onOptionChange(function(F){return M._updateOptions(F)})),M.register(M._bufferService.onScroll(function(F){M._onScroll.fire({position:M._bufferService.buffer.ydisp,source:0}),M._dirtyRowService.markRangeDirty(M._bufferService.buffer.scrollTop,M._bufferService.buffer.scrollBottom)})),M.register(M._inputHandler.onScroll(function(F){M._onScroll.fire({position:M._bufferService.buffer.ydisp,source:0}),M._dirtyRowService.markRangeDirty(M._bufferService.buffer.scrollTop,M._bufferService.buffer.scrollBottom)})),M._writeBuffer=new C.WriteBuffer(function(F,T){return M._inputHandler.parse(F,T)}),M.register((0,h.forwardEvent)(M._writeBuffer.onWriteParsed,M._onWriteParsed)),M}return v(A,E),Object.defineProperty(A.prototype,"onBinary",{get:function(){return this._onBinary.event},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onData",{get:function(){return this._onData.event},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onLineFeed",{get:function(){return this._onLineFeed.event},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onResize",{get:function(){return this._onResize.event},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onWriteParsed",{get:function(){return this._onWriteParsed.event},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onScroll",{get:function(){var D=this;return this._onScrollApi||(this._onScrollApi=new h.EventEmitter,this.register(this._onScroll.event(function(M){var F;(F=D._onScrollApi)===null||F===void 0||F.fire(M.position)}))),this._onScrollApi.event},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"cols",{get:function(){return this._bufferService.cols},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"rows",{get:function(){return this._bufferService.rows},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"buffers",{get:function(){return this._bufferService.buffers},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"options",{get:function(){return this.optionsService.options},set:function(D){for(var M in D)this.optionsService.options[M]=D[M]},enumerable:!1,configurable:!0}),A.prototype.dispose=function(){var D;this._isDisposed||(E.prototype.dispose.call(this),(D=this._windowsMode)===null||D===void 0||D.dispose(),this._windowsMode=void 0)},A.prototype.write=function(D,M){this._writeBuffer.write(D,M)},A.prototype.writeSync=function(D,M){this._logService.logLevel<=S.LogLevelEnum.WARN&&!L&&(this._logService.warn("writeSync is unreliable and will be removed soon."),L=!0),this._writeBuffer.writeSync(D,M)},A.prototype.resize=function(D,M){isNaN(D)||isNaN(M)||(D=Math.max(D,g.MINIMUM_COLS),M=Math.max(M,g.MINIMUM_ROWS),this._bufferService.resize(D,M))},A.prototype.scroll=function(D,M){M===void 0&&(M=!1),this._bufferService.scroll(D,M)},A.prototype.scrollLines=function(D,M,F){this._bufferService.scrollLines(D,M,F)},A.prototype.scrollPages=function(D){this._bufferService.scrollPages(D)},A.prototype.scrollToTop=function(){this._bufferService.scrollToTop()},A.prototype.scrollToBottom=function(){this._bufferService.scrollToBottom()},A.prototype.scrollToLine=function(D){this._bufferService.scrollToLine(D)},A.prototype.registerEscHandler=function(D,M){return this._inputHandler.registerEscHandler(D,M)},A.prototype.registerDcsHandler=function(D,M){return this._inputHandler.registerDcsHandler(D,M)},A.prototype.registerCsiHandler=function(D,M){return this._inputHandler.registerCsiHandler(D,M)},A.prototype.registerOscHandler=function(D,M){return this._inputHandler.registerOscHandler(D,M)},A.prototype._setup=function(){this.optionsService.rawOptions.windowsMode&&this._enableWindowsMode()},A.prototype.reset=function(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()},A.prototype._updateOptions=function(D){var M;switch(D){case"scrollback":this.buffers.resize(this.cols,this.rows);break;case"windowsMode":this.optionsService.rawOptions.windowsMode?this._enableWindowsMode():((M=this._windowsMode)===null||M===void 0||M.dispose(),this._windowsMode=void 0)}},A.prototype._enableWindowsMode=function(){var D=this;if(!this._windowsMode){var M=[];M.push(this.onLineFeed(m.updateWindowsModeWrappedState.bind(null,this._bufferService))),M.push(this.registerCsiHandler({final:"H"},function(){return(0,m.updateWindowsModeWrappedState)(D._bufferService),!1})),this._windowsMode={dispose:function(){var F,T;try{for(var R=l(M),O=R.next();!O.done;O=R.next())O.value.dispose()}catch(H){F={error:H}}finally{try{O&&!O.done&&(T=R.return)&&T.call(R)}finally{if(F)throw F.error}}}}}},A}(_.Disposable);e.CoreTerminal=k},8460:(d,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.forwardEvent=e.EventEmitter=void 0;var a=function(){function u(){this._listeners=[],this._disposed=!1}return Object.defineProperty(u.prototype,"event",{get:function(){var v=this;return this._event||(this._event=function(l){return v._listeners.push(l),{dispose:function(){if(!v._disposed){for(var _=0;_<v._listeners.length;_++)if(v._listeners[_]===l)return void v._listeners.splice(_,1)}}}}),this._event},enumerable:!1,configurable:!0}),u.prototype.fire=function(v,l){for(var _=[],S=0;S<this._listeners.length;S++)_.push(this._listeners[S]);for(S=0;S<_.length;S++)_[S].call(void 0,v,l)},u.prototype.dispose=function(){this._listeners&&(this._listeners.length=0),this._disposed=!0},u}();e.EventEmitter=a,e.forwardEvent=function(u,v){return u(function(l){return v.fire(l)})}},5435:function(d,e,a){var u,v=this&&this.__extends||(u=function(M,F){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,R){T.__proto__=R}||function(T,R){for(var O in R)Object.prototype.hasOwnProperty.call(R,O)&&(T[O]=R[O])},u(M,F)},function(M,F){if(typeof F!="function"&&F!==null)throw new TypeError("Class extends value "+String(F)+" is not a constructor or null");function T(){this.constructor=M}u(M,F),M.prototype=F===null?Object.create(F):(T.prototype=F.prototype,new T)});Object.defineProperty(e,"__esModule",{value:!0}),e.InputHandler=e.WindowsOptionsReportType=void 0;var l,_=a(2584),S=a(7116),b=a(2015),p=a(844),g=a(8273),w=a(482),x=a(8437),h=a(8460),s=a(643),c=a(511),o=a(3734),f=a(2585),m=a(6242),y=a(6351),C=a(5941),L={"(":0,")":1,"*":2,"+":3,"-":1,".":2},k=131072;function E(M,F){if(M>24)return F.setWinLines||!1;switch(M){case 1:return!!F.restoreWin;case 2:return!!F.minimizeWin;case 3:return!!F.setWinPosition;case 4:return!!F.setWinSizePixels;case 5:return!!F.raiseWin;case 6:return!!F.lowerWin;case 7:return!!F.refreshWin;case 8:return!!F.setWinSizeChars;case 9:return!!F.maximizeWin;case 10:return!!F.fullscreenWin;case 11:return!!F.getWinState;case 13:return!!F.getWinPosition;case 14:return!!F.getWinSizePixels;case 15:return!!F.getScreenSizePixels;case 16:return!!F.getCellSizePixels;case 18:return!!F.getWinSizeChars;case 19:return!!F.getScreenSizeChars;case 20:return!!F.getIconTitle;case 21:return!!F.getWinTitle;case 22:return!!F.pushTitle;case 23:return!!F.popTitle;case 24:return!!F.setWinLines}return!1}(function(M){M[M.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",M[M.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(l=e.WindowsOptionsReportType||(e.WindowsOptionsReportType={}));var A=function(){function M(F,T,R,O){this._bufferService=F,this._coreService=T,this._logService=R,this._optionsService=O,this._data=new Uint32Array(0)}return M.prototype.hook=function(F){this._data=new Uint32Array(0)},M.prototype.put=function(F,T,R){this._data=(0,g.concat)(this._data,F.subarray(T,R))},M.prototype.unhook=function(F){if(!F)return this._data=new Uint32Array(0),!0;var T=(0,w.utf32ToString)(this._data);switch(this._data=new Uint32Array(0),T){case'"q':this._coreService.triggerDataEvent(_.C0.ESC+'P1$r0"q'+_.C0.ESC+"\\");break;case'"p':this._coreService.triggerDataEvent(_.C0.ESC+'P1$r61;1"p'+_.C0.ESC+"\\");break;case"r":var R=this._bufferService.buffer.scrollTop+1+";"+(this._bufferService.buffer.scrollBottom+1)+"r";this._coreService.triggerDataEvent(_.C0.ESC+"P1$r"+R+_.C0.ESC+"\\");break;case"m":this._coreService.triggerDataEvent(_.C0.ESC+"P1$r0m"+_.C0.ESC+"\\");break;case" q":var O={block:2,underline:4,bar:6}[this._optionsService.rawOptions.cursorStyle];O-=this._optionsService.rawOptions.cursorBlink?1:0,this._coreService.triggerDataEvent(_.C0.ESC+"P1$r"+O+" q"+_.C0.ESC+"\\");break;default:this._logService.debug("Unknown DCS $q %s",T),this._coreService.triggerDataEvent(_.C0.ESC+"P0$r"+_.C0.ESC+"\\")}return!0},M}(),D=function(M){function F(T,R,O,H,ee,ie,J,ne,re){re===void 0&&(re=new b.EscapeSequenceParser);var B=M.call(this)||this;B._bufferService=T,B._charsetService=R,B._coreService=O,B._dirtyRowService=H,B._logService=ee,B._optionsService=ie,B._coreMouseService=J,B._unicodeService=ne,B._parser=re,B._parseBuffer=new Uint32Array(4096),B._stringDecoder=new w.StringToUtf32,B._utf8Decoder=new w.Utf8ToUtf32,B._workCell=new c.CellData,B._windowTitle="",B._iconName="",B._windowTitleStack=[],B._iconNameStack=[],B._curAttrData=x.DEFAULT_ATTR_DATA.clone(),B._eraseAttrDataInternal=x.DEFAULT_ATTR_DATA.clone(),B._onRequestBell=new h.EventEmitter,B._onRequestRefreshRows=new h.EventEmitter,B._onRequestReset=new h.EventEmitter,B._onRequestSendFocus=new h.EventEmitter,B._onRequestSyncScrollBar=new h.EventEmitter,B._onRequestWindowsOptionsReport=new h.EventEmitter,B._onA11yChar=new h.EventEmitter,B._onA11yTab=new h.EventEmitter,B._onCursorMove=new h.EventEmitter,B._onLineFeed=new h.EventEmitter,B._onScroll=new h.EventEmitter,B._onTitleChange=new h.EventEmitter,B._onColor=new h.EventEmitter,B._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},B._specialColors=[256,257,258],B.register(B._parser),B._activeBuffer=B._bufferService.buffer,B.register(B._bufferService.buffers.onBufferActivate(function(U){return B._activeBuffer=U.activeBuffer})),B._parser.setCsiHandlerFallback(function(U,xe){B._logService.debug("Unknown CSI code: ",{identifier:B._parser.identToString(U),params:xe.toArray()})}),B._parser.setEscHandlerFallback(function(U){B._logService.debug("Unknown ESC code: ",{identifier:B._parser.identToString(U)})}),B._parser.setExecuteHandlerFallback(function(U){B._logService.debug("Unknown EXECUTE code: ",{code:U})}),B._parser.setOscHandlerFallback(function(U,xe,ce){B._logService.debug("Unknown OSC code: ",{identifier:U,action:xe,data:ce})}),B._parser.setDcsHandlerFallback(function(U,xe,ce){xe==="HOOK"&&(ce=ce.toArray()),B._logService.debug("Unknown DCS code: ",{identifier:B._parser.identToString(U),action:xe,payload:ce})}),B._parser.setPrintHandler(function(U,xe,ce){return B.print(U,xe,ce)}),B._parser.registerCsiHandler({final:"@"},function(U){return B.insertChars(U)}),B._parser.registerCsiHandler({intermediates:" ",final:"@"},function(U){return B.scrollLeft(U)}),B._parser.registerCsiHandler({final:"A"},function(U){return B.cursorUp(U)}),B._parser.registerCsiHandler({intermediates:" ",final:"A"},function(U){return B.scrollRight(U)}),B._parser.registerCsiHandler({final:"B"},function(U){return B.cursorDown(U)}),B._parser.registerCsiHandler({final:"C"},function(U){return B.cursorForward(U)}),B._parser.registerCsiHandler({final:"D"},function(U){return B.cursorBackward(U)}),B._parser.registerCsiHandler({final:"E"},function(U){return B.cursorNextLine(U)}),B._parser.registerCsiHandler({final:"F"},function(U){return B.cursorPrecedingLine(U)}),B._parser.registerCsiHandler({final:"G"},function(U){return B.cursorCharAbsolute(U)}),B._parser.registerCsiHandler({final:"H"},function(U){return B.cursorPosition(U)}),B._parser.registerCsiHandler({final:"I"},function(U){return B.cursorForwardTab(U)}),B._parser.registerCsiHandler({final:"J"},function(U){return B.eraseInDisplay(U)}),B._parser.registerCsiHandler({prefix:"?",final:"J"},function(U){return B.eraseInDisplay(U)}),B._parser.registerCsiHandler({final:"K"},function(U){return B.eraseInLine(U)}),B._parser.registerCsiHandler({prefix:"?",final:"K"},function(U){return B.eraseInLine(U)}),B._parser.registerCsiHandler({final:"L"},function(U){return B.insertLines(U)}),B._parser.registerCsiHandler({final:"M"},function(U){return B.deleteLines(U)}),B._parser.registerCsiHandler({final:"P"},function(U){return B.deleteChars(U)}),B._parser.registerCsiHandler({final:"S"},function(U){return B.scrollUp(U)}),B._parser.registerCsiHandler({final:"T"},function(U){return B.scrollDown(U)}),B._parser.registerCsiHandler({final:"X"},function(U){return B.eraseChars(U)}),B._parser.registerCsiHandler({final:"Z"},function(U){return B.cursorBackwardTab(U)}),B._parser.registerCsiHandler({final:"`"},function(U){return B.charPosAbsolute(U)}),B._parser.registerCsiHandler({final:"a"},function(U){return B.hPositionRelative(U)}),B._parser.registerCsiHandler({final:"b"},function(U){return B.repeatPrecedingCharacter(U)}),B._parser.registerCsiHandler({final:"c"},function(U){return B.sendDeviceAttributesPrimary(U)}),B._parser.registerCsiHandler({prefix:">",final:"c"},function(U){return B.sendDeviceAttributesSecondary(U)}),B._parser.registerCsiHandler({final:"d"},function(U){return B.linePosAbsolute(U)}),B._parser.registerCsiHandler({final:"e"},function(U){return B.vPositionRelative(U)}),B._parser.registerCsiHandler({final:"f"},function(U){return B.hVPosition(U)}),B._parser.registerCsiHandler({final:"g"},function(U){return B.tabClear(U)}),B._parser.registerCsiHandler({final:"h"},function(U){return B.setMode(U)}),B._parser.registerCsiHandler({prefix:"?",final:"h"},function(U){return B.setModePrivate(U)}),B._parser.registerCsiHandler({final:"l"},function(U){return B.resetMode(U)}),B._parser.registerCsiHandler({prefix:"?",final:"l"},function(U){return B.resetModePrivate(U)}),B._parser.registerCsiHandler({final:"m"},function(U){return B.charAttributes(U)}),B._parser.registerCsiHandler({final:"n"},function(U){return B.deviceStatus(U)}),B._parser.registerCsiHandler({prefix:"?",final:"n"},function(U){return B.deviceStatusPrivate(U)}),B._parser.registerCsiHandler({intermediates:"!",final:"p"},function(U){return B.softReset(U)}),B._parser.registerCsiHandler({intermediates:" ",final:"q"},function(U){return B.setCursorStyle(U)}),B._parser.registerCsiHandler({final:"r"},function(U){return B.setScrollRegion(U)}),B._parser.registerCsiHandler({final:"s"},function(U){return B.saveCursor(U)}),B._parser.registerCsiHandler({final:"t"},function(U){return B.windowOptions(U)}),B._parser.registerCsiHandler({final:"u"},function(U){return B.restoreCursor(U)}),B._parser.registerCsiHandler({intermediates:"'",final:"}"},function(U){return B.insertColumns(U)}),B._parser.registerCsiHandler({intermediates:"'",final:"~"},function(U){return B.deleteColumns(U)}),B._parser.setExecuteHandler(_.C0.BEL,function(){return B.bell()}),B._parser.setExecuteHandler(_.C0.LF,function(){return B.lineFeed()}),B._parser.setExecuteHandler(_.C0.VT,function(){return B.lineFeed()}),B._parser.setExecuteHandler(_.C0.FF,function(){return B.lineFeed()}),B._parser.setExecuteHandler(_.C0.CR,function(){return B.carriageReturn()}),B._parser.setExecuteHandler(_.C0.BS,function(){return B.backspace()}),B._parser.setExecuteHandler(_.C0.HT,function(){return B.tab()}),B._parser.setExecuteHandler(_.C0.SO,function(){return B.shiftOut()}),B._parser.setExecuteHandler(_.C0.SI,function(){return B.shiftIn()}),B._parser.setExecuteHandler(_.C1.IND,function(){return B.index()}),B._parser.setExecuteHandler(_.C1.NEL,function(){return B.nextLine()}),B._parser.setExecuteHandler(_.C1.HTS,function(){return B.tabSet()}),B._parser.registerOscHandler(0,new m.OscHandler(function(U){return B.setTitle(U),B.setIconName(U),!0})),B._parser.registerOscHandler(1,new m.OscHandler(function(U){return B.setIconName(U)})),B._parser.registerOscHandler(2,new m.OscHandler(function(U){return B.setTitle(U)})),B._parser.registerOscHandler(4,new m.OscHandler(function(U){return B.setOrReportIndexedColor(U)})),B._parser.registerOscHandler(10,new m.OscHandler(function(U){return B.setOrReportFgColor(U)})),B._parser.registerOscHandler(11,new m.OscHandler(function(U){return B.setOrReportBgColor(U)})),B._parser.registerOscHandler(12,new m.OscHandler(function(U){return B.setOrReportCursorColor(U)})),B._parser.registerOscHandler(104,new m.OscHandler(function(U){return B.restoreIndexedColor(U)})),B._parser.registerOscHandler(110,new m.OscHandler(function(U){return B.restoreFgColor(U)})),B._parser.registerOscHandler(111,new m.OscHandler(function(U){return B.restoreBgColor(U)})),B._parser.registerOscHandler(112,new m.OscHandler(function(U){return B.restoreCursorColor(U)})),B._parser.registerEscHandler({final:"7"},function(){return B.saveCursor()}),B._parser.registerEscHandler({final:"8"},function(){return B.restoreCursor()}),B._parser.registerEscHandler({final:"D"},function(){return B.index()}),B._parser.registerEscHandler({final:"E"},function(){return B.nextLine()}),B._parser.registerEscHandler({final:"H"},function(){return B.tabSet()}),B._parser.registerEscHandler({final:"M"},function(){return B.reverseIndex()}),B._parser.registerEscHandler({final:"="},function(){return B.keypadApplicationMode()}),B._parser.registerEscHandler({final:">"},function(){return B.keypadNumericMode()}),B._parser.registerEscHandler({final:"c"},function(){return B.fullReset()}),B._parser.registerEscHandler({final:"n"},function(){return B.setgLevel(2)}),B._parser.registerEscHandler({final:"o"},function(){return B.setgLevel(3)}),B._parser.registerEscHandler({final:"|"},function(){return B.setgLevel(3)}),B._parser.registerEscHandler({final:"}"},function(){return B.setgLevel(2)}),B._parser.registerEscHandler({final:"~"},function(){return B.setgLevel(1)}),B._parser.registerEscHandler({intermediates:"%",final:"@"},function(){return B.selectDefaultCharset()}),B._parser.registerEscHandler({intermediates:"%",final:"G"},function(){return B.selectDefaultCharset()});var he=function(U){le._parser.registerEscHandler({intermediates:"(",final:U},function(){return B.selectCharset("("+U)}),le._parser.registerEscHandler({intermediates:")",final:U},function(){return B.selectCharset(")"+U)}),le._parser.registerEscHandler({intermediates:"*",final:U},function(){return B.selectCharset("*"+U)}),le._parser.registerEscHandler({intermediates:"+",final:U},function(){return B.selectCharset("+"+U)}),le._parser.registerEscHandler({intermediates:"-",final:U},function(){return B.selectCharset("-"+U)}),le._parser.registerEscHandler({intermediates:".",final:U},function(){return B.selectCharset("."+U)}),le._parser.registerEscHandler({intermediates:"/",final:U},function(){return B.selectCharset("/"+U)})},le=this;for(var me in S.CHARSETS)he(me);return B._parser.registerEscHandler({intermediates:"#",final:"8"},function(){return B.screenAlignmentPattern()}),B._parser.setErrorHandler(function(U){return B._logService.error("Parsing error: ",U),U}),B._parser.registerDcsHandler({intermediates:"$",final:"q"},new A(B._bufferService,B._coreService,B._logService,B._optionsService)),B}return v(F,M),Object.defineProperty(F.prototype,"onRequestBell",{get:function(){return this._onRequestBell.event},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"onRequestRefreshRows",{get:function(){return this._onRequestRefreshRows.event},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"onRequestReset",{get:function(){return this._onRequestReset.event},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"onRequestSendFocus",{get:function(){return this._onRequestSendFocus.event},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"onRequestSyncScrollBar",{get:function(){return this._onRequestSyncScrollBar.event},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"onRequestWindowsOptionsReport",{get:function(){return this._onRequestWindowsOptionsReport.event},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"onA11yChar",{get:function(){return this._onA11yChar.event},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"onA11yTab",{get:function(){return this._onA11yTab.event},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"onCursorMove",{get:function(){return this._onCursorMove.event},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"onLineFeed",{get:function(){return this._onLineFeed.event},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"onScroll",{get:function(){return this._onScroll.event},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"onTitleChange",{get:function(){return this._onTitleChange.event},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"onColor",{get:function(){return this._onColor.event},enumerable:!1,configurable:!0}),F.prototype.dispose=function(){M.prototype.dispose.call(this)},F.prototype._preserveStack=function(T,R,O,H){this._parseStack.paused=!0,this._parseStack.cursorStartX=T,this._parseStack.cursorStartY=R,this._parseStack.decodedLength=O,this._parseStack.position=H},F.prototype._logSlowResolvingAsync=function(T){this._logService.logLevel<=f.LogLevelEnum.WARN&&Promise.race([T,new Promise(function(R,O){return setTimeout(function(){return O("#SLOW_TIMEOUT")},5e3)})]).catch(function(R){if(R!=="#SLOW_TIMEOUT")throw R;console.warn("async parser handler taking longer than 5000 ms")})},F.prototype.parse=function(T,R){var O,H=this._activeBuffer.x,ee=this._activeBuffer.y,ie=0,J=this._parseStack.paused;if(J){if(O=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,R))return this._logSlowResolvingAsync(O),O;H=this._parseStack.cursorStartX,ee=this._parseStack.cursorStartY,this._parseStack.paused=!1,T.length>k&&(ie=this._parseStack.position+k)}if(this._logService.logLevel<=f.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof T=="string"?' "'+T+'"':' "'+Array.prototype.map.call(T,function(he){return String.fromCharCode(he)}).join("")+'"'),typeof T=="string"?T.split("").map(function(he){return he.charCodeAt(0)}):T),this._parseBuffer.length<T.length&&this._parseBuffer.length<k&&(this._parseBuffer=new Uint32Array(Math.min(T.length,k))),J||this._dirtyRowService.clearRange(),T.length>k)for(var ne=ie;ne<T.length;ne+=k){var re=ne+k<T.length?ne+k:T.length,B=typeof T=="string"?this._stringDecoder.decode(T.substring(ne,re),this._parseBuffer):this._utf8Decoder.decode(T.subarray(ne,re),this._parseBuffer);if(O=this._parser.parse(this._parseBuffer,B))return this._preserveStack(H,ee,B,ne),this._logSlowResolvingAsync(O),O}else if(!J&&(B=typeof T=="string"?this._stringDecoder.decode(T,this._parseBuffer):this._utf8Decoder.decode(T,this._parseBuffer),O=this._parser.parse(this._parseBuffer,B)))return this._preserveStack(H,ee,B,0),this._logSlowResolvingAsync(O),O;this._activeBuffer.x===H&&this._activeBuffer.y===ee||this._onCursorMove.fire(),this._onRequestRefreshRows.fire(this._dirtyRowService.start,this._dirtyRowService.end)},F.prototype.print=function(T,R,O){var H,ee,ie=this._charsetService.charset,J=this._optionsService.rawOptions.screenReaderMode,ne=this._bufferService.cols,re=this._coreService.decPrivateModes.wraparound,B=this._coreService.modes.insertMode,he=this._curAttrData,le=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowService.markDirty(this._activeBuffer.y),this._activeBuffer.x&&O-R>0&&le.getWidth(this._activeBuffer.x-1)===2&&le.setCellFromCodePoint(this._activeBuffer.x-1,0,1,he.fg,he.bg,he.extended);for(var me=R;me<O;++me){if(H=T[me],ee=this._unicodeService.wcwidth(H),H<127&&ie){var U=ie[String.fromCharCode(H)];U&&(H=U.charCodeAt(0))}if(J&&this._onA11yChar.fire((0,w.stringFromCodePoint)(H)),ee||!this._activeBuffer.x){if(this._activeBuffer.x+ee-1>=ne){if(re){for(;this._activeBuffer.x<ne;)le.setCellFromCodePoint(this._activeBuffer.x++,0,1,he.fg,he.bg,he.extended);this._activeBuffer.x=0,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),le=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)}else if(this._activeBuffer.x=ne-1,ee===2)continue}if(B&&(le.insertCells(this._activeBuffer.x,ee,this._activeBuffer.getNullCell(he),he),le.getWidth(ne-1)===2&&le.setCellFromCodePoint(ne-1,s.NULL_CELL_CODE,s.NULL_CELL_WIDTH,he.fg,he.bg,he.extended)),le.setCellFromCodePoint(this._activeBuffer.x++,H,ee,he.fg,he.bg,he.extended),ee>0)for(;--ee;)le.setCellFromCodePoint(this._activeBuffer.x++,0,0,he.fg,he.bg,he.extended)}else le.getWidth(this._activeBuffer.x-1)?le.addCodepointToCell(this._activeBuffer.x-1,H):le.addCodepointToCell(this._activeBuffer.x-2,H)}O-R>0&&(le.loadCell(this._activeBuffer.x-1,this._workCell),this._workCell.getWidth()===2||this._workCell.getCode()>65535?this._parser.precedingCodepoint=0:this._workCell.isCombined()?this._parser.precedingCodepoint=this._workCell.getChars().charCodeAt(0):this._parser.precedingCodepoint=this._workCell.content),this._activeBuffer.x<ne&&O-R>0&&le.getWidth(this._activeBuffer.x)===0&&!le.hasContent(this._activeBuffer.x)&&le.setCellFromCodePoint(this._activeBuffer.x,0,1,he.fg,he.bg,he.extended),this._dirtyRowService.markDirty(this._activeBuffer.y)},F.prototype.registerCsiHandler=function(T,R){var O=this;return T.final!=="t"||T.prefix||T.intermediates?this._parser.registerCsiHandler(T,R):this._parser.registerCsiHandler(T,function(H){return!E(H.params[0],O._optionsService.rawOptions.windowOptions)||R(H)})},F.prototype.registerDcsHandler=function(T,R){return this._parser.registerDcsHandler(T,new y.DcsHandler(R))},F.prototype.registerEscHandler=function(T,R){return this._parser.registerEscHandler(T,R)},F.prototype.registerOscHandler=function(T,R){return this._parser.registerOscHandler(T,new m.OscHandler(R))},F.prototype.bell=function(){return this._onRequestBell.fire(),!0},F.prototype.lineFeed=function(){return this._dirtyRowService.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowService.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0},F.prototype.carriageReturn=function(){return this._activeBuffer.x=0,!0},F.prototype.backspace=function(){var T;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&(!((T=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))===null||T===void 0)&&T.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;var R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);R.hasWidth(this._activeBuffer.x)&&!R.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0},F.prototype.tab=function(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;var T=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-T),!0},F.prototype.shiftOut=function(){return this._charsetService.setgLevel(1),!0},F.prototype.shiftIn=function(){return this._charsetService.setgLevel(0),!0},F.prototype._restrictCursor=function(T){T===void 0&&(T=this._bufferService.cols-1),this._activeBuffer.x=Math.min(T,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowService.markDirty(this._activeBuffer.y)},F.prototype._setCursor=function(T,R){this._dirtyRowService.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=T,this._activeBuffer.y=this._activeBuffer.scrollTop+R):(this._activeBuffer.x=T,this._activeBuffer.y=R),this._restrictCursor(),this._dirtyRowService.markDirty(this._activeBuffer.y)},F.prototype._moveCursor=function(T,R){this._restrictCursor(),this._setCursor(this._activeBuffer.x+T,this._activeBuffer.y+R)},F.prototype.cursorUp=function(T){var R=this._activeBuffer.y-this._activeBuffer.scrollTop;return R>=0?this._moveCursor(0,-Math.min(R,T.params[0]||1)):this._moveCursor(0,-(T.params[0]||1)),!0},F.prototype.cursorDown=function(T){var R=this._activeBuffer.scrollBottom-this._activeBuffer.y;return R>=0?this._moveCursor(0,Math.min(R,T.params[0]||1)):this._moveCursor(0,T.params[0]||1),!0},F.prototype.cursorForward=function(T){return this._moveCursor(T.params[0]||1,0),!0},F.prototype.cursorBackward=function(T){return this._moveCursor(-(T.params[0]||1),0),!0},F.prototype.cursorNextLine=function(T){return this.cursorDown(T),this._activeBuffer.x=0,!0},F.prototype.cursorPrecedingLine=function(T){return this.cursorUp(T),this._activeBuffer.x=0,!0},F.prototype.cursorCharAbsolute=function(T){return this._setCursor((T.params[0]||1)-1,this._activeBuffer.y),!0},F.prototype.cursorPosition=function(T){return this._setCursor(T.length>=2?(T.params[1]||1)-1:0,(T.params[0]||1)-1),!0},F.prototype.charPosAbsolute=function(T){return this._setCursor((T.params[0]||1)-1,this._activeBuffer.y),!0},F.prototype.hPositionRelative=function(T){return this._moveCursor(T.params[0]||1,0),!0},F.prototype.linePosAbsolute=function(T){return this._setCursor(this._activeBuffer.x,(T.params[0]||1)-1),!0},F.prototype.vPositionRelative=function(T){return this._moveCursor(0,T.params[0]||1),!0},F.prototype.hVPosition=function(T){return this.cursorPosition(T),!0},F.prototype.tabClear=function(T){var R=T.params[0];return R===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:R===3&&(this._activeBuffer.tabs={}),!0},F.prototype.cursorForwardTab=function(T){if(this._activeBuffer.x>=this._bufferService.cols)return!0;for(var R=T.params[0]||1;R--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0},F.prototype.cursorBackwardTab=function(T){if(this._activeBuffer.x>=this._bufferService.cols)return!0;for(var R=T.params[0]||1;R--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0},F.prototype._eraseInBufferLine=function(T,R,O,H){H===void 0&&(H=!1);var ee=this._activeBuffer.lines.get(this._activeBuffer.ybase+T);ee.replaceCells(R,O,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),H&&(ee.isWrapped=!1)},F.prototype._resetBufferLine=function(T){var R=this._activeBuffer.lines.get(this._activeBuffer.ybase+T);R.fill(this._activeBuffer.getNullCell(this._eraseAttrData())),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+T),R.isWrapped=!1},F.prototype.eraseInDisplay=function(T){var R;switch(this._restrictCursor(this._bufferService.cols),T.params[0]){case 0:for(R=this._activeBuffer.y,this._dirtyRowService.markDirty(R),this._eraseInBufferLine(R++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0);R<this._bufferService.rows;R++)this._resetBufferLine(R);this._dirtyRowService.markDirty(R);break;case 1:for(R=this._activeBuffer.y,this._dirtyRowService.markDirty(R),this._eraseInBufferLine(R,0,this._activeBuffer.x+1,!0),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(R+1).isWrapped=!1);R--;)this._resetBufferLine(R);this._dirtyRowService.markDirty(0);break;case 2:for(R=this._bufferService.rows,this._dirtyRowService.markDirty(R-1);R--;)this._resetBufferLine(R);this._dirtyRowService.markDirty(0);break;case 3:var O=this._activeBuffer.lines.length-this._bufferService.rows;O>0&&(this._activeBuffer.lines.trimStart(O),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-O,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-O,0),this._onScroll.fire(0))}return!0},F.prototype.eraseInLine=function(T){switch(this._restrictCursor(this._bufferService.cols),T.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0)}return this._dirtyRowService.markDirty(this._activeBuffer.y),!0},F.prototype.insertLines=function(T){this._restrictCursor();var R=T.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;for(var O=this._activeBuffer.ybase+this._activeBuffer.y,H=this._bufferService.rows-1-this._activeBuffer.scrollBottom,ee=this._bufferService.rows-1+this._activeBuffer.ybase-H+1;R--;)this._activeBuffer.lines.splice(ee-1,1),this._activeBuffer.lines.splice(O,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowService.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0},F.prototype.deleteLines=function(T){this._restrictCursor();var R=T.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;var O,H=this._activeBuffer.ybase+this._activeBuffer.y;for(O=this._bufferService.rows-1-this._activeBuffer.scrollBottom,O=this._bufferService.rows-1+this._activeBuffer.ybase-O;R--;)this._activeBuffer.lines.splice(H,1),this._activeBuffer.lines.splice(O,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowService.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0},F.prototype.insertChars=function(T){this._restrictCursor();var R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return R&&(R.insertCells(this._activeBuffer.x,T.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowService.markDirty(this._activeBuffer.y)),!0},F.prototype.deleteChars=function(T){this._restrictCursor();var R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return R&&(R.deleteCells(this._activeBuffer.x,T.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowService.markDirty(this._activeBuffer.y)),!0},F.prototype.scrollUp=function(T){for(var R=T.params[0]||1;R--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowService.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0},F.prototype.scrollDown=function(T){for(var R=T.params[0]||1;R--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(x.DEFAULT_ATTR_DATA));return this._dirtyRowService.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0},F.prototype.scrollLeft=function(T){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;for(var R=T.params[0]||1,O=this._activeBuffer.scrollTop;O<=this._activeBuffer.scrollBottom;++O){var H=this._activeBuffer.lines.get(this._activeBuffer.ybase+O);H.deleteCells(0,R,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),H.isWrapped=!1}return this._dirtyRowService.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0},F.prototype.scrollRight=function(T){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;for(var R=T.params[0]||1,O=this._activeBuffer.scrollTop;O<=this._activeBuffer.scrollBottom;++O){var H=this._activeBuffer.lines.get(this._activeBuffer.ybase+O);H.insertCells(0,R,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),H.isWrapped=!1}return this._dirtyRowService.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0},F.prototype.insertColumns=function(T){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;for(var R=T.params[0]||1,O=this._activeBuffer.scrollTop;O<=this._activeBuffer.scrollBottom;++O){var H=this._activeBuffer.lines.get(this._activeBuffer.ybase+O);H.insertCells(this._activeBuffer.x,R,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),H.isWrapped=!1}return this._dirtyRowService.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0},F.prototype.deleteColumns=function(T){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;for(var R=T.params[0]||1,O=this._activeBuffer.scrollTop;O<=this._activeBuffer.scrollBottom;++O){var H=this._activeBuffer.lines.get(this._activeBuffer.ybase+O);H.deleteCells(this._activeBuffer.x,R,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),H.isWrapped=!1}return this._dirtyRowService.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0},F.prototype.eraseChars=function(T){this._restrictCursor();var R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return R&&(R.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(T.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowService.markDirty(this._activeBuffer.y)),!0},F.prototype.repeatPrecedingCharacter=function(T){if(!this._parser.precedingCodepoint)return!0;for(var R=T.params[0]||1,O=new Uint32Array(R),H=0;H<R;++H)O[H]=this._parser.precedingCodepoint;return this.print(O,0,O.length),!0},F.prototype.sendDeviceAttributesPrimary=function(T){return T.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(_.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(_.C0.ESC+"[?6c")),!0},F.prototype.sendDeviceAttributesSecondary=function(T){return T.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(_.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(_.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(T.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(_.C0.ESC+"[>83;40003;0c")),!0},F.prototype._is=function(T){return(this._optionsService.rawOptions.termName+"").indexOf(T)===0},F.prototype.setMode=function(T){for(var R=0;R<T.length;R++)T.params[R]===4&&(this._coreService.modes.insertMode=!0);return!0},F.prototype.setModePrivate=function(T){for(var R=0;R<T.length;R++)switch(T.params[R]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,S.DEFAULT_CHARSET),this._charsetService.setgCharset(1,S.DEFAULT_CHARSET),this._charsetService.setgCharset(2,S.DEFAULT_CHARSET),this._charsetService.setgCharset(3,S.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0},F.prototype.resetMode=function(T){for(var R=0;R<T.length;R++)T.params[R]===4&&(this._coreService.modes.insertMode=!1);return!0},F.prototype.resetModePrivate=function(T){for(var R=0;R<T.length;R++)switch(T.params[R]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),T.params[R]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0},F.prototype._updateAttrColor=function(T,R,O,H,ee){return R===2?(T|=50331648,T&=-16777216,T|=o.AttributeData.fromColorRGB([O,H,ee])):R===5&&(T&=-50331904,T|=33554432|255&O),T},F.prototype._extractColor=function(T,R,O){var H=[0,0,-1,0,0,0],ee=0,ie=0;do{if(H[ie+ee]=T.params[R+ie],T.hasSubParams(R+ie)){var J=T.getSubParams(R+ie),ne=0;do H[1]===5&&(ee=1),H[ie+ne+1+ee]=J[ne];while(++ne<J.length&&ne+ie+1+ee<H.length);break}if(H[1]===5&&ie+ee>=2||H[1]===2&&ie+ee>=5)break;H[1]&&(ee=1)}while(++ie+R<T.length&&ie+ee<H.length);for(ne=2;ne<H.length;++ne)H[ne]===-1&&(H[ne]=0);switch(H[0]){case 38:O.fg=this._updateAttrColor(O.fg,H[1],H[3],H[4],H[5]);break;case 48:O.bg=this._updateAttrColor(O.bg,H[1],H[3],H[4],H[5]);break;case 58:O.extended=O.extended.clone(),O.extended.underlineColor=this._updateAttrColor(O.extended.underlineColor,H[1],H[3],H[4],H[5])}return ie},F.prototype._processUnderline=function(T,R){R.extended=R.extended.clone(),(!~T||T>5)&&(T=1),R.extended.underlineStyle=T,R.fg|=268435456,T===0&&(R.fg&=-268435457),R.updateExtended()},F.prototype.charAttributes=function(T){if(T.length===1&&T.params[0]===0)return this._curAttrData.fg=x.DEFAULT_ATTR_DATA.fg,this._curAttrData.bg=x.DEFAULT_ATTR_DATA.bg,!0;for(var R,O=T.length,H=this._curAttrData,ee=0;ee<O;ee++)(R=T.params[ee])>=30&&R<=37?(H.fg&=-50331904,H.fg|=16777216|R-30):R>=40&&R<=47?(H.bg&=-50331904,H.bg|=16777216|R-40):R>=90&&R<=97?(H.fg&=-50331904,H.fg|=16777224|R-90):R>=100&&R<=107?(H.bg&=-50331904,H.bg|=16777224|R-100):R===0?(H.fg=x.DEFAULT_ATTR_DATA.fg,H.bg=x.DEFAULT_ATTR_DATA.bg):R===1?H.fg|=134217728:R===3?H.bg|=67108864:R===4?(H.fg|=268435456,this._processUnderline(T.hasSubParams(ee)?T.getSubParams(ee)[0]:1,H)):R===5?H.fg|=536870912:R===7?H.fg|=67108864:R===8?H.fg|=1073741824:R===9?H.fg|=2147483648:R===2?H.bg|=134217728:R===21?this._processUnderline(2,H):R===22?(H.fg&=-134217729,H.bg&=-134217729):R===23?H.bg&=-67108865:R===24?H.fg&=-268435457:R===25?H.fg&=-536870913:R===27?H.fg&=-67108865:R===28?H.fg&=-1073741825:R===29?H.fg&=2147483647:R===39?(H.fg&=-67108864,H.fg|=16777215&x.DEFAULT_ATTR_DATA.fg):R===49?(H.bg&=-67108864,H.bg|=16777215&x.DEFAULT_ATTR_DATA.bg):R===38||R===48||R===58?ee+=this._extractColor(T,ee,H):R===59?(H.extended=H.extended.clone(),H.extended.underlineColor=-1,H.updateExtended()):R===100?(H.fg&=-67108864,H.fg|=16777215&x.DEFAULT_ATTR_DATA.fg,H.bg&=-67108864,H.bg|=16777215&x.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",R);return!0},F.prototype.deviceStatus=function(T){switch(T.params[0]){case 5:this._coreService.triggerDataEvent(_.C0.ESC+"[0n");break;case 6:var R=this._activeBuffer.y+1,O=this._activeBuffer.x+1;this._coreService.triggerDataEvent(_.C0.ESC+"["+R+";"+O+"R")}return!0},F.prototype.deviceStatusPrivate=function(T){if(T.params[0]===6){var R=this._activeBuffer.y+1,O=this._activeBuffer.x+1;this._coreService.triggerDataEvent(_.C0.ESC+"[?"+R+";"+O+"R")}return!0},F.prototype.softReset=function(T){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=x.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0},F.prototype.setCursorStyle=function(T){var R=T.params[0]||1;switch(R){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}var O=R%2==1;return this._optionsService.options.cursorBlink=O,!0},F.prototype.setScrollRegion=function(T){var R,O=T.params[0]||1;return(T.length<2||(R=T.params[1])>this._bufferService.rows||R===0)&&(R=this._bufferService.rows),R>O&&(this._activeBuffer.scrollTop=O-1,this._activeBuffer.scrollBottom=R-1,this._setCursor(0,0)),!0},F.prototype.windowOptions=function(T){if(!E(T.params[0],this._optionsService.rawOptions.windowOptions))return!0;var R=T.length>1?T.params[1]:0;switch(T.params[0]){case 14:R!==2&&this._onRequestWindowsOptionsReport.fire(l.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(l.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(_.C0.ESC+"[8;"+this._bufferService.rows+";"+this._bufferService.cols+"t");break;case 22:R!==0&&R!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),R!==0&&R!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:R!==0&&R!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),R!==0&&R!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0},F.prototype.saveCursor=function(T){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0},F.prototype.restoreCursor=function(T){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0},F.prototype.setTitle=function(T){return this._windowTitle=T,this._onTitleChange.fire(T),!0},F.prototype.setIconName=function(T){return this._iconName=T,!0},F.prototype.setOrReportIndexedColor=function(T){for(var R=[],O=T.split(";");O.length>1;){var H=O.shift(),ee=O.shift();if(/^\d+$/.exec(H)){var ie=parseInt(H);if(0<=ie&&ie<256)if(ee==="?")R.push({type:0,index:ie});else{var J=(0,C.parseColor)(ee);J&&R.push({type:1,index:ie,color:J})}}}return R.length&&this._onColor.fire(R),!0},F.prototype._setOrReportSpecialColor=function(T,R){for(var O=T.split(";"),H=0;H<O.length&&!(R>=this._specialColors.length);++H,++R)if(O[H]==="?")this._onColor.fire([{type:0,index:this._specialColors[R]}]);else{var ee=(0,C.parseColor)(O[H]);ee&&this._onColor.fire([{type:1,index:this._specialColors[R],color:ee}])}return!0},F.prototype.setOrReportFgColor=function(T){return this._setOrReportSpecialColor(T,0)},F.prototype.setOrReportBgColor=function(T){return this._setOrReportSpecialColor(T,1)},F.prototype.setOrReportCursorColor=function(T){return this._setOrReportSpecialColor(T,2)},F.prototype.restoreIndexedColor=function(T){if(!T)return this._onColor.fire([{type:2}]),!0;for(var R=[],O=T.split(";"),H=0;H<O.length;++H)if(/^\d+$/.exec(O[H])){var ee=parseInt(O[H]);0<=ee&&ee<256&&R.push({type:2,index:ee})}return R.length&&this._onColor.fire(R),!0},F.prototype.restoreFgColor=function(T){return this._onColor.fire([{type:2,index:256}]),!0},F.prototype.restoreBgColor=function(T){return this._onColor.fire([{type:2,index:257}]),!0},F.prototype.restoreCursorColor=function(T){return this._onColor.fire([{type:2,index:258}]),!0},F.prototype.nextLine=function(){return this._activeBuffer.x=0,this.index(),!0},F.prototype.keypadApplicationMode=function(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0},F.prototype.keypadNumericMode=function(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0},F.prototype.selectDefaultCharset=function(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,S.DEFAULT_CHARSET),!0},F.prototype.selectCharset=function(T){return T.length!==2?(this.selectDefaultCharset(),!0):(T[0]==="/"||this._charsetService.setgCharset(L[T[0]],S.CHARSETS[T[1]]||S.DEFAULT_CHARSET),!0)},F.prototype.index=function(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0},F.prototype.tabSet=function(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0},F.prototype.reverseIndex=function(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){var T=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,T,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowService.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0},F.prototype.fullReset=function(){return this._parser.reset(),this._onRequestReset.fire(),!0},F.prototype.reset=function(){this._curAttrData=x.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=x.DEFAULT_ATTR_DATA.clone()},F.prototype._eraseAttrData=function(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal},F.prototype.setgLevel=function(T){return this._charsetService.setgLevel(T),!0},F.prototype.screenAlignmentPattern=function(){var T=new c.CellData;T.content=1<<22|69,T.fg=this._curAttrData.fg,T.bg=this._curAttrData.bg,this._setCursor(0,0);for(var R=0;R<this._bufferService.rows;++R){var O=this._activeBuffer.ybase+this._activeBuffer.y+R,H=this._activeBuffer.lines.get(O);H&&(H.fill(T),H.isWrapped=!1)}return this._dirtyRowService.markAllDirty(),this._setCursor(0,0),!0},F}(p.Disposable);e.InputHandler=D},844:function(d,e){var a=this&&this.__values||function(l){var _=typeof Symbol=="function"&&Symbol.iterator,S=_&&l[_],b=0;if(S)return S.call(l);if(l&&typeof l.length=="number")return{next:function(){return l&&b>=l.length&&(l=void 0),{value:l&&l[b++],done:!l}}};throw new TypeError(_?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.getDisposeArrayDisposable=e.disposeArray=e.Disposable=void 0;var u=function(){function l(){this._disposables=[],this._isDisposed=!1}return l.prototype.dispose=function(){var _,S;this._isDisposed=!0;try{for(var b=a(this._disposables),p=b.next();!p.done;p=b.next())p.value.dispose()}catch(g){_={error:g}}finally{try{p&&!p.done&&(S=b.return)&&S.call(b)}finally{if(_)throw _.error}}this._disposables.length=0},l.prototype.register=function(_){return this._disposables.push(_),_},l.prototype.unregister=function(_){var S=this._disposables.indexOf(_);S!==-1&&this._disposables.splice(S,1)},l}();function v(l){var _,S;try{for(var b=a(l),p=b.next();!p.done;p=b.next())p.value.dispose()}catch(g){_={error:g}}finally{try{p&&!p.done&&(S=b.return)&&S.call(b)}finally{if(_)throw _.error}}l.length=0}e.Disposable=u,e.disposeArray=v,e.getDisposeArrayDisposable=function(l){return{dispose:function(){return v(l)}}}},6114:(d,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isLinux=e.isWindows=e.isIphone=e.isIpad=e.isMac=e.isSafari=e.isLegacyEdge=e.isFirefox=void 0;var a=typeof navigator>"u",u=a?"node":navigator.userAgent,v=a?"node":navigator.platform;e.isFirefox=u.includes("Firefox"),e.isLegacyEdge=u.includes("Edge"),e.isSafari=/^((?!chrome|android).)*safari/i.test(u),e.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(v),e.isIpad=v==="iPad",e.isIphone=v==="iPhone",e.isWindows=["Windows","Win16","Win32","WinCE"].includes(v),e.isLinux=v.indexOf("Linux")>=0},6106:function(d,e){var a=this&&this.__generator||function(v,l){var _,S,b,p,g={label:0,sent:function(){if(1&b[0])throw b[1];return b[1]},trys:[],ops:[]};return p={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function w(x){return function(h){return function(s){if(_)throw new TypeError("Generator is already executing.");for(;g;)try{if(_=1,S&&(b=2&s[0]?S.return:s[0]?S.throw||((b=S.return)&&b.call(S),0):S.next)&&!(b=b.call(S,s[1])).done)return b;switch(S=0,b&&(s=[2&s[0],b.value]),s[0]){case 0:case 1:b=s;break;case 4:return g.label++,{value:s[1],done:!1};case 5:g.label++,S=s[1],s=[0];continue;case 7:s=g.ops.pop(),g.trys.pop();continue;default:if(!((b=(b=g.trys).length>0&&b[b.length-1])||s[0]!==6&&s[0]!==2)){g=0;continue}if(s[0]===3&&(!b||s[1]>b[0]&&s[1]<b[3])){g.label=s[1];break}if(s[0]===6&&g.label<b[1]){g.label=b[1],b=s;break}if(b&&g.label<b[2]){g.label=b[2],g.ops.push(s);break}b[2]&&g.ops.pop(),g.trys.pop();continue}s=l.call(v,g)}catch(c){s=[6,c],S=0}finally{_=b=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([x,h])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.SortedList=void 0;var u=function(){function v(l){this._getKey=l,this._array=[]}return v.prototype.clear=function(){this._array.length=0},v.prototype.insert=function(l){if(this._array.length!==0){var _=this._search(this._getKey(l),0,this._array.length-1);this._array.splice(_,0,l)}else this._array.push(l)},v.prototype.delete=function(l){if(this._array.length===0)return!1;var _=this._getKey(l),S=this._search(_,0,this._array.length-1);if(this._getKey(this._array[S])!==_)return!1;do if(this._array[S]===l)return this._array.splice(S,1),!0;while(++S<this._array.length&&this._getKey(this._array[S])===_);return!1},v.prototype.getKeyIterator=function(l){var _;return a(this,function(S){switch(S.label){case 0:if(this._array.length===0)return[2];if((_=this._search(l,0,this._array.length-1))<0||_>=this._array.length)return[2];if(this._getKey(this._array[_])!==l)return[2];S.label=1;case 1:return[4,this._array[_]];case 2:S.sent(),S.label=3;case 3:if(++_<this._array.length&&this._getKey(this._array[_])===l)return[3,1];S.label=4;case 4:return[2]}})},v.prototype.values=function(){return this._array.values()},v.prototype._search=function(l,_,S){if(S<_)return _;var b=Math.floor((_+S)/2);if(this._getKey(this._array[b])>l)return this._search(l,_,b-1);if(this._getKey(this._array[b])<l)return this._search(l,b+1,S);for(;b>0&&this._getKey(this._array[b-1])===l;)b--;return b},v}();e.SortedList=u},8273:(d,e)=>{function a(u,v,l,_){if(l===void 0&&(l=0),_===void 0&&(_=u.length),l>=u.length)return u;l=(u.length+l)%u.length,_=_>=u.length?u.length:(u.length+_)%u.length;for(var S=l;S<_;++S)u[S]=v;return u}Object.defineProperty(e,"__esModule",{value:!0}),e.concat=e.fillFallback=e.fill=void 0,e.fill=function(u,v,l,_){return u.fill?u.fill(v,l,_):a(u,v,l,_)},e.fillFallback=a,e.concat=function(u,v){var l=new u.constructor(u.length+v.length);return l.set(u),l.set(v,u.length),l}},9282:(d,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.updateWindowsModeWrappedState=void 0;var u=a(643);e.updateWindowsModeWrappedState=function(v){var l=v.buffer.lines.get(v.buffer.ybase+v.buffer.y-1),_=l==null?void 0:l.get(v.cols-1),S=v.buffer.lines.get(v.buffer.ybase+v.buffer.y);S&&_&&(S.isWrapped=_[u.CHAR_DATA_CODE_INDEX]!==u.NULL_CELL_CODE&&_[u.CHAR_DATA_CODE_INDEX]!==u.WHITESPACE_CELL_CODE)}},3734:(d,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ExtendedAttrs=e.AttributeData=void 0;var a=function(){function v(){this.fg=0,this.bg=0,this.extended=new u}return v.toColorRGB=function(l){return[l>>>16&255,l>>>8&255,255&l]},v.fromColorRGB=function(l){return(255&l[0])<<16|(255&l[1])<<8|255&l[2]},v.prototype.clone=function(){var l=new v;return l.fg=this.fg,l.bg=this.bg,l.extended=this.extended.clone(),l},v.prototype.isInverse=function(){return 67108864&this.fg},v.prototype.isBold=function(){return 134217728&this.fg},v.prototype.isUnderline=function(){return 268435456&this.fg},v.prototype.isBlink=function(){return 536870912&this.fg},v.prototype.isInvisible=function(){return 1073741824&this.fg},v.prototype.isItalic=function(){return 67108864&this.bg},v.prototype.isDim=function(){return 134217728&this.bg},v.prototype.isStrikethrough=function(){return 2147483648&this.fg},v.prototype.getFgColorMode=function(){return 50331648&this.fg},v.prototype.getBgColorMode=function(){return 50331648&this.bg},v.prototype.isFgRGB=function(){return(50331648&this.fg)==50331648},v.prototype.isBgRGB=function(){return(50331648&this.bg)==50331648},v.prototype.isFgPalette=function(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432},v.prototype.isBgPalette=function(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432},v.prototype.isFgDefault=function(){return(50331648&this.fg)==0},v.prototype.isBgDefault=function(){return(50331648&this.bg)==0},v.prototype.isAttributeDefault=function(){return this.fg===0&&this.bg===0},v.prototype.getFgColor=function(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}},v.prototype.getBgColor=function(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}},v.prototype.hasExtendedAttrs=function(){return 268435456&this.bg},v.prototype.updateExtended=function(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456},v.prototype.getUnderlineColor=function(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()},v.prototype.getUnderlineColorMode=function(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()},v.prototype.isUnderlineColorRGB=function(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()},v.prototype.isUnderlineColorPalette=function(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()},v.prototype.isUnderlineColorDefault=function(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()},v.prototype.getUnderlineStyle=function(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0},v}();e.AttributeData=a;var u=function(){function v(l,_){l===void 0&&(l=0),_===void 0&&(_=-1),this.underlineStyle=l,this.underlineColor=_}return v.prototype.clone=function(){return new v(this.underlineStyle,this.underlineColor)},v.prototype.isEmpty=function(){return this.underlineStyle===0},v}();e.ExtendedAttrs=u},9092:function(d,e,a){var u=this&&this.__read||function(c,o){var f=typeof Symbol=="function"&&c[Symbol.iterator];if(!f)return c;var m,y,C=f.call(c),L=[];try{for(;(o===void 0||o-- >0)&&!(m=C.next()).done;)L.push(m.value)}catch(k){y={error:k}}finally{try{m&&!m.done&&(f=C.return)&&f.call(C)}finally{if(y)throw y.error}}return L},v=this&&this.__spreadArray||function(c,o,f){if(f||arguments.length===2)for(var m,y=0,C=o.length;y<C;y++)!m&&y in o||(m||(m=Array.prototype.slice.call(o,0,y)),m[y]=o[y]);return c.concat(m||Array.prototype.slice.call(o))};Object.defineProperty(e,"__esModule",{value:!0}),e.BufferStringIterator=e.Buffer=e.MAX_BUFFER_SIZE=void 0;var l=a(6349),_=a(8437),S=a(511),b=a(643),p=a(4634),g=a(4863),w=a(7116),x=a(3734);e.MAX_BUFFER_SIZE=4294967295;var h=function(){function c(o,f,m){this._hasScrollback=o,this._optionsService=f,this._bufferService=m,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.savedY=0,this.savedX=0,this.savedCurAttrData=_.DEFAULT_ATTR_DATA.clone(),this.savedCharset=w.DEFAULT_CHARSET,this.markers=[],this._nullCell=S.CellData.fromCharData([0,b.NULL_CELL_CHAR,b.NULL_CELL_WIDTH,b.NULL_CELL_CODE]),this._whitespaceCell=S.CellData.fromCharData([0,b.WHITESPACE_CELL_CHAR,b.WHITESPACE_CELL_WIDTH,b.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new l.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}return c.prototype.getNullCell=function(o){return o?(this._nullCell.fg=o.fg,this._nullCell.bg=o.bg,this._nullCell.extended=o.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new x.ExtendedAttrs),this._nullCell},c.prototype.getWhitespaceCell=function(o){return o?(this._whitespaceCell.fg=o.fg,this._whitespaceCell.bg=o.bg,this._whitespaceCell.extended=o.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new x.ExtendedAttrs),this._whitespaceCell},c.prototype.getBlankLine=function(o,f){return new _.BufferLine(this._bufferService.cols,this.getNullCell(o),f)},Object.defineProperty(c.prototype,"hasScrollback",{get:function(){return this._hasScrollback&&this.lines.maxLength>this._rows},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isCursorInViewport",{get:function(){var o=this.ybase+this.y-this.ydisp;return o>=0&&o<this._rows},enumerable:!1,configurable:!0}),c.prototype._getCorrectBufferLength=function(o){if(!this._hasScrollback)return o;var f=o+this._optionsService.rawOptions.scrollback;return f>e.MAX_BUFFER_SIZE?e.MAX_BUFFER_SIZE:f},c.prototype.fillViewportRows=function(o){if(this.lines.length===0){o===void 0&&(o=_.DEFAULT_ATTR_DATA);for(var f=this._rows;f--;)this.lines.push(this.getBlankLine(o))}},c.prototype.clear=function(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new l.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()},c.prototype.resize=function(o,f){var m=this.getNullCell(_.DEFAULT_ATTR_DATA),y=this._getCorrectBufferLength(f);if(y>this.lines.maxLength&&(this.lines.maxLength=y),this.lines.length>0){if(this._cols<o)for(var C=0;C<this.lines.length;C++)this.lines.get(C).resize(o,m);var L=0;if(this._rows<f)for(var k=this._rows;k<f;k++)this.lines.length<f+this.ybase&&(this._optionsService.rawOptions.windowsMode?this.lines.push(new _.BufferLine(o,m)):this.ybase>0&&this.lines.length<=this.ybase+this.y+L+1?(this.ybase--,L++,this.ydisp>0&&this.ydisp--):this.lines.push(new _.BufferLine(o,m)));else for(k=this._rows;k>f;k--)this.lines.length>f+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(y<this.lines.maxLength){var E=this.lines.length-y;E>0&&(this.lines.trimStart(E),this.ybase=Math.max(this.ybase-E,0),this.ydisp=Math.max(this.ydisp-E,0),this.savedY=Math.max(this.savedY-E,0)),this.lines.maxLength=y}this.x=Math.min(this.x,o-1),this.y=Math.min(this.y,f-1),L&&(this.y+=L),this.savedX=Math.min(this.savedX,o-1),this.scrollTop=0}if(this.scrollBottom=f-1,this._isReflowEnabled&&(this._reflow(o,f),this._cols>o))for(C=0;C<this.lines.length;C++)this.lines.get(C).resize(o,m);this._cols=o,this._rows=f},Object.defineProperty(c.prototype,"_isReflowEnabled",{get:function(){return this._hasScrollback&&!this._optionsService.rawOptions.windowsMode},enumerable:!1,configurable:!0}),c.prototype._reflow=function(o,f){this._cols!==o&&(o>this._cols?this._reflowLarger(o,f):this._reflowSmaller(o,f))},c.prototype._reflowLarger=function(o,f){var m=(0,p.reflowLargerGetLinesToRemove)(this.lines,this._cols,o,this.ybase+this.y,this.getNullCell(_.DEFAULT_ATTR_DATA));if(m.length>0){var y=(0,p.reflowLargerCreateNewLayout)(this.lines,m);(0,p.reflowLargerApplyNewLayout)(this.lines,y.layout),this._reflowLargerAdjustViewport(o,f,y.countRemoved)}},c.prototype._reflowLargerAdjustViewport=function(o,f,m){for(var y=this.getNullCell(_.DEFAULT_ATTR_DATA),C=m;C-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<f&&this.lines.push(new _.BufferLine(o,y))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-m,0)},c.prototype._reflowSmaller=function(o,f){for(var m=this.getNullCell(_.DEFAULT_ATTR_DATA),y=[],C=0,L=this.lines.length-1;L>=0;L--){var k=this.lines.get(L);if(!(!k||!k.isWrapped&&k.getTrimmedLength()<=o)){for(var E=[k];k.isWrapped&&L>0;)k=this.lines.get(--L),E.unshift(k);var A=this.ybase+this.y;if(!(A>=L&&A<L+E.length)){var D,M=E[E.length-1].getTrimmedLength(),F=(0,p.reflowSmallerGetNewLineLengths)(E,this._cols,o),T=F.length-E.length;D=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+T):Math.max(0,this.lines.length-this.lines.maxLength+T);for(var R=[],O=0;O<T;O++){var H=this.getBlankLine(_.DEFAULT_ATTR_DATA,!0);R.push(H)}R.length>0&&(y.push({start:L+E.length+C,newLines:R}),C+=R.length),E.push.apply(E,v([],u(R),!1));var ee=F.length-1,ie=F[ee];ie===0&&(ie=F[--ee]);for(var J=E.length-T-1,ne=M;J>=0;){var re=Math.min(ne,ie);if(E[ee]===void 0)break;if(E[ee].copyCellsFrom(E[J],ne-re,ie-re,re,!0),(ie-=re)==0&&(ie=F[--ee]),(ne-=re)==0){J--;var B=Math.max(J,0);ne=(0,p.getWrappedLineTrimmedLength)(E,B,this._cols)}}for(O=0;O<E.length;O++)F[O]<o&&E[O].setCell(F[O],m);for(var he=T-D;he-- >0;)this.ybase===0?this.y<f-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+C)-f&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+T,this.ybase+f-1)}}}if(y.length>0){var le=[],me=[];for(O=0;O<this.lines.length;O++)me.push(this.lines.get(O));var U=this.lines.length,xe=U-1,ce=0,$=y[ce];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+C);var X=0;for(O=Math.min(this.lines.maxLength-1,U+C-1);O>=0;O--)if($&&$.start>xe+X){for(var I=$.newLines.length-1;I>=0;I--)this.lines.set(O--,$.newLines[I]);O++,le.push({index:xe+1,amount:$.newLines.length}),X+=$.newLines.length,$=y[++ce]}else this.lines.set(O,me[xe--]);var Y=0;for(O=le.length-1;O>=0;O--)le[O].index+=Y,this.lines.onInsertEmitter.fire(le[O]),Y+=le[O].amount;var oe=Math.max(0,U+C-this.lines.maxLength);oe>0&&this.lines.onTrimEmitter.fire(oe)}},c.prototype.stringIndexToBufferIndex=function(o,f,m){for(m===void 0&&(m=!1);f;){var y=this.lines.get(o);if(!y)return[-1,-1];for(var C=m?y.getTrimmedLength():y.length,L=0;L<C;++L)if(y.get(L)[b.CHAR_DATA_WIDTH_INDEX]&&(f-=y.get(L)[b.CHAR_DATA_CHAR_INDEX].length||1),f<0)return[o,L];o++}return[o,0]},c.prototype.translateBufferLineToString=function(o,f,m,y){m===void 0&&(m=0);var C=this.lines.get(o);return C?C.translateToString(f,m,y):""},c.prototype.getWrappedRangeForLine=function(o){for(var f=o,m=o;f>0&&this.lines.get(f).isWrapped;)f--;for(;m+1<this.lines.length&&this.lines.get(m+1).isWrapped;)m++;return{first:f,last:m}},c.prototype.setupTabStops=function(o){for(o!=null?this.tabs[o]||(o=this.prevStop(o)):(this.tabs={},o=0);o<this._cols;o+=this._optionsService.rawOptions.tabStopWidth)this.tabs[o]=!0},c.prototype.prevStop=function(o){for(o==null&&(o=this.x);!this.tabs[--o]&&o>0;);return o>=this._cols?this._cols-1:o<0?0:o},c.prototype.nextStop=function(o){for(o==null&&(o=this.x);!this.tabs[++o]&&o<this._cols;);return o>=this._cols?this._cols-1:o<0?0:o},c.prototype.clearMarkers=function(o){this._isClearing=!0;for(var f=0;f<this.markers.length;f++)this.markers[f].line===o&&(this.markers[f].dispose(),this.markers.splice(f--,1));this._isClearing=!1},c.prototype.clearAllMarkers=function(){this._isClearing=!0;for(var o=0;o<this.markers.length;o++)this.markers[o].dispose(),this.markers.splice(o--,1);this._isClearing=!1},c.prototype.addMarker=function(o){var f=this,m=new g.Marker(o);return this.markers.push(m),m.register(this.lines.onTrim(function(y){m.line-=y,m.line<0&&m.dispose()})),m.register(this.lines.onInsert(function(y){m.line>=y.index&&(m.line+=y.amount)})),m.register(this.lines.onDelete(function(y){m.line>=y.index&&m.line<y.index+y.amount&&m.dispose(),m.line>y.index&&(m.line-=y.amount)})),m.register(m.onDispose(function(){return f._removeMarker(m)})),m},c.prototype._removeMarker=function(o){this._isClearing||this.markers.splice(this.markers.indexOf(o),1)},c.prototype.iterator=function(o,f,m,y,C){return new s(this,o,f,m,y,C)},c}();e.Buffer=h;var s=function(){function c(o,f,m,y,C,L){m===void 0&&(m=0),y===void 0&&(y=o.lines.length),C===void 0&&(C=0),L===void 0&&(L=0),this._buffer=o,this._trimRight=f,this._startIndex=m,this._endIndex=y,this._startOverscan=C,this._endOverscan=L,this._startIndex<0&&(this._startIndex=0),this._endIndex>this._buffer.lines.length&&(this._endIndex=this._buffer.lines.length),this._current=this._startIndex}return c.prototype.hasNext=function(){return this._current<this._endIndex},c.prototype.next=function(){var o=this._buffer.getWrappedRangeForLine(this._current);o.first<this._startIndex-this._startOverscan&&(o.first=this._startIndex-this._startOverscan),o.last>this._endIndex+this._endOverscan&&(o.last=this._endIndex+this._endOverscan),o.first=Math.max(o.first,0),o.last=Math.min(o.last,this._buffer.lines.length);for(var f="",m=o.first;m<=o.last;++m)f+=this._buffer.translateBufferLineToString(m,this._trimRight);return this._current=o.last+1,{range:o,content:f}},c}();e.BufferStringIterator=s},8437:(d,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BufferLine=e.DEFAULT_ATTR_DATA=void 0;var u=a(482),v=a(643),l=a(511),_=a(3734);e.DEFAULT_ATTR_DATA=Object.freeze(new _.AttributeData);var S=function(){function b(p,g,w){w===void 0&&(w=!1),this.isWrapped=w,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*p);for(var x=g||l.CellData.fromCharData([0,v.NULL_CELL_CHAR,v.NULL_CELL_WIDTH,v.NULL_CELL_CODE]),h=0;h<p;++h)this.setCell(h,x);this.length=p}return b.prototype.get=function(p){var g=this._data[3*p+0],w=2097151&g;return[this._data[3*p+1],2097152&g?this._combined[p]:w?(0,u.stringFromCodePoint)(w):"",g>>22,2097152&g?this._combined[p].charCodeAt(this._combined[p].length-1):w]},b.prototype.set=function(p,g){this._data[3*p+1]=g[v.CHAR_DATA_ATTR_INDEX],g[v.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[p]=g[1],this._data[3*p+0]=2097152|p|g[v.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*p+0]=g[v.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|g[v.CHAR_DATA_WIDTH_INDEX]<<22},b.prototype.getWidth=function(p){return this._data[3*p+0]>>22},b.prototype.hasWidth=function(p){return 12582912&this._data[3*p+0]},b.prototype.getFg=function(p){return this._data[3*p+1]},b.prototype.getBg=function(p){return this._data[3*p+2]},b.prototype.hasContent=function(p){return 4194303&this._data[3*p+0]},b.prototype.getCodePoint=function(p){var g=this._data[3*p+0];return 2097152&g?this._combined[p].charCodeAt(this._combined[p].length-1):2097151&g},b.prototype.isCombined=function(p){return 2097152&this._data[3*p+0]},b.prototype.getString=function(p){var g=this._data[3*p+0];return 2097152&g?this._combined[p]:2097151&g?(0,u.stringFromCodePoint)(2097151&g):""},b.prototype.loadCell=function(p,g){var w=3*p;return g.content=this._data[w+0],g.fg=this._data[w+1],g.bg=this._data[w+2],2097152&g.content&&(g.combinedData=this._combined[p]),268435456&g.bg&&(g.extended=this._extendedAttrs[p]),g},b.prototype.setCell=function(p,g){2097152&g.content&&(this._combined[p]=g.combinedData),268435456&g.bg&&(this._extendedAttrs[p]=g.extended),this._data[3*p+0]=g.content,this._data[3*p+1]=g.fg,this._data[3*p+2]=g.bg},b.prototype.setCellFromCodePoint=function(p,g,w,x,h,s){268435456&h&&(this._extendedAttrs[p]=s),this._data[3*p+0]=g|w<<22,this._data[3*p+1]=x,this._data[3*p+2]=h},b.prototype.addCodepointToCell=function(p,g){var w=this._data[3*p+0];2097152&w?this._combined[p]+=(0,u.stringFromCodePoint)(g):(2097151&w?(this._combined[p]=(0,u.stringFromCodePoint)(2097151&w)+(0,u.stringFromCodePoint)(g),w&=-2097152,w|=2097152):w=g|1<<22,this._data[3*p+0]=w)},b.prototype.insertCells=function(p,g,w,x){if((p%=this.length)&&this.getWidth(p-1)===2&&this.setCellFromCodePoint(p-1,0,1,(x==null?void 0:x.fg)||0,(x==null?void 0:x.bg)||0,(x==null?void 0:x.extended)||new _.ExtendedAttrs),g<this.length-p){for(var h=new l.CellData,s=this.length-p-g-1;s>=0;--s)this.setCell(p+g+s,this.loadCell(p+s,h));for(s=0;s<g;++s)this.setCell(p+s,w)}else for(s=p;s<this.length;++s)this.setCell(s,w);this.getWidth(this.length-1)===2&&this.setCellFromCodePoint(this.length-1,0,1,(x==null?void 0:x.fg)||0,(x==null?void 0:x.bg)||0,(x==null?void 0:x.extended)||new _.ExtendedAttrs)},b.prototype.deleteCells=function(p,g,w,x){if(p%=this.length,g<this.length-p){for(var h=new l.CellData,s=0;s<this.length-p-g;++s)this.setCell(p+s,this.loadCell(p+g+s,h));for(s=this.length-g;s<this.length;++s)this.setCell(s,w)}else for(s=p;s<this.length;++s)this.setCell(s,w);p&&this.getWidth(p-1)===2&&this.setCellFromCodePoint(p-1,0,1,(x==null?void 0:x.fg)||0,(x==null?void 0:x.bg)||0,(x==null?void 0:x.extended)||new _.ExtendedAttrs),this.getWidth(p)!==0||this.hasContent(p)||this.setCellFromCodePoint(p,0,1,(x==null?void 0:x.fg)||0,(x==null?void 0:x.bg)||0,(x==null?void 0:x.extended)||new _.ExtendedAttrs)},b.prototype.replaceCells=function(p,g,w,x){for(p&&this.getWidth(p-1)===2&&this.setCellFromCodePoint(p-1,0,1,(x==null?void 0:x.fg)||0,(x==null?void 0:x.bg)||0,(x==null?void 0:x.extended)||new _.ExtendedAttrs),g<this.length&&this.getWidth(g-1)===2&&this.setCellFromCodePoint(g,0,1,(x==null?void 0:x.fg)||0,(x==null?void 0:x.bg)||0,(x==null?void 0:x.extended)||new _.ExtendedAttrs);p<g&&p<this.length;)this.setCell(p++,w)},b.prototype.resize=function(p,g){if(p!==this.length){if(p>this.length){var w=new Uint32Array(3*p);this.length&&(3*p<this._data.length?w.set(this._data.subarray(0,3*p)):w.set(this._data)),this._data=w;for(var x=this.length;x<p;++x)this.setCell(x,g)}else if(p){(w=new Uint32Array(3*p)).set(this._data.subarray(0,3*p)),this._data=w;var h=Object.keys(this._combined);for(x=0;x<h.length;x++){var s=parseInt(h[x],10);s>=p&&delete this._combined[s]}}else this._data=new Uint32Array(0),this._combined={};this.length=p}},b.prototype.fill=function(p){this._combined={},this._extendedAttrs={};for(var g=0;g<this.length;++g)this.setCell(g,p)},b.prototype.copyFrom=function(p){for(var g in this.length!==p.length?this._data=new Uint32Array(p._data):this._data.set(p._data),this.length=p.length,this._combined={},p._combined)this._combined[g]=p._combined[g];for(var g in this._extendedAttrs={},p._extendedAttrs)this._extendedAttrs[g]=p._extendedAttrs[g];this.isWrapped=p.isWrapped},b.prototype.clone=function(){var p=new b(0);for(var g in p._data=new Uint32Array(this._data),p.length=this.length,this._combined)p._combined[g]=this._combined[g];for(var g in this._extendedAttrs)p._extendedAttrs[g]=this._extendedAttrs[g];return p.isWrapped=this.isWrapped,p},b.prototype.getTrimmedLength=function(){for(var p=this.length-1;p>=0;--p)if(4194303&this._data[3*p+0])return p+(this._data[3*p+0]>>22);return 0},b.prototype.copyCellsFrom=function(p,g,w,x,h){var s=p._data;if(h)for(var c=x-1;c>=0;c--)for(var o=0;o<3;o++)this._data[3*(w+c)+o]=s[3*(g+c)+o];else for(c=0;c<x;c++)for(o=0;o<3;o++)this._data[3*(w+c)+o]=s[3*(g+c)+o];var f=Object.keys(p._combined);for(o=0;o<f.length;o++){var m=parseInt(f[o],10);m>=g&&(this._combined[m-g+w]=p._combined[m])}},b.prototype.translateToString=function(p,g,w){p===void 0&&(p=!1),g===void 0&&(g=0),w===void 0&&(w=this.length),p&&(w=Math.min(w,this.getTrimmedLength()));for(var x="";g<w;){var h=this._data[3*g+0],s=2097151&h;x+=2097152&h?this._combined[g]:s?(0,u.stringFromCodePoint)(s):v.WHITESPACE_CELL_CHAR,g+=h>>22||1}return x},b}();e.BufferLine=S},4841:(d,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getRangeLength=void 0,e.getRangeLength=function(a,u){if(a.start.y>a.end.y)throw new Error("Buffer range end ("+a.end.x+", "+a.end.y+") cannot be before start ("+a.start.x+", "+a.start.y+")");return u*(a.end.y-a.start.y)+(a.end.x-a.start.x+1)}},4634:(d,e)=>{function a(u,v,l){if(v===u.length-1)return u[v].getTrimmedLength();var _=!u[v].hasContent(l-1)&&u[v].getWidth(l-1)===1,S=u[v+1].getWidth(0)===2;return _&&S?l-1:l}Object.defineProperty(e,"__esModule",{value:!0}),e.getWrappedLineTrimmedLength=e.reflowSmallerGetNewLineLengths=e.reflowLargerApplyNewLayout=e.reflowLargerCreateNewLayout=e.reflowLargerGetLinesToRemove=void 0,e.reflowLargerGetLinesToRemove=function(u,v,l,_,S){for(var b=[],p=0;p<u.length-1;p++){var g=p,w=u.get(++g);if(w.isWrapped){for(var x=[u.get(p)];g<u.length&&w.isWrapped;)x.push(w),w=u.get(++g);if(_>=p&&_<g)p+=x.length-1;else{for(var h=0,s=a(x,h,v),c=1,o=0;c<x.length;){var f=a(x,c,v),m=f-o,y=l-s,C=Math.min(m,y);x[h].copyCellsFrom(x[c],o,s,C,!1),(s+=C)===l&&(h++,s=0),(o+=C)===f&&(c++,o=0),s===0&&h!==0&&x[h-1].getWidth(l-1)===2&&(x[h].copyCellsFrom(x[h-1],l-1,s++,1,!1),x[h-1].setCell(l-1,S))}x[h].replaceCells(s,l,S);for(var L=0,k=x.length-1;k>0&&(k>h||x[k].getTrimmedLength()===0);k--)L++;L>0&&(b.push(p+x.length-L),b.push(L)),p+=x.length-1}}}return b},e.reflowLargerCreateNewLayout=function(u,v){for(var l=[],_=0,S=v[_],b=0,p=0;p<u.length;p++)if(S===p){var g=v[++_];u.onDeleteEmitter.fire({index:p-b,amount:g}),p+=g-1,b+=g,S=v[++_]}else l.push(p);return{layout:l,countRemoved:b}},e.reflowLargerApplyNewLayout=function(u,v){for(var l=[],_=0;_<v.length;_++)l.push(u.get(v[_]));for(_=0;_<l.length;_++)u.set(_,l[_]);u.length=v.length},e.reflowSmallerGetNewLineLengths=function(u,v,l){for(var _=[],S=u.map(function(s,c){return a(u,c,v)}).reduce(function(s,c){return s+c}),b=0,p=0,g=0;g<S;){if(S-g<l){_.push(S-g);break}b+=l;var w=a(u,p,v);b>w&&(b-=w,p++);var x=u[p].getWidth(b-1)===2;x&&b--;var h=x?l-1:l;_.push(h),g+=h}return _},e.getWrappedLineTrimmedLength=a},5295:function(d,e,a){var u,v=this&&this.__extends||(u=function(b,p){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,w){g.__proto__=w}||function(g,w){for(var x in w)Object.prototype.hasOwnProperty.call(w,x)&&(g[x]=w[x])},u(b,p)},function(b,p){if(typeof p!="function"&&p!==null)throw new TypeError("Class extends value "+String(p)+" is not a constructor or null");function g(){this.constructor=b}u(b,p),b.prototype=p===null?Object.create(p):(g.prototype=p.prototype,new g)});Object.defineProperty(e,"__esModule",{value:!0}),e.BufferSet=void 0;var l=a(9092),_=a(8460),S=function(b){function p(g,w){var x=b.call(this)||this;return x._optionsService=g,x._bufferService=w,x._onBufferActivate=x.register(new _.EventEmitter),x.reset(),x}return v(p,b),Object.defineProperty(p.prototype,"onBufferActivate",{get:function(){return this._onBufferActivate.event},enumerable:!1,configurable:!0}),p.prototype.reset=function(){this._normal=new l.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new l.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()},Object.defineProperty(p.prototype,"alt",{get:function(){return this._alt},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"active",{get:function(){return this._activeBuffer},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"normal",{get:function(){return this._normal},enumerable:!1,configurable:!0}),p.prototype.activateNormalBuffer=function(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))},p.prototype.activateAltBuffer=function(g){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(g),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))},p.prototype.resize=function(g,w){this._normal.resize(g,w),this._alt.resize(g,w)},p.prototype.setupTabStops=function(g){this._normal.setupTabStops(g),this._alt.setupTabStops(g)},p}(a(844).Disposable);e.BufferSet=S},511:function(d,e,a){var u,v=this&&this.__extends||(u=function(p,g){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,x){w.__proto__=x}||function(w,x){for(var h in x)Object.prototype.hasOwnProperty.call(x,h)&&(w[h]=x[h])},u(p,g)},function(p,g){if(typeof g!="function"&&g!==null)throw new TypeError("Class extends value "+String(g)+" is not a constructor or null");function w(){this.constructor=p}u(p,g),p.prototype=g===null?Object.create(g):(w.prototype=g.prototype,new w)});Object.defineProperty(e,"__esModule",{value:!0}),e.CellData=void 0;var l=a(482),_=a(643),S=a(3734),b=function(p){function g(){var w=p!==null&&p.apply(this,arguments)||this;return w.content=0,w.fg=0,w.bg=0,w.extended=new S.ExtendedAttrs,w.combinedData="",w}return v(g,p),g.fromCharData=function(w){var x=new g;return x.setFromCharData(w),x},g.prototype.isCombined=function(){return 2097152&this.content},g.prototype.getWidth=function(){return this.content>>22},g.prototype.getChars=function(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,l.stringFromCodePoint)(2097151&this.content):""},g.prototype.getCode=function(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content},g.prototype.setFromCharData=function(w){this.fg=w[_.CHAR_DATA_ATTR_INDEX],this.bg=0;var x=!1;if(w[_.CHAR_DATA_CHAR_INDEX].length>2)x=!0;else if(w[_.CHAR_DATA_CHAR_INDEX].length===2){var h=w[_.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=h&&h<=56319){var s=w[_.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=s&&s<=57343?this.content=1024*(h-55296)+s-56320+65536|w[_.CHAR_DATA_WIDTH_INDEX]<<22:x=!0}else x=!0}else this.content=w[_.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|w[_.CHAR_DATA_WIDTH_INDEX]<<22;x&&(this.combinedData=w[_.CHAR_DATA_CHAR_INDEX],this.content=2097152|w[_.CHAR_DATA_WIDTH_INDEX]<<22)},g.prototype.getAsCharData=function(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]},g}(S.AttributeData);e.CellData=b},643:(d,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WHITESPACE_CELL_CODE=e.WHITESPACE_CELL_WIDTH=e.WHITESPACE_CELL_CHAR=e.NULL_CELL_CODE=e.NULL_CELL_WIDTH=e.NULL_CELL_CHAR=e.CHAR_DATA_CODE_INDEX=e.CHAR_DATA_WIDTH_INDEX=e.CHAR_DATA_CHAR_INDEX=e.CHAR_DATA_ATTR_INDEX=e.DEFAULT_ATTR=e.DEFAULT_COLOR=void 0,e.DEFAULT_COLOR=256,e.DEFAULT_ATTR=256|e.DEFAULT_COLOR<<9,e.CHAR_DATA_ATTR_INDEX=0,e.CHAR_DATA_CHAR_INDEX=1,e.CHAR_DATA_WIDTH_INDEX=2,e.CHAR_DATA_CODE_INDEX=3,e.NULL_CELL_CHAR="",e.NULL_CELL_WIDTH=1,e.NULL_CELL_CODE=0,e.WHITESPACE_CELL_CHAR=" ",e.WHITESPACE_CELL_WIDTH=1,e.WHITESPACE_CELL_CODE=32},4863:function(d,e,a){var u,v=this&&this.__extends||(u=function(S,b){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,g){p.__proto__=g}||function(p,g){for(var w in g)Object.prototype.hasOwnProperty.call(g,w)&&(p[w]=g[w])},u(S,b)},function(S,b){if(typeof b!="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function p(){this.constructor=S}u(S,b),S.prototype=b===null?Object.create(b):(p.prototype=b.prototype,new p)});Object.defineProperty(e,"__esModule",{value:!0}),e.Marker=void 0;var l=a(8460),_=function(S){function b(p){var g=S.call(this)||this;return g.line=p,g._id=b._nextId++,g.isDisposed=!1,g._onDispose=new l.EventEmitter,g}return v(b,S),Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onDispose",{get:function(){return this._onDispose.event},enumerable:!1,configurable:!0}),b.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),S.prototype.dispose.call(this))},b._nextId=1,b}(a(844).Disposable);e.Marker=_},7116:(d,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_CHARSET=e.CHARSETS=void 0,e.CHARSETS={},e.DEFAULT_CHARSET=e.CHARSETS.B,e.CHARSETS[0]={"`":"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",q:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:"","{":"","|":"","}":"","~":""},e.CHARSETS.A={"#":""},e.CHARSETS.B=void 0,e.CHARSETS[4]={"#":"","@":"","[":"ij","\\":"","]":"|","{":"","|":"f","}":"","~":""},e.CHARSETS.C=e.CHARSETS[5]={"[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},e.CHARSETS.R={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""},e.CHARSETS.Q={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},e.CHARSETS.K={"@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""},e.CHARSETS.Y={"#":"","@":"","[":"","\\":"","]":"","`":"","{":"","|":"","}":"","~":""},e.CHARSETS.E=e.CHARSETS[6]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},e.CHARSETS.Z={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":""},e.CHARSETS.H=e.CHARSETS[7]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},e.CHARSETS["="]={"#":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":""}},2584:(d,e)=>{var a,u;Object.defineProperty(e,"__esModule",{value:!0}),e.C1_ESCAPED=e.C1=e.C0=void 0,function(v){v.NUL="\0",v.SOH="",v.STX="",v.ETX="",v.EOT="",v.ENQ="",v.ACK="",v.BEL="\x07",v.BS="\b",v.HT="	",v.LF=`
`,v.VT="\v",v.FF="\f",v.CR="\r",v.SO="",v.SI="",v.DLE="",v.DC1="",v.DC2="",v.DC3="",v.DC4="",v.NAK="",v.SYN="",v.ETB="",v.CAN="",v.EM="",v.SUB="",v.ESC="\x1B",v.FS="",v.GS="",v.RS="",v.US="",v.SP=" ",v.DEL=""}(a=e.C0||(e.C0={})),(u=e.C1||(e.C1={})).PAD="",u.HOP="",u.BPH="",u.NBH="",u.IND="",u.NEL="",u.SSA="",u.ESA="",u.HTS="",u.HTJ="",u.VTS="",u.PLD="",u.PLU="",u.RI="",u.SS2="",u.SS3="",u.DCS="",u.PU1="",u.PU2="",u.STS="",u.CCH="",u.MW="",u.SPA="",u.EPA="",u.SOS="",u.SGCI="",u.SCI="",u.CSI="",u.ST="",u.OSC="",u.PM="",u.APC="",(e.C1_ESCAPED||(e.C1_ESCAPED={})).ST=a.ESC+"\\"},7399:(d,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.evaluateKeyboardEvent=void 0;var u=a(2584),v={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};e.evaluateKeyboardEvent=function(l,_,S,b){var p={type:0,cancel:!1,key:void 0},g=(l.shiftKey?1:0)|(l.altKey?2:0)|(l.ctrlKey?4:0)|(l.metaKey?8:0);switch(l.keyCode){case 0:l.key==="UIKeyInputUpArrow"?p.key=_?u.C0.ESC+"OA":u.C0.ESC+"[A":l.key==="UIKeyInputLeftArrow"?p.key=_?u.C0.ESC+"OD":u.C0.ESC+"[D":l.key==="UIKeyInputRightArrow"?p.key=_?u.C0.ESC+"OC":u.C0.ESC+"[C":l.key==="UIKeyInputDownArrow"&&(p.key=_?u.C0.ESC+"OB":u.C0.ESC+"[B");break;case 8:if(l.shiftKey){p.key=u.C0.BS;break}if(l.altKey){p.key=u.C0.ESC+u.C0.DEL;break}p.key=u.C0.DEL;break;case 9:if(l.shiftKey){p.key=u.C0.ESC+"[Z";break}p.key=u.C0.HT,p.cancel=!0;break;case 13:p.key=l.altKey?u.C0.ESC+u.C0.CR:u.C0.CR,p.cancel=!0;break;case 27:p.key=u.C0.ESC,l.altKey&&(p.key=u.C0.ESC+u.C0.ESC),p.cancel=!0;break;case 37:if(l.metaKey)break;g?(p.key=u.C0.ESC+"[1;"+(g+1)+"D",p.key===u.C0.ESC+"[1;3D"&&(p.key=u.C0.ESC+(S?"b":"[1;5D"))):p.key=_?u.C0.ESC+"OD":u.C0.ESC+"[D";break;case 39:if(l.metaKey)break;g?(p.key=u.C0.ESC+"[1;"+(g+1)+"C",p.key===u.C0.ESC+"[1;3C"&&(p.key=u.C0.ESC+(S?"f":"[1;5C"))):p.key=_?u.C0.ESC+"OC":u.C0.ESC+"[C";break;case 38:if(l.metaKey)break;g?(p.key=u.C0.ESC+"[1;"+(g+1)+"A",S||p.key!==u.C0.ESC+"[1;3A"||(p.key=u.C0.ESC+"[1;5A")):p.key=_?u.C0.ESC+"OA":u.C0.ESC+"[A";break;case 40:if(l.metaKey)break;g?(p.key=u.C0.ESC+"[1;"+(g+1)+"B",S||p.key!==u.C0.ESC+"[1;3B"||(p.key=u.C0.ESC+"[1;5B")):p.key=_?u.C0.ESC+"OB":u.C0.ESC+"[B";break;case 45:l.shiftKey||l.ctrlKey||(p.key=u.C0.ESC+"[2~");break;case 46:p.key=g?u.C0.ESC+"[3;"+(g+1)+"~":u.C0.ESC+"[3~";break;case 36:p.key=g?u.C0.ESC+"[1;"+(g+1)+"H":_?u.C0.ESC+"OH":u.C0.ESC+"[H";break;case 35:p.key=g?u.C0.ESC+"[1;"+(g+1)+"F":_?u.C0.ESC+"OF":u.C0.ESC+"[F";break;case 33:l.shiftKey?p.type=2:l.ctrlKey?p.key=u.C0.ESC+"[5;"+(g+1)+"~":p.key=u.C0.ESC+"[5~";break;case 34:l.shiftKey?p.type=3:l.ctrlKey?p.key=u.C0.ESC+"[6;"+(g+1)+"~":p.key=u.C0.ESC+"[6~";break;case 112:p.key=g?u.C0.ESC+"[1;"+(g+1)+"P":u.C0.ESC+"OP";break;case 113:p.key=g?u.C0.ESC+"[1;"+(g+1)+"Q":u.C0.ESC+"OQ";break;case 114:p.key=g?u.C0.ESC+"[1;"+(g+1)+"R":u.C0.ESC+"OR";break;case 115:p.key=g?u.C0.ESC+"[1;"+(g+1)+"S":u.C0.ESC+"OS";break;case 116:p.key=g?u.C0.ESC+"[15;"+(g+1)+"~":u.C0.ESC+"[15~";break;case 117:p.key=g?u.C0.ESC+"[17;"+(g+1)+"~":u.C0.ESC+"[17~";break;case 118:p.key=g?u.C0.ESC+"[18;"+(g+1)+"~":u.C0.ESC+"[18~";break;case 119:p.key=g?u.C0.ESC+"[19;"+(g+1)+"~":u.C0.ESC+"[19~";break;case 120:p.key=g?u.C0.ESC+"[20;"+(g+1)+"~":u.C0.ESC+"[20~";break;case 121:p.key=g?u.C0.ESC+"[21;"+(g+1)+"~":u.C0.ESC+"[21~";break;case 122:p.key=g?u.C0.ESC+"[23;"+(g+1)+"~":u.C0.ESC+"[23~";break;case 123:p.key=g?u.C0.ESC+"[24;"+(g+1)+"~":u.C0.ESC+"[24~";break;default:if(!l.ctrlKey||l.shiftKey||l.altKey||l.metaKey)if(S&&!b||!l.altKey||l.metaKey)!S||l.altKey||l.ctrlKey||l.shiftKey||!l.metaKey?l.key&&!l.ctrlKey&&!l.altKey&&!l.metaKey&&l.keyCode>=48&&l.key.length===1?p.key=l.key:l.key&&l.ctrlKey&&(l.key==="_"&&(p.key=u.C0.US),l.key==="@"&&(p.key=u.C0.NUL)):l.keyCode===65&&(p.type=1);else{var w=v[l.keyCode],x=w==null?void 0:w[l.shiftKey?1:0];if(x)p.key=u.C0.ESC+x;else if(l.keyCode>=65&&l.keyCode<=90){var h=l.ctrlKey?l.keyCode-64:l.keyCode+32,s=String.fromCharCode(h);l.shiftKey&&(s=s.toUpperCase()),p.key=u.C0.ESC+s}else l.key==="Dead"&&l.code.startsWith("Key")&&(s=l.code.slice(3,4),l.shiftKey||(s=s.toLowerCase()),p.key=u.C0.ESC+s,p.cancel=!0)}else l.keyCode>=65&&l.keyCode<=90?p.key=String.fromCharCode(l.keyCode-64):l.keyCode===32?p.key=u.C0.NUL:l.keyCode>=51&&l.keyCode<=55?p.key=String.fromCharCode(l.keyCode-51+27):l.keyCode===56?p.key=u.C0.DEL:l.keyCode===219?p.key=u.C0.ESC:l.keyCode===220?p.key=u.C0.FS:l.keyCode===221&&(p.key=u.C0.GS)}return p}},482:(d,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Utf8ToUtf32=e.StringToUtf32=e.utf32ToString=e.stringFromCodePoint=void 0,e.stringFromCodePoint=function(v){return v>65535?(v-=65536,String.fromCharCode(55296+(v>>10))+String.fromCharCode(v%1024+56320)):String.fromCharCode(v)},e.utf32ToString=function(v,l,_){l===void 0&&(l=0),_===void 0&&(_=v.length);for(var S="",b=l;b<_;++b){var p=v[b];p>65535?(p-=65536,S+=String.fromCharCode(55296+(p>>10))+String.fromCharCode(p%1024+56320)):S+=String.fromCharCode(p)}return S};var a=function(){function v(){this._interim=0}return v.prototype.clear=function(){this._interim=0},v.prototype.decode=function(l,_){var S=l.length;if(!S)return 0;var b=0,p=0;this._interim&&(56320<=(x=l.charCodeAt(p++))&&x<=57343?_[b++]=1024*(this._interim-55296)+x-56320+65536:(_[b++]=this._interim,_[b++]=x),this._interim=0);for(var g=p;g<S;++g){var w=l.charCodeAt(g);if(55296<=w&&w<=56319){if(++g>=S)return this._interim=w,b;var x;56320<=(x=l.charCodeAt(g))&&x<=57343?_[b++]=1024*(w-55296)+x-56320+65536:(_[b++]=w,_[b++]=x)}else w!==65279&&(_[b++]=w)}return b},v}();e.StringToUtf32=a;var u=function(){function v(){this.interim=new Uint8Array(3)}return v.prototype.clear=function(){this.interim.fill(0)},v.prototype.decode=function(l,_){var S=l.length;if(!S)return 0;var b,p,g,w,x=0,h=0,s=0;if(this.interim[0]){var c=!1,o=this.interim[0];o&=(224&o)==192?31:(240&o)==224?15:7;for(var f=0,m=void 0;(m=63&this.interim[++f])&&f<4;)o<<=6,o|=m;for(var y=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,C=y-f;s<C;){if(s>=S)return 0;if((192&(m=l[s++]))!=128){s--,c=!0;break}this.interim[f++]=m,o<<=6,o|=63&m}c||(y===2?o<128?s--:_[x++]=o:y===3?o<2048||o>=55296&&o<=57343||o===65279||(_[x++]=o):o<65536||o>1114111||(_[x++]=o)),this.interim.fill(0)}for(var L=S-4,k=s;k<S;){for(;!(!(k<L)||128&(b=l[k])||128&(p=l[k+1])||128&(g=l[k+2])||128&(w=l[k+3]));)_[x++]=b,_[x++]=p,_[x++]=g,_[x++]=w,k+=4;if((b=l[k++])<128)_[x++]=b;else if((224&b)==192){if(k>=S)return this.interim[0]=b,x;if((192&(p=l[k++]))!=128){k--;continue}if((h=(31&b)<<6|63&p)<128){k--;continue}_[x++]=h}else if((240&b)==224){if(k>=S)return this.interim[0]=b,x;if((192&(p=l[k++]))!=128){k--;continue}if(k>=S)return this.interim[0]=b,this.interim[1]=p,x;if((192&(g=l[k++]))!=128){k--;continue}if((h=(15&b)<<12|(63&p)<<6|63&g)<2048||h>=55296&&h<=57343||h===65279)continue;_[x++]=h}else if((248&b)==240){if(k>=S)return this.interim[0]=b,x;if((192&(p=l[k++]))!=128){k--;continue}if(k>=S)return this.interim[0]=b,this.interim[1]=p,x;if((192&(g=l[k++]))!=128){k--;continue}if(k>=S)return this.interim[0]=b,this.interim[1]=p,this.interim[2]=g,x;if((192&(w=l[k++]))!=128){k--;continue}if((h=(7&b)<<18|(63&p)<<12|(63&g)<<6|63&w)<65536||h>1114111)continue;_[x++]=h}}return x},v}();e.Utf8ToUtf32=u},225:(d,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.UnicodeV6=void 0;var u,v=a(8273),l=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],_=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],S=function(){function b(){if(this.version="6",!u){u=new Uint8Array(65536),(0,v.fill)(u,1),u[0]=0,(0,v.fill)(u,0,1,32),(0,v.fill)(u,0,127,160),(0,v.fill)(u,2,4352,4448),u[9001]=2,u[9002]=2,(0,v.fill)(u,2,11904,42192),u[12351]=1,(0,v.fill)(u,2,44032,55204),(0,v.fill)(u,2,63744,64256),(0,v.fill)(u,2,65040,65050),(0,v.fill)(u,2,65072,65136),(0,v.fill)(u,2,65280,65377),(0,v.fill)(u,2,65504,65511);for(var p=0;p<l.length;++p)(0,v.fill)(u,0,l[p][0],l[p][1]+1)}}return b.prototype.wcwidth=function(p){return p<32?0:p<127?1:p<65536?u[p]:function(g,w){var x,h=0,s=w.length-1;if(g<w[0][0]||g>w[s][1])return!1;for(;s>=h;)if(g>w[x=h+s>>1][1])h=x+1;else{if(!(g<w[x][0]))return!0;s=x-1}return!1}(p,_)?0:p>=131072&&p<=196605||p>=196608&&p<=262141?2:1},b}();e.UnicodeV6=S},5981:(d,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WriteBuffer=void 0;var u=a(8460),v=typeof queueMicrotask>"u"?function(_){Promise.resolve().then(_)}:queueMicrotask,l=function(){function _(S){this._action=S,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._onWriteParsed=new u.EventEmitter}return Object.defineProperty(_.prototype,"onWriteParsed",{get:function(){return this._onWriteParsed.event},enumerable:!1,configurable:!0}),_.prototype.writeSync=function(S,b){if(b!==void 0&&this._syncCalls>b)this._syncCalls=0;else if(this._pendingData+=S.length,this._writeBuffer.push(S),this._callbacks.push(void 0),this._syncCalls++,!this._isSyncWriting){var p;for(this._isSyncWriting=!0;p=this._writeBuffer.shift();){this._action(p);var g=this._callbacks.shift();g&&g()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}},_.prototype.write=function(S,b){var p=this;if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");this._writeBuffer.length||(this._bufferOffset=0,setTimeout(function(){return p._innerWrite()})),this._pendingData+=S.length,this._writeBuffer.push(S),this._callbacks.push(b)},_.prototype._innerWrite=function(S,b){var p=this;S===void 0&&(S=0),b===void 0&&(b=!0);for(var g=S||Date.now();this._writeBuffer.length>this._bufferOffset;){var w=this._writeBuffer[this._bufferOffset],x=this._action(w,b);if(x)return void x.catch(function(s){return v(function(){throw s}),Promise.resolve(!1)}).then(function(s){return Date.now()-g>=12?setTimeout(function(){return p._innerWrite(0,s)}):p._innerWrite(g,s)});var h=this._callbacks[this._bufferOffset];if(h&&h(),this._bufferOffset++,this._pendingData-=w.length,Date.now()-g>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(function(){return p._innerWrite()})):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()},_}();e.WriteBuffer=l},5941:function(d,e){var a=this&&this.__read||function(_,S){var b=typeof Symbol=="function"&&_[Symbol.iterator];if(!b)return _;var p,g,w=b.call(_),x=[];try{for(;(S===void 0||S-- >0)&&!(p=w.next()).done;)x.push(p.value)}catch(h){g={error:h}}finally{try{p&&!p.done&&(b=w.return)&&b.call(w)}finally{if(g)throw g.error}}return x};Object.defineProperty(e,"__esModule",{value:!0}),e.toRgbString=e.parseColor=void 0;var u=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,v=/^[\da-f]+$/;function l(_,S){var b=_.toString(16),p=b.length<2?"0"+b:b;switch(S){case 4:return b[0];case 8:return p;case 12:return(p+p).slice(0,3);default:return p+p}}e.parseColor=function(_){if(_){var S=_.toLowerCase();if(S.indexOf("rgb:")===0){S=S.slice(4);var b=u.exec(S);if(b){var p=b[1]?15:b[4]?255:b[7]?4095:65535;return[Math.round(parseInt(b[1]||b[4]||b[7]||b[10],16)/p*255),Math.round(parseInt(b[2]||b[5]||b[8]||b[11],16)/p*255),Math.round(parseInt(b[3]||b[6]||b[9]||b[12],16)/p*255)]}}else if(S.indexOf("#")===0&&(S=S.slice(1),v.exec(S)&&[3,6,9,12].includes(S.length))){for(var g=S.length/3,w=[0,0,0],x=0;x<3;++x){var h=parseInt(S.slice(g*x,g*x+g),16);w[x]=g===1?h<<4:g===2?h:g===3?h>>4:h>>8}return w}}},e.toRgbString=function(_,S){S===void 0&&(S=16);var b=a(_,3),p=b[0],g=b[1],w=b[2];return"rgb:"+l(p,S)+"/"+l(g,S)+"/"+l(w,S)}},5770:(d,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PAYLOAD_LIMIT=void 0,e.PAYLOAD_LIMIT=1e7},6351:(d,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DcsHandler=e.DcsParser=void 0;var u=a(482),v=a(8742),l=a(5770),_=[],S=function(){function g(){this._handlers=Object.create(null),this._active=_,this._ident=0,this._handlerFb=function(){},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}return g.prototype.dispose=function(){this._handlers=Object.create(null),this._handlerFb=function(){},this._active=_},g.prototype.registerHandler=function(w,x){this._handlers[w]===void 0&&(this._handlers[w]=[]);var h=this._handlers[w];return h.push(x),{dispose:function(){var s=h.indexOf(x);s!==-1&&h.splice(s,1)}}},g.prototype.clearHandler=function(w){this._handlers[w]&&delete this._handlers[w]},g.prototype.setHandlerFallback=function(w){this._handlerFb=w},g.prototype.reset=function(){if(this._active.length)for(var w=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;w>=0;--w)this._active[w].unhook(!1);this._stack.paused=!1,this._active=_,this._ident=0},g.prototype.hook=function(w,x){if(this.reset(),this._ident=w,this._active=this._handlers[w]||_,this._active.length)for(var h=this._active.length-1;h>=0;h--)this._active[h].hook(x);else this._handlerFb(this._ident,"HOOK",x)},g.prototype.put=function(w,x,h){if(this._active.length)for(var s=this._active.length-1;s>=0;s--)this._active[s].put(w,x,h);else this._handlerFb(this._ident,"PUT",(0,u.utf32ToString)(w,x,h))},g.prototype.unhook=function(w,x){if(x===void 0&&(x=!0),this._active.length){var h=!1,s=this._active.length-1,c=!1;if(this._stack.paused&&(s=this._stack.loopPosition-1,h=x,c=this._stack.fallThrough,this._stack.paused=!1),!c&&h===!1){for(;s>=0&&(h=this._active[s].unhook(w))!==!0;s--)if(h instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=s,this._stack.fallThrough=!1,h;s--}for(;s>=0;s--)if((h=this._active[s].unhook(!1))instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=s,this._stack.fallThrough=!0,h}else this._handlerFb(this._ident,"UNHOOK",w);this._active=_,this._ident=0},g}();e.DcsParser=S;var b=new v.Params;b.addParam(0);var p=function(){function g(w){this._handler=w,this._data="",this._params=b,this._hitLimit=!1}return g.prototype.hook=function(w){this._params=w.length>1||w.params[0]?w.clone():b,this._data="",this._hitLimit=!1},g.prototype.put=function(w,x,h){this._hitLimit||(this._data+=(0,u.utf32ToString)(w,x,h),this._data.length>l.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))},g.prototype.unhook=function(w){var x=this,h=!1;if(this._hitLimit)h=!1;else if(w&&(h=this._handler(this._data,this._params))instanceof Promise)return h.then(function(s){return x._params=b,x._data="",x._hitLimit=!1,s});return this._params=b,this._data="",this._hitLimit=!1,h},g}();e.DcsHandler=p},2015:function(d,e,a){var u,v=this&&this.__extends||(u=function(h,s){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,o){c.__proto__=o}||function(c,o){for(var f in o)Object.prototype.hasOwnProperty.call(o,f)&&(c[f]=o[f])},u(h,s)},function(h,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function c(){this.constructor=h}u(h,s),h.prototype=s===null?Object.create(s):(c.prototype=s.prototype,new c)});Object.defineProperty(e,"__esModule",{value:!0}),e.EscapeSequenceParser=e.VT500_TRANSITION_TABLE=e.TransitionTable=void 0;var l=a(844),_=a(8273),S=a(8742),b=a(6242),p=a(6351),g=function(){function h(s){this.table=new Uint8Array(s)}return h.prototype.setDefault=function(s,c){(0,_.fill)(this.table,s<<4|c)},h.prototype.add=function(s,c,o,f){this.table[c<<8|s]=o<<4|f},h.prototype.addMany=function(s,c,o,f){for(var m=0;m<s.length;m++)this.table[c<<8|s[m]]=o<<4|f},h}();e.TransitionTable=g;var w=160;e.VT500_TRANSITION_TABLE=function(){var h=new g(4095),s=Array.apply(null,Array(256)).map(function(C,L){return L}),c=function(C,L){return s.slice(C,L)},o=c(32,127),f=c(0,24);f.push(25),f.push.apply(f,c(28,32));var m,y=c(0,14);for(m in h.setDefault(1,0),h.addMany(o,0,2,0),y)h.addMany([24,26,153,154],m,3,0),h.addMany(c(128,144),m,3,0),h.addMany(c(144,152),m,3,0),h.add(156,m,0,0),h.add(27,m,11,1),h.add(157,m,4,8),h.addMany([152,158,159],m,0,7),h.add(155,m,11,3),h.add(144,m,11,9);return h.addMany(f,0,3,0),h.addMany(f,1,3,1),h.add(127,1,0,1),h.addMany(f,8,0,8),h.addMany(f,3,3,3),h.add(127,3,0,3),h.addMany(f,4,3,4),h.add(127,4,0,4),h.addMany(f,6,3,6),h.addMany(f,5,3,5),h.add(127,5,0,5),h.addMany(f,2,3,2),h.add(127,2,0,2),h.add(93,1,4,8),h.addMany(o,8,5,8),h.add(127,8,5,8),h.addMany([156,27,24,26,7],8,6,0),h.addMany(c(28,32),8,0,8),h.addMany([88,94,95],1,0,7),h.addMany(o,7,0,7),h.addMany(f,7,0,7),h.add(156,7,0,0),h.add(127,7,0,7),h.add(91,1,11,3),h.addMany(c(64,127),3,7,0),h.addMany(c(48,60),3,8,4),h.addMany([60,61,62,63],3,9,4),h.addMany(c(48,60),4,8,4),h.addMany(c(64,127),4,7,0),h.addMany([60,61,62,63],4,0,6),h.addMany(c(32,64),6,0,6),h.add(127,6,0,6),h.addMany(c(64,127),6,0,0),h.addMany(c(32,48),3,9,5),h.addMany(c(32,48),5,9,5),h.addMany(c(48,64),5,0,6),h.addMany(c(64,127),5,7,0),h.addMany(c(32,48),4,9,5),h.addMany(c(32,48),1,9,2),h.addMany(c(32,48),2,9,2),h.addMany(c(48,127),2,10,0),h.addMany(c(48,80),1,10,0),h.addMany(c(81,88),1,10,0),h.addMany([89,90,92],1,10,0),h.addMany(c(96,127),1,10,0),h.add(80,1,11,9),h.addMany(f,9,0,9),h.add(127,9,0,9),h.addMany(c(28,32),9,0,9),h.addMany(c(32,48),9,9,12),h.addMany(c(48,60),9,8,10),h.addMany([60,61,62,63],9,9,10),h.addMany(f,11,0,11),h.addMany(c(32,128),11,0,11),h.addMany(c(28,32),11,0,11),h.addMany(f,10,0,10),h.add(127,10,0,10),h.addMany(c(28,32),10,0,10),h.addMany(c(48,60),10,8,10),h.addMany([60,61,62,63],10,0,11),h.addMany(c(32,48),10,9,12),h.addMany(f,12,0,12),h.add(127,12,0,12),h.addMany(c(28,32),12,0,12),h.addMany(c(32,48),12,9,12),h.addMany(c(48,64),12,0,11),h.addMany(c(64,127),12,12,13),h.addMany(c(64,127),10,12,13),h.addMany(c(64,127),9,12,13),h.addMany(f,13,13,13),h.addMany(o,13,13,13),h.add(127,13,0,13),h.addMany([27,156,24,26],13,14,0),h.add(w,0,2,0),h.add(w,8,5,8),h.add(w,6,0,6),h.add(w,11,0,11),h.add(w,13,13,13),h}();var x=function(h){function s(c){c===void 0&&(c=e.VT500_TRANSITION_TABLE);var o=h.call(this)||this;return o._transitions=c,o._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},o.initialState=0,o.currentState=o.initialState,o._params=new S.Params,o._params.addParam(0),o._collect=0,o.precedingCodepoint=0,o._printHandlerFb=function(f,m,y){},o._executeHandlerFb=function(f){},o._csiHandlerFb=function(f,m){},o._escHandlerFb=function(f){},o._errorHandlerFb=function(f){return f},o._printHandler=o._printHandlerFb,o._executeHandlers=Object.create(null),o._csiHandlers=Object.create(null),o._escHandlers=Object.create(null),o._oscParser=new b.OscParser,o._dcsParser=new p.DcsParser,o._errorHandler=o._errorHandlerFb,o.registerEscHandler({final:"\\"},function(){return!0}),o}return v(s,h),s.prototype._identifier=function(c,o){o===void 0&&(o=[64,126]);var f=0;if(c.prefix){if(c.prefix.length>1)throw new Error("only one byte as prefix supported");if((f=c.prefix.charCodeAt(0))&&60>f||f>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(c.intermediates){if(c.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(var m=0;m<c.intermediates.length;++m){var y=c.intermediates.charCodeAt(m);if(32>y||y>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");f<<=8,f|=y}}if(c.final.length!==1)throw new Error("final must be a single byte");var C=c.final.charCodeAt(0);if(o[0]>C||C>o[1])throw new Error("final must be in range "+o[0]+" .. "+o[1]);return(f<<=8)|C},s.prototype.identToString=function(c){for(var o=[];c;)o.push(String.fromCharCode(255&c)),c>>=8;return o.reverse().join("")},s.prototype.dispose=function(){this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null),this._oscParser.dispose(),this._dcsParser.dispose()},s.prototype.setPrintHandler=function(c){this._printHandler=c},s.prototype.clearPrintHandler=function(){this._printHandler=this._printHandlerFb},s.prototype.registerEscHandler=function(c,o){var f=this._identifier(c,[48,126]);this._escHandlers[f]===void 0&&(this._escHandlers[f]=[]);var m=this._escHandlers[f];return m.push(o),{dispose:function(){var y=m.indexOf(o);y!==-1&&m.splice(y,1)}}},s.prototype.clearEscHandler=function(c){this._escHandlers[this._identifier(c,[48,126])]&&delete this._escHandlers[this._identifier(c,[48,126])]},s.prototype.setEscHandlerFallback=function(c){this._escHandlerFb=c},s.prototype.setExecuteHandler=function(c,o){this._executeHandlers[c.charCodeAt(0)]=o},s.prototype.clearExecuteHandler=function(c){this._executeHandlers[c.charCodeAt(0)]&&delete this._executeHandlers[c.charCodeAt(0)]},s.prototype.setExecuteHandlerFallback=function(c){this._executeHandlerFb=c},s.prototype.registerCsiHandler=function(c,o){var f=this._identifier(c);this._csiHandlers[f]===void 0&&(this._csiHandlers[f]=[]);var m=this._csiHandlers[f];return m.push(o),{dispose:function(){var y=m.indexOf(o);y!==-1&&m.splice(y,1)}}},s.prototype.clearCsiHandler=function(c){this._csiHandlers[this._identifier(c)]&&delete this._csiHandlers[this._identifier(c)]},s.prototype.setCsiHandlerFallback=function(c){this._csiHandlerFb=c},s.prototype.registerDcsHandler=function(c,o){return this._dcsParser.registerHandler(this._identifier(c),o)},s.prototype.clearDcsHandler=function(c){this._dcsParser.clearHandler(this._identifier(c))},s.prototype.setDcsHandlerFallback=function(c){this._dcsParser.setHandlerFallback(c)},s.prototype.registerOscHandler=function(c,o){return this._oscParser.registerHandler(c,o)},s.prototype.clearOscHandler=function(c){this._oscParser.clearHandler(c)},s.prototype.setOscHandlerFallback=function(c){this._oscParser.setHandlerFallback(c)},s.prototype.setErrorHandler=function(c){this._errorHandler=c},s.prototype.clearErrorHandler=function(){this._errorHandler=this._errorHandlerFb},s.prototype.reset=function(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])},s.prototype._preserveStack=function(c,o,f,m,y){this._parseStack.state=c,this._parseStack.handlers=o,this._parseStack.handlerPos=f,this._parseStack.transition=m,this._parseStack.chunkPos=y},s.prototype.parse=function(c,o,f){var m,y=0,C=0,L=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,L=this._parseStack.chunkPos+1;else{if(f===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");var k=this._parseStack.handlers,E=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(f===!1&&E>-1){for(;E>=0&&(m=k[E](this._params))!==!0;E--)if(m instanceof Promise)return this._parseStack.handlerPos=E,m}this._parseStack.handlers=[];break;case 4:if(f===!1&&E>-1){for(;E>=0&&(m=k[E]())!==!0;E--)if(m instanceof Promise)return this._parseStack.handlerPos=E,m}this._parseStack.handlers=[];break;case 6:if(y=c[this._parseStack.chunkPos],m=this._dcsParser.unhook(y!==24&&y!==26,f))return m;y===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(y=c[this._parseStack.chunkPos],m=this._oscParser.end(y!==24&&y!==26,f))return m;y===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,L=this._parseStack.chunkPos+1,this.precedingCodepoint=0,this.currentState=15&this._parseStack.transition}for(var A=L;A<o;++A){switch(y=c[A],(C=this._transitions.table[this.currentState<<8|(y<160?y:w)])>>4){case 2:for(var D=A+1;;++D){if(D>=o||(y=c[D])<32||y>126&&y<w){this._printHandler(c,A,D),A=D-1;break}if(++D>=o||(y=c[D])<32||y>126&&y<w){this._printHandler(c,A,D),A=D-1;break}if(++D>=o||(y=c[D])<32||y>126&&y<w){this._printHandler(c,A,D),A=D-1;break}if(++D>=o||(y=c[D])<32||y>126&&y<w){this._printHandler(c,A,D),A=D-1;break}}break;case 3:this._executeHandlers[y]?this._executeHandlers[y]():this._executeHandlerFb(y),this.precedingCodepoint=0;break;case 0:break;case 1:if(this._errorHandler({position:A,code:y,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:for(var M=(k=this._csiHandlers[this._collect<<8|y])?k.length-1:-1;M>=0&&(m=k[M](this._params))!==!0;M--)if(m instanceof Promise)return this._preserveStack(3,k,M,C,A),m;M<0&&this._csiHandlerFb(this._collect<<8|y,this._params),this.precedingCodepoint=0;break;case 8:do switch(y){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(y-48)}while(++A<o&&(y=c[A])>47&&y<60);A--;break;case 9:this._collect<<=8,this._collect|=y;break;case 10:for(var F=this._escHandlers[this._collect<<8|y],T=F?F.length-1:-1;T>=0&&(m=F[T]())!==!0;T--)if(m instanceof Promise)return this._preserveStack(4,F,T,C,A),m;T<0&&this._escHandlerFb(this._collect<<8|y),this.precedingCodepoint=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|y,this._params);break;case 13:for(var R=A+1;;++R)if(R>=o||(y=c[R])===24||y===26||y===27||y>127&&y<w){this._dcsParser.put(c,A,R),A=R-1;break}break;case 14:if(m=this._dcsParser.unhook(y!==24&&y!==26))return this._preserveStack(6,[],0,C,A),m;y===27&&(C|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0;break;case 4:this._oscParser.start();break;case 5:for(var O=A+1;;O++)if(O>=o||(y=c[O])<32||y>127&&y<w){this._oscParser.put(c,A,O),A=O-1;break}break;case 6:if(m=this._oscParser.end(y!==24&&y!==26))return this._preserveStack(5,[],0,C,A),m;y===27&&(C|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0}this.currentState=15&C}},s}(l.Disposable);e.EscapeSequenceParser=x},6242:(d,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.OscHandler=e.OscParser=void 0;var u=a(5770),v=a(482),l=[],_=function(){function b(){this._state=0,this._active=l,this._id=-1,this._handlers=Object.create(null),this._handlerFb=function(){},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}return b.prototype.registerHandler=function(p,g){this._handlers[p]===void 0&&(this._handlers[p]=[]);var w=this._handlers[p];return w.push(g),{dispose:function(){var x=w.indexOf(g);x!==-1&&w.splice(x,1)}}},b.prototype.clearHandler=function(p){this._handlers[p]&&delete this._handlers[p]},b.prototype.setHandlerFallback=function(p){this._handlerFb=p},b.prototype.dispose=function(){this._handlers=Object.create(null),this._handlerFb=function(){},this._active=l},b.prototype.reset=function(){if(this._state===2)for(var p=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;p>=0;--p)this._active[p].end(!1);this._stack.paused=!1,this._active=l,this._id=-1,this._state=0},b.prototype._start=function(){if(this._active=this._handlers[this._id]||l,this._active.length)for(var p=this._active.length-1;p>=0;p--)this._active[p].start();else this._handlerFb(this._id,"START")},b.prototype._put=function(p,g,w){if(this._active.length)for(var x=this._active.length-1;x>=0;x--)this._active[x].put(p,g,w);else this._handlerFb(this._id,"PUT",(0,v.utf32ToString)(p,g,w))},b.prototype.start=function(){this.reset(),this._state=1},b.prototype.put=function(p,g,w){if(this._state!==3){if(this._state===1)for(;g<w;){var x=p[g++];if(x===59){this._state=2,this._start();break}if(x<48||57<x)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+x-48}this._state===2&&w-g>0&&this._put(p,g,w)}},b.prototype.end=function(p,g){if(g===void 0&&(g=!0),this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){var w=!1,x=this._active.length-1,h=!1;if(this._stack.paused&&(x=this._stack.loopPosition-1,w=g,h=this._stack.fallThrough,this._stack.paused=!1),!h&&w===!1){for(;x>=0&&(w=this._active[x].end(p))!==!0;x--)if(w instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=x,this._stack.fallThrough=!1,w;x--}for(;x>=0;x--)if((w=this._active[x].end(!1))instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=x,this._stack.fallThrough=!0,w}else this._handlerFb(this._id,"END",p);this._active=l,this._id=-1,this._state=0}},b}();e.OscParser=_;var S=function(){function b(p){this._handler=p,this._data="",this._hitLimit=!1}return b.prototype.start=function(){this._data="",this._hitLimit=!1},b.prototype.put=function(p,g,w){this._hitLimit||(this._data+=(0,v.utf32ToString)(p,g,w),this._data.length>u.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))},b.prototype.end=function(p){var g=this,w=!1;if(this._hitLimit)w=!1;else if(p&&(w=this._handler(this._data))instanceof Promise)return w.then(function(x){return g._data="",g._hitLimit=!1,x});return this._data="",this._hitLimit=!1,w},b}();e.OscHandler=S},8742:(d,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Params=void 0;var a=2147483647,u=function(){function v(l,_){if(l===void 0&&(l=32),_===void 0&&(_=32),this.maxLength=l,this.maxSubParamsLength=_,_>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(l),this.length=0,this._subParams=new Int32Array(_),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(l),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}return v.fromArray=function(l){var _=new v;if(!l.length)return _;for(var S=Array.isArray(l[0])?1:0;S<l.length;++S){var b=l[S];if(Array.isArray(b))for(var p=0;p<b.length;++p)_.addSubParam(b[p]);else _.addParam(b)}return _},v.prototype.clone=function(){var l=new v(this.maxLength,this.maxSubParamsLength);return l.params.set(this.params),l.length=this.length,l._subParams.set(this._subParams),l._subParamsLength=this._subParamsLength,l._subParamsIdx.set(this._subParamsIdx),l._rejectDigits=this._rejectDigits,l._rejectSubDigits=this._rejectSubDigits,l._digitIsSub=this._digitIsSub,l},v.prototype.toArray=function(){for(var l=[],_=0;_<this.length;++_){l.push(this.params[_]);var S=this._subParamsIdx[_]>>8,b=255&this._subParamsIdx[_];b-S>0&&l.push(Array.prototype.slice.call(this._subParams,S,b))}return l},v.prototype.reset=function(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1},v.prototype.addParam=function(l){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(l<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=l>a?a:l}},v.prototype.addSubParam=function(l){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(l<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=l>a?a:l,this._subParamsIdx[this.length-1]++}},v.prototype.hasSubParams=function(l){return(255&this._subParamsIdx[l])-(this._subParamsIdx[l]>>8)>0},v.prototype.getSubParams=function(l){var _=this._subParamsIdx[l]>>8,S=255&this._subParamsIdx[l];return S-_>0?this._subParams.subarray(_,S):null},v.prototype.getSubParamsAll=function(){for(var l={},_=0;_<this.length;++_){var S=this._subParamsIdx[_]>>8,b=255&this._subParamsIdx[_];b-S>0&&(l[_]=this._subParams.slice(S,b))}return l},v.prototype.addDigit=function(l){var _;if(!(this._rejectDigits||!(_=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)){var S=this._digitIsSub?this._subParams:this.params,b=S[_-1];S[_-1]=~b?Math.min(10*b+l,a):l}},v}();e.Params=u},5741:(d,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AddonManager=void 0;var a=function(){function u(){this._addons=[]}return u.prototype.dispose=function(){for(var v=this._addons.length-1;v>=0;v--)this._addons[v].instance.dispose()},u.prototype.loadAddon=function(v,l){var _=this,S={instance:l,dispose:l.dispose,isDisposed:!1};this._addons.push(S),l.dispose=function(){return _._wrappedAddonDispose(S)},l.activate(v)},u.prototype._wrappedAddonDispose=function(v){if(!v.isDisposed){for(var l=-1,_=0;_<this._addons.length;_++)if(this._addons[_]===v){l=_;break}if(l===-1)throw new Error("Could not dispose an addon that has not been loaded");v.isDisposed=!0,v.dispose.apply(v.instance),this._addons.splice(l,1)}},u}();e.AddonManager=a},8771:(d,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BufferApiView=void 0;var u=a(3785),v=a(511),l=function(){function _(S,b){this._buffer=S,this.type=b}return _.prototype.init=function(S){return this._buffer=S,this},Object.defineProperty(_.prototype,"cursorY",{get:function(){return this._buffer.y},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"cursorX",{get:function(){return this._buffer.x},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"viewportY",{get:function(){return this._buffer.ydisp},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"baseY",{get:function(){return this._buffer.ybase},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"length",{get:function(){return this._buffer.lines.length},enumerable:!1,configurable:!0}),_.prototype.getLine=function(S){var b=this._buffer.lines.get(S);if(b)return new u.BufferLineApiView(b)},_.prototype.getNullCell=function(){return new v.CellData},_}();e.BufferApiView=l},3785:(d,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BufferLineApiView=void 0;var u=a(511),v=function(){function l(_){this._line=_}return Object.defineProperty(l.prototype,"isWrapped",{get:function(){return this._line.isWrapped},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"length",{get:function(){return this._line.length},enumerable:!1,configurable:!0}),l.prototype.getCell=function(_,S){if(!(_<0||_>=this._line.length))return S?(this._line.loadCell(_,S),S):this._line.loadCell(_,new u.CellData)},l.prototype.translateToString=function(_,S,b){return this._line.translateToString(_,S,b)},l}();e.BufferLineApiView=v},8285:(d,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BufferNamespaceApi=void 0;var u=a(8771),v=a(8460),l=function(){function _(S){var b=this;this._core=S,this._onBufferChange=new v.EventEmitter,this._normal=new u.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new u.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(function(){return b._onBufferChange.fire(b.active)})}return Object.defineProperty(_.prototype,"onBufferChange",{get:function(){return this._onBufferChange.event},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"active",{get:function(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"normal",{get:function(){return this._normal.init(this._core.buffers.normal)},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"alternate",{get:function(){return this._alternate.init(this._core.buffers.alt)},enumerable:!1,configurable:!0}),_}();e.BufferNamespaceApi=l},7975:(d,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ParserApi=void 0;var a=function(){function u(v){this._core=v}return u.prototype.registerCsiHandler=function(v,l){return this._core.registerCsiHandler(v,function(_){return l(_.toArray())})},u.prototype.addCsiHandler=function(v,l){return this.registerCsiHandler(v,l)},u.prototype.registerDcsHandler=function(v,l){return this._core.registerDcsHandler(v,function(_,S){return l(_,S.toArray())})},u.prototype.addDcsHandler=function(v,l){return this.registerDcsHandler(v,l)},u.prototype.registerEscHandler=function(v,l){return this._core.registerEscHandler(v,l)},u.prototype.addEscHandler=function(v,l){return this.registerEscHandler(v,l)},u.prototype.registerOscHandler=function(v,l){return this._core.registerOscHandler(v,l)},u.prototype.addOscHandler=function(v,l){return this.registerOscHandler(v,l)},u}();e.ParserApi=a},7090:(d,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.UnicodeApi=void 0;var a=function(){function u(v){this._core=v}return u.prototype.register=function(v){this._core.unicodeService.register(v)},Object.defineProperty(u.prototype,"versions",{get:function(){return this._core.unicodeService.versions},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"activeVersion",{get:function(){return this._core.unicodeService.activeVersion},set:function(v){this._core.unicodeService.activeVersion=v},enumerable:!1,configurable:!0}),u}();e.UnicodeApi=a},744:function(d,e,a){var u,v=this&&this.__extends||(u=function(x,h){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,c){s.__proto__=c}||function(s,c){for(var o in c)Object.prototype.hasOwnProperty.call(c,o)&&(s[o]=c[o])},u(x,h)},function(x,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");function s(){this.constructor=x}u(x,h),x.prototype=h===null?Object.create(h):(s.prototype=h.prototype,new s)}),l=this&&this.__decorate||function(x,h,s,c){var o,f=arguments.length,m=f<3?h:c===null?c=Object.getOwnPropertyDescriptor(h,s):c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(x,h,s,c);else for(var y=x.length-1;y>=0;y--)(o=x[y])&&(m=(f<3?o(m):f>3?o(h,s,m):o(h,s))||m);return f>3&&m&&Object.defineProperty(h,s,m),m},_=this&&this.__param||function(x,h){return function(s,c){h(s,c,x)}};Object.defineProperty(e,"__esModule",{value:!0}),e.BufferService=e.MINIMUM_ROWS=e.MINIMUM_COLS=void 0;var S=a(2585),b=a(5295),p=a(8460),g=a(844);e.MINIMUM_COLS=2,e.MINIMUM_ROWS=1;var w=function(x){function h(s){var c=x.call(this)||this;return c._optionsService=s,c.isUserScrolling=!1,c._onResize=new p.EventEmitter,c._onScroll=new p.EventEmitter,c.cols=Math.max(s.rawOptions.cols||0,e.MINIMUM_COLS),c.rows=Math.max(s.rawOptions.rows||0,e.MINIMUM_ROWS),c.buffers=new b.BufferSet(s,c),c}return v(h,x),Object.defineProperty(h.prototype,"onResize",{get:function(){return this._onResize.event},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onScroll",{get:function(){return this._onScroll.event},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"buffer",{get:function(){return this.buffers.active},enumerable:!1,configurable:!0}),h.prototype.dispose=function(){x.prototype.dispose.call(this),this.buffers.dispose()},h.prototype.resize=function(s,c){this.cols=s,this.rows=c,this.buffers.resize(s,c),this.buffers.setupTabStops(this.cols),this._onResize.fire({cols:s,rows:c})},h.prototype.reset=function(){this.buffers.reset(),this.isUserScrolling=!1},h.prototype.scroll=function(s,c){c===void 0&&(c=!1);var o,f=this.buffer;(o=this._cachedBlankLine)&&o.length===this.cols&&o.getFg(0)===s.fg&&o.getBg(0)===s.bg||(o=f.getBlankLine(s,c),this._cachedBlankLine=o),o.isWrapped=c;var m=f.ybase+f.scrollTop,y=f.ybase+f.scrollBottom;if(f.scrollTop===0){var C=f.lines.isFull;y===f.lines.length-1?C?f.lines.recycle().copyFrom(o):f.lines.push(o.clone()):f.lines.splice(y+1,0,o.clone()),C?this.isUserScrolling&&(f.ydisp=Math.max(f.ydisp-1,0)):(f.ybase++,this.isUserScrolling||f.ydisp++)}else{var L=y-m+1;f.lines.shiftElements(m+1,L-1,-1),f.lines.set(y,o.clone())}this.isUserScrolling||(f.ydisp=f.ybase),this._onScroll.fire(f.ydisp)},h.prototype.scrollLines=function(s,c,o){var f=this.buffer;if(s<0){if(f.ydisp===0)return;this.isUserScrolling=!0}else s+f.ydisp>=f.ybase&&(this.isUserScrolling=!1);var m=f.ydisp;f.ydisp=Math.max(Math.min(f.ydisp+s,f.ybase),0),m!==f.ydisp&&(c||this._onScroll.fire(f.ydisp))},h.prototype.scrollPages=function(s){this.scrollLines(s*(this.rows-1))},h.prototype.scrollToTop=function(){this.scrollLines(-this.buffer.ydisp)},h.prototype.scrollToBottom=function(){this.scrollLines(this.buffer.ybase-this.buffer.ydisp)},h.prototype.scrollToLine=function(s){var c=s-this.buffer.ydisp;c!==0&&this.scrollLines(c)},l([_(0,S.IOptionsService)],h)}(g.Disposable);e.BufferService=w},7994:(d,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CharsetService=void 0;var a=function(){function u(){this.glevel=0,this._charsets=[]}return u.prototype.reset=function(){this.charset=void 0,this._charsets=[],this.glevel=0},u.prototype.setgLevel=function(v){this.glevel=v,this.charset=this._charsets[v]},u.prototype.setgCharset=function(v,l){this._charsets[v]=l,this.glevel===v&&(this.charset=l)},u}();e.CharsetService=a},1753:function(d,e,a){var u=this&&this.__decorate||function(h,s,c,o){var f,m=arguments.length,y=m<3?s:o===null?o=Object.getOwnPropertyDescriptor(s,c):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(h,s,c,o);else for(var C=h.length-1;C>=0;C--)(f=h[C])&&(y=(m<3?f(y):m>3?f(s,c,y):f(s,c))||y);return m>3&&y&&Object.defineProperty(s,c,y),y},v=this&&this.__param||function(h,s){return function(c,o){s(c,o,h)}},l=this&&this.__values||function(h){var s=typeof Symbol=="function"&&Symbol.iterator,c=s&&h[s],o=0;if(c)return c.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&o>=h.length&&(h=void 0),{value:h&&h[o++],done:!h}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.CoreMouseService=void 0;var _=a(2585),S=a(8460),b={NONE:{events:0,restrict:function(){return!1}},X10:{events:1,restrict:function(h){return h.button!==4&&h.action===1&&(h.ctrl=!1,h.alt=!1,h.shift=!1,!0)}},VT200:{events:19,restrict:function(h){return h.action!==32}},DRAG:{events:23,restrict:function(h){return h.action!==32||h.button!==3}},ANY:{events:31,restrict:function(h){return!0}}};function p(h,s){var c=(h.ctrl?16:0)|(h.shift?4:0)|(h.alt?8:0);return h.button===4?(c|=64,c|=h.action):(c|=3&h.button,4&h.button&&(c|=64),8&h.button&&(c|=128),h.action===32?c|=32:h.action!==0||s||(c|=3)),c}var g=String.fromCharCode,w={DEFAULT:function(h){var s=[p(h,!1)+32,h.col+32,h.row+32];return s[0]>255||s[1]>255||s[2]>255?"":"\x1B[M"+g(s[0])+g(s[1])+g(s[2])},SGR:function(h){var s=h.action===0&&h.button!==4?"m":"M";return"\x1B[<"+p(h,!0)+";"+h.col+";"+h.row+s}},x=function(){function h(s,c){var o,f,m,y;this._bufferService=s,this._coreService=c,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._onProtocolChange=new S.EventEmitter,this._lastEvent=null;try{for(var C=l(Object.keys(b)),L=C.next();!L.done;L=C.next()){var k=L.value;this.addProtocol(k,b[k])}}catch(M){o={error:M}}finally{try{L&&!L.done&&(f=C.return)&&f.call(C)}finally{if(o)throw o.error}}try{for(var E=l(Object.keys(w)),A=E.next();!A.done;A=E.next()){var D=A.value;this.addEncoding(D,w[D])}}catch(M){m={error:M}}finally{try{A&&!A.done&&(y=E.return)&&y.call(E)}finally{if(m)throw m.error}}this.reset()}return h.prototype.addProtocol=function(s,c){this._protocols[s]=c},h.prototype.addEncoding=function(s,c){this._encodings[s]=c},Object.defineProperty(h.prototype,"activeProtocol",{get:function(){return this._activeProtocol},set:function(s){if(!this._protocols[s])throw new Error('unknown protocol "'+s+'"');this._activeProtocol=s,this._onProtocolChange.fire(this._protocols[s].events)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"areMouseEventsActive",{get:function(){return this._protocols[this._activeProtocol].events!==0},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"activeEncoding",{get:function(){return this._activeEncoding},set:function(s){if(!this._encodings[s])throw new Error('unknown encoding "'+s+'"');this._activeEncoding=s},enumerable:!1,configurable:!0}),h.prototype.reset=function(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null},Object.defineProperty(h.prototype,"onProtocolChange",{get:function(){return this._onProtocolChange.event},enumerable:!1,configurable:!0}),h.prototype.triggerMouseEvent=function(s){if(s.col<0||s.col>=this._bufferService.cols||s.row<0||s.row>=this._bufferService.rows||s.button===4&&s.action===32||s.button===3&&s.action!==32||s.button!==4&&(s.action===2||s.action===3)||(s.col++,s.row++,s.action===32&&this._lastEvent&&this._compareEvents(this._lastEvent,s))||!this._protocols[this._activeProtocol].restrict(s))return!1;var c=this._encodings[this._activeEncoding](s);return c&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(c):this._coreService.triggerDataEvent(c,!0)),this._lastEvent=s,!0},h.prototype.explainEvents=function(s){return{down:!!(1&s),up:!!(2&s),drag:!!(4&s),move:!!(8&s),wheel:!!(16&s)}},h.prototype._compareEvents=function(s,c){return s.col===c.col&&s.row===c.row&&s.button===c.button&&s.action===c.action&&s.ctrl===c.ctrl&&s.alt===c.alt&&s.shift===c.shift},u([v(0,_.IBufferService),v(1,_.ICoreService)],h)}();e.CoreMouseService=x},6975:function(d,e,a){var u,v=this&&this.__extends||(u=function(s,c){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,f){o.__proto__=f}||function(o,f){for(var m in f)Object.prototype.hasOwnProperty.call(f,m)&&(o[m]=f[m])},u(s,c)},function(s,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");function o(){this.constructor=s}u(s,c),s.prototype=c===null?Object.create(c):(o.prototype=c.prototype,new o)}),l=this&&this.__decorate||function(s,c,o,f){var m,y=arguments.length,C=y<3?c:f===null?f=Object.getOwnPropertyDescriptor(c,o):f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(s,c,o,f);else for(var L=s.length-1;L>=0;L--)(m=s[L])&&(C=(y<3?m(C):y>3?m(c,o,C):m(c,o))||C);return y>3&&C&&Object.defineProperty(c,o,C),C},_=this&&this.__param||function(s,c){return function(o,f){c(o,f,s)}};Object.defineProperty(e,"__esModule",{value:!0}),e.CoreService=void 0;var S=a(2585),b=a(8460),p=a(1439),g=a(844),w=Object.freeze({insertMode:!1}),x=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0}),h=function(s){function c(o,f,m,y){var C=s.call(this)||this;return C._bufferService=f,C._logService=m,C._optionsService=y,C.isCursorInitialized=!1,C.isCursorHidden=!1,C._onData=C.register(new b.EventEmitter),C._onUserInput=C.register(new b.EventEmitter),C._onBinary=C.register(new b.EventEmitter),C._scrollToBottom=o,C.register({dispose:function(){return C._scrollToBottom=void 0}}),C.modes=(0,p.clone)(w),C.decPrivateModes=(0,p.clone)(x),C}return v(c,s),Object.defineProperty(c.prototype,"onData",{get:function(){return this._onData.event},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"onUserInput",{get:function(){return this._onUserInput.event},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"onBinary",{get:function(){return this._onBinary.event},enumerable:!1,configurable:!0}),c.prototype.reset=function(){this.modes=(0,p.clone)(w),this.decPrivateModes=(0,p.clone)(x)},c.prototype.triggerDataEvent=function(o,f){if(f===void 0&&(f=!1),!this._optionsService.rawOptions.disableStdin){var m=this._bufferService.buffer;m.ybase!==m.ydisp&&this._scrollToBottom(),f&&this._onUserInput.fire(),this._logService.debug('sending data "'+o+'"',function(){return o.split("").map(function(y){return y.charCodeAt(0)})}),this._onData.fire(o)}},c.prototype.triggerBinaryEvent=function(o){this._optionsService.rawOptions.disableStdin||(this._logService.debug('sending binary "'+o+'"',function(){return o.split("").map(function(f){return f.charCodeAt(0)})}),this._onBinary.fire(o))},l([_(1,S.IBufferService),_(2,S.ILogService),_(3,S.IOptionsService)],c)}(g.Disposable);e.CoreService=h},9074:function(d,e,a){var u,v=this&&this.__extends||(u=function(h,s){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,o){c.__proto__=o}||function(c,o){for(var f in o)Object.prototype.hasOwnProperty.call(o,f)&&(c[f]=o[f])},u(h,s)},function(h,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function c(){this.constructor=h}u(h,s),h.prototype=s===null?Object.create(s):(c.prototype=s.prototype,new c)}),l=this&&this.__generator||function(h,s){var c,o,f,m,y={label:0,sent:function(){if(1&f[0])throw f[1];return f[1]},trys:[],ops:[]};return m={next:C(0),throw:C(1),return:C(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function C(L){return function(k){return function(E){if(c)throw new TypeError("Generator is already executing.");for(;y;)try{if(c=1,o&&(f=2&E[0]?o.return:E[0]?o.throw||((f=o.return)&&f.call(o),0):o.next)&&!(f=f.call(o,E[1])).done)return f;switch(o=0,f&&(E=[2&E[0],f.value]),E[0]){case 0:case 1:f=E;break;case 4:return y.label++,{value:E[1],done:!1};case 5:y.label++,o=E[1],E=[0];continue;case 7:E=y.ops.pop(),y.trys.pop();continue;default:if(!((f=(f=y.trys).length>0&&f[f.length-1])||E[0]!==6&&E[0]!==2)){y=0;continue}if(E[0]===3&&(!f||E[1]>f[0]&&E[1]<f[3])){y.label=E[1];break}if(E[0]===6&&y.label<f[1]){y.label=f[1],f=E;break}if(f&&y.label<f[2]){y.label=f[2],y.ops.push(E);break}f[2]&&y.ops.pop(),y.trys.pop();continue}E=s.call(h,y)}catch(A){E=[6,A],o=0}finally{c=f=0}if(5&E[0])throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}([L,k])}}},_=this&&this.__values||function(h){var s=typeof Symbol=="function"&&Symbol.iterator,c=s&&h[s],o=0;if(c)return c.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&o>=h.length&&(h=void 0),{value:h&&h[o++],done:!h}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.DecorationService=void 0;var S=a(8055),b=a(8460),p=a(844),g=a(6106),w=function(h){function s(){var c=h.call(this)||this;return c._decorations=new g.SortedList(function(o){return o.marker.line}),c._onDecorationRegistered=c.register(new b.EventEmitter),c._onDecorationRemoved=c.register(new b.EventEmitter),c}return v(s,h),Object.defineProperty(s.prototype,"onDecorationRegistered",{get:function(){return this._onDecorationRegistered.event},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"onDecorationRemoved",{get:function(){return this._onDecorationRemoved.event},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"decorations",{get:function(){return this._decorations.values()},enumerable:!1,configurable:!0}),s.prototype.registerDecoration=function(c){var o=this;if(!c.marker.isDisposed){var f=new x(c);if(f){var m=f.marker.onDispose(function(){return f.dispose()});f.onDispose(function(){f&&(o._decorations.delete(f)&&o._onDecorationRemoved.fire(f),m.dispose())}),this._decorations.insert(f),this._onDecorationRegistered.fire(f)}return f}},s.prototype.reset=function(){var c,o;try{for(var f=_(this._decorations.values()),m=f.next();!m.done;m=f.next())m.value.dispose()}catch(y){c={error:y}}finally{try{m&&!m.done&&(o=f.return)&&o.call(f)}finally{if(c)throw c.error}}this._decorations.clear()},s.prototype.getDecorationsAtLine=function(c){return l(this,function(o){return[2,this._decorations.getKeyIterator(c)]})},s.prototype.getDecorationsAtCell=function(c,o,f){var m,y,C,L,k,E,A,D,M,F,T;return l(this,function(R){switch(R.label){case 0:m=0,y=0,R.label=1;case 1:R.trys.push([1,6,7,8]),C=_(this._decorations.getKeyIterator(o)),L=C.next(),R.label=2;case 2:return L.done?[3,5]:(k=L.value,m=(M=k.options.x)!==null&&M!==void 0?M:0,y=m+((F=k.options.width)!==null&&F!==void 0?F:1),!(c>=m&&c<y)||f&&((T=k.options.layer)!==null&&T!==void 0?T:"bottom")!==f?[3,4]:[4,k]);case 3:R.sent(),R.label=4;case 4:return L=C.next(),[3,2];case 5:return[3,8];case 6:return E=R.sent(),A={error:E},[3,8];case 7:try{L&&!L.done&&(D=C.return)&&D.call(C)}finally{if(A)throw A.error}return[7];case 8:return[2]}})},s.prototype.dispose=function(){var c,o;try{for(var f=_(this._decorations.values()),m=f.next();!m.done;m=f.next()){var y=m.value;this._onDecorationRemoved.fire(y)}}catch(C){c={error:C}}finally{try{m&&!m.done&&(o=f.return)&&o.call(f)}finally{if(c)throw c.error}}this.reset()},s}(p.Disposable);e.DecorationService=w;var x=function(h){function s(c){var o=h.call(this)||this;return o.options=c,o.isDisposed=!1,o.onRenderEmitter=o.register(new b.EventEmitter),o.onRender=o.onRenderEmitter.event,o._onDispose=o.register(new b.EventEmitter),o.onDispose=o._onDispose.event,o._cachedBg=null,o._cachedFg=null,o.marker=c.marker,o.options.overviewRulerOptions&&!o.options.overviewRulerOptions.position&&(o.options.overviewRulerOptions.position="full"),o}return v(s,h),Object.defineProperty(s.prototype,"backgroundColorRGB",{get:function(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=S.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"foregroundColorRGB",{get:function(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=S.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg},enumerable:!1,configurable:!0}),s.prototype.dispose=function(){this._isDisposed||(this._isDisposed=!0,this._onDispose.fire(),h.prototype.dispose.call(this))},s}(p.Disposable)},3730:function(d,e,a){var u=this&&this.__decorate||function(S,b,p,g){var w,x=arguments.length,h=x<3?b:g===null?g=Object.getOwnPropertyDescriptor(b,p):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(S,b,p,g);else for(var s=S.length-1;s>=0;s--)(w=S[s])&&(h=(x<3?w(h):x>3?w(b,p,h):w(b,p))||h);return x>3&&h&&Object.defineProperty(b,p,h),h},v=this&&this.__param||function(S,b){return function(p,g){b(p,g,S)}};Object.defineProperty(e,"__esModule",{value:!0}),e.DirtyRowService=void 0;var l=a(2585),_=function(){function S(b){this._bufferService=b,this.clearRange()}return Object.defineProperty(S.prototype,"start",{get:function(){return this._start},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"end",{get:function(){return this._end},enumerable:!1,configurable:!0}),S.prototype.clearRange=function(){this._start=this._bufferService.buffer.y,this._end=this._bufferService.buffer.y},S.prototype.markDirty=function(b){b<this._start?this._start=b:b>this._end&&(this._end=b)},S.prototype.markRangeDirty=function(b,p){if(b>p){var g=b;b=p,p=g}b<this._start&&(this._start=b),p>this._end&&(this._end=p)},S.prototype.markAllDirty=function(){this.markRangeDirty(0,this._bufferService.rows-1)},u([v(0,l.IBufferService)],S)}();e.DirtyRowService=_},4348:function(d,e,a){var u=this&&this.__values||function(g){var w=typeof Symbol=="function"&&Symbol.iterator,x=w&&g[w],h=0;if(x)return x.call(g);if(g&&typeof g.length=="number")return{next:function(){return g&&h>=g.length&&(g=void 0),{value:g&&g[h++],done:!g}}};throw new TypeError(w?"Object is not iterable.":"Symbol.iterator is not defined.")},v=this&&this.__read||function(g,w){var x=typeof Symbol=="function"&&g[Symbol.iterator];if(!x)return g;var h,s,c=x.call(g),o=[];try{for(;(w===void 0||w-- >0)&&!(h=c.next()).done;)o.push(h.value)}catch(f){s={error:f}}finally{try{h&&!h.done&&(x=c.return)&&x.call(c)}finally{if(s)throw s.error}}return o},l=this&&this.__spreadArray||function(g,w,x){if(x||arguments.length===2)for(var h,s=0,c=w.length;s<c;s++)!h&&s in w||(h||(h=Array.prototype.slice.call(w,0,s)),h[s]=w[s]);return g.concat(h||Array.prototype.slice.call(w))};Object.defineProperty(e,"__esModule",{value:!0}),e.InstantiationService=e.ServiceCollection=void 0;var _=a(2585),S=a(8343),b=function(){function g(){for(var w,x,h=[],s=0;s<arguments.length;s++)h[s]=arguments[s];this._entries=new Map;try{for(var c=u(h),o=c.next();!o.done;o=c.next()){var f=v(o.value,2),m=f[0],y=f[1];this.set(m,y)}}catch(C){w={error:C}}finally{try{o&&!o.done&&(x=c.return)&&x.call(c)}finally{if(w)throw w.error}}}return g.prototype.set=function(w,x){var h=this._entries.get(w);return this._entries.set(w,x),h},g.prototype.forEach=function(w){this._entries.forEach(function(x,h){return w(h,x)})},g.prototype.has=function(w){return this._entries.has(w)},g.prototype.get=function(w){return this._entries.get(w)},g}();e.ServiceCollection=b;var p=function(){function g(){this._services=new b,this._services.set(_.IInstantiationService,this)}return g.prototype.setService=function(w,x){this._services.set(w,x)},g.prototype.getService=function(w){return this._services.get(w)},g.prototype.createInstance=function(w){for(var x,h,s=[],c=1;c<arguments.length;c++)s[c-1]=arguments[c];var o=(0,S.getServiceDependencies)(w).sort(function(E,A){return E.index-A.index}),f=[];try{for(var m=u(o),y=m.next();!y.done;y=m.next()){var C=y.value,L=this._services.get(C.id);if(!L)throw new Error("[createInstance] "+w.name+" depends on UNKNOWN service "+C.id+".");f.push(L)}}catch(E){x={error:E}}finally{try{y&&!y.done&&(h=m.return)&&h.call(m)}finally{if(x)throw x.error}}var k=o.length>0?o[0].index:s.length;if(s.length!==k)throw new Error("[createInstance] First service dependency of "+w.name+" at position "+(k+1)+" conflicts with "+s.length+" static arguments");return new(w.bind.apply(w,l([void 0],v(l(l([],v(s),!1),v(f),!1)),!1)))},g}();e.InstantiationService=p},7866:function(d,e,a){var u=this&&this.__decorate||function(g,w,x,h){var s,c=arguments.length,o=c<3?w:h===null?h=Object.getOwnPropertyDescriptor(w,x):h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(g,w,x,h);else for(var f=g.length-1;f>=0;f--)(s=g[f])&&(o=(c<3?s(o):c>3?s(w,x,o):s(w,x))||o);return c>3&&o&&Object.defineProperty(w,x,o),o},v=this&&this.__param||function(g,w){return function(x,h){w(x,h,g)}},l=this&&this.__read||function(g,w){var x=typeof Symbol=="function"&&g[Symbol.iterator];if(!x)return g;var h,s,c=x.call(g),o=[];try{for(;(w===void 0||w-- >0)&&!(h=c.next()).done;)o.push(h.value)}catch(f){s={error:f}}finally{try{h&&!h.done&&(x=c.return)&&x.call(c)}finally{if(s)throw s.error}}return o},_=this&&this.__spreadArray||function(g,w,x){if(x||arguments.length===2)for(var h,s=0,c=w.length;s<c;s++)!h&&s in w||(h||(h=Array.prototype.slice.call(w,0,s)),h[s]=w[s]);return g.concat(h||Array.prototype.slice.call(w))};Object.defineProperty(e,"__esModule",{value:!0}),e.LogService=void 0;var S=a(2585),b={debug:S.LogLevelEnum.DEBUG,info:S.LogLevelEnum.INFO,warn:S.LogLevelEnum.WARN,error:S.LogLevelEnum.ERROR,off:S.LogLevelEnum.OFF},p=function(){function g(w){var x=this;this._optionsService=w,this.logLevel=S.LogLevelEnum.OFF,this._updateLogLevel(),this._optionsService.onOptionChange(function(h){h==="logLevel"&&x._updateLogLevel()})}return g.prototype._updateLogLevel=function(){this.logLevel=b[this._optionsService.rawOptions.logLevel]},g.prototype._evalLazyOptionalParams=function(w){for(var x=0;x<w.length;x++)typeof w[x]=="function"&&(w[x]=w[x]())},g.prototype._log=function(w,x,h){this._evalLazyOptionalParams(h),w.call.apply(w,_([console,"xterm.js: "+x],l(h),!1))},g.prototype.debug=function(w){for(var x=[],h=1;h<arguments.length;h++)x[h-1]=arguments[h];this.logLevel<=S.LogLevelEnum.DEBUG&&this._log(console.log,w,x)},g.prototype.info=function(w){for(var x=[],h=1;h<arguments.length;h++)x[h-1]=arguments[h];this.logLevel<=S.LogLevelEnum.INFO&&this._log(console.info,w,x)},g.prototype.warn=function(w){for(var x=[],h=1;h<arguments.length;h++)x[h-1]=arguments[h];this.logLevel<=S.LogLevelEnum.WARN&&this._log(console.warn,w,x)},g.prototype.error=function(w){for(var x=[],h=1;h<arguments.length;h++)x[h-1]=arguments[h];this.logLevel<=S.LogLevelEnum.ERROR&&this._log(console.error,w,x)},u([v(0,S.IOptionsService)],g)}();e.LogService=p},7302:function(d,e,a){var u=this&&this.__assign||function(){return u=Object.assign||function(b){for(var p,g=1,w=arguments.length;g<w;g++)for(var x in p=arguments[g])Object.prototype.hasOwnProperty.call(p,x)&&(b[x]=p[x]);return b},u.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.OptionsService=e.DEFAULT_OPTIONS=e.DEFAULT_BELL_SOUND=void 0;var v=a(8460),l=a(6114);e.DEFAULT_BELL_SOUND="data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjMyLjEwNAAAAAAAAAAAAAAA//tQxAADB8AhSmxhIIEVCSiJrDCQBTcu3UrAIwUdkRgQbFAZC1CQEwTJ9mjRvBA4UOLD8nKVOWfh+UlK3z/177OXrfOdKl7pyn3Xf//WreyTRUoAWgBgkOAGbZHBgG1OF6zM82DWbZaUmMBptgQhGjsyYqc9ae9XFz280948NMBWInljyzsNRFLPWdnZGWrddDsjK1unuSrVN9jJsK8KuQtQCtMBjCEtImISdNKJOopIpBFpNSMbIHCSRpRR5iakjTiyzLhchUUBwCgyKiweBv/7UsQbg8isVNoMPMjAAAA0gAAABEVFGmgqK////9bP/6XCykxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq",e.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,customGlyphs:!0,bellSound:e.DEFAULT_BELL_SOUND,bellStyle:"none",drawBoldTextInBrightColors:!0,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",lineHeight:1,linkTooltipHoverDuration:500,letterSpacing:0,logLevel:"info",scrollback:1e3,scrollSensitivity:1,screenReaderMode:!1,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!0,allowTransparency:!1,tabStopWidth:8,theme:{},rightClickSelectsWord:l.isMac,rendererType:"canvas",windowOptions:{},windowsMode:!1,wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:void 0};var _=["normal","bold","100","200","300","400","500","600","700","800","900"],S=function(){function b(p){this._onOptionChange=new v.EventEmitter;var g=u({},e.DEFAULT_OPTIONS);for(var w in p)if(w in g)try{var x=p[w];g[w]=this._sanitizeAndValidateOption(w,x)}catch(h){console.error(h)}this.rawOptions=g,this.options=u({},g),this._setupOptions()}return Object.defineProperty(b.prototype,"onOptionChange",{get:function(){return this._onOptionChange.event},enumerable:!1,configurable:!0}),b.prototype._setupOptions=function(){var p=this,g=function(s){if(!(s in e.DEFAULT_OPTIONS))throw new Error('No option with key "'+s+'"');return p.rawOptions[s]},w=function(s,c){if(!(s in e.DEFAULT_OPTIONS))throw new Error('No option with key "'+s+'"');c=p._sanitizeAndValidateOption(s,c),p.rawOptions[s]!==c&&(p.rawOptions[s]=c,p._onOptionChange.fire(s))};for(var x in this.rawOptions){var h={get:g.bind(this,x),set:w.bind(this,x)};Object.defineProperty(this.options,x,h)}},b.prototype.setOption=function(p,g){this.options[p]=g},b.prototype._sanitizeAndValidateOption=function(p,g){switch(p){case"bellStyle":case"cursorStyle":case"rendererType":case"wordSeparator":g||(g=e.DEFAULT_OPTIONS[p]);break;case"fontWeight":case"fontWeightBold":if(typeof g=="number"&&1<=g&&g<=1e3)break;g=_.includes(g)?g:e.DEFAULT_OPTIONS[p];break;case"cursorWidth":g=Math.floor(g);case"lineHeight":case"tabStopWidth":if(g<1)throw new Error(p+" cannot be less than 1, value: "+g);break;case"minimumContrastRatio":g=Math.max(1,Math.min(21,Math.round(10*g)/10));break;case"scrollback":if((g=Math.min(g,4294967295))<0)throw new Error(p+" cannot be less than 0, value: "+g);break;case"fastScrollSensitivity":case"scrollSensitivity":if(g<=0)throw new Error(p+" cannot be less than or equal to 0, value: "+g);case"rows":case"cols":if(!g&&g!==0)throw new Error(p+" must be numeric, value: "+g)}return g},b.prototype.getOption=function(p){return this.options[p]},b}();e.OptionsService=S},8343:(d,e)=>{function a(u,v,l){v.di$target===v?v.di$dependencies.push({id:u,index:l}):(v.di$dependencies=[{id:u,index:l}],v.di$target=v)}Object.defineProperty(e,"__esModule",{value:!0}),e.createDecorator=e.getServiceDependencies=e.serviceRegistry=void 0,e.serviceRegistry=new Map,e.getServiceDependencies=function(u){return u.di$dependencies||[]},e.createDecorator=function(u){if(e.serviceRegistry.has(u))return e.serviceRegistry.get(u);var v=function(l,_,S){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");a(v,l,S)};return v.toString=function(){return u},e.serviceRegistry.set(u,v),v}},2585:(d,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.IDecorationService=e.IUnicodeService=e.IOptionsService=e.ILogService=e.LogLevelEnum=e.IInstantiationService=e.IDirtyRowService=e.ICharsetService=e.ICoreService=e.ICoreMouseService=e.IBufferService=void 0;var u,v=a(8343);e.IBufferService=(0,v.createDecorator)("BufferService"),e.ICoreMouseService=(0,v.createDecorator)("CoreMouseService"),e.ICoreService=(0,v.createDecorator)("CoreService"),e.ICharsetService=(0,v.createDecorator)("CharsetService"),e.IDirtyRowService=(0,v.createDecorator)("DirtyRowService"),e.IInstantiationService=(0,v.createDecorator)("InstantiationService"),(u=e.LogLevelEnum||(e.LogLevelEnum={}))[u.DEBUG=0]="DEBUG",u[u.INFO=1]="INFO",u[u.WARN=2]="WARN",u[u.ERROR=3]="ERROR",u[u.OFF=4]="OFF",e.ILogService=(0,v.createDecorator)("LogService"),e.IOptionsService=(0,v.createDecorator)("OptionsService"),e.IUnicodeService=(0,v.createDecorator)("UnicodeService"),e.IDecorationService=(0,v.createDecorator)("DecorationService")},1480:(d,e,a)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.UnicodeService=void 0;var u=a(8460),v=a(225),l=function(){function _(){this._providers=Object.create(null),this._active="",this._onChange=new u.EventEmitter;var S=new v.UnicodeV6;this.register(S),this._active=S.version,this._activeProvider=S}return Object.defineProperty(_.prototype,"onChange",{get:function(){return this._onChange.event},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"versions",{get:function(){return Object.keys(this._providers)},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"activeVersion",{get:function(){return this._active},set:function(S){if(!this._providers[S])throw new Error('unknown Unicode version "'+S+'"');this._active=S,this._activeProvider=this._providers[S],this._onChange.fire(S)},enumerable:!1,configurable:!0}),_.prototype.register=function(S){this._providers[S.version]=S},_.prototype.wcwidth=function(S){return this._activeProvider.wcwidth(S)},_.prototype.getStringCellWidth=function(S){for(var b=0,p=S.length,g=0;g<p;++g){var w=S.charCodeAt(g);if(55296<=w&&w<=56319){if(++g>=p)return b+this.wcwidth(w);var x=S.charCodeAt(g);56320<=x&&x<=57343?w=1024*(w-55296)+x-56320+65536:b+=this.wcwidth(x)}b+=this.wcwidth(w)}return b},_}();e.UnicodeService=l}},n={};return function d(e){var a=n[e];if(a!==void 0)return a.exports;var u=n[e]={exports:{}};return t[e].call(u.exports,u,u.exports,d),u.exports}(4389)})()})})(la);var Pl=la.exports;class Xl extends ze.Component{constructor(){super(...arguments);ei(this,"mounted",!1);ei(this,"socket");ei(this,"state",{error:"",renderingLish:!0});ei(this,"terminal")}componentDidMount(){this.mounted=!0,Mo(1080,730),this.connect()}componentDidUpdate(t){this.props.token!==t.token&&(this.socket.close(),this.terminal.dispose(),this.connect())}componentWillUnmount(){this.mounted=!1}connect(){const{linode:t,token:n}=this.props,{region:d}=t;this.socket=new WebSocket(`${Pn(d)}:8181/${n}/weblish`),this.socket.addEventListener("open",()=>{this.mounted&&this.setState({renderingLish:!0},()=>this.renderTerminal())})}render(){const{error:t}=this.state;return t?Ee.jsx(da,{sx:{"& *":{color:"#f4f4f4 !important"}},children:Ee.jsx(Or,{errorText:t})}):Ee.jsx("div",{children:this.socket&&this.socket.readyState===this.socket.OPEN?Ee.jsx("div",{className:"terminal",id:"terminal"}):Ee.jsx(es,{})})}renderTerminal(){const{linode:t,refreshToken:n}=this.props,{group:d,label:e}=t;this.terminal=new Pl.Terminal({cols:120,fontFamily:'"Ubuntu Mono", monospace, sans-serif',rows:40,screenReaderMode:!0}),this.terminal.onData(v=>this.socket.send(v));const a=document.getElementById("terminal");this.terminal.open(a),this.terminal.writeln("\x1B[32mLinode Lish Console\x1B[m"),this.socket.addEventListener("message",v=>{var _;let l;try{l=JSON.parse(v.data)}catch{l=v.data}if((l==null?void 0:l.type)==="error"&&((_=l==null?void 0:l.reason)==null?void 0:_.toLowerCase())==="your session has expired."){n();return}try{this.terminal.write(v.data)}catch{window.location.reload()}}),this.socket.addEventListener("close",()=>{this.terminal.dispose(),this.mounted&&this.setState({renderingLish:!1})});const u=d?`${d}/${e}`:e;window.document.title=`${u} - Linode Lish Console`}}const Il=2e3,Hl=()=>{var c,o;const r=pa(),{isLoading:i}=va(),{linodeId:t,type:n}=ga(),d=Number(t),{data:e,error:a,isLoading:u}=ya(d),{data:v,error:l,isLoading:_,refetch:S}=xa(d),b=u||_||i,p=v==null?void 0:v.lish_token;ze.useEffect(()=>{const f=setInterval(g,Il);return()=>{clearInterval(f)}},[]);const g=()=>{window.localStorage.getItem("authentication/token")||window.close()},w=e&&e.type&&e.type.includes("metal"),x=[{routeName:`/linodes/${d}/lish/weblish`,title:"Weblish"},w?null:{routeName:`/linodes/${d}/lish/glish`,title:"Glish"}].filter(Boolean),h=f=>{r.replace(`/linodes/${d}/lish/${x[f].title.toLowerCase()}`)},s=async()=>{await S()};return b?Ee.jsx(es,{}):a?Ee.jsx(Or,{errorText:((c=a==null?void 0:a[0])==null?void 0:c.reason)??"Unable to load this Linode"}):l?Ee.jsx(Or,{errorText:((o=l==null?void 0:l[0])==null?void 0:o.reason)??"Unable to load a Lish token for this Linode"}):e&&p?Ee.jsxs(Ul,{index:n&&x.findIndex(f=>f.title.toLocaleLowerCase()===n)!==-1?x.findIndex(f=>f.title.toLocaleLowerCase()===n):0,onChange:h,children:[Ee.jsx(ma,{tabs:x}),Ee.jsxs(Sa,{children:[Ee.jsx(as,{"data-qa-tab":"Weblish",index:0,children:Ee.jsx(Xl,{linode:e,refreshToken:s,token:p})}),!w&&Ee.jsx(as,{"data-qa-tab":"Glish",index:1,children:Ee.jsx(Ol,{linode:e,refreshToken:s,token:p})})]})]}):null},Vl=Hl,Ul=Ao(wa)(({theme:r})=>({'& [data-reach-tab][role="tab"]':{'&[aria-selected="true"]':{"&:hover":{backgroundColor:r.palette.primary.light,color:r.name==="light"?r.color.white:r.color.black},backgroundColor:r.palette.primary.main,borderBottom:"none !important",color:r.name==="light"?r.color.white:r.color.black},backgroundColor:r.bg.offWhite,color:r.color.tableHeaderText,flex:"auto",margin:0,maxWidth:"none !important"},'& [role="tablist"]':{backgroundColor:r.bg.offWhite,display:"flex",margin:0,overflow:"hidden"},backgroundColor:"black",margin:0})),es=Ao(ba)(()=>({left:"50%",position:"absolute",top:"50%",transform:"translate(-50%, -50%)"}));export{Vl as default};
