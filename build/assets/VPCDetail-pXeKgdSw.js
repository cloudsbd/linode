import{s as T,f as ue,B,aY as X,aa as Ze,j as e,c1 as ve,T as me,eM as et,r,a4 as tt,bC as nt,av as we,ky as st,dV as ge,ao as fe,bp as be,N as Me,ez as ze,ad as U,bJ as Ee,d0 as ot,cQ as it,c3 as Ce,bB as Le,a1 as le,kz as Ae,ak as Te,kA as at,ag as De,cx as rt,kB as lt,c as dt,C as Ie,kC as ct,dT as pt,W as Q,b1 as ut,aW as We,E as He,b as mt,ba as gt,a2 as ft,Q as bt,cH as xt,aZ as ht}from"./index-Eksrs3uK.js";import{g as St,P as yt,E as Ct}from"./utils-x4yn563A.js";import{L as Lt}from"./LandingHeader-JXAVBhqg.js";import{A as jt,R as vt,a as wt,M as Tt,V as Dt,W as It,N as Pt,S as Et,d as At,e as Rt,f as kt}from"./constants-jI3mcPVd.js";import{v as ce,s as Re,b as Ot,c as Bt,d as _t,e as Ft,f as Vt}from"./vpcs-qp5yIH1u.js";import{V as $t,a as Nt}from"./VPCEditDrawer-_TGfWlTt.js";import{C as Ut}from"./CollapsibleTable-0WYTbtYD.js";import{D as Mt}from"./DebouncedSearchTextField-EUZwzd3g.js";import{P as zt}from"./PaginationFooter-NHWf7fW2.js";import{T as de,a as z,b as Wt,c as Ht}from"./TableRow-phXfWUGW.js";import{T as ke}from"./TableRowEmpty-aXmC67-Z.js";import{T as Qt}from"./TableSortCell-hcsagFzN.js";import{A as Gt}from"./ActionMenu-4CPisA_2.js";import{u as Kt}from"./useOrder-rsUMHEuj.js";import{u as qt}from"./usePagination-Sxr0Tlb7.js";import{u as xe}from"./formik.esm-Kap5lsIh.js";import{A as je}from"./Autocomplete-XvrzKoAo.js";import{D as Qe}from"./DownloadCSV-HnOVCNZX.js";import{D as he}from"./Drawer-A9yKjC3Z.js";import{L as Yt}from"./ListItem-joIHQeyv.js";import{d as Xt}from"./LinodeCreate-0Iogm6Fa.js";import{u as Ge}from"./useFormattedDate-CkANZUWG.js";import{c as Oe,i as Be,u as Jt}from"./configs-3PoBJaCX.js";import{b as Ke,D as Zt,c as en}from"./useCreateVPC-U4LUEfXY.js";import{T as tn}from"./TypeToConfirmDialog-9yjZCCL0.js";import{I as Se}from"./InlineMenuAction-d5mRENST.js";import{S as nn}from"./StatusIcon-RuV8PvAV.js";import{u as sn}from"./firewalls-zJDfBkPC.js";import{T as on}from"./TableHead-Si_pzkLK.js";import"./RegionSelect-_Z8IGlox.js";import"./Flag-kVTQNGw3.js";import"./visuallyHidden-DVicuktI.js";import"./OrderBy-H-bWJCPy.js";import"./splitAt-pbTnq2Oi.js";import"./lke-download-Hz_dthl6.js";import"./AccessPanel-rD0WgXZZ.js";import"./TableRowError-8gKmGX7P.js";import"./CreateSSHKeyDrawer-NnwCGTeL.js";import"./Code-HuerkG4_.js";import"./formikTrimUtil-tfsUpEEv.js";import"./getAPIErrorFor-OfQrArkQ.js";import"./TableRowLoading-iP7zIRHG.js";import"./Skeleton-iwmO4Yae.js";import"./SelectRegionPanel-Y2ibm2gz.js";import"./RegionHelperText-N0L662HQ.js";import"./SelectFirewallPanel-xh9FN-rV.js";import"./CreateFirewallDrawer-dcf-B8xd.js";import"./LinodeSelect-y7DOgXsC.js";import"./NodeBalancerSelect-tPR8nvIa.js";import"./formikErrorUtils-jhqfCjwU.js";import"./grants-2yY1GgvJ.js";import"./LinkButton-O1af9aD7.js";import"./constants-KokzTiEs.js";import"./linodes-orSDvVk7.js";import"./TagsInput-cI8zXYga.js";import"./concat-Y0p1CSCT.js";import"./_isFunction-X3ooR5X_.js";import"./_contains-91K6xqrF.js";import"./tags-kBUFHmv1.js";import"./SafeTabPanel-S0Pp8CVT.js";import"./TabList-4PWL4GSj.js";import"./TabLinkList-BrXtJznm.js";import"./LinodeActionMenu-bV6ckFLX.js";import"./immer.esm--MpJ8fpr.js";import"./groupBy-7jUcQ2cf.js";import"./PlansPanel-EH5ViSTx.js";import"./TabbedPanel-IicwaI6L.js";import"./PlanInformation-CouBULD4.js";import"./TextTooltip-SPU6hUyt.js";import"./Currency-No8tnN7b.js";import"./Radio-HudVgwMW.js";import"./SelectionCard-IyO-o1CU.js";import"./dynamicPricing-n5eCZqTg.js";import"./arePropsEqual-WL8SjyyC.js";import"./getSelectedOptionFromGroupedOptions-4YyATpGV.js";import"./RenderGuard-iLW_eACV.js";import"./image.helpers-5SOq-oMg.js";import"./CommonStackScript.styles-tUmBO9fs.js";import"./index-C8Ov-8_e.js";import"./ResourcesSection-fJQ13r7x.js";import"./StackScript-_ub41xk0.js";import"./CopyTooltip-mIyzAQ7E.js";import"./index-Y5esPPk-.js";import"./DateTimeDisplay-bXC9mIcz.js";import"./ShowMoreExpansion-5I3PKpip.js";import"./lishUtils-OjFanRCH.js";import"./linodes--kIa80QO.js";import"./SMTPRestrictionText-BVvt12px.js";import"./InterfaceSelect--p7gvXq_.js";import"./scrollErrorIntoView-6n4Cku1Y.js";import"./filterCurrentLinodeTypes-6QsXu4XU.js";import"./backups-brLSog0e.js";import"./ipUtils-P4y3JNCT.js";import"./ipaddr-jlottelM.js";import"./toInteger-N3RsDDMF.js";import"./assocPath-nNkv7F8U.js";import"./stackscripts-7LZsSbBg.js";import"./LandingLoading-jDJ3d7aA.js";import"./Paginate-XLm_-WxT.js";import"./TypeToConfirm-koQ3u5up.js";const an=n=>{const o=[];for(const s of n)s.linodes.forEach(t=>{o.includes(t.id)||o.push(t.id)});return o.length},rn=(n,o)=>{var s;for(const t of n)for(const a of t.interfaces)if((s=a.ipv4)!=null&&s.vpc&&a.subnet_id===o)return a},ln=(n,o)=>{for(const s of n){const t=s.interfaces;if(t.some(a=>a.subnet_id===o))return t.some(a=>a.active&&a.purpose==="vpc"&&!a.primary)}return!1},_e=T(ue,{label:"StyledActionButton"})(({theme:n})=>({"&:hover":{backgroundColor:n.color.blueDTwhite,color:n.color.white},color:n.textColors.linkActiveLight,fontFamily:n.font.normal,fontSize:"0.875rem",height:n.spacing(5),minWidth:"auto"})),dn=T(B,{label:"StyledDescriptionBox"})(({theme:n})=>({[n.breakpoints.down("lg")]:{display:"flex",flexDirection:"column",paddingTop:n.spacing(3)},[n.breakpoints.down("sm")]:{paddingTop:n.spacing(1)}})),cn=T(B,{label:"StyledSummaryBox"})(({theme:n})=>({[n.breakpoints.down("sm")]:{flexDirection:"column"}})),Fe=T(X,{label:"StyledSummaryTextTypography"})(({theme:n})=>({"& strong":{paddingRight:n.spacing(1)},"&:first-of-type":{paddingBottom:n.spacing(2)},[n.breakpoints.down("sm")]:{paddingBottom:n.spacing(2)},whiteSpace:"nowrap"})),pn=T(Ze,{label:"StyledPaper"})(({theme:n})=>({borderTop:`1px solid ${n.borderColors.borderTable}`,display:"flex",padding:n.spacing(2),[n.breakpoints.down("lg")]:{flexDirection:"column"}})),un=n=>{const{handleAssignLinodes:o,handleDelete:s,handleEdit:t,handleUnassignLinodes:a,numLinodes:c,subnet:l}=n,i=[{onClick:()=>{o(l)},title:"Assign Linodes"},{onClick:()=>{a(l)},title:"Unassign Linodes"},{onClick:()=>{t(l)},title:"Edit"},{disabled:c!==0,onClick:()=>{s(l)},title:"Delete",tooltip:c>0?"Linodes assigned to a subnet must be unassigned before the subnet can be deleted.":""}];return e.jsx(Gt,{actionsList:i,ariaLabel:`Action menu for Subnet ${l.label}`})},mn=T(B,{label:"StyledNoAssignedLinodesBox",shouldForwardProp:ve(["maxWidth"])})(({maxWidth:n,theme:o})=>({background:o.name==="light"?o.bg.main:o.bg.app,display:"flex",flexDirection:"column",height:"52px",justifyContent:"center",maxWidth:n?`${n}px`:"416px",paddingLeft:o.spacing(2),width:"100%"})),gn=T(me,{label:"SelectedOptionsHeader"})(({theme:n})=>({color:n.color.headline,fontFamily:n.font.bold,marginBottom:n.spacing(2)})),fn=T(et,{label:"SelectedOptionsList",shouldForwardProp:ve(["isRemovable"])})(({isRemovable:n,theme:o})=>({background:o.name==="light"?o.bg.main:o.bg.app,padding:n?"5px 0":`${o.spacing(2)} 0`,width:"100%"})),bn=T(Yt,{label:"SelectedOptionsListItem"})(()=>({justifyContent:"space-between",paddingBottom:0,paddingRight:4,paddingTop:0})),Ve=T("span",{label:"StyledLabel"})(({theme:n})=>({color:n.color.label,fontSize:"14px"})),xn=T(B,{label:"StyledBoxShadowWrapper",shouldForwardProp:ve(["displayShadow"])})(({displayShadow:n,maxWidth:o,theme:s})=>({"&:after":{bottom:0,content:'""',height:"15px",position:"absolute",width:"100%",...n&&{boxShadow:`${s.color.boxShadow} 0px -15px 10px -10px inset`}},maxWidth:`${o}px`,position:"relative"})),hn=T(B,{label:"StyledScrollBox"})(({maxHeight:n,maxWidth:o})=>({maxHeight:`${n}px`,maxWidth:`${o}px`,overflow:"auto"})),qe=n=>{const{headerText:o,isRemovable:s=!0,maxHeight:t=427,maxWidth:a=416,noDataText:c,onRemove:l,preferredDataLabel:i,selectionData:m}=n,u=r.useRef(null),[g,L]=r.useState(0);r.useEffect(()=>{u.current&&L(u.current.clientHeight)},[m]);const S=f=>{l(f)};return e.jsxs(e.Fragment,{children:[e.jsx(gn,{children:o}),m.length>0?e.jsx(xn,{displayShadow:g>t,maxWidth:a,children:e.jsx(hn,{maxHeight:t,maxWidth:a,children:e.jsx(fn,{isRemovable:s,ref:u,children:m.map(f=>e.jsxs(bn,{alignItems:"center",children:[e.jsx(Ve,{children:i?f[i]:f.label}),s&&e.jsx(tt,{"aria-label":`remove ${i?f[i]:f.label}`,disableRipple:!0,onClick:()=>S(f),size:"medium",children:e.jsx(nt,{})})]},f.id))})})}):e.jsx(mn,{maxWidth:a,children:e.jsx(Ve,{children:c})})]})},Ye=()=>{const n=we(),[o,s]=r.useState([]),t=async({configId:c,linodeId:l,subnetId:i,vpcId:m})=>{const u=[[ce,"paginated"],[ce,"vpc",m],[ce,"vpc",m,Re],[ce,"vpc",m,Re,"subnet",i],[ge,"linode",l,Oe,"config",c,Be]];await Promise.all(u.map(g=>n.invalidateQueries(g)))};return{invalidateQueries:t,setUnassignLinodesErrors:s,unassignLinode:async({configId:c,interfaceId:l,linodeId:i,subnetId:m,vpcId:u})=>{await st(i,c,l),t({configId:c,linodeId:i,subnetId:m,vpcId:u}),n.invalidateQueries([ge,"linode",i,Oe,"config",c,Be,"interface",l])},unassignLinodesErrors:o}},$e=T(B,{label:"StyledButtonBox"})(({theme:n})=>({display:"flex",justifyContent:"flex-end",margin:`${n.spacing(3)} 0px`})),Sn=n=>{var te,oe;const{onClose:o,open:s,subnet:t,vpcId:a,vpcRegion:c}=n,{invalidateQueries:l,setUnassignLinodesErrors:i,unassignLinode:m,unassignLinodesErrors:u}=Ye(),g=r.useRef(),L=r.useRef(-1),S=r.useRef(-1),f=Ge(),[D,y]=r.useState({}),[C,p]=r.useState([]),[P,E]=r.useState([]),[$,_]=r.useState(!0),{data:A}=fe(),{data:R}=be(),j=R==null?void 0:R.vpc.find(x=>x.id===a),k=!!(A!=null&&A.restricted)&&((j==null?void 0:j.permissions)==="read_only"||(R==null?void 0:R.vpc.length)===0),G=async()=>{await W(),g.current.link.click()},{data:F,refetch:W}=Me({},{region:c}),J=r.useCallback(()=>F==null?void 0:F.filter(x=>!(t!=null&&t.linodes.some(h=>h.id===x.id))),[t,F]),[M,Z]=r.useState([]);r.useEffect(()=>{F&&Z(J()??[])},[F,Z,J]);function ee(x,h){var w;return(x.length>1?h==null?void 0:h.id:(w=x[0])==null?void 0:w.id)??-1}const ne=async()=>{const{chosenIP:x,selectedConfig:h,selectedLinode:w}=b,Y=ee(P,h),ie=P.find(ae=>ae.id===Y),Xe={ipam_address:null,ipv4:{nat_1_1:"any",vpc:$?void 0:x},label:null,primary:!0,purpose:"vpc",subnet_id:t==null?void 0:t.id,vpc_id:a};try{(ie==null?void 0:ie.interfaces.length)===0&&Ae((w==null?void 0:w.id)??-1,Y,Xt);const ae=await Ae((w==null?void 0:w.id)??-1,Y,Xe);L.current=ae.id,await l({configId:Y,linodeId:(w==null?void 0:w.id)??-1,subnetId:(t==null?void 0:t.id)??-1,vpcId:a})}catch(ae){const Pe=Te(["ipv4.vpc"],ae),Je=v(Y,Pe);y({...Pe,none:Je})}},se=async x=>{const{configId:h,id:w,interfaceId:Y}=x;S.current=w;try{await m({configId:h,interfaceId:Y,linodeId:w,subnetId:(t==null?void 0:t.id)??-1,vpcId:a})}catch(ie){i(ie)}},K=()=>{_(!$)},v=(x,h)=>x===-1?"Selected Linode must have at least one configuration profile":h.none,{dirty:I,handleSubmit:N,resetForm:V,setFieldValue:H,setValues:q,values:b}=xe({enableReinitialize:!0,initialValues:{chosenIP:"",selectedConfig:null,selectedLinode:null},onSubmit:ne,validateOnBlur:!1,validateOnChange:!1});r.useEffect(()=>{var x;if(b.selectedLinode&&b.selectedLinode&&t!=null&&t.linodes.some(h=>{var w;return h.id===((w=b.selectedLinode)==null?void 0:w.id)})){const h=ee(P,b.selectedConfig),w={...b.selectedLinode,configId:h,interfaceId:L.current,linodeConfigLabel:`${b.selectedLinode.label}${(x=b.selectedConfig)!=null&&x.label?` (${b.selectedConfig.label})`:""}`};p([...C,w]),V(),E([]),q({chosenIP:"",selectedConfig:null,selectedLinode:null})}},[t,C,b.selectedLinode,b.selectedConfig,P,V,E,q]),r.useEffect(()=>{S.current!==-1&&!(t!=null&&t.linodes.some(h=>h.id===S.current))&&!!C.find(h=>h.id===S.current)&&p([...C].filter(h=>h.id!==S.current))},[t,C]);const d=r.useCallback(async x=>{if(x)try{const h=await ze(x.id);E(h)}catch{y({none:"Could not load configurations for selected linode"})}else E([])},[]);r.useEffect(()=>{d(b.selectedLinode)},[b.selectedLinode,d]);const O=()=>{o(),V(),p([]),E([]),y({}),i([]),_(!0)};return e.jsxs(he,{title:`Assign Linodes to subnet: ${t==null?void 0:t.label} (${(t==null?void 0:t.ipv4)??(t==null?void 0:t.ipv6)})`,onClose:O,open:s,children:[k&&e.jsx(U,{important:!0,text:`You don't have permissions to assign Linodes to ${t==null?void 0:t.label}. Please contact an account administrator for details.`,variant:"error"}),D.none&&e.jsx(U,{text:D.none,variant:"error"}),e.jsx(U,{spacingBottom:16,text:`${jt}`,variant:"warning"}),e.jsxs("form",{onSubmit:N,children:[e.jsx(Ee,{children:vt}),e.jsx(je,{onChange:(x,h)=>{H("selectedLinode",h),y({})},disabled:k,inputValue:((te=b.selectedLinode)==null?void 0:te.label)||"",label:"Linodes",options:M,placeholder:"Select Linodes or type to search",sx:{marginBottom:"8px"},value:b.selectedLinode||null}),e.jsxs(B,{alignItems:"center",display:"flex",flexDirection:"row",children:[e.jsx(ot,{control:e.jsx(it,{checked:$,onChange:K}),label:e.jsx(me,{children:"Auto-assign a VPC IPv4 address for this Linode"}),"data-testid":"vpc-ipv4-checkbox",disabled:k,sx:{marginRight:0}}),e.jsx(Ce,{status:"help",text:wt})]}),!$&&e.jsx(Le,{onChange:x=>{H("chosenIP",x.target.value),y({})},disabled:k,errorText:D["ipv4.vpc"],label:"VPC IPv4",sx:{marginBottom:"8px"},value:b.chosenIP}),P.length>1&&e.jsxs(e.Fragment,{children:[e.jsxs(Ee,{sx:{marginTop:"16px"},children:[Tt,e.jsx(le,{to:"#",children:" Learn more"}),"."]}),e.jsx(je,{onChange:(x,h)=>{H("selectedConfig",h),y({})},disabled:k,inputValue:((oe=b.selectedConfig)==null?void 0:oe.label)||"",label:"Configuration profile",options:P,placeholder:"Select a configuration profile",value:b.selectedConfig||null})]}),e.jsx($e,{children:e.jsx(ue,{disabled:k||!I||!b.selectedLinode||P.length>1&&!b.selectedConfig,buttonType:"primary",type:"submit",children:"Assign Linode"})})]}),u?u.map(x=>e.jsx(U,{spacingBottom:8,text:x.reason,variant:"error"},x.reason)):null,e.jsx(qe,{onRemove:x=>{se(x),i([])},headerText:`Linodes Assigned to Subnet (${C.length})`,noDataText:"No Linodes have been assigned.",preferredDataLabel:"linodeConfigLabel",selectionData:C}),C.length>0&&e.jsx(Qe,{sx:{alignItems:"flex-start",display:"flex",gap:1,marginTop:2,textAlign:"left"},buttonType:"styledLink",csvRef:g,data:C,filename:`linodes-assigned-${f}.csv`,headers:Ke,onClick:G,text:"Download List of Assigned Linodes (.csv)"}),e.jsx($e,{children:e.jsx(ue,{buttonType:"outlined",onClick:O,children:"Done"})})]})},yn=n=>{const{onClose:o,open:s,vpcId:t}=n,{data:a}=fe(),{data:c}=be(),l=(a==null?void 0:a.restricted)&&!(c!=null&&c.global.add_vpcs),[i,m]=r.useState({}),{isLoading:u,mutateAsync:g,reset:L}=Ot(t),S=async()=>{try{await g({label:p.label,ipv4:p.ip.ipv4}),o()}catch(P){const E=Te(["label","ipv4"],P);m(E),C({label:p.label,labelError:E.label,ip:{...p.ip,ipv4Error:E.ipv4}})}},{dirty:f,handleSubmit:D,resetForm:y,setValues:C,values:p}=xe({enableReinitialize:!0,initialValues:{label:"",ip:{ipv4:Zt,availIPv4s:256}},onSubmit:S,validateOnBlur:!1,validateOnChange:!1,validationSchema:at});return r.useEffect(()=>{s&&(y(),L(),m({}))},[s]),e.jsxs(he,{onClose:o,open:s,title:"Create Subnet",children:[i.none&&e.jsx(U,{text:i.none,variant:"error"}),l&&e.jsx(U,{text:"You don't have permissions to create a new Subnet. Please contact an account administrator for details.",important:!0,spacingTop:16,variant:"error"}),e.jsxs("form",{onSubmit:D,children:[e.jsx(en,{disabled:l,onChange:P=>{C(P)},subnet:p}),e.jsx(De,{primaryButtonProps:{"data-testid":"create-subnet-drawer-button",disabled:!f||l,label:"Create Subnet",loading:u,type:"submit",onClick:S},secondaryButtonProps:{label:"Cancel",onClick:o}})]})]})},Cn=n=>{const{onClose:o,open:s,subnet:t,vpcId:a}=n,{enqueueSnackbar:c}=rt(),{error:l,isLoading:i,mutateAsync:m,reset:u}=Bt(a,(t==null?void 0:t.id)??-1);r.useEffect(()=>{s&&u()},[s,u]);const g=async()=>{await m(),c("Subnet deleted successfully.",{variant:"success"}),o()};return e.jsx(tn,{entity:{action:"deletion",name:t==null?void 0:t.label,primaryBtnText:"Delete",type:"Subnet"},errors:l,label:"Subnet Label",loading:i,onClick:g,onClose:o,open:s,title:`Delete Subnet ${t==null?void 0:t.label}`})},Ln="Once a subnet is created its IP range cannot be edited.",jn=n=>{const{onClose:o,open:s,subnet:t,vpcId:a}=n,{error:c,isLoading:l,mutateAsync:i,reset:m}=_t(a,(t==null?void 0:t.id)??-1),u=xe({enableReinitialize:!0,initialValues:{label:(t==null?void 0:t.label)??""},async onSubmit(y){await i(y),o()}});r.useEffect(()=>{s&&(u.resetForm(),m())},[s]);const{data:g}=fe(),{data:L}=be(),S=L==null?void 0:L.vpc.find(y=>y.id===a),f=!!(g!=null&&g.restricted)&&((S==null?void 0:S.permissions)==="read_only"||(L==null?void 0:L.vpc.length)===0),D=Te(["label"],c);return e.jsxs(he,{onClose:o,open:s,title:"Edit Subnet",children:[D.none&&e.jsx(U,{text:D.none,variant:"error"}),f&&e.jsx(U,{important:!0,text:`You don't have permissions to edit ${t==null?void 0:t.label}. Please contact an account administrator for details.`,variant:"error"}),e.jsxs("form",{onSubmit:u.handleSubmit,children:[e.jsx(Le,{disabled:f,errorText:D.label,label:"Label",name:"label",onChange:u.handleChange,value:u.values.label}),e.jsx(Le,{disabled:!0,label:"Subnet IP Address Range",tooltipText:Ln,value:t==null?void 0:t.ipv4}),e.jsx(De,{primaryButtonProps:{"data-testid":"save-button",disabled:!u.dirty,label:"Save",loading:l,type:"submit"},secondaryButtonProps:{label:"Cancel",onClick:o}})]})]})},vn=T(de,{label:"StyledTableRow"})(({theme:n})=>({"&:last-of-type":{"& th, td":{borderBottom:`1px solid ${n.borderColors.borderTable}`}}})),pe=T(z,{label:"StyledTableCell"})(({theme:n})=>({"&:last-of-type":{paddingRight:n.spacing(2)},border:"none"})),wn=T(z,{label:"StyledActionTableCell"})(()=>({border:"none",height:45})),re=T(z,{label:"StyledTableHeadCell"})(({theme:n})=>({"&:first-of-type":{paddingLeft:n.spacing(6)},borderBottom:`1px solid ${n.borderColors.borderTable} !important`,borderTop:"none !important"})),Tn=T(lt,{label:"StyledWarningIcon"})(({theme:n})=>({fill:n.color.yellow})),Dn=n=>{const o=we(),{handlePowerActionsLinode:s,handleUnassignLinode:t,linodeId:a,subnet:c,subnetId:l}=n,{data:i,error:m,isLoading:u}=dt(a),{data:g,error:L,isLoading:S}=sn(a),{data:f,error:D,isLoading:y}=Jt(a),C=ln(f??[],(c==null?void 0:c.id)??-1);if(r.useEffect(()=>{i&&i.status==="running"&&o.invalidateQueries([ge,"linode",a,"configs"])},[i,a,o]),u||!i)return e.jsx(de,{children:e.jsx(z,{colSpan:6,children:e.jsx(Ie,{mini:!0})})});if(m)return e.jsx(de,{"data-testid":"subnet-linode-row-error",children:e.jsx(z,{colSpan:5,style:{paddingLeft:24},children:e.jsxs(B,{alignItems:"center",display:"flex",children:[e.jsx(ct,{"data-qa-error-icon":!0,sx:j=>({color:j.color.red,marginRight:1})}),e.jsxs(me,{children:["There was an error loading"," ",e.jsxs(le,{to:`/linodes/${a}`,children:["Linode ",a]})]})]})})});const p=e.jsx(le,{to:`/linodes/${i.id}`,children:i.label}),P=C?e.jsxs(B,{"data-testid":It,sx:{alignItems:"center",display:"flex"},children:[e.jsx(Ce,{text:e.jsxs(me,{children:["This Linode is using an unrecommended configuration profile. Update its configuration profile to avoid connectivity issues. Read our"," ",e.jsx(le,{to:Pt,children:"Configuration Profiles"})," ","guide for more information."]}),icon:e.jsx(Tn,{}),interactive:!0,status:"other",sxTooltipIcon:{paddingLeft:0}}),p]}):p,E=St(i.status),$=i.status==="running",_=i.status==="stopped"||i.status==="offline",A=$&&(f==null?void 0:f.some(j=>j.interfaces.some(k=>k.purpose==="vpc"&&!k.active))),R=!A&&($||_);return e.jsxs(vn,{children:[e.jsx(pe,{component:"th",scope:"row",sx:{paddingLeft:6},children:P}),e.jsxs(pe,{statusCell:!0,children:[e.jsx(nn,{"aria-label":`Linode status ${(i==null?void 0:i.status)??E}`,status:E}),A?e.jsxs(e.Fragment,{children:["Reboot Needed",e.jsx(Ce,{status:"help",sxTooltipIcon:{paddingRight:0},text:Dt})]}):pt(i.status.replace("_"," "))]}),e.jsx(Q,{smDown:!0,children:e.jsx(pe,{children:Pn(f??[],y,l,D??void 0)})}),e.jsx(Q,{smDown:!0,children:e.jsx(pe,{children:In((g==null?void 0:g.data)??[],S,L??void 0)})}),e.jsxs(wn,{actionCell:!0,children:[A&&e.jsx(Se,{onClick:()=>{s(i,"Reboot")},actionText:"Reboot"}),R&&e.jsx(Se,{onClick:()=>{s(i,_?"Power On":"Power Off")},actionText:_?"Power On":"Power Off"}),e.jsx(Se,{actionText:"Unassign Linode",onClick:()=>t(i,c)})]})]})},In=(n,o,s)=>o?"Loading...":s?"Error retrieving Firewalls":n.length===0?"None":An(n),Pn=(n,o,s,t)=>{if(o)return"Loading...";if(t)return"Error retrieving VPC IPv4s";if(n.length===0)return"None";const a=rn(n,s);return En(a)},En=n=>{var o;return e.jsx(e.Fragment,{children:n&&e.jsx("span",{children:(o=n.ipv4)==null?void 0:o.vpc},n.id)})},An=n=>{const o=n.slice(0,3);return e.jsxs(e.Fragment,{children:[o.map((s,t)=>e.jsxs(le,{className:"link secondaryLink","data-testid":"firewall-row-link",to:`/firewalls/${s.id}`,children:[t>0&&", ",s.label]},s.id)),n.length>3&&e.jsxs("span",{children:[", ","plus ",n.length-3," more."]})]})},Rn=e.jsxs(de,{children:[e.jsx(re,{children:"Linode Label"}),e.jsx(re,{sx:{width:"14%"},children:"Status"}),e.jsx(Q,{smDown:!0,children:e.jsx(re,{children:"VPC IPv4"})}),e.jsx(Q,{smDown:!0,children:e.jsx(re,{children:"Firewalls"})}),e.jsx(re,{})]}),kn=r.memo(({onClose:n,open:o,singleLinodeToBeUnassigned:s,subnet:t,vpcId:a})=>{const{data:c}=fe(),{data:l}=be(),i=t==null?void 0:t.id,m=l==null?void 0:l.vpc.find(v=>v.id===a),u=we(),{setUnassignLinodesErrors:g,unassignLinode:L,unassignLinodesErrors:S}=Ye(),f=r.useRef(),D=Ge(),[y,C]=r.useState(s?[s]:[]),p=r.useRef(!1),[P,E]=r.useState([]),[$,_]=r.useState([]),{linodes:A}=t||{},R=!!(c!=null&&c.restricted)&&((m==null?void 0:m.permissions)==="read_only"||(l==null?void 0:l.vpc.length)===0),{data:j,error:k,refetch:G}=Me(),F=r.useCallback(()=>j==null?void 0:j.filter(v=>A==null?void 0:A.some(I=>I.id===v.id)),[j,A]);r.useEffect(()=>{j&&E(F()??[])},[j,E,F]);const W=r.useCallback(async v=>{try{const N=(await Promise.all(v.map(async V=>{var q;const H=await u.fetchQuery([ge,"linode",V.id,"configs"],()=>ze(V.id));if(H){const b=H.find(O=>O.interfaces.some(te=>te.subnet_id===i&&te.purpose==="vpc")),d=(q=b==null?void 0:b.interfaces)==null?void 0:q.find(O=>O.subnet_id===i&&O.purpose==="vpc");return!d||!b?null:{configId:b.id,interfaceId:d.id,linodeId:V.id}}return null}))).filter(V=>V!==null);_([...N])}catch(I){p.current=!0,g(I)}},[u,_,g,i]);r.useEffect(()=>{s&&W([s])},[s,W]);const J=async v=>{v.preventDefault(),await G(),f.current.link.click()},M=v=>{C(I=>I.filter(N=>N.id!==v.id)),_(I=>I.filter(N=>N.linodeId!==v.id))},Z=async()=>{try{const v=$.map(async I=>{try{await L({configId:I.configId,interfaceId:I.interfaceId,linodeId:I.linodeId,subnetId:i??-1,vpcId:a})}catch(N){p.current=!0,g(V=>[...V,...N])}});await Promise.all(v)}catch(v){g([v])}},ee=async()=>{await Z(),p.current||K()},{handleSubmit:ne,resetForm:se}=xe({enableReinitialize:!0,initialValues:{},onSubmit:ee,validateOnBlur:!1,validateOnChange:!1}),K=()=>{se(),C([]),_([]),g([]),n()};return e.jsxs(he,{title:`Unassign Linodes from subnet: ${t==null?void 0:t.label} (${(t==null?void 0:t.ipv4)??(t==null?void 0:t.ipv6)})`,onClose:K,open:o,children:[R&&e.jsx(U,{important:!0,text:`You don't have permissions to unassign Linodes from ${t==null?void 0:t.label}. Please contact an account administrator for details.`,variant:"error"}),S.length>0&&e.jsx(U,{text:S[0].reason,variant:"error"}),e.jsx(U,{spacingBottom:s?0:16,text:Et,variant:"warning"}),!s&&e.jsx(X,{children:"Select the Linodes you would like to unassign from this subnet. Only Linodes in this VPC’s region are displayed."}),e.jsx("form",{onSubmit:ne,children:e.jsxs(ut,{children:[!s&&e.jsx(je,{onChange:(v,I)=>{C(I),W(I)},disabled:R,errorText:k?k[0].reason:void 0,label:"Linodes",multiple:!0,options:P,placeholder:"Select Linodes or type to search",renderTags:()=>null,value:y}),e.jsx(B,{sx:v=>({marginTop:v.spacing(2)}),children:e.jsx(qe,{headerText:`Linodes to be Unassigned from Subnet (${y.length})`,isRemovable:!s,noDataText:"Select Linodes to be Unassigned from Subnet.",onRemove:M,selectionData:y})}),y.length>0&&e.jsx(Qe,{sx:{alignItems:"flex-start",display:"flex",gap:1,marginTop:2,textAlign:"left"},buttonType:"styledLink",csvRef:f,data:y,filename:`linodes-unassigned-${D}.csv`,headers:Ke,onClick:J,text:"Download List of Unassigned Linodes (.csv)"}),e.jsx(De,{primaryButtonProps:{"data-testid":"unassign-submit-button",disabled:$.length===0,label:"Unassign Linodes",type:"submit"},secondaryButtonProps:{label:"Cancel",onClick:K}})]})})]})}),Ne="vpc-subnets",On=n=>{var b;const{vpcId:o,vpcRegion:s}=n,t=We(),[a,c]=r.useState(""),[l,i]=r.useState(),[m,u]=r.useState(),[g,L]=r.useState(!1),[S,f]=r.useState(!1),[D,y]=r.useState(!1),[C,p]=r.useState(!1),[P,E]=r.useState(!1),[$,_]=r.useState(),[A,R]=r.useState(!1),j=qt(1,Ne),{handleOrderChange:k,order:G,orderBy:F}=Kt({order:"asc",orderBy:"label"},`${Ne}-order`),W={"+order":G,"+order_by":F},J=d=>d===""?W:{"+or":[{label:{"+contains":d}},{id:{"+contains":d}}],...W},{data:M,error:Z,isLoading:ee}=Ft(o,{page:j.page,page_size:j.pageSize},J(a)),ne=d=>{c(d),j.handlePageChange(1)},se=d=>{i(d),L(!0)},K=d=>{i(d),f(!0)},v=d=>{i(d),R(!0)},I=(d,O)=>{i(O),u(d),R(!0)},N=d=>{i(d),p(!0)},V=(d,O)=>{u(d),E(!0),_(O)};if(r.useEffect(()=>{if(M&&l){const d=M.data.find(O=>O.id===l.id);i(d)}},[M,l]),ee)return e.jsx(Ie,{});if(!M||Z)return e.jsx(He,{errorText:"There was a problem retrieving your subnets. Please try again."});const H=e.jsxs(de,{children:[e.jsx(Ue,{sx:d=>({[d.breakpoints.down("sm")]:{width:"50%"},width:"24%"}),active:F==="label",direction:G,handleClick:k,label:"label",children:"Subnet Label"}),e.jsx(Q,{smDown:!0,children:e.jsx(Ue,{active:F==="id",direction:G,handleClick:k,label:"id",sx:{width:"10%"},children:"Subnet ID"})}),e.jsx(ye,{sx:{width:"18%"},children:"Subnet IP Range"}),e.jsx(Q,{smDown:!0,children:e.jsx(ye,{sx:{width:"10%"},children:"Linodes"})}),e.jsx(ye,{})]}),q=()=>M.data.map(d=>{const O=e.jsxs(e.Fragment,{children:[e.jsx(Q,{smDown:!0,children:e.jsx(z,{children:d.id})}),e.jsx(z,{children:d.ipv4}),e.jsx(Q,{smDown:!0,children:e.jsx(z,{children:d.linodes.length})}),e.jsx(z,{align:"right",children:e.jsx(un,{handleAssignLinodes:N,handleDelete:se,handleEdit:K,handleUnassignLinodes:v,numLinodes:d.linodes.length,subnet:d,vpcId:o})})]});return{InnerTable:e.jsxs(Wt,{"aria-label":"Linode",size:"small",children:[e.jsx(on,{style:{fontSize:".875rem"},children:Rn}),e.jsx(Ht,{children:d.linodes.length>0?d.linodes.map(oe=>e.jsx(Dn,{handlePowerActionsLinode:V,handleUnassignLinode:I,linodeId:oe.id,subnet:d,subnetId:d.id},oe.id)):e.jsx(ke,{colSpan:6,message:"No Linodes"})})]}),OuterTableCells:O,id:d.id,label:d.label}});return e.jsxs(e.Fragment,{children:[e.jsxs(B,{display:"flex",flexWrap:"wrap",justifyContent:"space-between",children:[e.jsx(Mt,{sx:{marginBottom:t.spacing(2),[t.breakpoints.up("sm")]:{width:"416px"},width:"250px"},debounceTime:250,hideLabel:!0,isSearching:!1,label:"Filter Subnets by label or id",onSearch:ne,placeholder:"Filter Subnets by label or id"}),e.jsx(ue,{sx:{marginBottom:t.spacing(2)},buttonType:"primary",onClick:()=>y(!0),children:"Create Subnet"})]}),D&&e.jsx(yn,{onClose:()=>y(!1),open:D,vpcId:o}),e.jsx(Ut,{TableRowEmpty:e.jsx(ke,{colSpan:5,message:"No Subnets are assigned."}),TableItems:q(),TableRowHead:H}),e.jsx(zt,{count:((b=M.data)==null?void 0:b.length)||0,handlePageChange:j.handlePageChange,handleSizeChange:j.handlePageSizeChange,page:j.page,pageSize:j.pageSize}),A&&e.jsx(kn,{onClose:()=>{R(!1),u(void 0)},open:A,singleLinodeToBeUnassigned:m,subnet:l,vpcId:o}),C&&e.jsx(Sn,{onClose:()=>p(!1),open:C,subnet:l,vpcId:o,vpcRegion:s}),g&&e.jsx(Cn,{onClose:()=>L(!1),open:g,subnet:l,vpcId:o}),S&&e.jsx(jn,{onClose:()=>f(!1),open:S,subnet:l,vpcId:o}),P&&e.jsx(yt,{action:$??"Reboot",isOpen:P,linodeId:m==null?void 0:m.id,manuallyUpdateConfigs:!0,onClose:()=>E(!1)})]})},ye=T(z,{label:"StyledTableCell"})(({theme:n})=>({borderBottom:`1px solid ${n.borderColors.borderTable} !important`,whiteSpace:"nowrap"})),Ue=T(Qt,{label:"StyledTableSortCell"})(({theme:n})=>({borderBottom:`1px solid ${n.borderColors.borderTable} !important`,whiteSpace:"nowrap"})),Io=()=>{var C;const{vpcId:n}=mt(),o=We(),{data:s,error:t,isLoading:a}=Vt(+n),{data:c}=gt(),[l,i]=r.useState(!1),[m,u]=r.useState(!1),[g,L]=r.useState(!1);if(a)return e.jsx(Ie,{});if(!s||t)return e.jsx(He,{errorText:"There was a problem retrieving your VPC. Please try again."});const S=s.description.length<150||g?s.description:ft(s.description,150),f=((C=c==null?void 0:c.find(p=>p.id===s.region))==null?void 0:C.label)??s.region,D=an(s.subnets),y=[[{label:"Subnets",value:s.subnets.length},{label:"Linodes",value:D}],[{label:"Region",value:f},{label:"VPC ID",value:s.id}],[{label:"Created",value:s.created},{label:"Updated",value:s.updated}]];return e.jsxs(e.Fragment,{children:[e.jsx(bt,{segment:s.label}),e.jsx(Lt,{breadcrumbProps:{crumbOverrides:[{label:At,position:1}],labelOptions:{noCap:!0},pathname:`/vpcs/${s.label}`},betaFeedbackLink:Rt,docsLabel:"Docs",docsLink:"#"}),e.jsxs(Ct,{children:[e.jsx(B,{children:e.jsx(X,{sx:p=>({color:p.textColors.headlineStatic,fontFamily:p.font.bold,fontSize:"1rem",padding:"6px 16px"}),children:"Summary"})}),e.jsxs(B,{display:"flex",justifyContent:"end",children:[e.jsx(_e,{onClick:()=>i(!0),children:"Edit"}),e.jsx(_e,{onClick:()=>u(!0),children:"Delete"})]})]}),e.jsxs(pn,{children:[e.jsx(cn,{"data-qa-vpc-summary":!0,display:"flex",flex:1,children:y.map(p=>e.jsxs(B,{paddingRight:6,children:[e.jsxs(Fe,{children:[e.jsx("span",{style:{fontFamily:o.font.bold},children:p[0].label})," ",p[0].value]}),e.jsxs(Fe,{children:[e.jsx("span",{style:{fontFamily:o.font.bold},children:p[1].label})," ",p[1].value]})]},p[0].label))}),s.description.length>0&&e.jsxs(dn,{display:"flex",flex:1,children:[e.jsxs(X,{children:[e.jsx("span",{style:{fontFamily:o.font.bold,paddingRight:8},children:"Description"})," "]}),e.jsxs(X,{sx:{overflowWrap:"anywhere",wordBreak:"normal"},children:[S," ",S.length>150&&e.jsxs(xt,{onClick:()=>L(p=>!p),sx:{fontSize:"0.875rem"},children:["Read ",g?"Less":"More"]})]})]})]}),e.jsx($t,{id:s.id,label:s.label,onClose:()=>u(!1),open:m}),e.jsx(Nt,{onClose:()=>i(!1),open:l,vpc:s}),e.jsx(B,{sx:p=>({[p.breakpoints.up("lg")]:{paddingLeft:0}}),padding:`${o.spacing(2)} ${o.spacing()}`,children:e.jsxs(X,{sx:{fontSize:"1rem"},variant:"h2",children:["Subnets (",s.subnets.length,")"]})}),D>0&&e.jsx(ht,{preferenceKey:"reboot-linodes-warning-banner",sx:{marginBottom:o.spacing(2)},variant:"warning",children:e.jsx(X,{variant:"body1",children:kt})}),e.jsx(On,{vpcId:s.id,vpcRegion:s.region})]})};export{Io as default};
