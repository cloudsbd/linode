import{j as t,r as i,bB as f,m as Ke,bm as We,ai as K,bF as Ge,bG as Ve,b5 as Je,b7 as Ye,b6 as ze,N as Ue,b8 as Xe,aj as Ze,ak as et,bH as tt,ad as at,T as nt,bI as W,bJ as st,al as rt,ag as it,a1 as ot,bK as lt,an as dt,bL as q,am as ut,bM as ct}from"./index-Eksrs3uK.js";import{s as mt}from"./scrollErrorIntoView-6n4Cku1Y.js";import{T as pt,M as gt,A as bt}from"./TabbedReply-8laJdW9a.js";async function ft(n,l,d){let u=d;for(let p=0;p<n.length;p++)u=await l(u,n[p],p,n);return u}const ht="Contact Support: SMTP Restriction Removal",yt="In an effort to fight spam, outbound connections are restricted on ports 25, 465, and 587. To have these restrictions removed, please provide us with the following information. A member of the Support team will review your request and follow up with you as soon as possible.",h={companyName:"Business or company name",customerName:"First and last name",emailDomains:"Domain(s) that will be sending emails",publicInfo:"Links to public information - e.g. your business or application's website, Twitter profile, GitHub, etc.",useCase:"A clear and detailed description of your email use case, including how you'll avoid sending unwanted emails"},Tt=n=>{const{formState:l,handleChange:d}=n;return t.jsxs(i.Fragment,{children:[t.jsx(f,{"data-qa-ticket-customer-name":!0,label:h.customerName,name:"customerName",onChange:d,required:!0,value:l.customerName}),t.jsx(f,{"data-qa-ticket-company-name":!0,label:h.companyName,name:"companyName",onChange:d,value:l.companyName}),t.jsx(f,{"data-qa-ticket-use-case":!0,expand:!0,label:h.useCase,multiline:!0,name:"useCase",onChange:d,required:!0,value:l.useCase}),t.jsx(f,{"data-qa-ticket-email-domains":!0,expand:!0,label:h.emailDomains,multiline:!0,name:"emailDomains",onChange:d,required:!0,value:l.emailDomains}),t.jsx(f,{"data-qa-ticket-public-info":!0,expand:!0,label:h.publicInfo,multiline:!0,name:"publicInfo",onChange:d,required:!0,value:l.publicInfo})]})},xt=Ke()(n=>({expPanelSummary:{backgroundColor:n.name==="dark"?n.bg.main:n.bg.white,borderTop:`1px solid ${n.bg.main}`,paddingTop:n.spacing(1)},innerReply:{'& div[role="tablist"]':{marginBottom:n.spacing(),marginTop:n.spacing()},padding:0},rootReply:{marginBottom:n.spacing(2),padding:0}})),G={general:{dialogTitle:"Open a Support Ticket",helperText:t.jsxs(t.Fragment,{children:[`We love our customers, and we’re here to help if you need us.
        Please keep in mind that not all topics are within the scope of our support.
        For overall system status, please see `,t.jsx(ot,{to:"https://status.linode.com",children:"status.linode.com"}),"."]})},smtp:{dialogTitle:ht,helperText:yt}},V={Databases:"database_id",Domains:"domain_id",Firewalls:"firewall_id",Kubernetes:"lkecluster_id",Linodes:"linode_id",NodeBalancers:"nodebalancer_id",Volumes:"volume_id"},_={database_id:"Database Cluster",domain_id:"Domain",firewall_id:"Firewall",general:"",linode_id:"Linode",lkecluster_id:"Kubernetes Cluster",nodebalancer_id:"NodeBalancer",none:"",volume_id:"Volume"},j=(n,l)=>n??l??"",kt=n=>{const{open:l,prefilledDescription:d,prefilledEntity:u,prefilledTicketType:p,prefilledTitle:A}=n,{data:m}=We(),S=K.supportText.get(),[y,I]=i.useState(j(A,S.title)),[T,M]=i.useState(j(d,S.description)),[s,P]=i.useState((u==null?void 0:u.type)??"general"),[D,F]=i.useState(u?String(u.id):""),[g,J]=i.useState(p??"general"),[b,Y]=i.useState({companyName:"",customerName:m?`${m==null?void 0:m.first_name} ${m==null?void 0:m.last_name}`:"",emailDomains:"",publicInfo:"",useCase:""}),[R,x]=i.useState([]),[z,k]=i.useState(),[U,L]=i.useState(!1),{classes:N}=xt();i.useEffect(()=>{l||w()},[l]);const{data:X,error:Z,isLoading:ee}=Ge(s==="database_id"),{data:te,error:ae,isLoading:ne}=Ve(s==="firewall_id"),{data:se,error:re,isLoading:ie}=Je(s==="domain_id"),{data:oe,error:le,isLoading:de}=Ye(s==="nodebalancer_id"),{data:ue,error:ce,isLoading:me}=ze(s==="lkecluster_id"),{data:pe,error:ge,isLoading:be}=Ue({},{},s==="linode_id"),{data:fe,error:he,isLoading:ye}=Xe({},{},s==="volume_id"),B=(e,r)=>{K.supportText.set({description:r,title:e})},Te=i.useRef(Ze(500,!1,B)).current;i.useEffect(()=>{Te(y,T)},[y,T]);const xe=(e=!1)=>{const r=e?"":j(A,S.title),a=e?"":j(d,S.description);I(r),M(a),F(""),P("general"),J("general")},w=(e=!1)=>{xe(e),x([]),e&&B("","")},ve=e=>{I(e.target.value)},_e=e=>{M(e)},Se=e=>{s!==e.value&&(P(e.value),F(""))},ke=e=>{F(String(e==null?void 0:e.value)??"")},we=e=>{const{name:r,value:a}=e.target;Y(o=>({...o,[r]:a}))},Ce=e=>Object.entries(e).map(([r,a])=>`**${h[r]}**
${a||"No response"}`).join(`

`),O=()=>{n.onClose(),g==="smtp"&&window.setTimeout(()=>w(!0),500)},Ee=()=>{n.onClose(),window.setTimeout(()=>w(!0),500)},je=e=>{x(e)},De=(e,r,a)=>ut(r.ticketId,r.file).then(()=>(x(o=>q(a,{file:null,name:"",uploaded:!0,uploading:!1},o)),e)).catch(o=>{x(v=>q(a,{...v[a],uploading:!1},v));const c=ct(o,"There was an error attaching this file. Please try again.");return{...e,errors:[...e.errors,{error:c,file:r.file.get("name")}]}}),Fe=e=>{const r=R.filter(a=>!a.uploaded).map((a,o)=>{x(v=>q(o,{...v[o],uploading:!0},v));const c=new FormData;return c.append("file",a.file??""),c.append("name",a.name),{file:c,ticketId:e}});return ft(r,De,{errors:[],success:[]})},Le=()=>{const{onSuccess:e}=n,r=g==="smtp"?Ce(b):T;if(!["general","none"].includes(s)&&!D){k([{field:"input",reason:`Please select a ${_[s]}.`}]);return}k(void 0),L(!0),lt({description:r,[s]:Number(D),summary:y}).then(a=>(k(void 0),L(!1),window.setTimeout(()=>w(!0),500),a)).then(a=>{Fe(a.id).then(({errors:o})=>{n.keepOpenOnSuccess||O(),e(a.id,o)})}).catch(a=>{k(dt(a)),L(!1),mt()})},Ne=()=>Object.keys(V).map(e=>({label:e,value:V[e]})),qe=b.customerName.length>0&&b.useCase.length>0&&b.emailDomains.length>0&&b.publicInfo.length>0,Ae=y.length>0&&(g==="smtp"?qe:T.length>0),C=et(["summary","description","input"],z),Ie=C.summary,Me=C.description,Q=C.none,Pe=C.input,$=[{label:"General/Account/Billing",value:"general"},...Ne()],Re=$.find(e=>e.value===s),Be=()=>{var r,a;const e={database_id:X,domain_id:se,firewall_id:te,linode_id:pe,lkecluster_id:ue,nodebalancer_id:oe,volume_id:fe};return e[s]?s==="domain_id"?((r=e[s])==null?void 0:r.map(({domain:o,id:c})=>({label:o,value:c})))||[]:((a=e[s])==null?void 0:a.map(({id:o,label:c})=>({label:c,value:o})))||[]:[]},Oe={database_id:ee,domain_id:ie,firewall_id:ne,general:!1,linode_id:be,lkecluster_id:me,nodebalancer_id:de,none:!1,volume_id:ye},Qe={database_id:Z,domain_id:re,firewall_id:ae,general:null,linode_id:ge,lkecluster_id:ce,nodebalancer_id:le,none:null,volume_id:he},E=Be(),H=Oe[s],$e=Qe[s]?`Error loading ${_[s]}s`:void 0,He=E.find(e=>String(e.value)===D)||null;return t.jsx(tt,{fullHeight:!0,fullWidth:!0,onClose:O,open:l,title:G[g].dialogTitle,children:n.children||t.jsxs(i.Fragment,{children:[Q&&t.jsx(at,{"data-qa-notice":!0,text:Q,variant:"error"}),t.jsx(nt,{"data-qa-support-ticket-helper-text":!0,children:G[g].helperText}),t.jsx(f,{"data-qa-ticket-summary":!0,errorText:Ie,inputProps:{maxLength:64},label:"Title",onChange:ve,placeholder:"Enter a title for your ticket.",required:!0,value:y}),g==="smtp"?t.jsx(Tt,{formState:b,handleChange:we}):t.jsxs(i.Fragment,{children:[n.hideProductSelection?null:t.jsxs(i.Fragment,{children:[t.jsx(W,{"data-qa-ticket-entity-type":!0,isClearable:!1,label:"What is this regarding?",onChange:Se,options:$,value:Re}),!["general","none"].includes(s)&&t.jsxs(t.Fragment,{children:[t.jsx(W,{"data-qa-ticket-entity-id":!0,disabled:E.length===0,errorText:$e||Pe,isClearable:!1,isLoading:H,label:_[s]??"Entity Select",onChange:ke,options:E,placeholder:`Select a ${_[s]}`,value:He}),!H&&E.length===0?t.jsxs(st,{children:["You don’t have any"," ",_[s],"s on your account."]}):null]})]}),t.jsx(pt,{placeholder:"Tell us more about the trouble you're having and any steps you've already taken to resolve it.",error:Me,handleChange:_e,innerClass:N.innerReply,required:!0,rootClass:N.rootReply,value:T}),t.jsx(rt,{detailProps:{className:N.expPanelSummary},heading:"Formatting Tips",children:t.jsx(gt,{})}),t.jsx(bt,{files:R,updateFiles:je})]}),t.jsx(it,{primaryButtonProps:{"data-testid":"submit",disabled:!Ae,label:"Open Ticket",loading:U,onClick:Le},secondaryButtonProps:{"data-testid":"cancel",label:"Cancel",onClick:Ee},sx:{display:"flex",justifyContent:"flex-end"}})]})})};export{kt as S};
