import{hC as F,f as ge,aW as $,j as e,T as A,m as X,r as p,$ as M,B as R,cn as xe,a4 as he,bC as be,s as H,aY as Z,ao as ye,dw as fe,bb as Se,bd as je,C as ee,dB as ve,ad as te,hD as Ce,a0 as oe,E as se,cS as ae,G as E,dx as Te,ba as Pe,u as ke,bm as Ae,hE as Ee,dM as Re,hF as De,hs as Le,hG as we,ak as He,Q as Be,aa as Ne,bB as _e,hH as w,bE as Ie,bI as Ke,an as Y,dD as Me,bL as Fe}from"./index-Eksrs3uK.js";import{r as $e}from"./remove-KHZAQMPH.js";import{p as Ge}from"./pick-ELd0PGNj.js";import{L as We}from"./LandingHeader-JXAVBhqg.js";import{a as qe,R as ze}from"./RegionSelect-_Z8IGlox.js";import{R as J}from"./RegionHelperText-N0L662HQ.js";import{f as Ue}from"./filterCurrentLinodeTypes-6QsXu4XU.js";import{p as Ve}from"./PlanInformation-CouBULD4.js";import{L as Oe,D as Qe,d as Ye}from"./constants-KokzTiEs.js";import{g as Je}from"./dynamicPricing-n5eCZqTg.js";import{s as Xe}from"./scrollErrorIntoView-6n4Cku1Y.js";import{D as ne,d as Ze}from"./DisplayPrice-SNYRHKEX.js";import{R as et}from"./RenderGuard-iLW_eACV.js";import{E as tt,g as ot,a as st,K as at,H as nt}from"./KubernetesPlansPanel-yuUO1O8e.js";import"./Autocomplete-XvrzKoAo.js";import"./Flag-kVTQNGw3.js";import"./ListItem-joIHQeyv.js";import"./visuallyHidden-DVicuktI.js";import"./TextTooltip-SPU6hUyt.js";import"./TableRow-phXfWUGW.js";import"./Currency-No8tnN7b.js";import"./linodes-orSDvVk7.js";import"./FormControl-CNHz4Ctl.js";import"./Radio-HudVgwMW.js";import"./RadioGroup-zpRjMzXK.js";import"./TabbedPanel-IicwaI6L.js";import"./TabList-4PWL4GSj.js";import"./TableRowEmpty-aXmC67-Z.js";import"./SelectionCard-IyO-o1CU.js";import"./TableHead-Si_pzkLK.js";const rt=F(ge)(({theme:t})=>({marginTop:18,[t.breakpoints.up("lg")]:{width:"100%"}})),it=F("div")(()=>{const t=$();return{minHeight:"24px",minWidth:"24px",[t.breakpoints.down("md")]:{background:t.color.white,bottom:"0 !important",left:"0 !important",padding:t.spacing(2),position:"relative !important"}}}),lt=F("div")(({theme:t})=>({padding:"12px 0",[t.breakpoints.down("md")]:{"& button":{marginLeft:0}}})),ct=()=>({color:$().color.headline,fontSize:".8rem",lineHeight:"1.5em"}),dt=t=>{const{agreement:s,calculatedPrice:d,children:r,disabled:n,footer:i,heading:l,isMakingRequest:x,onDeploy:b,priceHelperText:h,priceSelectionText:y,submitText:f}=t,u=$(),m=d??0;return e.jsxs(it,{children:[e.jsx(A,{sx:{color:u.color.headline,fontSize:"1.125rem",wordBreak:"break-word"},"data-qa-order-summary":!0,variant:"h2",children:l}),r,e.jsxs(lt,{"data-qa-total-price":!0,children:[m?e.jsx(ne,{interval:"mo",price:m}):e.jsx(A,{children:y}),h&&m>0&&e.jsx(A,{sx:{...ct,marginTop:u.spacing()},children:h})]}),s||null,e.jsx(rt,{buttonType:"primary","data-qa-deploy-linode":!0,disabled:n,loading:x,onClick:b,children:f??"Create"}),i||null]})},pt=X()(t=>({button:{"&:hover":{color:"#6e6e6e"},alignItems:"flex-start",color:"#979797",marginTop:-4,padding:0},numberInput:{marginBottom:t.spacing(1.5),marginTop:t.spacing(2)},price:{"& h3":{color:`${t.palette.text.primary} !important`,fontFamily:t.font.normal}},root:{"& $textField":{width:53}},typeHeader:{fontFamily:t.font.bold,fontSize:"16px",paddingBottom:t.spacing(.5)},typeSubheader:{fontSize:"14px"}})),ut=t=>{const{classes:s}=pt(),{nodeCount:d,onRemove:r,poolType:n,price:i,updateNodeCount:l}=t;return n===null?null:e.jsxs(e.Fragment,{children:[e.jsx(M,{dark:!0,spacingBottom:12,spacingTop:24}),e.jsxs(R,{className:s.root,"data-testid":"node-pool-summary",display:"flex",flexDirection:"column",children:[e.jsxs(R,{display:"flex",justifyContent:"space-between",children:[e.jsxs("div",{children:[e.jsxs(A,{className:s.typeHeader,children:[n.formattedLabel," Plan"]}),e.jsxs(A,{className:s.typeSubheader,children:[xe("CPU","CPUs",n.vcpus),", ",n.disk/1024," ","GB Storage"]})]}),e.jsx(he,{className:s.button,"data-testid":"remove-pool-button",onClick:r,size:"large",title:`Remove ${n.label} Node Pool`,children:e.jsx(be,{})})]}),e.jsx("div",{className:s.numberInput,children:e.jsx(tt,{min:1,setValue:l,value:d})}),e.jsx("div",{className:s.price,children:i?e.jsx(ne,{fontSize:"14px",interval:"month",price:i}):void 0})]})]})},mt=p.memo(ut),gt=t=>{const{createCluster:s,hasAgreed:d,highAvailability:r,highAvailabilityPrice:n,pools:i,region:l,regionsData:x,removePool:b,showHighAvailability:h,submitting:y,toggleHasAgreed:f,updatePool:u}=t,m=i.some(c=>c.count<3),{data:T}=ye(),{data:v}=fe(),a=Se(i.map(c=>c.type)),g=je(a),B=a.some(c=>c.isLoading),{showGDPRCheckbox:D}=qe({agreements:v,profile:T,regions:x,selectedRegionId:l}),L=!!(i.length<1||!d&&D||r===void 0&&h&&n!==void 0||l==="");return B?e.jsx(ee,{}):e.jsx(dt,{agreement:D?e.jsx(ve,{checked:d,onChange:f}):void 0,calculatedPrice:l!==""?ot({highAvailabilityPrice:r?n:void 0,pools:i,region:l,types:g??[]}):void 0,"data-qa-checkout-bar":!0,disabled:L,heading:"Cluster Summary",isMakingRequest:y,onDeploy:s,priceSelectionText:Oe,submitText:"Create Cluster",children:e.jsxs(e.Fragment,{children:[i.map((c,j)=>e.jsx(mt,{poolType:(g==null?void 0:g.find(k=>k.id===c.type))||null,price:l!==""?st({count:c.count,region:l,type:c.type,types:g??[]}):void 0,updateNodeCount:k=>u(j,{...c,count:k}),nodeCount:c.count,onRemove:()=>b(j)},j)),e.jsx(M,{dark:!0,spacingBottom:0,spacingTop:16}),m&&e.jsx(te,{important:!0,spacingTop:16,text:Ce,variant:"warning"}),l!=""&&r?e.jsxs(bt,{children:[e.jsx(ht,{children:"High Availability (HA) Control Plane"}),e.jsxs(Z,{children:[Ze(Number(n)),"/month"]}),e.jsx(M,{dark:!0,spacingBottom:0,spacingTop:16})]}):void 0]})})},xt=et(gt),ht=H(Z,{label:"StyledHAHeader"})(({theme:t})=>({fontFamily:t.font.bold,fontSize:"16px",paddingBottom:t.spacing(.5),paddingTop:t.spacing(.5)})),bt=H(R,{label:"StyledHABox"})(({theme:t})=>({marginTop:t.spacing(2)})),yt=X()(t=>({root:{"& .mlMain":{flexBasis:"100%",maxWidth:"100%",[t.breakpoints.up("lg")]:{flexBasis:"78.8%",maxWidth:"78.8%"}},"& .mlSidebar":{flexBasis:"100%",maxWidth:"100%",position:"static",[t.breakpoints.up("lg")]:{flexBasis:"21.2%",maxWidth:"21.2%",position:"sticky"},width:"100%"}},sidebar:{background:"none",marginTop:"0px !important",paddingTop:"0px !important",[t.breakpoints.down("lg")]:{background:t.color.white,marginTop:`${t.spacing(3)} !important`,padding:`${t.spacing(3)} !important`},[t.breakpoints.down("md")]:{padding:`${t.spacing()} !important`}}})),ft=H(oe,{label:"StyledRegionSelectStack"})(({theme:t})=>({flexDirection:"row",[t.breakpoints.down("md")]:{flexDirection:"column"}})),St=H(R,{label:"StyledRegionSelectStack"})(({theme:t})=>({alignSelf:"flex-start",marginLeft:"auto",marginTop:t.spacing(2),[t.breakpoints.down("md")]:{marginLeft:"unset",marginTop:t.spacing(2)}})),jt=3,vt=t=>e.jsx(Ct,{...t}),Ct=t=>{const{typesError:s,typesLoading:d}=t;return s?e.jsx(se,{errorText:s}):d?e.jsx(ee,{}):e.jsx(Tt,{...t})},Tt=t=>{const{addNodePool:s,apiError:d,hasSelectedRegion:r,isPlanPanelDisabled:n,isSelectedRegionEligibleForPlan:i,regionsData:l,selectedRegionId:x,types:b}=t,[h,y]=p.useState(new Map),[f,u]=p.useState(),m=b.map(ae),T=(a,g)=>{s({count:g,id:Math.random(),type:a}),v(a,0),u(void 0)},v=(a,g)=>{y(new Map(h).set(a,g)),u(a)};return e.jsx(E,{container:!0,direction:"column",children:e.jsx(E,{children:e.jsx(at,{getTypeCount:a=>h.get(a)??jt,types:m.filter(a=>a.class!=="nanode"&&a.class!=="gpu"),copy:"Add groups of Linodes to your cluster. You can have a maximum of 100 Linodes per node pool.",error:d,hasSelectedRegion:r,header:"Add Node Pools",isPlanPanelDisabled:n,isSelectedRegionEligibleForPlan:i,onAdd:T,onSelect:a=>u(a),regionsData:l,resetValues:()=>null,selectedId:f,selectedRegionID:x,updatePlanCount:v})})})},oo=()=>{const{classes:t}=yt(),[s,d]=p.useState(""),[r,n]=p.useState([]),[i,l]=p.useState(),[x,b]=p.useState(),[h,y]=p.useState(),[f,u]=p.useState(!1),[m,T]=p.useState(!1),{mutateAsync:v}=Te(),[a,g]=p.useState(),{data:B,error:D}=Pe(),P=B??[],G=ke(),{data:W}=Ae(),{showHighAvailability:L}=Ee(W),{data:c,error:j,isLoading:k}=Re(),q=Ue(c==null?void 0:c.map(ae)),{mutateAsync:re}=De(),{data:z,isError:ie}=Le(),N=(z??[]).map(o=>({label:o.id,value:o.id}));p.useEffect(()=>{N.length>0&&b(we(N))},[z]);const U=()=>{const{push:o}=G;y(void 0),u(!0);const S=x?x.value:void 0,I=r.map(Ge(["type","count"]));re({control_plane:{high_availability:a??!1},k8s_version:S,label:i,node_pools:I,region:s}).then(K=>{o(`/kubernetes/clusters/${K.id}`),m&&v({eu_model:!0,privacy_policy:!0}).catch(Me)}).catch(K=>{y(Y(K,"Error creating your cluster")),u(!1),Xe()})},le=()=>T(o=>!o),ce=o=>{n([...r,o])},V=(o,S)=>{const I={...S};n(Fe(o,I,r))},O=o=>{const S=$e(o,1,r);n(S)},de=o=>{l(o||void 0)},Q=o=>{const S=o?Je({basePrice:Ye,regionId:o}):void 0;return S?parseFloat(S):void 0},C=He(["region","node_pools","label","k8s_version","versionLoad"],h),_=s||null,{hasSelectedRegion:pe,isPlanPanelDisabled:ue,isSelectedRegionEligibleForPlan:me}=Ve({regionsData:P,selectedRegionID:s});return j||D||ie?e.jsx(se,{errorText:"An unexpected error occurred."}):e.jsxs(E,{className:t.root,container:!0,children:[e.jsx(Be,{segment:"Create a Kubernetes Cluster"}),e.jsx(We,{docsLabel:"Docs",docsLink:"https://www.linode.com/docs/kubernetes/deploy-and-manage-a-cluster-with-linode-kubernetes-engine-a-tutorial/",title:"Create Cluster"}),e.jsxs(E,{className:"mlMain py0",children:[C.none&&e.jsx(te,{text:C.none,variant:"error"}),e.jsxs(Ne,{"data-qa-label-header":!0,children:[e.jsx(_e,{onChange:o=>de(o.target.value),"data-qa-label-input":!0,errorText:C.label,label:"Cluster Label",value:i||""}),e.jsx(w,{sx:{marginTop:4}}),e.jsxs(ft,{children:[e.jsxs(oe,{children:[e.jsx(ze,{handleSelection:o=>d(o),textFieldProps:{helperText:e.jsx(J,{mb:2}),helperTextPosition:"top"},currentCapability:"Kubernetes",errorText:C.region,regions:P,selectedId:_}),e.jsx(J,{sx:{marginTop:1}})]}),e.jsx(St,{children:e.jsx(Ie,{href:"https://www.linode.com/pricing",label:Qe})})]}),e.jsx(w,{sx:{marginTop:4}}),e.jsx(Ke,{onChange:o=>{b(o)},errorText:C.k8s_version,isClearable:!1,label:"Kubernetes Version",options:N,placeholder:" ",value:x||null}),e.jsx(w,{sx:{marginTop:4}}),L?e.jsx(R,{"data-testid":"ha-control-plane",children:e.jsx(nt,{highAvailabilityPrice:Q(_),setHighAvailability:g})}):null,e.jsx(w,{sx:{marginBottom:4}}),e.jsx(vt,{typesError:j?Y(j,"Error loading Linode type information.")[0].reason:void 0,addNodePool:o=>ce(o),apiError:C.node_pools,hasSelectedRegion:pe,isPlanPanelDisabled:ue,isSelectedRegionEligibleForPlan:me,regionsData:P,selectedRegionId:s,types:q||[],typesLoading:k})]})]}),e.jsx(E,{className:`mlSidebar ${t.sidebar}`,"data-testid":"kube-checkout-bar",children:e.jsx(xt,{updateFor:[m,a,s,r,f,q,V,O,U,t],createCluster:U,hasAgreed:m,highAvailability:a,highAvailabilityPrice:Q(_),pools:r,region:s,regionsData:P,removePool:O,showHighAvailability:L,submitting:f,toggleHasAgreed:le,updatePool:V})})]})};export{oo as CreateCluster};
