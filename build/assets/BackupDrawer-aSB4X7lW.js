import{s as b,aa as z,d0 as M,T as p,j as e,ad as v,a1 as E,dr as W,ba as K,av as H,aw as V,cn as w,dV as x,dZ as X,B as P,cx as Y,N as Z,dM as G,dg as J,e4 as ee,r as ae,a0 as ne,c2 as oe,ag as se}from"./index-Eksrs3uK.js";import{D as te}from"./DisplayPrice-SNYRHKEX.js";import{D as ie}from"./Drawer-A9yKjC3Z.js";import{T as A,a as c,b as re,c as le}from"./TableRow-phXfWUGW.js";import{T as ce}from"./TableRowError-8gKmGX7P.js";import{T as de}from"./TableRowLoading-iP7zIRHG.js";import{a as ue,b as pe}from"./backups-brLSog0e.js";import{a as be,U as $}from"./constants-KokzTiEs.js";import{T as ge}from"./Toggle-AbahDP9J.js";import{T as me}from"./TableHead-Si_pzkLK.js";const ye=a=>{const{enabled:o,error:n,toggle:s}=a;return e.jsxs(xe,{children:[n&&e.jsx(v,{text:n,variant:"error"}),e.jsx(he,{label:e.jsxs(fe,{children:[e.jsx(je,{children:"Auto Enroll All New Linodes in Backups"}),e.jsxs(p,{variant:"body1",children:["Enroll all future Linodes in backups. Your account will be billed the additional hourly rate noted on the"," ",e.jsx(E,{"data-qa-backups-price":!0,to:"https://www.linode.com/products/backups/",children:"Backups pricing page"}),"."]})]}),control:e.jsx(ge,{checked:o,onChange:s})})]})},xe=b(z,{label:"StyledPaper"})(({theme:a})=>({backgroundColor:a.bg.offWhite,padding:a.spacing(1)})),he=b(M,{label:"StyledFormControlLabel"})(({theme:a})=>({alignItems:"flex-start",display:"flex",marginBottom:a.spacing(1),marginLeft:0})),fe=b("div",{label:"StyledDiv"})(({theme:a})=>({marginTop:a.spacing(1.5)})),je=b(p,{label:"StyledTypography"})(({theme:a})=>({fontSize:17,marginBottom:a.spacing(1)})),ke=a=>{var h;const{error:o,linode:n}=a,{data:s}=W(n.type??"",!!n.type),{data:r}=K(),i=ue({region:n.region,type:s}),k=((h=r==null?void 0:r.find(g=>g.id===n.region))==null?void 0:h.label)??n.region;return e.jsxs(A,{children:[e.jsxs(c,{parentColumn:"Label",children:[e.jsx(p,{variant:"body1",children:n.label}),o&&e.jsx(p,{sx:g=>({color:g.color.red,fontSize:13}),variant:"body1",children:o})]}),e.jsx(c,{parentColumn:"Plan",children:(s==null?void 0:s.label)??n.type??"Unknown"}),e.jsx(c,{parentColumn:"Region",children:k??"Unknown"}),e.jsx(c,{errorCell:!i,errorText:i?void 0:be,parentColumn:"Price",children:`$${(i==null?void 0:i.toFixed(2))??$}/mo`})]},`backup-linode-${n.id}`)},Le=()=>{const a=H();return V(async o=>{const n=await Promise.allSettled(o.map(s=>X(s.id)));return o.map((s,r)=>({linode:s,...n[r]}))},{onSuccess(o,n){a.invalidateQueries([x,"paginated"]),a.invalidateQueries([x,"all"]),a.invalidateQueries([x,"infinite"]);for(const s of n)a.invalidateQueries([x,"linode",s.id,"details"]),a.invalidateQueries([x,"linode",s.id,"backups"])}})},Te=({failedCount:a,successCount:o})=>o>0?`Enabled backups successfully for ${w("Linode","Linodes",o)}, but ${w("Linode","Linodes",a)} failed.`:"There was an error enabling backups for your Linodes.",De=a=>{const{onClose:o,open:n}=a,{enqueueSnackbar:s}=Y(),{data:r,error:i,isLoading:k}=Z({},{},n),{data:h,isLoading:g}=G(n),{data:L,isLoading:Q}=J(),{error:T,isLoading:N,mutateAsync:R}=ee(),[S,D]=ae.useState(!0),{data:l,isLoading:_,mutateAsync:F}=Le(),C=(l==null?void 0:l.filter(t=>t.status==="rejected").length)??0,I=(l==null?void 0:l.filter(t=>t.status==="fulfilled").length)??0,f=(r==null?void 0:r.filter(t=>!t.backups.enabled))??[],O=f.length,U=()=>{var t;return k||g||Q?e.jsx(de,{columns:3}):i?e.jsx(ce,{colSpan:4,message:(t=i==null?void 0:i[0])==null?void 0:t.reason}):f.map(m=>{var d,y,j;return e.jsx(ke,{error:(j=(y=(d=l==null?void 0:l.find(u=>u.linode.id===m.id&&u.status==="rejected"))==null?void 0:d.reason)==null?void 0:y[0])==null?void 0:j.reason,linode:m},m.id)})},q=async()=>{S&&R({backups_enabled:!0});const t=await F(f),m=t.some(u=>u.status==="rejected"),d=t.filter(u=>u.status==="fulfilled").length;if(m)return;const y=d>1?"Linodes have":"Linode has",j=S?`${d} ${y} been enrolled in automatic backups, and
all new Linodes will automatically be backed up.`:`${d} ${y} been enrolled in automatic backups.`;s(j,{variant:"success"}),o()},B=pe({linodes:f,types:h??[]});return e.jsx(ie,{onClose:o,open:n,title:"Enable All Backups",wide:!0,children:e.jsxs(ne,{spacing:2,children:[e.jsxs(p,{variant:"body1",children:["Three backup slots are executed and rotated automatically: a daily backup, a 2-7 day old backup, and an 8-14 day old backup. See our"," ",e.jsx(E,{to:"https://www.linode.com/docs/platform/disk-images/linode-backup-service/",children:"guide on Backups"})," ","for more information on features and limitations."," "]}),C>0&&e.jsx(P,{children:e.jsx(v,{spacingBottom:0,variant:"error",children:Te({failedCount:C,successCount:I})})}),!(L!=null&&L.backups_enabled)&&e.jsx(ye,{enabled:S,error:T==null?void 0:T[0].reason,toggle:()=>D(t=>!t)}),e.jsxs(Se,{children:[e.jsxs(Be,{variant:"h2",children:["Total for ",w("Linode","Linodes",O),":"]}),"Â ",e.jsx(te,{price:B&&oe.isNumber(B)?B:$,interval:"mo"})]}),e.jsx(se,{primaryButtonProps:{label:"Confirm",loading:N||_,onClick:q},secondaryButtonProps:{label:"Cancel",onClick:o},style:{margin:0,padding:0}}),e.jsxs(re,{"aria-label":"List of Linodes without backups",children:[e.jsx(me,{children:e.jsxs(A,{children:[e.jsx(c,{children:"Label"}),e.jsx(c,{children:"Plan"}),e.jsx(c,{children:"Region"}),e.jsx(c,{children:"Price"})]})}),e.jsx(le,{children:U()})]})]})})},Se=b(P,{label:"StyledPricingBox"})(({})=>({alignItems:"center",display:"flex"})),Be=b(p,{label:"StyledTypography"})(({theme:a})=>({color:a.palette.text.primary}));export{De as B};
