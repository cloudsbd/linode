import{cO as U,jZ as k,cl as m,j_ as C,i as A,cb as g,p as w,r}from"./index-Eksrs3uK.js";import{c as O}from"./longview.container-N5k_O7w1.js";const D={activeConnections:"Ports.active",apache:"Applications.Apache.*",apacheProcesses:"Processes.apache.*",cpu:"CPU.*",disk:"Disk.*",listeningServices:"Ports.listening",load:"Load.*",memory:"Memory.*",mysql:"Applications.MySQL.*",mysqlProcesses:"Processes.mysql.*",network:"Network.*",nginx:"Applications.Nginx.*",nginxProcesses:"Processes.nginx.*",packages:"Packages",processes:"Processes.*",sysinfo:"SysInfo.*",uptime:"Uptime"},E=U.create({baseURL:k,headers:{"Content-Type":"Multivalue-FormData"},method:"POST"}),N=t=>{const a=t.data[0].NOTIFICATIONS.filter(n=>n.SEVERITY===3);return a.length>0?Promise.reject(a):Promise.resolve(t.data[0])},i=(t,s,a={})=>{const{end:n,fields:e,start:d}=a,p=E,o=new FormData;return o.set("api_key",t),o.set("api_action",s),e&&o.set("keys",JSON.stringify(e.map(l=>D[l]))),d&&o.set("start",`${d}`),n&&o.set("end",`${n}`),p({data:o}).then(N)},q=t=>i(t,"lastUpdated"),b=m((t,s)=>i(t,"getValues",s));m((t,s)=>i(t,"getLatestValue",s));m((t,s)=>i(t,"getTopProcesses",s));const I=O(C,async({api_key:t,lastUpdated:s})=>{var n;let a;try{const e=await i(t,"getValues",{fields:["packages"]});a=((n=e==null?void 0:e.DATA)==null?void 0:n.Packages)||[]}catch{a=[]}return s&&Date.now()/1e3-s>60*30?Promise.resolve({Packages:[...a]}):i(t,"getLatestValue",{fields:["cpu","disk","load","memory","network","sysinfo","uptime"]}).then(e=>({...e.DATA,Packages:[...a]}))}),R=t=>A((s,a)=>{const{longviewStats:n}=s,e=n[t(a)];return{longviewClientData:g({},["data"],e),longviewClientDataError:w(["error"],e),longviewClientDataLoading:g(!0,["loading"],e),longviewClientLastUpdated:w(["lastUpdated"],e)}},(s,a)=>({getClientStats:(n,e)=>s(I({api_key:n,clientID:t(a),lastUpdated:e}))})),F=R,_=(t,s)=>{const a=r.useRef(!0),n=r.useRef(0),[e,d]=r.useState(void 0),[p,o]=r.useState([]),l=r.useRef(e),[L,h]=r.useState(),[P,y]=r.useState(!0),v=T=>{const{current:f}=l;return h(void 0),q(T).then(c=>{var S;o(c.NOTIFICATIONS);const u=((S=c.DATA)==null?void 0:S.updated)??0;a.current&&(typeof f>"u"||u>f)&&(d(u),s&&s(u))}).catch(c=>{const u=g("",[0,"TEXT"],c);a.current&&(u.match(/authentication/i)&&y(!1),typeof f>"u"&&h(c))})};return r.useEffect(()=>{l.current=e},[e]),r.useEffect(()=>{if(t)return v(t).then(()=>{n.current=window.setInterval(()=>{document.visibilityState==="visible"&&v(t)},3e4)}),()=>{a.current=!1,clearInterval(n.current)}},[t]),{authed:P,lastUpdated:e,lastUpdatedError:L,notifications:p}};export{i as a,b as g,_ as u,F as w};
