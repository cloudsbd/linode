import{s as u,cr as H,cs as C,cb as k,ct as I,cu as M,j as t,W as x,a3 as B,H as z,T as A,cv as W,cw as _,cx as $,r as l,cy as h,cz as G,i as O,g as U,cA as N,cB as Y}from"./index-Eksrs3uK.js";import{c as J}from"./concat-Y0p1CSCT.js";import{u as K}from"./uniq-xa8_MmzW.js";import{W as Q}from"./index-C8Ov-8_e.js";import{T as j,a as d,b as V,c as X}from"./TableRow-phXfWUGW.js";import{T as Z}from"./TableRowEmpty-aXmC67-Z.js";import{T as ee}from"./TableRowError-8gKmGX7P.js";import{T as b}from"./TableRowLoading-iP7zIRHG.js";import{D as te}from"./DateTimeDisplay-bXC9mIcz.js";import{T as ne}from"./TableHead-Si_pzkLK.js";import"./_isFunction-X3ooR5X_.js";import"./_contains-91K6xqrF.js";import"./Skeleton-iwmO4Yae.js";const se=u(H,{label:"StyledGravatar"})(({theme:e})=>({height:e.spacing(3),width:e.spacing(3)})),ae=e=>{const{entityId:a,event:n}=e,s=C(n.action,n.entity,n._deleted),r=k("linode",["entity","type"],n),i=I(n),c={action:n.action,entityId:a,link:s,message:M(n),timestamp:i,type:r,username:n.username};return t.jsx(re,{...c,"data-qa-events-row":n.id})},re=e=>{const{action:a,message:n,timestamp:s,username:r}=e;return n?t.jsxs(j,{ariaLabel:`Event ${n}`,"data-qa-event-row":!0,"data-test-id":a,children:[t.jsx(x,{smDown:!0,children:t.jsx(d,{"data-qa-event-icon-cell":!0,children:t.jsx(se,{username:r??""})})}),t.jsx(d,{"data-qa-event-message-cell":!0,parentColumn:"Event",children:t.jsx(B,{sanitizeOptions:{allowedTags:["a"],disallowedTagsMode:"discard"},textOrMarkdown:n})}),t.jsx(d,{parentColumn:"Relative Date",children:s.toRelative()}),t.jsx(x,{mdDown:!0,children:t.jsx(d,{"data-qa-event-created-cell":!0,parentColumn:"Absolute Date",children:t.jsx(te,{value:s.toString()})})})]}):null},S=u(d,{label:"StyledTableCell"})(({theme:e})=>({color:e.textColors.tableHeader,fontFamily:e.font.bold,fontSize:"0.875rem"})),oe=u(d,{label:"StyledLabelTableCell"})(({theme:e})=>({color:e.textColors.tableHeader,fontFamily:e.font.bold,fontSize:"0.875rem",minWidth:200,paddingLeft:10,[e.breakpoints.down("sm")]:{width:"70%"},width:"60%"})),ie=u(z,{label:"StyledH1Header"})(({theme:e})=>({marginBottom:e.spacing(1),[e.breakpoints.down("md")]:{marginLeft:e.spacing()}})),ce=u(A,{label:"StyledTyography"})(({theme:e})=>({padding:e.spacing(4),textAlign:"center"})),le=(e,a)=>N(K,J(e),Y)(a),de=(e,a)=>{const{payload:{entityId:n,eventsFromRedux:s,inProgressEvents:r,mostRecentEventTime:i,reactStateEvents:c}}=a;switch(a.type){case"prepend":return W({inProgressEvents:e.inProgressEvents,mostRecentEventTime:e.mostRecentEventTime},{inProgressEvents:r,mostRecentEventTime:i})?{eventsFromRedux:s,inProgressEvents:r,mostRecentEventTime:i,reactStateEvents:_([...s.filter(o=>!o._initial&&(typeof n>"u"||o.entity&&o.entity.id===n)),...c.filter(o=>typeof o._initial>"u")])}:{eventsFromRedux:s,inProgressEvents:r,mostRecentEventTime:i,reactStateEvents:c};case"append":default:return{eventsFromRedux:s,inProgressEvents:r,mostRecentEventTime:i,reactStateEvents:le(e.reactStateEvents,c)}}},ve=e=>{const{enqueueSnackbar:a}=$(),[n,s]=l.useState(!1),[r,i]=l.useState(!1),[c,o]=l.useState(void 0),[m,y]=l.useState(1),[f,E]=l.useState(!1),[w,q]=l.useState(!1),[g,p]=l.useReducer(de,{eventsFromRedux:e.eventsFromRedux,inProgressEvents:e.inProgressEvents,mostRecentEventTime:e.mostRecentEventTime,reactStateEvents:[]}),P=()=>{if(f)return;E(!0),(e.getEventsRequest||h)({page:m}).then(R).catch(()=>{a("There was an error loading more events",{variant:"error"}),s(!1),E(!1)})},R=v=>{y(m+1),i(!0),p({payload:{entityId:e.entityId,eventsFromRedux:e.eventsFromRedux,inProgressEvents:e.inProgressEvents,mostRecentEventTime:e.mostRecentEventTime,reactStateEvents:v.data},type:"append"}),s(!1),E(!1),o(void 0),v.pages===m&&i(!1)};l.useEffect(()=>{s(!0),E(!0),o(void 0),(e.getEventsRequest||h)().then(R).then(()=>q(!0)).catch(()=>{s(!1),o("Error")})},[]),l.useEffect(()=>{const{eventsFromRedux:v,inProgressEvents:L}=e;p({payload:{entityId:e.entityId,eventsFromRedux:v,inProgressEvents:L,mostRecentEventTime:e.mostRecentEventTime,reactStateEvents:g.reactStateEvents},type:"prepend"})},[g.reactStateEvents,e,e.eventsFromRedux,e.inProgressEvents]);const{emptyMessage:D,entityId:T,errorMessage:F}=e;return t.jsxs(t.Fragment,{children:[!T&&t.jsx(ie,{title:"Events"}),t.jsxs(V,{"aria-label":"List of Events",children:[t.jsx(ne,{children:t.jsxs(j,{children:[t.jsx(x,{smDown:!0,children:t.jsx(d,{style:{padding:0,width:"1%"}})}),t.jsx(oe,{"data-qa-events-subject-header":!0,children:"Event"}),t.jsx(S,{children:"Relative Date"}),t.jsx(x,{mdDown:!0,children:t.jsx(S,{"data-qa-events-time-header":!0,children:"Absolute Date"})})]})}),t.jsx(X,{children:me(n,f,F,T,c,g.reactStateEvents,D)})]}),r&&w&&!n?t.jsx(Q,{onEnter:P,children:t.jsx("div",{})}):!n&&!c&&g.reactStateEvents.length>0&&t.jsx(ce,{children:"No more events to show"})]})},me=(e,a,n="There was an error retrieving the events on your account.",s,r,i,c="You don't have any events on your account.")=>{const o=G(i,["profile_update"]);return e?t.jsx(b,{columns:4,responsive:{0:{xsDown:!0},3:{smDown:!0}},rows:5}):r?t.jsx(ee,{colSpan:12,"data-qa-events-table-error":!0,message:n}):o.length===0?t.jsx(Z,{colSpan:12,"data-qa-events-table-empty":!0,message:c}):t.jsxs(t.Fragment,{children:[o.map((m,y)=>t.jsx(ae,{entityId:s,event:m},`event-list-item-${y}`)),a&&t.jsx(b,{columns:4,responsive:{0:{xsDown:!0},3:{smDown:!0}},rows:5})]})},ue=e=>({eventsFromRedux:e.events.events,inProgressEvents:e.events.inProgressEvents,mostRecentEventTime:e.events.mostRecentEventTime}),Ee=O(ue),ge=U(Ee),De=ge(ve);export{ve as EventsLanding,De as default,de as reducer,me as renderTableBody};
