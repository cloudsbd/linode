import{hi as Fe,hj as Ae,r as w,j as e,ao as Re,W as q,ap as ce,dT as qe,T as B,m as Se,cx as De,u as re,hk as Be,hl as _e,ep as Oe,ee as Me,bj as Ne,ad as V,hm as $e,bB as de,ag as Le,an as ue,dE as Ue,di as Ge,gC as He,av as Qe,hn as me,ho as We,fh as Ke,Q as ge,aa as pe,af as Ve,cW as Ye,hp as K,E as Je,C as Xe,bM as Ze,hq as he}from"./index-Eksrs3uK.js";import{p as et}from"./immer.esm--MpJ8fpr.js";import{L as tt}from"./LandingHeader-JXAVBhqg.js";import{P as fe}from"./PaginationFooter-NHWf7fW2.js";import{T as se,a as T,b as be,c as ve}from"./TableRow-phXfWUGW.js";import{T as ye}from"./TableRowEmpty-aXmC67-Z.js";import{T as N}from"./TableSortCell-hcsagFzN.js";import{u as xe}from"./useOrder-rsUMHEuj.js";import{u as Ie}from"./usePagination-Sxr0Tlb7.js";import{A as at}from"./ActionMenu-4CPisA_2.js";import{D as nt}from"./Drawer-A9yKjC3Z.js";import{D as st}from"./DiskSelect-4cJhrQl_.js";import{L as rt}from"./LinodeSelect-y7DOgXsC.js";import{g as it}from"./getAPIErrorFor-OfQrArkQ.js";import{y as ot,b as lt,R as ct}from"./ResourcesSection-fJQ13r7x.js";import{T as Ce}from"./TableHead-Si_pzkLK.js";import"./OrderBy-H-bWJCPy.js";import"./splitAt-pbTnq2Oi.js";import"./RenderGuard-iLW_eACV.js";import"./Autocomplete-XvrzKoAo.js";import"./ListItem-joIHQeyv.js";var Y="NOT_FOUND";function dt(t){var n;return{get:function(a){return n&&t(n.key,a)?n.value:Y},put:function(a,l){n={key:a,value:l}},getEntries:function(){return n?[n]:[]},clear:function(){n=void 0}}}function ut(t,n){var s=[];function a(c){var r=s.findIndex(function(g){return n(c,g.key)});if(r>-1){var d=s[r];return r>0&&(s.splice(r,1),s.unshift(d)),d.value}return Y}function l(c,r){a(c)===Y&&(s.unshift({key:c,value:r}),s.length>t&&s.pop())}function u(){return s}function m(){s=[]}return{get:a,put:l,getEntries:u,clear:m}}var mt=function(n,s){return n===s};function gt(t){return function(s,a){if(s===null||a===null||s.length!==a.length)return!1;for(var l=s.length,u=0;u<l;u++)if(!t(s[u],a[u]))return!1;return!0}}function pt(t,n){var s=typeof n=="object"?n:{equalityCheck:n},a=s.equalityCheck,l=a===void 0?mt:a,u=s.maxSize,m=u===void 0?1:u,c=s.resultEqualityCheck,r=gt(l),d=m===1?dt(r):ut(m,r);function g(){var p=d.get(arguments);if(p===Y){if(p=t.apply(null,arguments),c){var i=d.getEntries(),h=i.find(function(x){return c(x.value,p)});h&&(p=h.value)}d.put(arguments,p)}return p}return g.clearCache=function(){return d.clear()},g}function ht(t){var n=Array.isArray(t[0])?t[0]:t;if(!n.every(function(a){return typeof a=="function"})){var s=n.map(function(a){return typeof a=="function"?"function "+(a.name||"unnamed")+"()":typeof a}).join(", ");throw new Error("createSelector expects all input-selectors to be functions, but received the following types: ["+s+"]")}return n}function ft(t){for(var n=arguments.length,s=new Array(n>1?n-1:0),a=1;a<n;a++)s[a-1]=arguments[a];var l=function(){for(var m=arguments.length,c=new Array(m),r=0;r<m;r++)c[r]=arguments[r];var d=0,g,p={memoizeOptions:void 0},i=c.pop();if(typeof i=="object"&&(p=i,i=c.pop()),typeof i!="function")throw new Error("createSelector expects an output function after the inputs, but received: ["+typeof i+"]");var h=p,x=h.memoizeOptions,k=x===void 0?s:x,b=Array.isArray(k)?k:[k],I=ht(c),C=t.apply(void 0,[function(){return d++,i.apply(null,arguments)}].concat(b)),P=t(function(){for(var F=[],_=I.length,v=0;v<_;v++)F.push(I[v].apply(null,arguments));return g=C.apply(null,F),g});return Object.assign(P,{resultFunc:i,memoizedResultFunc:C,dependencies:I,lastResult:function(){return g},recomputations:function(){return d},resetRecomputations:function(){return d=0}}),P};return l}var bt=ft(pt);const vt=bt(t=>t.events||[],t=>t.filter(n=>Fe(n)||Ae(n))),yt=t=>{const{description:n,event:s,id:a,label:l,onCancelFailed:u,onDelete:m,onDeploy:c,onEdit:r,onRestore:d,onRetry:g,status:p}=t,i=w.useMemo(()=>{const h=p&&p!=="available",x=!h;return(s==null?void 0:s.status)==="failed"?[{onClick:()=>{g==null||g(a,l,n)},title:"Retry"},{onClick:()=>{u==null||u(a)},title:"Cancel"}]:[{disabled:h,onClick:()=>{r==null||r(l,n??" ",a)},title:"Edit",tooltip:h?"Image is not yet available for use.":void 0},{disabled:h,onClick:()=>{c==null||c(a)},title:"Deploy to New Linode",tooltip:h?"Image is not yet available for use.":void 0},{disabled:h,onClick:()=>{d==null||d(a)},title:"Rebuild an Existing Linode",tooltip:h?"Image is not yet available for use.":void 0},{onClick:()=>{m==null||m(l,a,p)},title:x?"Delete":"Cancel Upload"}]},[p,n,a,l,m,d,c,r,g,u,s]);return e.jsx(at,{actionsList:i,ariaLabel:`Action menu for Image ${t.label}`})},xt=t=>{const{created:n,description:s,event:a,expiry:l,id:u,label:m,onCancelFailed:c,onRetry:r,size:d,status:g,...p}=t,{data:i}=Re(),h=g==="pending_upload"&&(a==null?void 0:a.status)==="failed",x=b=>{switch(b){case"creating":return e.jsx(Ct,{progress:It(a),text:"Creating"});case"available":return"Ready";case"pending_upload":return h?"Failed":"Processing";default:return qe(b.replace("_"," "))}},k=(b,I,C)=>I==="available"||C==="finished"?`${b} MB`:h?"N/A":"Pending";return e.jsxs(se,{"data-qa-image-cell":u,children:[e.jsx(T,{"data-qa-image-label":!0,children:m}),e.jsxs(q,{smDown:!0,children:[g?e.jsx(T,{children:x(g)}):null,e.jsx(T,{"data-qa-image-date":!0,children:ce(n,{timezone:i==null?void 0:i.timezone})})]}),e.jsx(T,{"data-qa-image-size":!0,children:k(d,g,a==null?void 0:a.status)}),e.jsx(q,{smDown:!0,children:l?e.jsx(T,{"data-qa-image-date":!0,children:ce(l,{timezone:i==null?void 0:i.timezone})}):null}),e.jsx(T,{actionCell:!0,children:e.jsx(yt,{description:s,event:(a==null?void 0:a.status)==="failed"?a:void 0,id:u,label:m,onCancelFailed:c,onRetry:r,status:g,...p})})]},u)},It=t=>(t==null?void 0:t.status)==="started"&&(t!=null&&t.percent_complete)?t.percent_complete:void 0,Ct=t=>{const{progress:n,text:s}=t,a=n?`${n}%`:"scheduled";return e.jsxs(B,{variant:"body1",children:[s,": ",a]})},je=w.memo(xt),jt=Se()(t=>({actionPanel:{marginTop:t.spacing(2)},helperText:{paddingTop:t.spacing(.5)},root:{},suffix:{fontSize:".9rem",marginRight:t.spacing(1)}})),J="Create Image",wt={closed:"",create:J,edit:"Edit Image",imagize:J,restore:"Restore from Image"},kt={closed:"",create:J,edit:"Save Changes",imagize:J,restore:"Restore Image"},St=t=>{const{changeDescription:n,changeDisk:s,changeLabel:a,changeLinode:l,description:u,imageId:m,label:c,mode:r,onClose:d,open:g,selectedDisk:p,selectedLinode:i}=t,{classes:h}=jt(),{enqueueSnackbar:x}=De(),k=re(),{canCreateImage:b,permissionedLinodes:I}=Be(),[C,P]=w.useState(!1),[E,F]=w.useState(void 0),[_,v]=w.useState(!1),[O,y]=w.useState(void 0),[D,S]=w.useState([]),{mutateAsync:A}=_e(),{mutateAsync:M}=Oe();w.useEffect(()=>(P(!0),t.disks&&S(t.disks),()=>{P(!1)}),[t.disks]),w.useEffect(()=>{i||S([]),i&&Me(i).then(f=>{if(!C)return;const W=f.data.filter(ne=>ne.filesystem!=="swap");Ne(D,W)||S(W)}).catch(f=>{C&&C&&y([{field:"disk_id",reason:"Could not retrieve disks for this Linode."}])})},[i]);const X=f=>{y(void 0),l(f)},Z=f=>{y(void 0),s(f)},z=()=>{d(),C&&(y(void 0),F(void 0),v(!1))},$=u||" ",ee=()=>{switch(y(void 0),F(void 0),v(!0),r){case"edit":if(!m){v(!1);return}A({description:$,imageId:m,label:c}).then(()=>{C&&z()}).catch(f=>{C&&(v(!1),y(ue(f,"Unable to edit Image")))});return;case"create":case"imagize":M({description:$,diskID:Number(p),label:c}).then(()=>{C&&(Ue(),v(!1),z(),x("Image scheduled for creation.",{variant:"info"}))}).catch(f=>{C&&(v(!1),y(ue(f,"There was an error creating the image.")))});return;case"restore":if(!i){v(!1),y([{field:"linode_id",reason:"Choose a Linode."}]);return}z(),k.push({pathname:`/linodes/${i}/rebuild`,state:{selectedImageId:m}});default:return}},te=(()=>{const f=!!p;switch(r){case"create":return!(f&&i);case"imagize":return!f;case"restore":return!i;default:return!1}})(),R=it({disk_id:"Disk",label:"Label",linode_id:"Linode",region:"Region",size:"Size"},O),U=R("label"),G=R("description"),H=R("none"),ae=R("linode_id"),Q=R("disk_id");return e.jsxs(nt,{onClose:d,open:g,title:wt[r],children:[b?null:e.jsx(V,{text:"You don't have permissions to create a new Image. Please contact an account administrator for details.",variant:"error"}),H&&e.jsx(V,{"data-qa-notice":!0,text:H,variant:"error"}),E&&e.jsx(V,{"data-qa-notice":!0,text:E,variant:"info"}),["create","restore"].includes(r)&&e.jsx(rt,{onSelectionChange:f=>{f!==null&&X(f.id)},optionsFilter:f=>I?I.includes(f.id):!0,clearable:!1,disabled:!b,errorText:ae,value:i}),["create","imagize"].includes(r)&&e.jsxs(e.Fragment,{children:[e.jsx(st,{"data-qa-disk-select":!0,disabled:r==="imagize"||!b,diskError:Q,disks:D,handleChange:Z,selectedDisk:p,updateFor:[D,p,Q,h]}),e.jsxs(B,{className:h.helperText,variant:"body1",children:["Linode Images are limited to ",$e," MB of data per disk by default. Please ensure that your disk content does not exceed this size limit, or open a Support ticket to request a higher limit. Additionally, Linode Images cannot be created if you are using raw disks or disks that have been formatted using custom filesystems."]})]}),["create","edit","imagizing"].includes(r)&&e.jsxs(w.Fragment,{children:[e.jsx(de,{"data-qa-image-label":!0,disabled:!b,error:!!U,errorText:U,label:"Label",onChange:a,value:c}),e.jsx(de,{"data-qa-image-description":!0,disabled:!b,error:!!G,errorText:G,label:"Description",multiline:!0,onChange:n,rows:1,value:u})]}),e.jsx(Le,{primaryButtonProps:{"data-testid":"submit",disabled:te||!b,label:kt[r]??"Submit",loading:_,onClick:ee},secondaryButtonProps:{"data-testid":"cancel",disabled:!b,label:"Cancel",onClick:z},style:{marginTop:16}})]})},Dt={description:"Store your own custom Linux images, enabling you to rapidly deploy Linode Compute Instances preconfigured with the software and settings you require.",subtitle:"",title:"Images"},Lt={links:[{text:"Overview of Custom Images",to:"https://www.linode.com/docs/products/tools/images/"},{text:"Getting Started with Custom Images",to:"https://www.linode.com/docs/products/tools/images/get-started/"},{text:"Capture an Image from a Linode",to:"https://www.linode.com/docs/products/tools/images/guides/capture-an-image/"},{text:"Upload a Custom Image",to:"https://www.linode.com/docs/products/tools/images/guides/upload-an-image/"}],moreInfo:{text:"View additional Images guides",to:"https://www.linode.com/docs/products/tools/images/guides/"},title:"Getting Started Guides"},Tt={links:[{external:!0,text:"How to use Linode Images | Learn how to Create, Upload, and Deploy Custom Images on Linode",to:"https://www.youtube.com/watch?v=1nYhLui1urQ"},{external:!0,text:"Custom Images on Linode | Create, Upload, and Deploy Custom iso Images to Deploy on Linode",to:"https://www.youtube.com/watch?v=GdEFNHTCGqA"},{external:!0,text:"Using Images and Backups on Linode",to:"https://www.youtube.com/watch?v=UNlJUzQrBBI"}],moreInfo:{text:ot,to:lt},title:"Video Playlist"},we={action:"Click:link",category:"Images landing page empty"},Et=()=>{const{push:t}=re();return e.jsx(ct,{buttonProps:[{children:"Create Image",onClick:()=>{Ge({action:"Click:button",category:we.category,label:"Create Image"}),t("/images/create")}}],gettingStartedGuidesData:Lt,headers:Dt,icon:He,linkAnalyticsEvent:we,youtubeLinkData:Tt})},zt=Se()(t=>({imageTable:{marginBottom:t.spacing(3),padding:0},imageTableHeader:{marginLeft:t.spacing(),padding:t.spacing()},imageTableSubheader:{marginTop:t.spacing()}})),Pt={description:"",label:"",mode:"edit",open:!1,selectedDisk:null},Ft={error:void 0,image:"",imageID:"",open:!1,submitting:!1},ta=()=>{const{classes:t}=zt(),n=re(),{enqueueSnackbar:s}=De(),a=Qe(),l=Ie(1,`${K}-manual`,"manual"),{handleOrderChange:u,order:m,orderBy:c}=xe({order:"asc",orderBy:"label"},`${K}-manual-order`,"manual"),r={"+order":m,"+order_by":c},{data:d,error:g,isLoading:p}=me({page:l.page,page_size:l.pageSize},{...r,is_public:!1,type:"manual"}),i=Ie(1,`${K}-automatic`,"automatic"),{handleOrderChange:h,order:x,orderBy:k}=xe({order:"asc",orderBy:"label"},`${K}-automatic-order`,"automatic"),b={"+order":x,"+order_by":k},{data:I,error:C,isLoading:P}=me({page:i.page,page_size:i.pageSize},{...b,is_public:!1,type:"automatic"}),{mutateAsync:E}=We(),F=Ke(o=>o.events),_=vt(F),v=ke((d==null?void 0:d.data)??[],_),O=ke((I==null?void 0:I.data)??[],_),[y,D]=w.useState(Pt),[S,A]=w.useState(Ft),M=S.status==="pending_upload"?"cancel":"delete",X=M==="cancel"?"Are you sure you want to cancel this Image upload?":"Are you sure you want to delete this Image?",Z=(o,j,L)=>{A({error:void 0,image:o,imageID:j,open:!0,status:L,submitting:!1})},z=()=>{A({...S,open:!1})},$=()=>{S.imageID||A(o=>({...o,error:"Image is not available."})),A(o=>({...o,error:void 0,submitting:!0})),E({imageId:S.imageID}).then(()=>{z(),s("Image has been scheduled for deletion.",{variant:"info"})}).catch(o=>{const j=Ze(o,"There was an error deleting the image.");A(L=>({...L,error:j,submitting:!1}))})},ee=(o,j,L)=>{he(a),n.push("/images/create/upload",{imageDescription:L,imageLabel:j})},ie=()=>{he(a)},te=(o,j,L)=>{D({description:j,imageID:L,label:o,mode:"edit",open:!0,selectedDisk:null})},R=o=>{D({imageID:o,mode:"restore",open:!0,selectedDisk:null})},U=o=>{n.push({pathname:"/linodes/create/",search:`?type=Images&imageID=${o}`,state:{selectedImageId:o}})},G=o=>{D(j=>({...j,selectedDisk:null,selectedLinode:o??void 0}))},H=o=>{D(j=>({...j,selectedDisk:o}))},ae=o=>{const j=o.target.value;D(L=>({...L,label:j}))},Q=o=>{const j=o.target.value;D(L=>({...L,description:j}))},f=()=>e.jsx(Le,{primaryButtonProps:{"data-testid":"submit",label:M==="cancel"?"Cancel Upload":"Delete Image",loading:S.submitting,onClick:$},secondaryButtonProps:{"data-testid":"cancel",label:M==="cancel"?"Keep Image":"Cancel",onClick:z}}),W=()=>{D(o=>({...o,open:!1}))},ne=()=>e.jsx(St,{changeDescription:Q,changeDisk:H,changeLabel:ae,changeLinode:G,description:y.description,imageId:y.imageID,label:y.label,mode:y.mode,onClose:W,open:y.open,selectedDisk:y.selectedDisk,selectedLinode:y.selectedLinode||null}),oe={onCancelFailed:ie,onDelete:Z,onDeploy:U,onEdit:te,onRestore:R,onRetry:ee},le=o=>e.jsxs(w.Fragment,{children:[e.jsx(ge,{segment:"Images"}),e.jsx(Je,{errorText:"There was an error retrieving your images. Please reload and try again."})]}),Te=()=>e.jsx(Xe,{}),Ee=()=>e.jsx(Et,{});if(p||P)return Te();if(g||C)return le();if((!v||v.length===0)&&(!O||O.length===0))return Ee();const ze=e.jsx(ye,{colSpan:5,message:"No Custom Images to display."}),Pe=e.jsx(ye,{colSpan:6,message:"No Recovery Images to display."});return e.jsxs(w.Fragment,{children:[e.jsx(ge,{segment:"Images"}),e.jsx(tt,{docsLink:"https://www.linode.com/docs/platform/disk-images/linode-images/",entity:"Image",onButtonClick:()=>n.push("/images/create"),title:"Images"}),e.jsxs(pe,{className:t.imageTable,children:[e.jsxs("div",{className:t.imageTableHeader,children:[e.jsx(B,{variant:"h3",children:"Custom Images"}),e.jsx(B,{className:t.imageTableSubheader,children:"These are images you manually uploaded or captured from an existing Linode disk."})]}),e.jsxs(be,{children:[e.jsx(Ce,{children:e.jsxs(se,{children:[e.jsx(N,{active:c==="label",direction:m,handleClick:u,label:"label",children:"Image"}),e.jsx(q,{smDown:!0,children:e.jsx(T,{children:"Status"})}),e.jsx(q,{smDown:!0,children:e.jsx(N,{active:c==="created",direction:m,handleClick:u,label:"created",children:"Created"})}),e.jsx(N,{active:c==="size",direction:m,handleClick:u,label:"size",children:"Size"}),e.jsx(T,{})]})}),e.jsx(ve,{children:v.length>0?v.map(o=>e.jsx(je,{...o,...oe},o.id)):ze})]}),e.jsx(fe,{count:(d==null?void 0:d.results)??0,eventCategory:"Custom Images Table",handlePageChange:l.handlePageChange,handleSizeChange:l.handlePageSizeChange,page:l.page,pageSize:l.pageSize})]}),e.jsxs(pe,{className:t.imageTable,children:[e.jsxs("div",{className:t.imageTableHeader,children:[e.jsx(B,{variant:"h3",children:"Recovery Images"}),e.jsx(B,{className:t.imageTableSubheader,children:"These are images we automatically capture when Linode disks are deleted. They will be deleted after the indicated expiration date."})]}),e.jsxs(be,{children:[e.jsx(Ce,{children:e.jsxs(se,{children:[e.jsx(N,{active:k==="label",direction:x,handleClick:h,label:"label",children:"Image"}),e.jsx(q,{smDown:!0,children:e.jsx(T,{children:"Status"})}),e.jsx(q,{smDown:!0,children:e.jsx(N,{active:k==="created",direction:x,handleClick:h,label:"created",children:"Created"})}),e.jsx(N,{active:k==="size",direction:x,handleClick:h,label:"size",children:"Size"}),e.jsx(q,{smDown:!0,children:e.jsx(T,{children:"Expires"})}),e.jsx(T,{})]})}),e.jsx(ve,{children:O.length>0?O.map(o=>e.jsx(je,{...o,...oe},o.id)):Pe})]}),e.jsx(fe,{count:(I==null?void 0:I.results)??0,eventCategory:"Recovery Images Table",handlePageChange:i.handlePageChange,handleSizeChange:i.handlePageSizeChange,page:i.page,pageSize:i.pageSize})]}),ne(),e.jsxs(Ve,{title:M==="cancel"?"Cancel Upload":`Delete Image ${S.image}`,actions:f,onClose:z,open:S.open,children:[S.error&&e.jsx(V,{text:S.error,variant:"error"}),e.jsx(B,{children:X})]})]})},ke=(t,n)=>{const s=Ye(t??[]);return Object.values(s).reduce((a,l)=>et(a,u=>{if(!l.is_public){const m=n.find(c=>{var r,d;return`private/${(r=c.secondary_entity)==null?void 0:r.id}`===l.id||`private/${(d=c.entity)==null?void 0:d.id}`===l.id&&c.status==="failed"});m?u.push({...l,event:m}):u.push(l)}}),[])};export{ta as ImagesLanding,ta as default};
