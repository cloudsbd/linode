import{a8 as $,a9 as G,j as e,m as N,ba as E,r as c,b as M,aW as Q,bm as z,q as W,aa as O,G as d,a1 as H,a4 as K,T as p,f as V,ad as Z,B as J,br as X,an as Y,aN as ee,bs as ae}from"./index-Eksrs3uK.js";import{C as u}from"./Currency-No8tnN7b.js";import{D as te}from"./DownloadCSV-HnOVCNZX.js";import{g as re,r as ne,i as se,a as oe,p as ie}from"./PdfGenerator-N_TKezyR.js";import{D as le}from"./DateTimeDisplay-bXC9mIcz.js";import{P as de}from"./Paginate-XLm_-WxT.js";import{P as ce}from"./PaginationFooter-NHWf7fW2.js";import{b as ue,T as R,a as t,c as xe}from"./TableRow-phXfWUGW.js";import{T as pe}from"./TableRowEmpty-aXmC67-Z.js";import{T as _}from"./TableRowError-8gKmGX7P.js";import{T as he}from"./TableRowLoading-iP7zIRHG.js";import{T as me}from"./TableHead-Si_pzkLK.js";import"./lke-download-Hz_dthl6.js";import"./constants-KokzTiEs.js";import"./Skeleton-iwmO4Yae.js";var U={},ge=G;Object.defineProperty(U,"__esModule",{value:!0});var F=U.default=void 0,je=ge($()),be=e,fe=(0,je.default)((0,be.jsx)("path",{d:"M15.41 16.59 10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"}),"KeyboardArrowLeft");F=U.default=fe;const ye=N()(n=>({table:{"& thead th":{"&:last-of-type":{paddingRight:15},borderBottom:`1px solid ${n.borderColors.borderTable}`},border:`1px solid ${n.borderColors.borderTable}`}})),Se=n=>{const{classes:x}=ye(),j=25,{data:b,error:f,isLoading:a}=E(),{errors:S,items:o,loading:T,shouldShowRegion:h}=n,s=h?9:8,v=()=>T||a?e.jsx(he,{columns:s}):f?e.jsx(_,{colSpan:s,message:"Unable to retrieve regions for this invoice."}):S?e.jsx(_,{colSpan:s,message:"Unable to retrieve invoice items."}):o&&o.length>0?e.jsx(de,{data:o,pageSize:25,children:({count:y,data:D,handlePageChange:q,handlePageSizeChange:C,page:m,pageSize:P})=>e.jsxs(c.Fragment,{children:[D.map(r=>e.jsxs(R,{children:[e.jsx(t,{"data-qa-description":!0,parentColumn:"Description",children:r.label}),e.jsx(t,{"data-qa-from":!0,parentColumn:"From",children:A(r.from)}),e.jsx(t,{"data-qa-to":!0,parentColumn:"To",children:A(r.to)}),e.jsx(t,{"data-qa-quantity":!0,parentColumn:"Quantity",children:Te(r.quantity)}),h&&e.jsx(t,{"data-qa-region":!0,parentColumn:"Region",children:re(r,b??[])}),e.jsx(t,{"data-qa-unit-price":!0,parentColumn:"Unit Price",children:r.unit_price!=="None"&&ne(r.unit_price)}),e.jsx(t,{"data-qa-amount":!0,parentColumn:"Amount (USD)",children:e.jsx(u,{quantity:r.amount,wrapInParentheses:r.amount<0})}),e.jsx(t,{"data-qa-tax":!0,parentColumn:"Tax (USD)",children:e.jsx(u,{quantity:r.tax})}),e.jsx(t,{"data-qa-total":!0,parentColumn:"Total (USD)",children:e.jsx(u,{quantity:r.total,wrapInParentheses:r.total<0})})]},`${r.label}-${r.from}-${r.to}`)),y>j&&e.jsx(R,{children:e.jsx(t,{colSpan:s,sx:{paddingLeft:"0px !important"},children:e.jsx(ce,{count:y,eventCategory:"invoice_items",handlePageChange:q,handleSizeChange:C,page:m,pageSize:P})})})]})}):e.jsx(pe,{colSpan:s});return e.jsxs(ue,{"aria-label":"Invoice Details",className:x.table,noBorder:!0,children:[e.jsx(me,{children:e.jsxs(R,{children:[e.jsx(t,{children:"Description"}),e.jsx(t,{sx:{minWidth:"125px"},children:"From"}),e.jsx(t,{sx:{minWidth:"125px"},children:"To"}),e.jsx(t,{children:"Quantity"}),h&&e.jsx(t,{children:"Region"}),e.jsx(t,{noWrap:!0,children:"Unit Price"}),e.jsx(t,{children:"Amount (USD)"}),e.jsx(t,{children:"Tax (USD)"}),e.jsx(t,{children:"Total (USD)"})]})}),e.jsx(xe,{children:v()})]})},A=n=>n?e.jsx(le,{value:n}):null,Te=n=>n||null,Be=()=>{const{invoiceId:n}=M(),x=Q(),j=c.useRef(),{data:b}=z(),{data:f}=E(),[a,S]=c.useState(void 0),[o,T]=c.useState(void 0),[h,s]=c.useState(!1),[v,y]=c.useState(),[D,q]=c.useState(void 0),C=W(),m=se(a==null?void 0:a.date),P=()=>{s(!0);const i=ee((l,g)=>ae(+n,l,g));Promise.all([X(+n),i()]).then(([l,{data:g}])=>{s(!1),S(l),T(g)}).catch(l=>{s(!1),y(Y(l,"Unable to retrieve invoice details."))})};c.useEffect(()=>{P()},[]);const r=async(i,l,g)=>{const B=C[oe(l.date)?"taxes":"taxBanner"],I=await ie({account:i,invoice:l,items:g,regions:m&&f?f:[],taxes:B});q(I.status==="error"?I.error:void 0)},L=[{key:"label",label:"Description"},{key:"from",label:"From"},{key:"to",label:"To"},{key:"quantity",label:"Quantity"},...m?[{key:"region",label:"Region"}]:[],{key:"unit_price",label:"Unit Price"},{key:"amount",label:"Amount (USD)"},{key:"tax",label:"Tax (USD)"},{key:"total",label:"Total (USD)"}],w={alignItems:"center",display:"flex"},k={whiteSpace:"nowrap"};return e.jsx(O,{sx:{padding:`${x.spacing(2)} ${x.spacing(3)}`},children:e.jsxs(d,{container:!0,rowGap:2,children:[e.jsx(d,{xs:12,children:e.jsxs(d,{container:!0,"data-qa-invoice-header":!0,spacing:2,sx:w,children:[e.jsxs(d,{sm:4,sx:w,xs:12,children:[e.jsx(H,{accessibleAriaLabel:"Back to Billing","data-qa-back-to-billing":!0,to:"/account/billing",children:e.jsx(K,{sx:{padding:0},component:"span",disableFocusRipple:!0,role:"none",size:"large",tabIndex:-1,children:e.jsx(F,{sx:{height:34,width:34}})})}),a&&e.jsxs(p,{"data-qa-invoice-id":!0,sx:{paddingLeft:x.spacing(1)},variant:"h2",children:["Invoice #",a.id]})]}),e.jsx(d,{"data-qa-printable-invoice":!0,sm:!0,sx:{...w,justifyContent:"flex-end"},children:b&&a&&o&&e.jsxs(e.Fragment,{children:[e.jsx(te,{csvRef:j,data:o,filename:`invoice-${a.date}.csv`,headers:L,onClick:()=>j.current.link.click(),sx:{...k,marginRight:"8px"}}),e.jsx(V,{buttonType:"secondary",onClick:()=>r(b,a,o),sx:k,children:"Download PDF"})]})}),e.jsx(d,{sm:"auto",children:a&&e.jsxs(p,{"data-qa-total":a.total,variant:"h2",children:["Total:"," ",e.jsx(u,{quantity:a.total,wrapInParentheses:a.total<0})]})})]})}),e.jsxs(d,{xs:12,children:[D&&e.jsx(Z,{variant:"error",children:"Failed generating PDF."}),e.jsx(Se,{errors:v,items:o,loading:h,shouldShowRegion:m})]}),e.jsx(d,{xs:12,children:a&&e.jsxs(J,{sx:{alignItems:"flex-end",display:"flex",flexDirection:"column",gap:x.spacing(2),padding:x.spacing(1)},"data-qa-invoice-summary":!0,children:[e.jsxs(p,{variant:"h2",children:["Subtotal:"," ",e.jsx(u,{quantity:a.subtotal,wrapInParentheses:a.subtotal<0})]}),a.tax_summary.map(i=>e.jsxs(p,{variant:"h2",children:[i.name==="Standard"?"Standard Tax: ":`${i.name}: `,e.jsx(u,{quantity:i.tax})]},i.name)),e.jsxs(p,{variant:"h2",children:["Tax Subtotal: ",e.jsx(u,{quantity:a.tax})]}),e.jsxs(p,{variant:"h2",children:["Total:"," ",e.jsx(u,{quantity:a.total,wrapInParentheses:a.total<0})]})]})})]})})};export{Be as InvoiceDetail};
