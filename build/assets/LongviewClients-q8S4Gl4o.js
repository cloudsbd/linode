import{s as f,G as r,r as d,j as e,af as we,ag as Ce,T as j,B as _,f as q,bB as fe,bz as ye,bA as ve,a4 as $,bC as je,aW as H,lK as Se,g as G,ao as V,cb as w,ap as Le,a1 as De,an as Q,aa as k,bp as Y,C as Ie,E as ke,cH as Ee,dg as Pe,ab as M,Q as Te,bI as Ue,V as Be,i as Ae}from"./index-Eksrs3uK.js";import{D as _e}from"./DebouncedSearchTextField-EUZwzd3g.js";import{w as J}from"./longview.container-N5k_O7w1.js";import{f as Ge,C as Re,R as ze,S as Fe,L as $e,N as Me,a as Ne,b as Ke,g as N,c as K,d as O}from"./formatUptime-T2o8loDP.js";import{i as Oe,j as W}from"./utilities-JekaXHyt.js";import{P as We}from"./Paginate-XLm_-WxT.js";import{P as qe}from"./PaginationFooter-NHWf7fW2.js";import{w as X,u as He}from"./useClientLastUpdated-a0PNleVi.js";import{A as Ve}from"./ActionMenu-4CPisA_2.js";import{d as Qe,a as Ye}from"./LandingHeader-JXAVBhqg.js";import{I as Je}from"./InstallationInstructions-co98NL17.js";import{S as Xe}from"./LongviewLanding-Mg9nqQoy.js";import"./Drawer-A9yKjC3Z.js";import"./TableRow-phXfWUGW.js";import"./TableRowEmpty-aXmC67-Z.js";import"./TableHead-Si_pzkLK.js";import"./CopyTooltip-mIyzAQ7E.js";import"./index-Y5esPPk-.js";import"./SafeTabPanel-S0Pp8CVT.js";import"./TabList-4PWL4GSj.js";import"./TabLinkList-BrXtJznm.js";import"./useAPIRequest-UcK5fafY.js";import"./immer.esm--MpJ8fpr.js";import"./Radio-HudVgwMW.js";import"./TableRowError-8gKmGX7P.js";import"./TableRowLoading-iP7zIRHG.js";import"./Skeleton-iwmO4Yae.js";const Ze=f(r,{label:"StyledCTAGrid"})(({theme:t})=>({alignItems:"center",boxSizing:"border-box",display:"flex",flexDirection:"column",flexWrap:"wrap",justifyContent:"center",marginTop:t.spacing(2)})),et=f(r,{label:"StyledHeadingGrid"})(({theme:t})=>({alignItems:"center",boxSizing:"border-box",display:"flex",flexWrap:"wrap",marginBottom:t.spacing(),width:"100%",[t.breakpoints.down("lg")]:{marginLeft:0,marginRight:0}})),tt=f(r,{label:"StyledSearchbarGrid"})(({theme:t})=>({boxSizing:"border-box",margin:0,"& > div":{width:"300px"},[t.breakpoints.down("sm")]:{width:"100%"},[t.breakpoints.only("md")]:{"&.MuiGrid-item":{paddingLeft:0}}})),nt=f(r,{label:"StyledSortSelectGrid"})(({theme:t})=>({alignItems:"center",boxSizing:"border-box",display:"flex",flexFlow:"row nowrap",margin:0,paddingBottom:0,paddingTop:0,[t.breakpoints.up("xs")]:{width:221},width:210})),at=d.memo(t=>{const[i,n]=d.useState(!1),[s,a]=d.useState(void 0),{closeDialog:l,open:o,selectedLongviewClientID:g,selectedLongviewClientLabel:p}=t;d.useEffect(()=>{o&&a(void 0)},[o]);const x=()=>{if(!g)return a([{reason:"There was an issue deleting this Longview Client."}]);n(!0),t.deleteClient(g).then(()=>{n(!1),l()}).catch(c=>{n(!1),a(c)})};return e.jsx(we,{actions:e.jsx(it,{isDeleting:i,onClose:t.closeDialog,onSubmit:x}),error:s?s[0].reason:"",onClose:t.closeDialog,open:o,title:`Delete ${p||"this Longview Client"}?`,children:"Are you sure you want to delete this Longview Client?"})}),it=t=>e.jsx(Ce,{primaryButtonProps:{"data-testid":"delete-button",label:"Delete",loading:t.isDeleting,onClick:t.onSubmit},secondaryButtonProps:{label:"Cancel",onClick:t.onClose}}),Z=d.memo(t=>{const{longviewClientID:i,longviewClientLabel:n,triggerDeleteLongviewClient:s,userCanModifyClient:a}=t,l=[{disabled:!a,onClick:()=>{s(i,n)},title:"Delete",tooltip:a?"":"Contact an account administrator for permission."}];return e.jsx(Ve,{actionsList:l,ariaLabel:`Action menu for Longview Client ${t.longviewClientLabel}`})}),st=f(j,{label:"EditableInput__StyledTypography"})(({theme:t,...i})=>({...!i.className&&{display:"inline-block",lineHeight:1,padding:"5px 8px",textDecoration:"inherit",transition:t.transitions.create(["opacity"]),wordBreak:"break-all"}})),ot=f(_,{label:"EditableInput__StyledTextContainer"})(({theme:t})=>({"& svg":{[t.breakpoints.up("sm")]:{opacity:0}},"&:hover, &:focus":{"& svg":{"&:hover":{color:t.color.black},color:t.color.grey1,opacity:1}},alignItems:"center",display:"flex",justifyContent:"flex-start",position:"relative"})),lt=f(q,{label:"EditableInput__StyledButton"})(()=>({height:24,marginTop:0,minHeight:"auto",minWidth:"auto",padding:0,position:"absolute",right:10,width:24})),rt=f(Qe,{label:"EditableInput__StyledEdit"})(({theme:t})=>({"&:hover, &:focus":{color:t.palette.primary.light},border:"1px solid transparent",color:t.palette.text.primary,fontSize:22,margin:"0 10px"})),dt=f(_,{label:"EditableInput__StyledEditingContainer"})(()=>({alignItems:"center",border:"1px solid transparent",display:"flex",fontSize:22,gap:2,justifyContent:"flex-start",position:"relative"})),ct=f(fe,{label:"EditableInput__StyledTextField"})(({theme:t,...i})=>({"& .MuiInputBase-input":{padding:"5px 8px",...t.typography.body1,...i.typeVariant==="h1"&&{...t.typography.h1},...i.typeVariant==="h2"&&{...t.typography.h2}},"& .MuiInputBase-root":{backgroundColor:"transparent",borderColor:`${t.palette.primary.main} !important`,boxShadow:"none",maxWidth:170,minHeight:40,[t.breakpoints.up("md")]:{maxWidth:415,width:"100%"}},animation:`${ye} .3s ease-in-out forwards`,margin:0,opacity:0})),gt=t=>{const{cancelEdit:i,className:n,errorText:s,inputText:a,isEditing:l,loading:o,onEdit:g,onInputChange:p,openForEdit:x,text:c,typeVariant:m,...h}=t,b=u=>{u.key==="Enter"&&g(),(u.key==="Escape"||u.key==="Esc")&&i()},C=e.jsx(st,{"aria-label":c,className:n,"data-qa-editable-text":!0,variant:m==="table-cell"?"body1":"h1",children:e.jsx("strong",{children:c})});return!l&&!s?e.jsxs(ot,{className:n,"data-testid":"editable-text",children:[C,e.jsx(lt,{"aria-label":`Edit ${c}`,"data-qa-edit-button":!0,onClick:x,children:e.jsx(rt,{})})]}):e.jsx(ve,{mouseEvent:"onMouseDown",onClickAway:i,children:e.jsxs(dt,{className:n,"data-qa-edit-field":!0,children:[e.jsx(ct,{...h,autoFocus:!0,editable:!0,errorText:s,hideLabel:!0,label:"Edit Label",loading:o,onChange:u=>p(u.target.value),onKeyDown:b,type:"text",typeVariant:m,value:a}),!o&&e.jsxs(e.Fragment,{children:[e.jsx($,{"aria-label":"Save new label","data-qa-save-edit":!0,onClick:()=>g(),size:"small",children:e.jsx(Ye,{})}),e.jsx($,{"aria-label":"Cancel label edit","data-qa-cancel-edit":!0,onClick:i,size:"small",children:e.jsx(je,{})})]})]})})},ee=t=>{const{iconVariant:i,loading:n,onEdit:s,status:a,subText:l,text:o}=t,[g,p]=d.useState(!1),[x,c]=d.useState(o),[m,h]=d.useState(),b=H(),C=()=>{h(void 0),x!==o?s(x).then(()=>p(!1)).catch(y=>h(y.toString())):p(!1)},u=()=>{p(!1),h(void 0)},S=()=>{c(o),p(!0)};return e.jsxs(r,{sx:{margin:0,minHeight:"40px"},alignItems:"center",container:!0,direction:"row",justifyContent:"flex-start",wrap:"nowrap",children:[!g&&i&&e.jsx(r,{className:"py0 px0",children:e.jsx(Se,{style:{marginRight:b.spacing(1)},status:a,variant:i})}),e.jsx(r,{className:"py0",children:e.jsxs(r,{container:!0,children:[e.jsx(r,{className:"py0 px0",children:e.jsx(ut,{cancelEdit:u,errorText:m,inputText:x,isEditing:g,loading:n,onEdit:C,onInputChange:y=>c(y),openForEdit:S,text:o,typeVariant:"table-cell"})}),l&&!g&&e.jsx(r,{className:"py0 px0",xs:12,children:e.jsx(j,{variant:"body1",children:l})})]})})]})},ut=f(gt)(()=>({fontSize:15,paddingRight:20,position:"relative",whiteSpace:"pre-wrap",wordBreak:"break-all"})),pt=f(q,{label:"StyledButton"})({"&:hover":{backgroundColor:"inherit",color:"inherit",textDecoration:"underline"},fontSize:"0.875rem",padding:0,textAlign:"left"}),xt=f("div",{label:"StyledDiv"})(({theme:t})=>({[t.breakpoints.up("md")]:{marginTop:t.spacing(1)}})),mt=f(r,{label:"StyledRootGrid"})(({theme:t})=>({boxSizing:"border-box",display:"flex",flexDirection:"column",flexWrap:"wrap",width:"100%","& a":{color:t.textColors.linkActiveLight},"& a:hover":{color:t.palette.primary.main},[t.breakpoints.down("lg")]:{alignItems:"center",flexDirection:"row"}})),bt=f(r,{label:"StyledUpdatesGrid"})(({theme:t})=>({boxSizing:"border-box",margin:0,[t.breakpoints.down("lg")]:{marginRight:t.spacing(2)}})),te=d.memo(t=>e.jsxs(d.Fragment,{children:[e.jsx(j,{children:e.jsx("strong",{children:t.label})}),e.jsx(j,{children:t.subtext})]})),ht=G(X(t=>t.clientID)),wt=ht(t=>{const{clientID:i,clientLabel:n,lastUpdatedError:s,longviewClientData:a,longviewClientDataLoading:l,longviewClientLastUpdated:o,openPackageDrawer:g,updateLongviewClient:p,userCanModifyClient:x}=t,[c,m]=d.useState(!1),{data:h}=V(),b=U=>(m(!0),p(i,U).then(P=>{m(!1)}).catch(P=>(m(!1),Promise.reject(Q(P,"Error updating label")[0].reason)))),C=w("Hostname not available",["SysInfo","hostname"],a),u=w(null,["Uptime"],a),S=u!==null?`Up ${Ge(u)}`:"Uptime not available",y=w(null,["Packages"],a),D=y?y.length:0,I=Oe(y),T=o!==void 0?`Last updated ${Le(o,{timezone:h==null?void 0:h.timezone})}`:"Latest update time not available",E=l&&!s&&o!==0;return e.jsxs(mt,{container:!0,spacing:2,children:[e.jsx(r,{children:x?e.jsx(ee,{loading:c,onEdit:b,subText:C,text:n}):e.jsx(te,{label:n,subtext:C})}),e.jsx(bt,{children:E?e.jsx(j,{children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsx(j,{children:S}),D>0?e.jsx(pt,{onClick:()=>g(),title:I,children:I}):e.jsx(j,{children:I})]})}),e.jsxs(r,{children:[e.jsx(De,{to:`/longview/clients/${i}`,children:"View Details"}),!E&&e.jsx(xt,{children:e.jsx(j,{sx:{fontSize:"0.75rem"},variant:"caption",children:T})})]})]})}),Ct=t=>{const{clientAPIKey:i,clientID:n,clientLabel:s,installCode:a,triggerDeleteLongviewClient:l,updateLongviewClient:o,userCanModifyClient:g}=t,p=H(),[x,c]=d.useState(!1),m=h=>(c(!0),o(n,h).then(b=>{c(!1)}).catch(b=>(c(!1),Promise.reject(Q(b,"Error updating label")[0].reason))));return e.jsx(k,{sx:{marginBottom:p.spacing(4),padding:p.spacing(3)},"data-testid":n,children:e.jsxs(r,{"aria-label":"Installation instructions for the Longview agent",container:!0,"data-testid":"installation",children:[e.jsxs(r,{xs:11,container:!0,children:[e.jsx(r,{md:3,xs:12,children:g?e.jsx(ee,{loading:x,onEdit:m,subText:"Waiting for data...",text:s}):e.jsx(te,{label:s,subtext:"Waiting for data..."})}),e.jsx(r,{md:9,xs:12,children:e.jsx(Je,{APIKey:i,installationKey:a})})]}),e.jsx(r,{xs:1,children:e.jsx(r,{container:!0,justifyContent:"flex-end",spacing:2,children:e.jsx(r,{children:e.jsx(Z,{longviewClientID:n,longviewClientLabel:s,triggerDeleteLongviewClient:l,userCanModifyClient:g})})})})]})})},ft=t=>{const{clientAPIKey:i,clientID:n,clientInstallKey:s,clientLabel:a,openPackageDrawer:l,triggerDeleteLongviewClient:o,updateLongviewClient:g}=t,{authed:p,lastUpdated:x,lastUpdatedError:c}=He(i,u=>t.getClientStats(i,u).catch(S=>null)),{data:m}=Y(),b=((m==null?void 0:m.longview)||[]).find(u=>u.id===n),C=b?b.permissions==="read_write":!0;return!p||x===0?e.jsx(Ct,{clientAPIKey:i,clientID:n,clientLabel:a,installCode:s,triggerDeleteLongviewClient:o,updateLongviewClient:g,userCanModifyClient:C}):e.jsx(k,{sx:u=>({marginBottom:u.spacing(4)}),"data-testid":n,children:e.jsxs(r,{alignItems:"flex-start","aria-label":"List of Your Longview Clients",container:!0,"data-testid":"longview-client-row",justifyContent:"space-between",padding:1,spacing:2,wrap:"nowrap",children:[e.jsxs(r,{container:!0,xs:11,children:[e.jsx(r,{container:!0,md:3,xs:12,children:e.jsx(wt,{clientID:n,clientLabel:a,lastUpdatedError:c,longviewClientLastUpdated:x,openPackageDrawer:l,updateLongviewClient:g,userCanModifyClient:C})}),e.jsxs(r,{alignItems:"center",container:!0,direction:"row",md:9,mt:-4,spacing:2,xs:12,children:[e.jsx(r,{sm:2,xs:4,children:e.jsx(Re,{clientID:n,lastUpdatedError:c})}),e.jsx(r,{sm:2,xs:4,children:e.jsx(ze,{clientID:n,lastUpdatedError:c})}),e.jsx(r,{sm:2,xs:4,children:e.jsx(Fe,{clientID:n,lastUpdatedError:c})}),e.jsx(r,{sm:2,xs:4,children:e.jsx($e,{clientID:n,lastUpdatedError:c})}),e.jsx(r,{sm:2,xs:4,children:e.jsx(Me,{clientID:n,lastUpdatedError:c})}),e.jsx(r,{sm:2,xs:4,children:e.jsx(Ne,{clientID:n,lastUpdatedError:c})})]})]}),e.jsx(r,{container:!0,justifyContent:"flex-end",xs:1,children:e.jsx(Z,{longviewClientID:n,longviewClientLabel:a,triggerDeleteLongviewClient:o,userCanModifyClient:C})})]})})},yt=G(d.memo,X(t=>t.clientID),J(()=>({})))(ft),vt=d.memo(t=>{const{longviewClientsData:i,openPackageDrawer:n,triggerDeleteLongviewClient:s}=t;return e.jsx(d.Fragment,{children:i.map(a=>e.jsx("div",{"data-qa-longview-client":a.id,children:e.jsx(yt,{openPackageDrawer:()=>n(a.id,a.label),clientAPIKey:a.api_key,clientID:a.id,clientInstallKey:a.install_code,clientLabel:a.label,triggerDeleteLongviewClient:s})},`longview-client-${a.label}`))})}),jt=d.memo(t=>{const{createLongviewClient:i,filteredData:n,loading:s,longviewClientsError:a,longviewClientsLastUpdated:l,longviewClientsLoading:o,longviewClientsResults:g,openPackageDrawer:p,triggerDeleteLongviewClient:x,userCanCreateLongviewClient:c}=t;if(o&&l===0||s&&g===0)return e.jsx(k,{children:e.jsx(Ie,{})});if(a.read&&l===0){const b=a.read[0].reason;return e.jsx(k,{children:e.jsx(ke,{errorText:b})})}if(l!==0&&g===0)return e.jsx(k,{"data-testid":"no-client-list",sx:{alignItems:"center",display:"flex",height:"20em",justifyContent:"center"},children:e.jsx(j,{sx:{fontSize:"1.1em"},variant:"body1",children:c?e.jsxs(d.Fragment,{children:["You have no Longview clients configured."," ",e.jsx(Ee,{onClick:i,children:"Click here to add one."})]}):"You have no Longview clients configured."})});const h=5;return e.jsx(We,{data:n,pageSize:h,children:({count:b,data:C,handlePageChange:u,handlePageSizeChange:S,page:y,pageSize:D})=>e.jsxs(e.Fragment,{children:[e.jsx(_,{flexDirection:"column",children:e.jsx(vt,{longviewClientsData:C,openPackageDrawer:p,triggerDeleteLongviewClient:x})}),n.length>D?e.jsx(qe,{count:b,eventCategory:"Longview Table",fixedSize:!0,handlePageChange:u,handleSizeChange:S,page:y,pageSize:D}):null]})})}),St=t=>{var F;const{getLongviewClients:i}=t,{data:n}=V(),{data:s}=Y(),{data:a}=Pe(),l=!!(n!=null&&n.restricted),o=!!((F=s==null?void 0:s.global)!=null&&F.add_longview),g=!!(a!=null&&a.managed),p=!l||o&&l,[x,c]=d.useState(!1),[m,h]=d.useState(void 0),[b,C]=d.useState(""),u=[{label:"Client Name",value:"name"},{label:"CPU",value:"cpu"},{label:"RAM",value:"ram"},{label:"Swap",value:"swap"},{label:"Load",value:"load"},{label:"Network",value:"network"},{label:"Storage",value:"storage"}],[S,y]=d.useState("name"),[D,I]=d.useState(""),[T,E]=d.useState(!1);d.useEffect(()=>{i()},[i]);const U=d.useCallback((v,A)=>{c(!0),h(v),C(A)},[]),P=()=>{const{history:{push:v}}=t;if(g){v({pathname:"/support/tickets",state:{open:!0,title:"Request for additional Longview clients"}});return}t.history.push("/longview/plan-details")},[ne,R]=d.useState(!1),ae=d.useCallback((v,A)=>{h(v),C(A),R(!0)},[]),{activeSubscription:B,deleteLongviewClient:ie,handleAddClient:se,longviewClientsData:oe,longviewClientsError:le,longviewClientsLastUpdated:re,longviewClientsLoading:de,longviewClientsResults:ce,lvClientData:z,newClientLoading:ge}=t,ue=v=>{I(v)},pe=v=>{y(v.value)},xe=!M(B),me=Object.values(oe),be=kt(D,me,z),he=It(S,be,z);return e.jsxs(d.Fragment,{children:[e.jsx(Te,{segment:"Clients"}),e.jsxs(et,{container:!0,spacing:2,children:[e.jsx(tt,{children:e.jsx(_e,{debounceTime:250,hideLabel:!0,label:"Filter by client label or hostname",onSearch:ue,placeholder:"Filter by client label or hostname"})}),e.jsxs(nt,{children:[e.jsx(j,{sx:{minWidth:"65px"},children:"Sort by: "}),e.jsx(Ue,{value:u.find(v=>v.value===S),hideLabel:!0,isClearable:!1,label:"Sort by",onChange:pe,options:u,small:!0})]})]}),e.jsx(jt,{createLongviewClient:se,filteredData:he,loading:ge,longviewClientsError:le,longviewClientsLastUpdated:re,longviewClientsLoading:de,longviewClientsResults:ce,openPackageDrawer:ae,triggerDeleteLongviewClient:U,userCanCreateLongviewClient:p}),!xe&&e.jsx(Ze,{container:!0,spacing:2,children:e.jsxs(j,{"data-testid":"longview-upgrade",children:[e.jsx(Be,{to:"/longview/plan-details",children:"Upgrade to Longview Pro"})," ","for more clients, longer data retention, and more frequent data updates."]})}),e.jsx(at,{closeDialog:()=>c(!1),deleteClient:ie,open:x,selectedLongviewClientID:m,selectedLongviewClientLabel:b}),e.jsx(Xe,{clientLimit:M(B)?10:B.clients_included,isManaged:g,isOpen:T,onClose:()=>E(!1),onSubmit:P}),e.jsx(Ke,{clientID:m||0,clientLabel:b,isOpen:ne,onClose:()=>R(!1)})]})},Lt=(t,i)=>({lvClientData:t.longviewStats??{}}),Dt=Ae(Lt),nn=G(d.memo,Dt,J())(St),L=(t,i,n="desc")=>{let s;return t>i?s=-1:t<i?s=1:s=0,n==="desc"?s:-s},It=(t,i,n)=>{switch(t){case"name":return i.sort((s,a)=>L(s.label,a.label,"asc"));case"cpu":return i.sort((s,a)=>{const l=O(w(0,[s.id,"data"],n)),o=O(w(0,[a.id,"data"],n));return L(l,o)});case"ram":return i.sort((s,a)=>{const l=W(w({},[s.id,"data"],n)),o=W(w({},[a.id,"data"],n));return L(l,o)});case"swap":return i.sort((s,a)=>{const l=w(0,[s.id,"data","Memory","swap","used",0,"y"],n),o=w(0,[a.id,"data","Memory","swap","used",0,"y"],n);return L(l,o)});case"load":return i.sort((s,a)=>{const l=w(0,[s.id,"data","Load",0,"y"],n),o=w(0,[a.id,"data","Load",0,"y"],n);return L(l,o)});case"network":return i.sort((s,a)=>{const l=K(w(0,[s.id,"data","Network","Interface"],n)),o=K(w(0,[a.id,"data","Network","Interface"],n));return L(l,o)});case"storage":return i.sort((s,a)=>{const l=N(w(0,[s.id,"data"],n)),o=N(w(0,[a.id,"data"],n));return L(l,o)});default:return i}},kt=(t,i,n)=>{if(!t.trim())return i;const s=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),a=new RegExp(`${s}`,"gmi");return i.filter(l=>!!(l.label.match(a)||w("",["data","SysInfo","hostname"],n[l.id]).match(a)))};export{St as LongviewClients,nn as default,kt as filterLongviewClientsByQuery,It as sortClientsBy,L as sortFunc};
