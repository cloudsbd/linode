import{m as X,cx as Z,u as ee,ao as se,bp as te,q as ae,ep as ie,r as n,ee as ne,bj as oe,j as e,ad as g,aa as re,B as k,cQ as ce,bB as B,T as L,a1 as w,f as de,an as le,dE as ue}from"./index-Eksrs3uK.js";import{D as me}from"./DiskSelect-4cJhrQl_.js";import{L as pe}from"./LinodeSelect-y7DOgXsC.js";import{g as ge}from"./getAPIErrorFor-OfQrArkQ.js";import"./RenderGuard-iLW_eACV.js";import"./Autocomplete-XvrzKoAo.js";const xe=X()(t=>({buttonGroup:{marginBottom:t.spacing(2),marginTop:t.spacing(3),[t.breakpoints.down("sm")]:{justifyContent:"flex-end"}},cloudInitCheckboxWrapper:{marginLeft:3,marginTop:t.spacing(2)},container:{"& .MuiFormHelperText-root":{marginBottom:t.spacing(2)},padding:t.spacing(3),paddingBottom:t.spacing(),paddingTop:t.spacing(2)},diskAndPrice:{"& > div":{width:415}},helperText:{marginBottom:t.spacing(),marginTop:t.spacing(2),[t.breakpoints.down("sm")]:{width:"100%"},width:"80%"},rawDiskWarning:{maxWidth:600,width:"100%"}})),he=e.jsxs(L,{children:["Many Linode supported distributions are compatible with cloud-init by default, or you may have installed cloud-init."," ",e.jsx(w,{to:"https://www.linode.com/docs/products/compute/compute-instances/guides/metadata/",children:"Learn more."})]}),ve=t=>{var q;const{changeDescription:E,changeIsCloudInit:_,changeLabel:F,description:j,isCloudInit:x,label:y}=t,{classes:a}=xe(),{enqueueSnackbar:N}=Z(),{push:P}=ee(),{data:o}=se(),{data:r}=te(),W=ae(),{mutateAsync:A}=ie(),[i,M]=n.useState(),[d,T]=n.useState(""),[p,R]=n.useState([]),[C,G]=n.useState(),[H,l]=n.useState(),[$,h]=n.useState(!1),c=!(o!=null&&o.restricted)||!!((q=r==null?void 0:r.global)!=null&&q.add_images),b=o!=null&&o.restricted?(r==null?void 0:r.linode.filter(s=>s.permissions==="read_write").map(s=>s.id))??[]:null;n.useEffect(()=>{i&&(T(""),ne(i.id).then(s=>{const m=s.data.filter(V=>V.filesystem!=="swap");oe(p,m)||R(m)}).catch(s=>{l([{field:"disk_id",reason:"Could not retrieve disks for this Linode."}])}))},[i]);const z=s=>{s!==null&&l(void 0),M(s??void 0)},O=s=>{l(void 0),T(s)},Q=()=>{l(void 0),G(void 0),h(!0),A({cloud_init:x||void 0,description:j??"",diskID:Number(d),label:y}).then(m=>{ue(),h(!1),N("Image scheduled for creation.",{variant:"info"}),P("/images")}).catch(m=>{h(!1),l(le(m,"There was an error creating the image."))})},U=!(!!d&&i),f=p.find(s=>`${s.id}`===d),Y=(f==null?void 0:f.filesystem)==="raw",J=e.jsx(g,{className:a.rawDiskWarning,spacingBottom:32,spacingTop:16,text:be,variant:"warning"}),u=ge({disk_id:"Disk",label:"Label",linode_id:"Linode",region:"Region",size:"Size"},H),v=u("label"),D=u("description"),I=u("none"),K=u("linode_id"),S=u("disk_id");return e.jsxs(re,{className:a.container,children:[c?null:e.jsx(g,{text:"You don't have permissions to create a new Image. Please contact an account administrator for details.",variant:"error"}),I?e.jsx(g,{"data-qa-notice":!0,text:I,variant:"error"}):null,C?e.jsx(g,{"data-qa-notice":!0,text:C,variant:"info"}):null,e.jsx(pe,{optionsFilter:s=>(b==null?void 0:b.includes(s.id))??!0,disabled:!c,errorText:K,onSelectionChange:s=>z(s),required:!0,value:(i==null?void 0:i.id)||null}),e.jsx(k,{alignItems:"flex-end",className:a.diskAndPrice,display:"flex",children:e.jsx(me,{"data-qa-disk-select":!0,disabled:!c,diskError:S,disks:p,handleChange:O,required:!0,selectedDisk:d,updateFor:[p,d,S,a]})}),Y?J:null,W.metadata&&e.jsx(k,{className:a.cloudInitCheckboxWrapper,children:e.jsx(ce,{checked:x,onChange:_,text:"This image is cloud-init compatible",toolTipInteractive:!0,toolTipText:he})}),e.jsxs(e.Fragment,{children:[e.jsx(B,{"data-qa-image-label":!0,disabled:!c,error:!!v,errorText:v,label:"Label",onChange:F,value:y}),e.jsx(B,{"data-qa-image-description":!0,disabled:!c,error:!!D,errorText:D,label:"Description",multiline:!0,onChange:E,rows:1,value:j})]}),e.jsxs(L,{className:a.helperText,variant:"body1",children:["Custom Images are billed at $0.10/GB per month."," ",e.jsxs(w,{to:"https://www.linode.com/docs/products/tools/images/guides/capture-an-image/",children:["Learn more about requirements and considerations."," "]}),"For information about how to check and clean a Linux systemâ€™s disk space,"," ",e.jsx(w,{to:"https://www.linode.com/docs/guides/check-and-clean-linux-disk-space/",children:"read this guide."})]}),e.jsx(k,{alignItems:"center",className:a.buttonGroup,display:"flex",flexWrap:"wrap",justifyContent:"flex-end",children:e.jsx(de,{buttonType:"primary","data-qa-submit":!0,disabled:U||!c,loading:$,onClick:Q,children:"Create Image"})})]})},be="Using a raw disk may fail, as Linode Images cannot be created from disks formatted with custom filesystems.";export{ve as CreateImageTab,ve as default};
