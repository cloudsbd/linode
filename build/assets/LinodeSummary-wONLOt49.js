import{j as a,T as V,C as st,s as w,G as y,aW as q,cb as m,cg as N,co as it,J as D,Z as ct,b as lt,ao as dt,r as O,an as pt,aj as ut,aa as k,E,bI as gt}from"./index-Eksrs3uK.js";import{S as bt}from"./pending-Ji4jJt0E.js";import{L,s as ht}from"./LineGraph-UgU3EQj3.js";import{u as mt}from"./useWindowDimensions-Dnr94FWA.js";import{u as ft,a as xt,S as M,b as vt}from"./stats-RaLCUvLc.js";import{a as _,g as f,b as yt,f as U}from"./statMetrics-2cM1lQIj.js";import{g as A,b as It,c as St,f as wt}from"./utilities-JekaXHyt.js";import"./TableRow-phXfWUGW.js";import"./visuallyHidden-DVicuktI.js";import"./TableHead-Si_pzkLK.js";const T=t=>{const{height:l,loading:n,renderBody:o,title:s}=t;return a.jsxs(a.Fragment,{children:[a.jsx(V,{"data-qa-stats-title":!0,variant:"h2",children:s}),n?a.jsx("div",{style:{minHeight:l,alignItems:"center",display:"flex",justifyContent:"center",width:"100%"},children:a.jsx(st,{mini:!0})}):o()]})},W=t=>it(t,{base10:!0}).formatted,z=t=>({privateIn:f(t.privateIn),privateOut:f(t.privateOut??[]),publicIn:f(t.publicIn),publicOut:f(t.publicOut)}),Ct=t=>{const{rangeSelection:l,stats:n,...o}=t,s=q(),c={privateIn:m([],["data","netv4","private_in"],n),privateOut:m([],["data","netv4","private_out"],n),publicIn:m([],["data","netv4","in"],n),publicOut:m([],["data","netv4","out"],n)},i={privateIn:m([],["data","netv6","private_in"],n),privateOut:m([],["data","netv6","private_out"],n),publicIn:m([],["data","netv6","in"],n),publicOut:m([],["data","netv6","out"],n)},e=z(c),r=z(i),d=N(W,_(e.publicIn.total,e.publicOut.total,c.publicIn.length,r.publicIn.total,r.publicOut.total)),p=N(W,_(r.publicIn.total,r.publicOut.total,r.publicIn.length)),b=Math.max(e.publicIn.max,e.publicOut.max,e.privateIn.max,e.privateOut.max)/8,x=A(b),I=Math.max(r.publicIn.max,r.publicOut.max,r.privateIn.max,r.privateOut.max)/8,v=A(I),u={chartHeight:t.height,rangeSelection:l,theme:s,timezone:t.timezone};return a.jsxs(Tt,{container:!0,spacing:4,xs:12,children:[a.jsx(H,{xs:12,children:a.jsx(T,{renderBody:()=>a.jsx($,{ariaLabel:"IPv4 Network Traffic Graph",data:c,metrics:e,totalTraffic:d,unit:x,...u}),title:`Network — IPv4 (${x}/s)`,...o})}),a.jsx(H,{xs:12,children:a.jsx(T,{renderBody:()=>a.jsx($,{ariaLabel:"IPv6 Network Traffic Graph",data:i,metrics:r,totalTraffic:p,unit:v,...u}),title:`Network — IPv6 (${v}/s)`,...o})})]})},$=t=>{const{ariaLabel:l,chartHeight:n,data:o,metrics:s,rangeSelection:c,theme:i,timezone:e,unit:r}=t,d=It,p=S=>St(S,r),b=S=>wt(S/8),x=o.publicIn,I=o.publicOut,v=o.privateIn,u=o.privateOut;return a.jsx(L,{data:[{backgroundColor:i.graphs.network.inbound,borderColor:"transparent",data:x,label:"Public In"},{backgroundColor:i.graphs.network.outbound,borderColor:"transparent",data:I,label:"Public Out"},{backgroundColor:i.graphs.purple,borderColor:"transparent",data:v,label:"Private In"},{backgroundColor:i.graphs.yellow,borderColor:"transparent",data:u,label:"Private Out"}],legendRows:[{data:s.publicIn,format:d},{data:s.publicOut,format:d},{data:s.privateIn,format:d},{data:s.privateOut,format:d}],accessibleDataTable:{unit:"Kb/s"},ariaLabel:l,chartHeight:n,formatData:p,formatTooltip:b,showToday:c==="24",timezone:e,unit:"/s"})},H=w(y,{label:"StyledGrid"})(({theme:t})=>({"& h2":{fontSize:"1rem"},"&.MuiGrid-item":{padding:t.spacing(2)},backgroundColor:t.bg.offWhite,border:`solid 1px ${t.borderColors.divider}`,[t.breakpoints.down(1100)]:{"&:first-of-type":{marginBottom:t.spacing(2),marginTop:t.spacing(2)}},[t.breakpoints.up(1100)]:{"&:first-of-type":{marginRight:t.spacing(2)}}})),Tt=w(y,{label:"StyledGraphGrid"})(({theme:t})=>({flexWrap:"nowrap",margin:0,padding:0,[t.breakpoints.down(1100)]:{flexWrap:"wrap",marginTop:`-${t.spacing(2)}`}})),jt=t=>{const l=D.local(),n=l.month,o=l.year,s=[["24","Last 24 Hours"]],i=ct(t).startOf("month");let[e,r]=[n,o],d;do{const p=r===o&&e===n?"Last 30 Days":l.set({month:e,year:r}).toFormat("LLL yyyy");s.push([`${r} ${e.toString().padStart(2,"0")}`,p]),e===1?(e=12,r-=1):e-=1,d=D.fromObject({day:1,month:e,year:r})}while(d>=i);return s.map(p=>({label:p[1],value:p[0]}))};ht();const P=160,_t=t=>{const{isBareMetalInstance:l,linodeCreated:n}=t,{linodeId:o}=lt(),s=Number(o),c=q(),{data:i}=dt(),e=(i==null?void 0:i.timezone)||D.local().zoneName,{height:r,width:d}=mt(),p=jt(n),[b,x]=O.useState("24"),[I,v]=b.split(" "),u=b==="24",{data:S,error:J,isLoading:K,refetch:Z}=ft(s,u,n),{data:Q,error:X,isLoading:tt}=xt(s,I,v,!u,n),g=u?S:Q,at=u?K:tt,G=u?J:X,C=G?pt(G,"An error occurred while getting stats.")[0].reason:void 0,R=C&&[vt,M].includes(C),et=h=>{x(h.value)},B=O.useRef(ut(1500,!1,()=>{Z()})).current;O.useEffect(()=>{B()},[d,r,B]);const rt=()=>{const h=(g==null?void 0:g.data.cpu)??[],ot=f(h);return a.jsx(L,{data:[{backgroundColor:c.graphs.cpu.percent,borderColor:"transparent",data:h,label:"CPU %"}],legendRows:[{data:ot,format:yt,legendColor:"blue",legendTitle:"CPU %"}],accessibleDataTable:{unit:"%"},ariaLabel:"CPU Usage Graph",chartHeight:P,showToday:b==="24",timezone:e})},nt=()=>{const h={io:(g==null?void 0:g.data.io.io)??[],swap:(g==null?void 0:g.data.io.swap)??[]};return a.jsx(L,{data:[{backgroundColor:c.graphs.diskIO.read,borderColor:"transparent",data:h.io,label:"I/O Rate"},{backgroundColor:c.graphs.diskIO.swap,borderColor:"transparent",data:h.swap,label:"Swap Rate"}],legendRows:[{data:f(h.io),format:U},{data:f(h.swap),format:U}],accessibleDataTable:{unit:"blocks/s"},ariaLabel:"Disk I/O Graph",chartHeight:P,showToday:b==="24",timezone:e})};if(!o)return null;if(R)return a.jsx(k,{children:a.jsx(E,{errorText:a.jsxs(a.Fragment,{children:[a.jsx("div",{children:a.jsx(Y,{variant:"h2",children:M})}),a.jsx("div",{children:a.jsx(Y,{variant:"body1",children:"CPU, Network, and Disk stats will be available shortly"})})]}),CustomIcon:bt,CustomIconStyles:{height:64,width:64}})});if(C&&!R)return a.jsx(k,{children:a.jsx(E,{CustomIconStyles:{height:64,width:64},errorText:C})});const j={height:P,loading:at,rangeSelection:b,timezone:e};return a.jsx(k,{children:a.jsxs(y,{sx:{width:"100%",margin:0},container:!0,children:[a.jsx(y,{sx:{display:"flex",justifyContent:"flex-end",marginBottom:c.spacing(),padding:0},xs:12,children:a.jsx(Ot,{defaultValue:p[0],hideLabel:!0,id:"chartRange",isClearable:!1,label:"Select Time Range",name:"chartRange",onChange:et,options:p,small:!0})}),l?null:a.jsxs(y,{sx:{flexWrap:"nowrap",margin:0,[c.breakpoints.down(1100)]:{flexWrap:"wrap"}},container:!0,spacing:4,xs:12,children:[a.jsx(F,{xs:12,children:a.jsx(T,{renderBody:rt,title:"CPU (%)",...j})}),a.jsx(F,{xs:12,children:a.jsx(T,{renderBody:nt,title:"Disk I/O (blocks/s)",...j})})]}),a.jsx(Ct,{stats:g,...j})]})})},Ot=w(gt,{label:"StyledSelect"})({maxWidth:150}),F=w(y,{label:"StyledGrid"})(({theme:t})=>({"& h2":{fontSize:"1rem"},"&.MuiGrid-item":{padding:t.spacing(2)},backgroundColor:t.bg.offWhite,border:`solid 1px ${t.borderColors.divider}`,marginBottom:t.spacing(2),[t.breakpoints.up(1100)]:{"&:first-of-type":{marginRight:t.spacing(2)}}})),Y=w(V,{label:"StyledTypography"})(({theme:t})=>({marginTop:t.spacing(),textAlign:"center"}));export{_t as default};
