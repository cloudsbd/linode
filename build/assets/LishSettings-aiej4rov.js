import{aW as B,ao as H,i7 as I,r as o,j as t,Q as M,aa as q,ad as m,T as k,bI as R,B as D,bB as O,f as S,ag as V,bj as W,an as N}from"./index-Eksrs3uK.js";import{r as Q}from"./remove-KHZAQMPH.js";import{l as $}from"./over-27tc0FF7.js";import{s as G}from"./set-2Chj4B2I.js";import{F as J}from"./FormControl-CNHz4Ctl.js";import{g as U}from"./getAPIErrorFor-OfQrArkQ.js";import{s as X}from"./scrollErrorIntoView-6n4Cku1Y.js";import"./assocPath-nNkv7F8U.js";const ie=()=>{const n=B(),{data:e,isLoading:v}=H(),{mutateAsync:P}=I(),[j,i]=o.useState(!1),[u,A]=o.useState((e==null?void 0:e.lish_auth_method)||"password_keys"),[r,l]=o.useState((e==null?void 0:e.authorized_keys)||[]),[d,h]=o.useState(e!=null&&e.authorized_keys?e.authorized_keys.length:1),[z,y]=o.useState([]),[b,g]=o.useState(),w=(e==null?void 0:e.authentication_type)!=="password"?"Password is disabled because Third-Party Authentication has been enabled.":"",c=U({authorized_keys:"ssh public keys",lish_auth_method:"authentication method"},z),p=c("none"),T=c("lish_auth_method"),x=c("authorized_keys"),_=[{isDisabled:(e==null?void 0:e.authentication_type)!=="password",label:"Allow both password and key authentication",value:"password_keys"},{label:"Allow key authentication only",value:"keys_only"},{label:"Disable Lish",value:"disabled"}],C=_.find(a=>(e==null?void 0:e.authentication_type)!=="password"?a.value==="keys_only":a.value===u),E=()=>h(d+1),f=()=>{const a=r.filter(s=>s!=="");y([]),i(!1),P({authorized_keys:a,lish_auth_method:u}).then(s=>{i(!1),g("LISH authentication settings have been updated."),l(s.authorized_keys||[]),h(s.authorized_keys?s.authorized_keys.length:1)}).catch(s=>{i(!1),y(N(s)),g(void 0),X()})},K=a=>A(a.value),F=a=>s=>{l(G($([a]),s.target.value))},L=a=>()=>{l(Q(a,1,r)),h(d-1)};return t.jsxs(t.Fragment,{children:[t.jsx(M,{segment:"LISH Console Settings"}),t.jsxs(q,{children:[b&&t.jsx(m,{text:b,variant:"success"}),x&&t.jsx(m,{text:x,variant:"error"}),p&&t.jsx(m,{text:p,variant:"error"}),t.jsx(k,{sx:{marginBottom:n.spacing(2)},children:"This controls what authentication methods are allowed to connect to the Lish console servers."}),v?null:t.jsxs(t.Fragment,{children:[t.jsx(J,{sx:{display:"flex"},children:t.jsx(R,{textFieldProps:{dataAttrs:{"data-qa-mode-select":!0},tooltipText:w},defaultValue:C,errorText:T,id:"mode-select",isClearable:!1,label:"Authentication Mode",name:"mode-select",onChange:K,options:_})}),Array.from(Array(d)).map((a,s)=>t.jsxs(D,{sx:{margin:`${n.spacing(1)} 0`},children:[t.jsx(O,{sx:{[n.breakpoints.up("md")]:{minWidth:415}},"data-qa-public-key":!0,label:"SSH Public Key",multiline:!0,onChange:F(s),rows:1.75,value:r[s]||""},s),s===0&&typeof r[0]<"u"||s>0?t.jsx(S,{buttonType:"outlined","data-qa-remove":!0,onClick:L(s),sx:{marginTop:n.spacing()},children:"Remove"}):null]},s)),t.jsx(k,{style:{paddingTop:2},children:"Place your SSH public keys here for use with Lish console access."}),t.jsx(S,{buttonType:"outlined",onClick:E,sx:{marginTop:n.spacing()},children:"Add SSH Public Key"})]}),t.jsx(V,{primaryButtonProps:{"data-testid":"save",disabled:u===(e==null?void 0:e.lish_auth_method)&&W(r,e==null?void 0:e.authorized_keys),label:"Save",loading:j,onClick:f}})]})]})};export{ie as LishSettings};
