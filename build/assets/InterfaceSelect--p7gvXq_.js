import{au as ie,ax as le,aN as de,gI as ce,aW as J,r as T,j as e,G as b,ad as pe,B as F,ag as ue,bD as se,q as ne,f5 as ge,ba as ve,bn as ae,an as Ce,aa as be,T as A,a0 as X,bI as H,d0 as z,cQ as Z,c3 as ee,bB as te,a1 as he,bm as Pe,gG as xe,$ as me}from"./index-Eksrs3uK.js";import{L as fe}from"./LinkButton-O1af9aD7.js";import{R as Ve,a as Ie}from"./SelectFirewallPanel-xh9FN-rV.js";import{a as je}from"./constants-jI3mcPVd.js";import{u as Ae}from"./vpcs-qp5yIH1u.js";import{s as Le}from"./scrollErrorIntoView-6n4Cku1Y.js";import{D as Ee}from"./Drawer-A9yKjC3Z.js";import{u as Se,C as Te,V as _e,S as ye}from"./useCreateVPC-U4LUEfXY.js";const Oe=(r,o,i)=>{const a=o.find(l=>l.id===r);return a?a.capabilities.includes(i):!1},Je=(r,o)=>r.filter(i=>i.capabilities.includes(o)),we="vlans",Ne=()=>de(r=>ce(r))().then(({data:r})=>r),De=()=>ie(we,Ne,{...le.longLived}),Re=r=>{const o=J(),{handleSelectVPC:i,onClose:a,open:l,selectedRegion:h}=r,{formik:w,generalAPIError:t,generalSubnetErrorsFromAPI:v,isLoadingCreateVPC:L,onChangeField:P,onCreateVPC:x,regionsData:m,setGeneralAPIError:f,setGeneralSubnetErrorsFromAPI:u,userCannotAddVPC:d}=Se({handleSelectVPC:i,onDrawerClose:a,selectedRegion:h}),{errors:g,handleSubmit:E,resetForm:_,setFieldValue:S,values:V}=w;return T.useEffect(()=>{l&&(_(),u([]),f(void 0))},[l,_,f,u]),e.jsxs(Ee,{onClose:a,open:l,title:"Create VPC",children:[d&&Te,e.jsxs(b,{children:[t?e.jsx(pe,{text:t,variant:"error"}):null,e.jsxs("form",{onSubmit:E,children:[e.jsx(F,{sx:{marginTop:o.spacing(3)},children:e.jsx(_e,{disabled:d,errors:g,isDrawer:!0,onChangeField:P,regions:m,values:V})}),e.jsx(ye,{disabled:d,isDrawer:!0,onChangeField:S,subnetErrors:v,subnets:V.subnets}),e.jsx(ue,{primaryButtonProps:{"data-testid":"submit",disabled:d,label:"Create VPC",loading:L,onClick:x},secondaryButtonProps:{"data-testid":"cancel",label:"Cancel",onClick:a},style:{marginTop:o.spacing(3)}})]})]})]})},q="vpc-errors",ke=r=>{var W;const{assignPublicIPv4Address:o,autoassignIPv4WithinVPC:i,from:a,handleSelectVPC:l,handleSubnetChange:h,handleVPCIPv4Change:w,publicIPv4Error:t,region:v,selectedSubnetId:L,selectedVPCId:P,subnetError:x,toggleAssignPublicIPv4Address:m,toggleAutoassignIPv4WithinVPCEnabled:f,vpcIPv4AddressOfLinode:u,vpcIPv4Error:d,vpcIdError:g}=r,E=J(),_=se(E.breakpoints.down("sm")),S=ne(),{account:V}=ge(),N=ve().data??[],I=Oe(v||"",N,"VPCs"),[y,B]=T.useState(!1),O=ae("VPCs",!!S.vpc,(V==null?void 0:V.capabilities)??[]),{data:c,error:G,isLoading:p}=Ae({},{},O);if(T.useEffect(()=>{(x||d)&&Le(q)},[x,d]),!O)return null;const M=(c==null?void 0:c.data)??[],j=M.reduce((n,k)=>k.region===v?[...n,{label:k.label,value:k.id}]:n,[]),D=a==="linodeCreate",R=a==="linodeConfig";D&&j.unshift({label:"None",value:-1});const $=((W=M.find(n=>n.id===P))==null?void 0:W.subnets.map(n=>({label:`${n.label} (${n.ipv4??"No IPv4 range provided"})`,value:n.id})))??[],Q=G?Ce(G,"Unable to load VPCs")[0].reason:void 0,U=()=>{if(R)return null;const n=j.length<=1?"Allow Linode to communicate in an isolated environment.":"Assign this Linode to an existing VPC.";return e.jsxs(e.Fragment,{children:[n," ",e.jsx(he,{to:"https://www.linode.com/docs/products/networking/vpc/guides/assign-services/",children:"Learn more"}),"."]})};return e.jsxs(e.Fragment,{children:[e.jsxs(be,{sx:n=>({...D&&{marginTop:n.spacing(3)},...R&&{padding:0}}),"data-testid":"vpc-panel",children:[D&&e.jsx(A,{sx:n=>({marginBottom:n.spacing(2)}),variant:"h2",children:"VPC"}),e.jsxs(X,{children:[e.jsx(A,{children:U()}),e.jsx(H,{onChange:n=>{l(n.value)},textFieldProps:{tooltipText:Ve},value:j.find(n=>n.value===P),defaultValue:R?null:j[0],disabled:!I,errorText:g??Q,isClearable:!1,isLoading:p,label:a==="linodeCreate"?"Assign VPC":"VPC",noOptionsMessage:()=>"No VPCs exist in this Linode's region.",options:j,placeholder:"Select a VPC"}),a==="linodeCreate"&&j.length<=1&&I&&e.jsx(A,{sx:n=>({paddingTop:n.spacing(1.5)}),children:"No VPCs exist in the selected region. Click Create VPC to create one."}),a==="linodeCreate"&&(I?e.jsx(Ie,{children:e.jsx(fe,{onClick:()=>B(!0),children:"Create VPC"})}):v&&e.jsx(A,{sx:n=>({paddingTop:n.spacing(1.5)}),children:"VPC is not available in the selected region."})),P!==-1&&I&&e.jsxs(X,{"data-testid":"subnet-and-additional-options-section",children:[e.jsx(H,{onChange:n=>h(n.value),value:$.find(n=>n.value===L)||null,errorGroup:q,errorText:x,isClearable:!1,label:"Subnet",options:$,placeholder:"Select Subnet"}),e.jsx(F,{sx:n=>({marginLeft:"2px",paddingTop:n.spacing()}),alignItems:"center",display:"flex",flexDirection:"row",children:e.jsx(z,{control:e.jsx(Z,{checked:i,onChange:f}),label:e.jsxs(F,{alignItems:"center",display:"flex",flexDirection:"row",children:[e.jsx(A,{noWrap:!_&&a==="linodeConfig",children:"Auto-assign a VPC IPv4 address for this Linode in the VPC"}),e.jsx(ee,{status:"help",text:je})]}),"data-testid":"vpc-ipv4-checkbox"})}),!i&&e.jsx(te,{errorGroup:q,errorText:d,label:"VPC IPv4",onChange:n=>w(n.target.value),required:!i,value:u}),e.jsx(F,{sx:n=>({marginLeft:"2px",marginTop:i?0:n.spacing()}),alignItems:"center",display:"flex",children:e.jsx(z,{control:e.jsx(Z,{checked:o,onChange:m}),label:e.jsxs(F,{alignItems:"center",display:"flex",flexDirection:"row",children:[e.jsx(A,{children:"Assign a public IPv4 address for this Linode"}),e.jsx(ee,{text:"Access the internet through the public IPv4 address using static 1:1 NAT.",status:"help"})]})})}),o&&t&&e.jsx(A,{sx:n=>({color:n.color.red}),children:t})]})]})]}),y&&e.jsx(Re,{handleSelectVPC:n=>l(n),onClose:()=>B(!1),open:y,selectedRegion:v})]})},Ke=r=>{const{errors:o,fromAddonsPanel:i,handleChange:a,ipamAddress:l,label:h,nattedIPv4Address:w,purpose:t,readOnly:v,region:L,regionHasVLANs:P,regionHasVPCs:x,slotNumber:m,subnetId:f,vpcIPv4:u,vpcId:d}=r,g=J(),E=se(g.breakpoints.down(i?"sm":1015)),_=ne(),{data:S}=Pe(),V=ae("VPCs",!!_.vpc,(S==null?void 0:S.capabilities)??[]),[N,K]=T.useState(""),I=Fe(V),{data:y,isLoading:B}=De(),O=(y==null?void 0:y.filter(s=>L?s.region===L:!0).map(s=>({label:s.label,value:s.label})))??[];N&&O.push({label:N,value:N});const[c,G]=T.useState(!u),[p,M]=T.useState(!!w),j=s=>{const C=s.value;a({ipam_address:C==="vlan"?l:"",label:C==="vlan"?h:"",purpose:C})},D=s=>a({ipam_address:s.target.value,label:h,purpose:t}),R=s=>a({ipam_address:l,label:(s==null?void 0:s.value)??"",purpose:t}),$=s=>{s!==d&&a({ipam_address:null,ipv4:{nat_1_1:p?"any":void 0,vpc:c?void 0:u},label:null,purpose:t,subnet_id:void 0,vpc_id:s})},Q=s=>a({ipam_address:null,ipv4:{nat_1_1:p?"any":void 0,vpc:c?void 0:u},label:null,purpose:t,subnet_id:s,vpc_id:d}),U=s=>{const C={ipam_address:null,label:null,purpose:t,subnet_id:f,vpc_id:d};a(p?{...C,ipv4:{nat_1_1:"any",vpc:s}}:{...C,ipv4:{vpc:s}})};T.useEffect(()=>{if(t!=="vpc")return a({ipam_address:l,label:h,purpose:t});const s={ipam_address:null,label:null,purpose:t,subnet_id:f,vpc_id:d};!c&&p?a({...s,ipv4:{nat_1_1:"any",vpc:u}}):c&&p||p?a({...s,ipv4:{nat_1_1:"any"}}):c&&!p?a({...s}):!p&&!c&&a({...s,ipv4:{vpc:u}})},[c,p,t]);const W=s=>{K(s),a({ipam_address:l,label:s,purpose:t})},n=e.jsx(H,{noOptionsMessage:()=>B?"Loading...":"You have no VLANs in this region. Type to create one.",creatable:!0,createOptionPosition:"first",errorText:o.labelError,inputId:`vlan-label-${m}`,isClearable:!0,isDisabled:v,label:"VLAN",onChange:R,onCreateOption:W,options:O,placeholder:"Create or select a VLAN",value:O.find(s=>s.value===h)??null}),k=e.jsx(te,{tooltipOnMouseEnter:()=>xe("IPAM Address Tooltip Hover"),tooltipText:"IPAM address must use IP/netmask format, e.g. 192.0.2.0/24.",disabled:v,errorText:o.ipamError,inputId:`ipam-input-${m}`,label:"IPAM Address",onChange:D,optional:!0,placeholder:"192.0.2.0/24",value:l}),oe=(s,C)=>i?e.jsx(b,{container:!0,children:e.jsxs(b,{sx:{flexDirection:"row",[g.breakpoints.down("sm")]:{flexDirection:"column"}},container:!0,spacing:E?0:4,children:[e.jsx(b,{sm:6,xs:12,children:s}),e.jsx(b,{sm:6,xs:12,children:C})]})}):e.jsx(b,{sm:6,xs:12,children:e.jsxs(X,{children:[s,C]})}),Y=t==="vpc"&&x===!1,re=!Y&&!(t==="vlan"&&P===!1)?null:e.jsxs(A,{"data-testid":"unavailable-in-region-text",sx:{marginTop:g.spacing()},children:[Y?"VPC ":"VLAN "," ",Be]});return e.jsxs(b,{container:!0,children:[i?null:e.jsxs(b,{xs:E?12:6,children:[e.jsx(H,{options:m>0?I:I.filter(s=>s.value!=="none"),value:I.find(s=>s.value===t),disabled:v,isClearable:!1,label:`eth${m}`,onChange:j}),re]}),t==="vlan"&&P!==!1&&oe(n,k),t==="vpc"&&x!==!1&&e.jsx(b,{xs:E?12:6,children:e.jsx(ke,{toggleAssignPublicIPv4Address:()=>M(s=>!s),toggleAutoassignIPv4WithinVPCEnabled:()=>G(s=>!s),assignPublicIPv4Address:p,autoassignIPv4WithinVPC:c,from:"linodeConfig",handleSelectVPC:$,handleSubnetChange:Q,handleVPCIPv4Change:U,publicIPv4Error:o.publicIPv4Error,region:L,selectedSubnetId:f,selectedVPCId:d,subnetError:o.subnetError,vpcIPv4AddressOfLinode:u,vpcIPv4Error:o.vpcIPv4Error,vpcIdError:o.vpcError})}),!i&&e.jsx(me,{sx:{margin:`${g.spacing(4.5)} ${g.spacing()} ${g.spacing(1.5)} `,width:`calc(100% - ${g.spacing(2)})`}})]})},Fe=r=>{const o=[{label:"Public Internet",value:"public"},{label:"VLAN",value:"vlan"},{label:"None",value:"none"}];return r&&o.splice(1,0,{label:"VPC",value:"vpc"}),o},Be="is not available in this Linode's region";export{Ke as I,ke as V,Oe as d,we as q,Je as r};
