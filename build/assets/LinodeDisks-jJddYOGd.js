import{r as x,j as e,d0 as be,s as S,bp as W,ao as ge,b9 as xe,an as fe,cx as F,c as M,dE as Y,ad as _,bB as A,bN as Q,bJ as T,ag as I,en as ye,eo as ke,ep as je,bt as J,af as K,aY as Ce,eq as De,aW as X,bD as we,u as Se,B as Ie,di as q,dt as ze,er as ve,W as Z,es as Le,et as Re,a1 as B,eu as Te,G as P,T as Ae,b as Pe,c3 as Be}from"./index-Eksrs3uK.js";import{A as Ee}from"./AddNewLink-LwviGK8c.js";import{O as Fe}from"./OrderBy-H-bWJCPy.js";import{P as Me}from"./Paginate-XLm_-WxT.js";import{P as _e}from"./PaginationFooter-NHWf7fW2.js";import{T as ee,a as w,b as qe,c as Oe}from"./TableRow-phXfWUGW.js";import{T as $e}from"./TableRowEmpty-aXmC67-Z.js";import{T as Ge}from"./TableRowError-8gKmGX7P.js";import{T as Ve}from"./TableRowLoading-iP7zIRHG.js";import{T as R}from"./TableSortCell-hcsagFzN.js";import{u as O,a as He,b as Ue,c as Ne,d as We}from"./disks-ZTjtBBb6.js";import{u as $}from"./formik.esm-Kap5lsIh.js";import{A as Ye}from"./Autocomplete-XvrzKoAo.js";import{D as G}from"./Drawer-A9yKjC3Z.js";import{R as Qe}from"./Radio-HudVgwMW.js";import{R as Je}from"./RadioGroup-zpRjMzXK.js";import{b as V}from"./formikErrorUtils-jhqfCjwU.js";import{A as Ke}from"./AccessPanel-rD0WgXZZ.js";import{I as Xe}from"./ImageSelect-L2KD_WsZ.js";import{L as Ze}from"./LinodePermissionsError-htxzmi5m.js";import{D as es}from"./DateTimeDisplay-bXC9mIcz.js";import{s as ss}from"./splitAt-pbTnq2Oi.js";import{A as ts}from"./ActionMenu-4CPisA_2.js";import{I as as}from"./InlineMenuAction-d5mRENST.js";import{C as os}from"./Code-HuerkG4_.js";import{T as is}from"./TextTooltip-SPU6hUyt.js";import{T as ns}from"./TableHead-Si_pzkLK.js";const rs=x.memo(o=>{const{modes:s,onChange:i,selected:t}=o;return e.jsx(Je,{"aria-label":"mode","data-qa-mode-radio-group":!0,name:"mode",onChange:i,value:t,children:s.map((n,c)=>e.jsx(be,{control:e.jsx(Qe,{}),"data-qa-radio":n.label,label:n.label,value:n.mode},c))})}),ls=o=>{var k;const{authorizedUsers:s,imageFieldError:i,linodeId:t,onImageChange:n,onPasswordChange:c,password:r,passwordError:d,setAuthorizedUsers:g}=o,{data:u}=W(),{data:b}=ge(),{data:l,error:f}=xe(),h=f?fe(f,"Unable to load Images")[0].reason:void 0,a=(b==null?void 0:b.restricted)&&((k=u==null?void 0:u.linode.find(m=>m.id===t))==null?void 0:k.permissions)!=="read_write";return e.jsxs(x.Fragment,{children:[a&&e.jsx(Ze,{}),e.jsx(Xe,{disabled:a,imageError:h,imageFieldError:i,images:l??[],onSelect:n}),e.jsx(ds,{disabledReason:a?"You don't have permissions to modify this Linode":void 0,authorizedUsers:s,disabled:a,error:d,handleChange:c,password:r||"",setAuthorizedUsers:g})]})},ds=S(Ke,{label:"StyledAccessPanel"})(({theme:o})=>({margin:`${o.spacing(3)} 0 ${o.spacing(3)} 0`,padding:0})),cs=[{label:"Create Empty Disk",mode:"empty"},{label:"Create from Image",mode:"from_image"}],ms=o=>{const{linodeId:s,onClose:i,open:t}=o,{enqueueSnackbar:n}=F(),[c,r]=x.useState("empty"),{data:d}=M(s,t),{data:g}=O(s,t),{mutateAsync:u,reset:b}=He(s),l=se(d,g,0),a=$({enableReinitialize:!0,initialValues:{authorized_users:[],filesystem:"ext4",image:"",label:"",root_pass:"",size:l},async onSubmit(m,C){try{const y=c==="empty"?{filesystem:m.filesystem,label:m.label,size:m.size}:m;await u(y),Y(),n(`Started creation of disk ${m.label}`,{variant:"success"}),i()}catch(y){V(y,C.setFieldError,C.setStatus)}},validationSchema:c==="from_image"?ye:ke});x.useEffect(()=>{t&&(r("empty"),a.resetForm(),b())},[t]);const k=[{label:"raw"},{label:"swap"},{label:"ext3"},{label:"ext4"},{label:"initrd"}];return e.jsx(G,{onClose:i,open:t,title:"Create Disk",children:e.jsxs("form",{onSubmit:a.handleSubmit,children:[e.jsx(rs,{modes:cs,onChange:m=>r(m.target.value),selected:c}),a.status&&e.jsx(_,{errorGroup:"linode-disk-drawer",spacingBottom:8,text:a.status,variant:"error"}),e.jsx(A,{"data-qa-label":!0,errorGroup:"linode-disk-drawer",errorText:a.touched.label?a.errors.label:void 0,label:"Label",name:"label",onBlur:a.handleBlur,onChange:a.handleChange,required:!0,value:a.values.label}),c==="empty"&&e.jsx(Ye,{errorText:a.touched.filesystem?a.errors.filesystem:void 0,onChange:(m,C)=>a.setFieldValue("filesystem",C.label),value:k.find(m=>m.label===a.values.filesystem),disableClearable:!0,label:"Filesystem",onBlur:a.handleBlur,options:k}),c==="from_image"&&e.jsx(ls,{imageFieldError:a.touched.image?a.errors.image:void 0,onImageChange:m=>a.setFieldValue("image",(m==null?void 0:m.value)??null),onPasswordChange:m=>a.setFieldValue("root_pass",m),passwordError:a.touched.root_pass?a.errors.root_pass:void 0,setAuthorizedUsers:m=>a.setFieldValue("authorized_users",m),authorizedUsers:a.values.authorized_users,linodeId:s,password:a.values.root_pass}),e.jsx(A,{InputProps:{endAdornment:e.jsx(Q,{position:"end",children:"MB"})},"data-qa-disk-size":!0,errorText:a.touched.size?a.errors.size:void 0,label:"Size",name:"size",onBlur:a.handleBlur,onChange:a.handleChange,required:!0,type:"number",value:a.values.size}),e.jsxs(T,{style:{marginTop:8},children:["Maximum size: ",l," MB"]}),e.jsx(I,{primaryButtonProps:{"data-testid":"submit-disk-form",label:"Create",loading:a.isSubmitting,type:"submit"},secondaryButtonProps:{label:"Cancel",onClick:i}})]})})},se=(o,s,i)=>!o||!s?0:o.specs.disk-s.reduce((t,n)=>i===n.id?t:t+n.size,0),us=o=>{const{disk:s,linodeId:i,onClose:t,open:n}=o,{enqueueSnackbar:c}=F(),{error:r,isLoading:d,mutateAsync:g,reset:u}=je();J.useEffect(()=>{n&&u()},[n]);const b=async()=>{await g({diskID:(s==null?void 0:s.id)??-1}),c("Image scheduled for creation.",{variant:"info"}),t()},l=r?`I see a notice saying "${r==null?void 0:r[0].reason}" when trying to create an Image from my disk ${s==null?void 0:s.label} (${s==null?void 0:s.id}).`:`I would like to create an Image from my disk ${s==null?void 0:s.label} (${s==null?void 0:s.id}).`;return e.jsx(K,{actions:e.jsx(I,{primaryButtonProps:{label:"Create Image",loading:d,onClick:b},secondaryButtonProps:{label:"Cancel",onClick:t}}),error:r==null?void 0:r[0].reason,onClose:t,open:n,title:`Create Image from ${s==null?void 0:s.label}?`,children:e.jsxs(Ce,{children:["Linode Images are limited to 6144 MB of data per disk by default. Please ensure that your disk content does not exceed this size limit, or"," ",e.jsx(De,{description:l,entity:{id:i,type:"linode_id"},text:"open a support ticket",title:"Increase Image Size Request"})," ","to request a higher limit. Additionally, Linode Images cannot be created if you are using raw disks or disks that have been formatted using custom filesystems."]})})},ps=o=>{const{disk:s,linodeId:i,onClose:t,open:n}=o,{error:c,isLoading:r,mutateAsync:d,reset:g}=Ue(i,(s==null?void 0:s.id)??-1);J.useEffect(()=>{n&&g()},[n]);const u=async()=>{await d(),t()};return e.jsxs(K,{actions:e.jsx(I,{primaryButtonProps:{"data-testid":"confirm-delete",label:"Delete",loading:r,onClick:u},secondaryButtonProps:{"data-testid":"cancel-delete",label:"Cancel",onClick:t},style:{padding:0}}),error:c==null?void 0:c[0].reason,onClose:t,open:n,title:"Confirm Delete",children:["Are you sure you want to delete ",s==null?void 0:s.label,"?"]})},hs=o=>{const s=X(),i=we(s.breakpoints.down("md")),t=Se(),{diskId:n,linodeId:c,linodeStatus:r,onDelete:d,onImagize:g,onRename:u,onResize:b,readOnly:l}=o;let f=r==="offline"?void 0:"Your Linode must be fully powered down in order to perform this action";f=l?"You don't have permissions to perform this action":f;const h=f?{disabled:!0,tooltip:f}:{},a=[{disabled:l,onClick:u,title:"Rename",tooltip:l?f:""},{onClick:b,title:"Resize",...h},{onClick:g,title:"Imagize",...l?h:{}},{onClick:()=>{t.push(`/linodes/${c}/clone/disks?selectedDisk=${n}`)},title:"Clone",...l?h:{}},{onClick:d,title:"Delete",...h}],k=i?0:2,[m,C]=ss(k,a);return e.jsxs(Ie,{alignItems:"center",display:"flex",justifyContent:"flex-end",children:[!i&&m.map(y=>e.jsx(as,{tooltipAnalyticsEvent:y.title==="Resize"?()=>q({action:"Open:tooltip",category:`Disk ${y.title} Flow`,label:`${y.title} help icon tooltip`}):void 0,actionText:y.title,disabled:y.disabled,onClick:y.onClick,tooltip:y.tooltip},y.title)),e.jsx(ts,{actionsList:C,ariaLabel:`Action menu for Disk ${o.label}`})]})},bs=x.memo(o=>{const{inProgressEvents:s}=ze(),i=X(),{disk:t,linodeId:n,linodeStatus:c,onDelete:r,onImagize:d,onRename:g,onResize:u,readOnly:b}=o,l={disk_create:"Creating",disk_delete:"Deleting",disk_resize:"Resizing"},f=Object.keys(l),h=s.find(a=>{var k;return((k=a.secondary_entity)==null?void 0:k.id)===t.id&&f.includes(a.action)});return e.jsxs(ee,{"data-qa-disk":t.label,children:[e.jsx(w,{sx:{width:"20%"},children:t.label}),e.jsx(w,{sx:{width:"10%"},children:t.filesystem}),e.jsx(w,{sx:{width:"15%"},children:h?e.jsxs("div",{style:{alignItems:"center",display:"flex",flexFlow:"row nowrap"},children:[l[h.action]," (",h.percent_complete,"%)",e.jsx(ve,{sx:{paddingLeft:i.spacing(),width:250},max:100,narrow:!0,rounded:!0,value:(h==null?void 0:h.percent_complete)??0})]}):`${t.size} MB`}),e.jsx(Z,{mdDown:!0,children:e.jsx(w,{sx:{width:"20%"},children:e.jsx(es,{value:t.created})})}),e.jsx(w,{children:e.jsx(hs,{diskId:t.id,label:t.label,linodeId:n,linodeStatus:c||"offline",onDelete:r,onImagize:d,onRename:g,onResize:u,readOnly:b})})]})}),gs=Le({label:Re().required("Label is required.").min(3,"Label must contain between 3 and 32 characters.").max(32,"Label must contain between 3 and 32 characters.")}),xs=o=>{const{disk:s,linodeId:i,onClose:t,open:n}=o,{mutateAsync:c,reset:r}=Ne(i,(s==null?void 0:s.id)??-1),d=$({enableReinitialize:!0,initialValues:{label:(s==null?void 0:s.label)??""},async onSubmit(g,u){try{await c(g),t()}catch(b){V(b,u.setFieldError,u.setStatus)}},validateOnChange:!0,validationSchema:gs});return x.useEffect(()=>{n&&(d.resetForm(),r())},[n]),e.jsx(G,{onClose:t,open:n,title:"Rename Disk",children:e.jsxs("form",{onSubmit:d.handleSubmit,children:[d.status&&e.jsx(_,{errorGroup:"linode-disk-drawer",spacingBottom:8,text:d.status,variant:"error"}),e.jsx(A,{"data-qa-label":!0,errorGroup:"linode-disk-drawer",errorText:d.errors.label,label:"Label",name:"label",onBlur:d.handleBlur,onChange:d.handleChange,required:!0,value:d.values.label}),e.jsx(I,{primaryButtonProps:{"data-testid":"submit-disk-form",label:"Rename",loading:d.isSubmitting,type:"submit"},secondaryButtonProps:{label:"Cancel",onClick:t}})]})})},E=o=>{q({action:"Click:link",category:"Disk Resize Flow",label:o})},fs=o=>{const{disk:s,linodeId:i,onClose:t,open:n}=o,{enqueueSnackbar:c}=F(),{mutateAsync:r,reset:d}=We(i,(s==null?void 0:s.id)??-1),{data:g}=O(i,n),{data:u}=M(i,n),b=se(u,g,(s==null?void 0:s.id)??0),l=$({enableReinitialize:!0,initialValues:{size:(s==null?void 0:s.size)??b},async onSubmit(f,h){try{await r(f),Y(),c("Disk queued for resizing.",{variant:"success"}),t()}catch(a){V(a,h.setFieldError,h.setStatus)}},validateOnChange:!0,validationSchema:Te});return x.useEffect(()=>{n&&(l.resetForm(),d())},[n]),e.jsx(G,{onClose:t,open:n,title:`Resize ${s==null?void 0:s.label}`,children:e.jsxs("form",{onSubmit:l.handleSubmit,children:[l.status&&e.jsx(_,{errorGroup:"linode-disk-drawer",spacingBottom:8,text:l.status,variant:"error"}),e.jsxs(T,{children:["The size of a Linode Compute Instance’s disk can be increased or decreased as needed.",e.jsx(ks,{onClick:()=>{E("Learn more about restrictions to keep in mind.")},to:"https://www.linode.com/docs/products/compute/compute-instances/guides/disks-and-storage/",children:"Learn more about restrictions to keep in mind."})]}),e.jsx(A,{InputProps:{endAdornment:e.jsx(Q,{position:"end",children:"MB"})},"aria-required":!0,"data-qa-disk-size":!0,errorText:l.errors.size,label:"Size",name:"size",onBlur:l.handleBlur,onChange:l.handleChange,required:!0,type:"number",value:l.values.size}),e.jsxs(T,{style:{marginTop:8},children:["Maximum size: ",b," MB"]}),e.jsxs(T,{children:["Minimum size is determined by how much space the files on the disk are using."," ",e.jsx(is,{displayText:"Check disk usage.",tooltipText:ys})]}),e.jsx(I,{primaryButtonProps:{"data-testid":"submit-disk-form",label:"Resize",loading:l.isSubmitting,type:"submit"},secondaryButtonProps:{label:"Cancel",onClick:t}})]})})},ys=e.jsxs(e.Fragment,{children:["Run the command ",e.jsx(os,{children:"df -h"})," within the Linode’s command line (through"," ",e.jsx(B,{onClick:()=>{E("SSH")},to:"https://www.linode.com/docs/guides/connect-to-server-over-ssh/",children:"SSH"})," ","or"," ",e.jsx(B,{onClick:()=>{E("Lish")},to:"https://www.linode.com/docs/products/compute/compute-instances/guides/lish/",children:"Lish"}),")."]}),ks=S(B,{label:"StyledLink"})(({theme:o})=>({display:"block",marginTop:o.spacing(1)})),js=S(P,{label:"StyledWrapperGrid"})(({theme:o})=>({"&.MuiGrid-item":{padding:5},[o.breakpoints.down("sm")]:{marginLeft:`-${o.spacing(1.5)}`}})),Cs=S(P,{label:"StyledRootGrid"})(({theme:o})=>({backgroundColor:o.color.white,margin:0,width:"100%"})),Ds=S(Ae,{label:"StyledTypography"})({lineHeight:"1.5rem",marginBottom:8,marginLeft:15,marginTop:8}),Xs=()=>{const o=x.useRef(null),{linodeId:s}=Pe(),i=Number(s),{data:t,error:n,isLoading:c}=O(i),{data:r}=M(i),{data:d}=W(),[g,u]=x.useState(!1),[b,l]=x.useState(!1),[f,h]=x.useState(!1),[a,k]=x.useState(!1),[m,C]=x.useState(!1),[y,z]=x.useState(),v=t==null?void 0:t.find(p=>p.id===y),H=(r==null?void 0:r.specs.disk)??0,U=d!==void 0&&d.linode.some(p=>p.id===i&&p.permissions==="read_only"),te=ws(t??[]),N=H&&H>te,ae="You do not have enough unallocated storage to create a Disk. Please choose a different plan with more storage or delete an existing Disk.",oe=p=>{z(p.id),h(!0)},ie=p=>{z(p.id),k(!0)},ne=p=>{z(p.id),u(!0)},re=p=>{z(p.id),C(!0)},le=p=>{var D;return n?e.jsx(Ge,{colSpan:5,message:(D=n[0])==null?void 0:D.reason}):c?e.jsx(Ve,{columns:5,rows:1}):(p==null?void 0:p.length)===0?e.jsx($e,{colSpan:5}):p==null?void 0:p.map(j=>e.jsx(bs,{disk:j,linodeId:i,linodeStatus:(r==null?void 0:r.status)??"offline",onDelete:()=>ne(j),onImagize:()=>re(j),onRename:()=>oe(j),onResize:()=>ie(j),readOnly:U},j.id))};return e.jsxs(x.Fragment,{children:[e.jsxs(Cs,{alignItems:"flex-end",container:!0,justifyContent:"space-between",spacing:1,children:[e.jsx(P,{className:"p0",ref:o,children:e.jsx(Ds,{variant:"h3",children:"Disks"})}),e.jsxs("span",{style:{display:"flex",flexDirection:"row"},children:[N?void 0:e.jsx(Be,{tooltipAnalyticsEvent:()=>q({action:"Open:tooltip",category:"Disk Resize Flow",label:"Add a Disk help icon tooltip"}),status:"help",text:ae}),e.jsx(js,{children:e.jsx(Ee,{disabled:U||!N,label:"Add a Disk",onClick:()=>l(!0)})})]})]}),e.jsx(Fe,{data:t??[],order:"asc",orderBy:"created",preferenceKey:"linode-disks",children:({data:p,handleOrderChange:D,order:j,orderBy:L})=>e.jsx(Me,{data:p,scrollToRef:o,children:({count:de,data:ce,handlePageChange:me,handlePageSizeChange:ue,page:pe,pageSize:he})=>e.jsxs(x.Fragment,{children:[e.jsx(P,{xs:12,children:e.jsxs(qe,{"aria-label":"List of Disks",children:[e.jsx(ns,{children:e.jsxs(ee,{children:[e.jsx(R,{active:L==="label",direction:j,handleClick:D,label:"label",children:"Label"}),e.jsx(R,{active:L==="filesystem",direction:j,handleClick:D,label:"filesystem",children:"Type"}),e.jsx(R,{active:L==="size",direction:j,handleClick:D,label:"size",children:"Size"}),e.jsx(Z,{mdDown:!0,children:e.jsx(R,{active:L==="created",direction:j,handleClick:D,label:"created",children:"Created"})}),e.jsx(w,{})]})}),e.jsx(Oe,{children:le(ce)})]})}),e.jsx(_e,{count:de,eventCategory:"linode disks",handlePageChange:me,handleSizeChange:ue,page:pe,pageSize:he})]})})}),e.jsx(ps,{disk:v,linodeId:i,onClose:()=>u(!1),open:g}),e.jsx(ms,{linodeId:i,onClose:()=>l(!1),open:b}),e.jsx(xs,{disk:v,linodeId:i,onClose:()=>h(!1),open:f}),e.jsx(fs,{disk:v,linodeId:i,onClose:()=>k(!1),open:a}),e.jsx(us,{disk:v,linodeId:i,onClose:()=>C(!1),open:m})]})},ws=o=>o.reduce((s,i)=>i.size+s,0);export{Xs as L,Cs as S,ws as a,Ds as b};
