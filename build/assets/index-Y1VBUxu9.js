import{m as F,kl as P,ba as R,j as s,T as t,B as i,dz as H,c3 as h,ex as M,aW as Y,cx as $,r as b,mn as G,f as _,mo as O,C as U,mp as q,bM as Q,aa as W,G as C,$ as J,a1 as V}from"./index-Eksrs3uK.js";import{A as X}from"./AccessControls-OuapwWFu.js";import{S as K}from"./StatusIcon-RuV8PvAV.js";import{a as Z,d as ss}from"./DatabaseRow-eP9fQ9jC.js";import{S as es}from"./lke-download-Hz_dthl6.js";import{C as u}from"./CopyTooltip-mIyzAQ7E.js";import{d as as}from"./downloadFile-7KribbgA.js";import"./AddNewLink-LwviGK8c.js";import"./InlineMenuAction-d5mRENST.js";import"./TableRow-phXfWUGW.js";import"./ipUtils-P4y3JNCT.js";import"./ipaddr-jlottelM.js";import"./formik.esm-Kap5lsIh.js";import"./Drawer-A9yKjC3Z.js";import"./MultipleIPInput-NQt3M-F3.js";import"./FirewallRuleDrawer.utils-gE7QU4cL.js";import"./uniq-xa8_MmzW.js";import"./_contains-91K6xqrF.js";import"./shared-QcuPM2Px.js";import"./sortBy-avzW26A0.js";import"./formikErrorUtils-jhqfCjwU.js";import"./index-Y5esPPk-.js";const ns=F()(n=>({configs:{fontSize:"0.875rem",lineHeight:"22px"},header:{marginBottom:n.spacing(2)},label:{fontFamily:n.font.bold,lineHeight:"22px",width:n.spacing(13)},status:{alignItems:"center",display:"flex",textTransform:"capitalize"}})),ts=n=>{const{classes:e}=ns(),{database:a}=n,{data:d}=P(),{data:x}=R(),l=x==null?void 0:x.find(g=>g.id===a.region),p=d==null?void 0:d.find(g=>g.id===(a==null?void 0:a.type));if(!a||!p)return null;const f=a.cluster_size===1?"Primary":`Primary +${a.cluster_size-1} replicas`,m={marginLeft:"4px",padding:"0px"},o="The total disk size is smaller than the selected plan capacity due to the OS overhead.";return s.jsxs(s.Fragment,{children:[s.jsx(t,{className:e.header,variant:"h3",children:"Cluster Configuration"}),s.jsxs("div",{className:e.configs,"data-qa-cluster-config":!0,children:[s.jsxs(i,{display:"flex",children:[s.jsx(t,{className:e.label,children:"Status"}),s.jsxs("span",{className:e.status,children:[s.jsx(K,{status:Z[a.status]}),a.status]})]}),s.jsxs(i,{display:"flex",children:[s.jsx(t,{className:e.label,children:"Version"}),ss[a.engine]," v",a.version]}),s.jsxs(i,{display:"flex",children:[s.jsx(t,{className:e.label,children:"Nodes"}),f]}),s.jsxs(i,{display:"flex",style:{marginBottom:12},children:[s.jsx(t,{className:e.label,children:"Region"}),(l==null?void 0:l.label)??a.region]}),s.jsxs(i,{display:"flex",children:[s.jsx(t,{className:e.label,children:"Plan"}),H(p.label)]}),s.jsxs(i,{display:"flex",children:[s.jsx(t,{className:e.label,children:"RAM"}),p.memory/1024," GB"]}),s.jsxs(i,{display:"flex",children:[s.jsx(t,{className:e.label,children:"CPUs"}),p.vcpus]}),a.total_disk_size_gb?s.jsxs(s.Fragment,{children:[s.jsxs(i,{display:"flex",children:[s.jsx(t,{className:e.label,children:"Total Disk Size"}),a.total_disk_size_gb," GB",s.jsx(h,{status:"help",sxTooltipIcon:m,text:o})]}),s.jsxs(i,{display:"flex",children:[s.jsx(t,{className:e.label,children:"Used"}),a.used_disk_size_gb," GB"]})]}):s.jsxs(i,{display:"flex",children:[s.jsx(t,{className:e.label,children:"Storage"}),M(p.disk,!0)]})]})]})},is=F()(n=>({actionBtnsCtn:{display:"flex",justifyContent:"flex-end",padding:`${n.spacing(1)} 0`},caCertBtn:{"& svg":{marginRight:n.spacing()},"&:hover":{backgroundColor:"transparent",opacity:.7},"&[disabled]":{"& g":{stroke:"#cdd0d5"},"&:hover":{backgroundColor:"inherit",textDecoration:"none"},backgroundColor:"transparent",color:"#cdd0d5",cursor:"default"},color:n.palette.primary.main,fontFamily:n.font.bold,fontSize:"0.875rem",lineHeight:"1.125rem",marginLeft:n.spacing(),minHeight:"auto",minWidth:"auto",padding:0},connectionDetailsCtn:{"& p":{lineHeight:"1.5rem"},"& span":{fontFamily:n.font.bold},background:n.bg.bgAccessRow,border:`1px solid ${n.name==="light"?"#ccc":"#222"}`,padding:"8px 15px"},copyToolTip:{"& svg":{color:n.palette.primary.main,height:"16px !important",width:"16px !important"},marginRight:12},error:{color:n.color.red,marginLeft:n.spacing(2)},header:{marginBottom:n.spacing(2)},inlineCopyToolTip:{"& svg":{height:"16px",width:"16px"},"&:hover":{backgroundColor:"transparent"},display:"inline-flex",marginLeft:4},progressCtn:{"& circle":{stroke:n.palette.primary.main},alignSelf:"flex-end",marginBottom:2,marginLeft:22},provisioningText:{fontFamily:n.font.normal,fontStyle:"italic"},showBtn:{color:n.palette.primary.main,fontSize:"0.875rem",marginLeft:n.spacing(),minHeight:"auto",minWidth:"auto",padding:0}})),j={marginLeft:"4px",padding:"0px"},rs="A private network host and a private IP can only be used to access a Database Cluster from Linodes in the same data center and will not incur transfer costs.",A="This is a public hostname. Coming soon: connect to your MongoDB clusters using private IPs",os=n=>{var N,B,k;const{database:e}=n,{classes:a}=is(),d=Y(),{enqueueSnackbar:x}=$(),[l,p]=b.useState(!1),[f,m]=b.useState(!1),{data:o,error:g,isLoading:L,refetch:y}=G(e.engine,e.id),v=l&&o?o==null?void 0:o.password:"••••••••••",z=()=>{p(r=>!r)},w=e.engine==="mongodb"&&e.cluster_size>1;b.useEffect(()=>{l&&!o&&y()},[o,y,l]);const I=()=>{m(!0),q(e.engine,e.id).then(r=>{try{const c=window.atob(r.ca_certificate);as(`${e.label}-ca-certificate.crt`,c),m(!1)}catch{x("Error parsing your CA Certificate file",{variant:"error"}),m(!1);return}}).catch(r=>{const c=Q(r,"Unable to download your CA Certificate");m(!1),x(c,{variant:"error"})})},S=["failed","provisioning"].includes(e.status),T=e.status==="provisioning",D=(r,c)=>s.jsx(_,{className:a.showBtn,disabled:S,onClick:r,children:c}),E=s.jsxs(s.Fragment,{children:[s.jsxs(_,{className:a.caCertBtn,disabled:T,loading:f,onClick:I,children:[s.jsx(es,{}),"Download CA Certificate"]}),T?s.jsx("span",{className:"tooltipIcon",children:s.jsx(h,{status:"help",sxTooltipIcon:j,text:"Your Database Cluster is currently provisioning."})}):null]});return s.jsxs(s.Fragment,{children:[s.jsx(t,{className:a.header,variant:"h3",children:"Connection Details"}),s.jsxs(i,{className:a.connectionDetailsCtn,"data-qa-connection-details":!0,children:[s.jsxs(t,{children:[s.jsx("span",{children:"username"})," ="," ",e.engine==="postgresql"?"linpostgres":O]}),s.jsxs(i,{display:"flex",children:[s.jsxs(t,{children:[s.jsx("span",{children:"password"})," = ",v]}),L?s.jsx("div",{className:a.progressCtn,children:s.jsx(U,{mini:!0,noPadding:!0,size:12})}):g?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:a.error,children:"Error retrieving credentials."}),D(()=>y(),"Retry")]}):D(z,l&&o?"Hide":"Show"),S?s.jsx(h,{text:e.status==="provisioning"?"Your Database Cluster is currently provisioning.":"Your root password is unavailable when your Database Cluster has failed.",status:"help",sxTooltipIcon:j}):null,l&&o?s.jsx(u,{className:a.inlineCopyToolTip,text:v}):null]}),s.jsx(i,{children:w?s.jsxs(s.Fragment,{children:[s.jsxs(t,{children:[s.jsx("span",{children:"hosts"})," ="," ",!e.peers||e.peers.length===0?s.jsx("span",{className:a.provisioningText,children:"Your hostnames will appear here once they are available."}):null]}),e.peers&&e.peers.length>0?e.peers.map((r,c)=>s.jsxs(i,{alignItems:"center",display:"flex",flexDirection:"row",children:[s.jsx(t,{style:{marginBottom:0,marginLeft:16,marginTop:0},children:s.jsx("span",{style:{fontFamily:d.font.normal},children:r})}),s.jsx(u,{className:a.inlineCopyToolTip,text:r}),c===0?s.jsx(h,{status:"help",sxTooltipIcon:j,text:A}):null]},r)):null]}):s.jsx(i,{alignItems:"center",display:"flex",flexDirection:"row",children:(N=e.hosts)!=null&&N.primary?s.jsxs(s.Fragment,{children:[s.jsxs(t,{children:[s.jsx("span",{children:"host"})," ="," ",s.jsx("span",{style:{fontFamily:d.font.normal},children:(B=e.hosts)==null?void 0:B.primary})," "]}),s.jsx(u,{className:a.inlineCopyToolTip,text:(k=e.hosts)==null?void 0:k.primary}),e.engine==="mongodb"?s.jsx(h,{status:"help",sxTooltipIcon:j,text:A}):null]}):s.jsxs(t,{children:[s.jsx("span",{children:"host"})," ="," ",s.jsx("span",{className:a.provisioningText,children:"Your hostname will appear here once it is available."})]})})}),e.hosts.secondary?s.jsxs(i,{alignItems:"center",display:"flex",flexDirection:"row",children:[s.jsxs(t,{children:[s.jsx("span",{children:"private network host"})," = ",e.hosts.secondary]}),s.jsx(u,{className:a.inlineCopyToolTip,text:e.hosts.secondary}),s.jsx(h,{status:"help",sxTooltipIcon:j,text:rs})]}):null,s.jsxs(t,{children:[s.jsx("span",{children:"port"})," = ",e.port]}),w?e.replica_set?s.jsxs(i,{alignItems:"center",display:"flex",flexDirection:"row",children:[s.jsxs(t,{children:[s.jsx("span",{children:"replica set"})," ="," ",s.jsx("span",{style:{fontFamily:d.font.normal},children:e.replica_set})]}),s.jsx(u,{className:a.inlineCopyToolTip,text:e.replica_set})]}):s.jsxs(t,{children:[s.jsx("span",{children:"replica set"})," ="," ",s.jsx("span",{className:a.provisioningText,children:"Your replica set will appear here once it is available."})]}):null,s.jsxs(t,{children:[s.jsx("span",{children:"ssl"})," = ",e.ssl_connection?"ENABLED":"DISABLED"]})]}),s.jsx("div",{className:a.actionBtnsCtn,children:e.ssl_connection?E:null})]})},ls=n=>{const{database:e}=n,a=s.jsxs(s.Fragment,{children:[s.jsxs(t,{children:["Add IPv4 addresses or ranges that should be authorized to access this cluster. All other public and private connections are denied."," ",s.jsx(V,{to:"https://www.linode.com/docs/products/databases/managed-databases/guides/manage-access-controls/",children:"Learn more"}),"."]}),s.jsx(t,{style:{marginTop:12},children:"You can add or modify access controls after your database cluster is active."})]});return s.jsxs(W,{children:[s.jsxs(C,{container:!0,spacing:2,children:[s.jsx(C,{md:4,sm:12,children:s.jsx(ts,{database:e})}),s.jsx(C,{md:8,sm:12,children:s.jsx(os,{database:e})})]}),s.jsx(J,{spacingBottom:16,spacingTop:28}),s.jsx(X,{database:e,description:a})]})},As=ls;export{As as default};
