import{i9 as H,r as p,j as e,ad as v,bB as g,d0 as P,cQ as E,ag as C,ia as V,af as L,T as B,ib as K,aW as Y,bD as q,ic as G,id as J,Q as X,B as Z,W as x}from"./index-Eksrs3uK.js";import{A as ee}from"./AddNewLink-LwviGK8c.js";import{P as te}from"./PaginationFooter-NHWf7fW2.js";import{b as re,T as w,a as m,c as ae}from"./TableRow-phXfWUGW.js";import{T as se}from"./TableRowEmpty-aXmC67-Z.js";import{T as ne}from"./TableRowError-8gKmGX7P.js";import{T as oe}from"./TableRowLoading-iP7zIRHG.js";import{T as R}from"./TableSortCell-hcsagFzN.js";import{u as le}from"./useOrder-rsUMHEuj.js";import{u as ie}from"./usePagination-Sxr0Tlb7.js";import{S as ce}from"./SecretTokenDialog-Sh51_GwU.js";import{u as F}from"./formik.esm-Kap5lsIh.js";import{D as _}from"./Drawer-A9yKjC3Z.js";import{F as I}from"./FormControl-CNHz4Ctl.js";import{g as M}from"./getAPIErrorFor-OfQrArkQ.js";import{A as ue}from"./ActionMenu-4CPisA_2.js";import{I as de}from"./InlineMenuAction-d5mRENST.js";import{T as me}from"./TableHead-Si_pzkLK.js";import"./Skeleton-iwmO4Yae.js";import"./OrderBy-H-bWJCPy.js";import"./splitAt-pbTnq2Oi.js";import"./CopyTooltip-mIyzAQ7E.js";import"./index-Y5esPPk-.js";import"./download-J2cziBKr.js";import"./downloadFile-7KribbgA.js";const pe=({onClose:t,open:s,showSecret:a})=>{const{error:o,isLoading:r,mutateAsync:i}=H(),n=F({initialValues:{label:"",public:!1,redirect_uri:""},async onSubmit(u){const b=await i(u);t(),a(b.secret)}});p.useEffect(()=>{s&&n.resetForm()},[s]);const c=M({label:"A label",redirect_uri:"A callback URL"},o??void 0);return e.jsxs(_,{onClose:t,open:s,title:"Create OAuth App",children:[c("none")&&e.jsx(v,{text:c("none"),variant:"error"}),e.jsxs("form",{onSubmit:n.handleSubmit,children:[e.jsx(g,{errorText:c("label"),label:"Label",name:"label",onChange:n.handleChange,value:n.values.label}),e.jsx(g,{errorText:c("redirect_uri"),label:"Callback URL",name:"redirect_uri",onChange:n.handleChange,value:n.values.redirect_uri}),e.jsx(I,{children:e.jsx(P,{control:e.jsx(E,{checked:n.values.public,name:"public",onChange:n.handleChange}),label:"Public"})}),e.jsx(C,{primaryButtonProps:{label:"Create",loading:r,type:"submit"},secondaryButtonProps:{label:"Cancel",onClick:t}})]})]})},he=({id:t,label:s,onClose:a,open:o})=>{const{error:r,isLoading:i,mutateAsync:n}=V(t),l=()=>{n().then(()=>{a()})};return e.jsx(L,{actions:e.jsx(C,{primaryButtonProps:{"data-testid":"button-confirm",label:"Delete",loading:i,onClick:l},secondaryButtonProps:{"data-testid":"button-cancel",label:"Cancel",onClick:a}}),error:r==null?void 0:r[0].reason,onClose:a,open:o,title:`Delete ${s}?`,children:e.jsx(B,{children:"Are you sure you want to permanently delete this app?"})})},be=({client:t,onClose:s,open:a})=>{const{error:o,isLoading:r,mutateAsync:i,reset:n}=K((t==null?void 0:t.id)??""),l=F({enableReinitialize:!0,initialValues:{label:t==null?void 0:t.label,redirect_uri:t==null?void 0:t.redirect_uri},async onSubmit(b){await i(b),s()}});p.useEffect(()=>{a&&(n(),l.resetForm())},[a]);const u=M({label:"A label",redirect_uri:"A callback URL"},o??void 0);return e.jsxs(_,{onClose:s,open:a,title:"Create OAuth App",children:[u("none")&&e.jsx(v,{text:u("none"),variant:"error"}),e.jsxs("form",{onSubmit:l.handleSubmit,children:[e.jsx(g,{errorText:u("label"),label:"Label",name:"label",onChange:l.handleChange,value:l.values.label}),e.jsx(g,{errorText:u("redirect_uri"),label:"Callback URL",name:"redirect_uri",onChange:l.handleChange,value:l.values.redirect_uri}),e.jsx(I,{children:e.jsx(P,{control:e.jsx(E,{checked:t==null?void 0:t.public,disabled:!0,name:"public"}),label:"Public"})}),e.jsx(C,{primaryButtonProps:{disabled:!l.dirty,label:"Save Changes",loading:r,type:"submit"},secondaryButtonProps:{label:"Cancel",onClick:s}})]})]})},xe=t=>{const s=Y(),a=q(s.breakpoints.down("md")),o=[{onClick:t.onOpenEditDrawer,title:"Edit"},{onClick:t.onOpenResetDialog,title:"Reset"},{onClick:t.onOpenDeleteDialog,title:"Delete"}];return e.jsx(e.Fragment,{children:a?e.jsx(ue,{actionsList:o,ariaLabel:`Action menu for OAuth Client ${t.label}`}):o.map(r=>e.jsx(de,{actionText:r.title,onClick:r.onClick},r.title))})},ge=({id:t,label:s,onClose:a,open:o,showSecret:r})=>{const{error:i,isLoading:n,mutateAsync:l}=G(t),c=()=>{l().then(u=>{a(),r(u.secret)})};return e.jsx(L,{actions:e.jsx(C,{primaryButtonProps:{label:"Reset Secret",loading:n,onClick:c},secondaryButtonProps:{label:"Cancel",onClick:a}}),error:i==null?void 0:i[0].reason,onClose:a,open:o,title:`Reset secret for ${s}?`,children:e.jsx(B,{children:"Are you sure you want to permanently reset the secret for this app?"})})},T="oauth-clients",We=()=>{const t=ie(1,T),{handleOrderChange:s,order:a,orderBy:o}=le({order:"desc",orderBy:"status"},T),{data:r,error:i,isLoading:n}=J({page:t.page,page_size:t.pageSize},{"+order":a,"+order_by":o}),[l,c]=p.useState(!1),[u,b]=p.useState(!1),[z,D]=p.useState(!1),[U,y]=p.useState(!1),[O,S]=p.useState(),Q=!!O,[j,f]=p.useState(""),h=r==null?void 0:r.data.find(d=>d.id===j),k=d=>{S(d)},N=()=>i?e.jsx(ne,{colSpan:6,message:"We were unable to load your OAuth Clients."}):n?e.jsx(oe,{columns:5,responsive:{1:{smDown:!0},3:{smDown:!0}}}):(r==null?void 0:r.results)===0?e.jsx(se,{colSpan:6}):r==null?void 0:r.data.map(({id:d,label:A,public:W,redirect_uri:$})=>e.jsxs(w,{ariaLabel:A,children:[e.jsx(m,{children:A}),e.jsx(x,{smDown:!0,children:e.jsx(m,{children:W?"Public":"Private"})}),e.jsx(m,{children:d}),e.jsx(x,{smDown:!0,children:e.jsx(m,{children:$})}),e.jsx(m,{actionCell:!0,children:e.jsx(xe,{onOpenDeleteDialog:()=>{f(d),c(!0)},onOpenEditDrawer:()=>{f(d),D(!0)},onOpenResetDialog:()=>{f(d),b(!0)},label:A})})]},d));return e.jsxs(e.Fragment,{children:[e.jsx(X,{segment:"OAuth Apps"}),e.jsx(Z,{display:"flex",justifyContent:"flex-end",marginBottom:1,paddingRight:{lg:0,md:0,sm:1,xs:1},children:e.jsx(ee,{label:"Add an OAuth App",onClick:()=>y(!0)})}),e.jsxs(re,{"aria-label":"List of OAuth Apps",children:[e.jsx(me,{children:e.jsxs(w,{children:[e.jsx(R,{active:o==="label",direction:a,handleClick:s,label:"label",children:"Label"}),e.jsx(x,{smDown:!0,children:e.jsx(R,{active:o==="public",direction:a,handleClick:s,label:"public",children:"Access"})}),e.jsx(m,{children:"ID"}),e.jsx(x,{smDown:!0,children:e.jsx(m,{children:"Callback URL"})}),e.jsx(m,{})]})}),e.jsx(ae,{children:N()})]}),e.jsx(ce,{onClose:()=>S(void 0),open:Q,title:"Client Secret",value:O}),e.jsx(he,{id:j,label:(h==null?void 0:h.label)??"",onClose:()=>c(!1),open:l}),e.jsx(ge,{id:j,label:(h==null?void 0:h.label)??"",onClose:()=>b(!1),open:u,showSecret:k}),e.jsx(pe,{onClose:()=>y(!1),open:U,showSecret:k}),e.jsx(be,{client:h,onClose:()=>D(!1),open:z}),e.jsx(te,{count:(r==null?void 0:r.results)??0,eventCategory:"oauth clients",handlePageChange:t.handlePageChange,handleSizeChange:t.handlePageSizeChange,page:t.page,pageSize:t.pageSize})]})};export{We as default};
