import{cA as pe,cP as we,fV as Ee,ci as ue,ak as ke,j as e,G as c,T as q,bI as K,bJ as A,bB as _,bN as fe,r as B,iU as Ie,$ as Y,ad as U,cp as De,B as Z,f as ee,s as je,d0 as $e,ag as ye,a1 as Te,q as Re,dw as qe,bp as Fe,ao as He,ba as Me,jf as Le,u as Ge,dx as Oe,aW as We,bD as Ke,Q as Ue,aa as Ve,gE as Qe,al as ze,dB as Je,af as Xe,cb as Ye,d7 as z,dD as Ze,jg as et,an as tt,eX as ot}from"./index-Eksrs3uK.js";import{a as nt}from"./append-Xa6QMsiD.js";import{l as _e,o as at}from"./over-27tc0FF7.js";import{S as rt,C as st}from"./SelectRegionPanel-Y2ibm2gz.js";import{L as ct}from"./LandingHeader-JXAVBhqg.js";import{S as it}from"./SelectFirewallPanel-xh9FN-rV.js";import{T as lt}from"./TagsInput-cI8zXYga.js";import{a as dt}from"./RegionSelect-_Z8IGlox.js";import{g as ht}from"./getAPIErrorFor-OfQrArkQ.js";import{N as ut}from"./constants-KokzTiEs.js";import{g as gt,r as pt}from"./dynamicPricing-n5eCZqTg.js";import{s as be}from"./scrollErrorIntoView-6n4Cku1Y.js";import{t as mt}from"./concat-Y0p1CSCT.js";import{S as xt,A as Ct}from"./Autocomplete-XvrzKoAo.js";import{L as ft}from"./LinodeSelect-y7DOgXsC.js";import{p as J}from"./ipUtils-P4y3JNCT.js";import{T as bt}from"./Toggle-AbahDP9J.js";const vt=(t,a)=>{const s=a&&+a;return s&&s!=="NaN"?s:t},no=(t,a)=>pe(mt,we(t,a),s=>vt(0,s)),Pe=()=>({address:"",label:"",mode:"accept",modifyStatus:"new",port:80,weight:100}),Ne=t=>({algorithm:"roundrobin",check:"none",check_attempts:2,check_body:void 0,check_interval:5,check_passive:!0,check_path:void 0,check_timeout:3,cipher_suite:void 0,modifyStatus:"new",nodes:[Pe()],port:t?80:void 0,protocol:"http",proxy_protocol:"none",ssl_cert:void 0,ssl_key:void 0,stickiness:"table"}),kt=t=>({address:t.address,label:t.label,mode:t.mode,port:t.port,weight:+t.weight}),jt=t=>{const a=/^(192\.168\.\d{1,3}\.\d{1,3}):(\d{1,5})$/.exec(t.address);return a?{...t,address:a[1],port:a[2]}:t},ao=t=>t.map(jt),yt=t=>t.map(a=>Ee(s=>s!==void 0,{algorithm:a.algorithm||void 0,check:a.check||void 0,check_attempts:ue(a.check_attempts)?void 0:+a.check_attempts,check_body:_t(a)?a.check_body:void 0,check_interval:ue(a.check_interval)?void 0:+a.check_interval,check_passive:a.check_passive,check_path:Tt(a)?a.check_path:void 0,check_timeout:ue(a.check_timeout)?void 0:+a.check_timeout,cipher_suite:a.cipher_suite||void 0,id:void 0,nodebalancer_id:void 0,nodes:a.nodes.map(kt),nodes_status:void 0,port:a.port?+a.port:void 0,protocol:a.protocol==="https"&&a.ssl_cert==="<REDACTED>"&&a.ssl_key==="<REDACTED>"?void 0:a.protocol||void 0,proxy_protocol:a.protocol==="tcp"?a.proxy_protocol:"none",ssl_cert:a.ssl_cert==="<REDACTED>"?void 0:a.ssl_cert||void 0,ssl_commonname:void 0,ssl_fingerprint:void 0,ssl_key:a.ssl_key==="<REDACTED>"?void 0:a.ssl_key||void 0,stickiness:a.stickiness||void 0})),Tt=t=>(t.check==="http"||t.check==="http_body")&&t.check_path,_t=t=>t.check==="http_body"&&t.check_body,Pt=t=>t?t.filter(a=>!a.field||!a.field.match(/nodes\[[0-9+]\]/)):[],Ae=t=>ke(["algorithm","check_attempts","check_body","check_interval","check_path","check_timeout","check","configs","port","protocol","proxy_protocol","ssl_cert","ssl_key","stickiness","nodes"],Pt(t)),Nt=t=>{if(t==="tcp")return"'TCP Connection' requires a successful TCP handshake.";if(t==="http"||t==="https")return"'HTTP Valid Status' requires a 2xx or 3xx response from the backend node. 'HTTP Body Regex' uses a regex to match against an expected result body."},At=t=>{const{checkBody:a,checkPath:s,configIdx:i,disabled:h,errors:u,forEdit:p,healthCheckAttempts:C,healthCheckInterval:P,healthCheckTimeout:l,healthCheckType:m,protocol:k}=t,y=Ae(u||[]),v=f=>t.onCheckBodyChange(f.target.value),N=f=>t.onCheckPathChange(f.target.value),w=f=>t.onHealthCheckAttemptsChange(f.target.value),S=f=>t.onHealthCheckIntervalChange(f.target.value),I=f=>t.onHealthCheckTimeoutChange(f.target.value),T=f=>t.onHealthCheckTypeChange(f.value),F=Nt(k),E=[{label:"None",value:"none"},{label:"TCP Connection",value:"connection"},{disabled:k==="tcp",label:"HTTP Status",value:"http"},{disabled:k==="tcp",label:"HTTP Body",value:"http_body"}],H=E.find(f=>f.value===m);return e.jsx(c,{md:6,xs:12,children:e.jsxs(c,{container:!0,spacing:2,sx:{padding:1},children:[e.jsx(c,{xs:12,children:e.jsx(q,{"data-qa-active-checks-header":!0,variant:"h2",children:"Active Health Checks"})}),e.jsxs(c,{xs:12,children:[e.jsx(K,{textFieldProps:{dataAttrs:{"data-qa-active-check-select":!0}},disabled:h,errorGroup:p?`${i}`:void 0,errorText:y.check,inputId:`type-${i}`,isClearable:!1,label:"Type",noMarginTop:!0,onChange:T,options:E,small:!0,value:H||E[0]}),e.jsxs(A,{children:["Active health checks proactively check the health of back-end nodes."," ",F]})]}),m!=="none"&&e.jsxs(c,{container:!0,children:[e.jsxs(c,{xs:12,children:[e.jsx(_,{InputProps:{"aria-label":"Active Health Check Interval",endAdornment:e.jsx(fe,{position:"end",children:"seconds"})},"data-qa-active-check-interval":!0,disabled:h,errorGroup:p?`${i}`:void 0,errorText:y.check_interval,label:"Interval",onChange:S,type:"number",value:P}),e.jsx(A,{children:"Seconds between health check probes"})]}),e.jsxs(c,{xs:12,children:[e.jsx(_,{InputProps:{"aria-label":"Active Health Check Timeout",endAdornment:e.jsx(fe,{position:"end",children:"seconds"})},"data-qa-active-check-timeout":!0,disabled:h,errorGroup:p?`${i}`:void 0,errorText:y.check_timeout,label:"Timeout",onChange:I,type:"number",value:l}),e.jsx(A,{children:"Seconds to wait before considering the probe a failure. 1-30. Must be less than check_interval."})]}),e.jsxs(c,{lg:6,xs:12,children:[e.jsx(_,{InputProps:{"aria-label":"Active Health Check Attempts"},"data-qa-active-check-attempts":!0,disabled:h,errorGroup:p?`${i}`:void 0,errorText:y.check_attempts,label:"Attempts",onChange:w,type:"number",value:C}),e.jsx(A,{children:"Number of failed probes before taking a node out of rotation. 1-30"})]}),["http","http_body"].includes(m)&&e.jsx(c,{lg:6,xs:12,children:e.jsx(_,{disabled:h,errorGroup:p?`${i}`:void 0,errorText:y.check_path,label:"Check HTTP Path",onChange:N,required:["http","http_body"].includes(m),value:s||""})}),m==="http_body"&&e.jsx(c,{md:12,xs:12,children:e.jsx(_,{disabled:h,errorGroup:p?`${i}`:void 0,errorText:y.check_body,label:"Expected HTTP Body",onChange:v,required:m==="http_body",value:a})})]})]})})},St=B.memo(t=>{const{handleChange:a,inputId:s,nodeAddress:i,nodeIndex:h}=t,u=p=>{p||a(h,null);const C=p==null?void 0:p.ipv4.find(P=>P.match(J));C&&a(h,C)};return e.jsx(ft,{noOptionsMessage:`No options - please ensure you have at least 1 Linode
      with a private IP located in the selected region.`,optionsFilter:p=>!!p.ipv4.find(C=>C.match(J))&&p.region===t.selectedRegion,renderOption:(p,C)=>e.jsxs(e.Fragment,{children:[e.jsxs(Ie,{sx:{flexGrow:1},children:[e.jsx("strong",{children:p.ipv4.find(P=>P.match(J))}),e.jsx("div",{children:p.label})]}),e.jsx(xt,{visible:C})]}),renderOptionLabel:p=>p.ipv4.find(C=>C.match(J))??"",clearable:!0,disabled:t.disabled,errorText:t.errorText,id:s,label:"IP Address",noMarginTop:!0,onSelectionChange:u,placeholder:"Enter IP Address",value:p=>p.ipv4.some(C=>C===i)})}),ve=[{label:"Accept",value:"accept"},{label:"Reject",value:"reject"},{label:"Backup",value:"backup"},{label:"Drain",value:"drain"}],Bt={DOWN:"error",UP:"success",unknown:"default"},wt=B.memo(t=>{const{configIdx:a,disabled:s,forEdit:i,idx:h,node:u,nodeBalancerRegion:p,onNodeAddressChange:C,onNodeLabelChange:P,onNodeModeChange:l,onNodePortChange:m,onNodeWeightChange:k,removeNode:y}=t;if(u.modifyStatus==="delete")return null;const v=ke(["label","address","weight","port","mode"],u.errors);return e.jsxs(B.Fragment,{children:[e.jsxs(c,{"data-qa-node":!0,sx:{padding:1},xs:12,children:[h!==0&&e.jsx(c,{xs:12,children:e.jsx(Y,{style:{marginBottom:24,marginTop:i?8:24}})}),v.none&&e.jsx(c,{children:e.jsx(U,{text:v.none,variant:"error"})}),e.jsxs(c,{container:!0,spacing:2,children:[e.jsx(c,{sx:{".MuiInputLabel-root":{marginTop:0}},lg:i?2:4,sm:i?4:6,xs:12,children:e.jsx(_,{"data-qa-backend-ip-label":!0,disabled:s,errorGroup:i?`${a}`:void 0,errorText:v.label,inputId:`node-label-${a}-${h}`,inputProps:{"data-node-idx":h},label:"Label",onChange:P,value:u.label})}),u.status&&e.jsxs(c,{lg:2,sm:4,xs:6,children:[e.jsx(Et,{"data-qa-active-checks-header":!0,variant:"h3",children:"Status"}),e.jsx(De,{color:Bt[u.status],label:u.status,sx:{marginTop:1}})]})]})]}),e.jsx(c,{sx:{padding:1},xs:12,children:e.jsxs(c,{container:!0,"data-qa-node":!0,spacing:2,children:[e.jsx(c,{lg:i?2:4,sm:3,xs:12,children:e.jsx(St,{textfieldProps:{dataAttrs:{"data-qa-backend-ip-address":!0}},disabled:s,errorText:v.address,handleChange:C,inputId:`ip-select-node-${a}-${h}`,nodeAddress:u.address,nodeIndex:h,selectedRegion:p})}),e.jsx(c,{lg:2,sm:3,xs:6,children:e.jsx(_,{"data-qa-backend-ip-port":!0,disabled:s,errorGroup:i?`${a}`:void 0,errorText:v.port,inputProps:{"data-node-idx":h},label:"Port",noMarginTop:!0,onChange:m,type:"number",value:u.port})}),e.jsx(c,{lg:2,sm:3,xs:6,children:e.jsx(_,{"data-qa-backend-ip-weight":!0,disabled:s,errorGroup:i?`${a}`:void 0,errorText:v.weight,inputProps:{"data-node-idx":h},label:"Weight",noMarginTop:!0,onChange:k,type:"number",value:u.weight})}),i&&e.jsx(c,{lg:2,sm:3,xs:6,children:e.jsx(Ct,{value:ve.find(N=>N.value===u.mode),disableClearable:!0,disabled:s,errorText:v.mode,label:"Mode",noMarginTop:!0,onChange:(N,w)=>l(h,w.value),options:ve})}),(i||h!==0)&&e.jsx(Z,{alignSelf:"flex-end",paddingBottom:1,children:e.jsx(ee,{disabled:s,onClick:()=>y(h),children:"Remove"})})]},h)})]})}),Et=je(q,{label:"StyledStatusHeader"})(({theme:t})=>({color:t.color.label,fontSize:".9rem",marginTop:`calc(${t.spacing(2)} - 4)`})),It=t=>{const{checkPassive:a,disabled:s}=t,i=(h,u)=>t.onCheckPassiveChange(u);return e.jsx(c,{md:6,sx:{padding:1},xs:12,children:e.jsxs(c,{container:!0,spacing:2,children:[e.jsx(c,{xs:12,children:e.jsx(q,{"data-qa-passive-checks-header":!0,variant:"h2",children:"Passive Checks"})}),e.jsxs(c,{xs:12,children:[e.jsx($e,{control:e.jsx(bt,{checked:a,"data-qa-passive-checks-toggle":a,disabled:s,onChange:i}),label:"Passive Checks"}),e.jsx(A,{children:"Enable passive checks based on observing communication with back-end nodes."})]})]})})},ge="data-node-idx",Dt=t=>{const{algorithm:a,configIdx:s,disabled:i,errors:h,forEdit:u,nodeMessage:p,nodes:C,onSave:P,port:l,privateKey:m,protocol:k,proxyProtocol:y,sessionStickiness:v,sslCertificate:N,submitting:w}=t,S=d=>t.onAlgorithmChange(d.value),I=d=>t.onPortChange(d.target.value),T=d=>t.onPrivateKeyChange(d.target.value),F=d=>{const{healthCheckType:x}=t,{value:D}=d;t.onProtocolChange(d.value),D==="tcp"&&(x==="http"||x==="http_body")&&t.onHealthCheckTypeChange("connection"),D==="http"&&x==="connection"&&t.onHealthCheckTypeChange("http"),D==="https"&&x==="connection"&&t.onHealthCheckTypeChange("http")},E=d=>{t.onProxyProtocolChange(d.value)},H=d=>t.onSessionStickinessChange(d.value),f=d=>t.onSslCertificateChange(d.target.value),te=d=>{const x=d.currentTarget.getAttribute(ge);x&&t.onNodeLabelChange(+x,d.target.value)},oe=d=>{const x=d.currentTarget.getAttribute(ge);x&&t.onNodePortChange(+x,d.target.value)},ne=d=>{const x=d.currentTarget.getAttribute(ge);x&&t.onNodeWeightChange(+x,d.target.value)},ae=(d,x)=>{t.onNodeModeChange(d,x)},re=()=>{t.disabled||t.addNode()},se=d=>{if(t.disabled)return;const{removeNode:x}=t;if(x)return x(d)},j=Ae(h||[]),V=j.none,M=[{label:"TCP",value:"tcp"},{label:"HTTP",value:"http"},{label:"HTTPS",value:"https"}],L=[{label:"None",value:"none"},{label:"v1",value:"v1"},{label:"v2",value:"v2"}],ce=M.find(d=>d.value===k),ie=L.find(d=>d.value===y),G=[{label:"Round Robin",value:"roundrobin"},{label:"Least Connections",value:"leastconn"},{label:"Source",value:"source"}],le=G.find(d=>d.value===a),O=[{label:"None",value:"none"},{label:"Table",value:"table"},{label:"HTTP Cookie",value:"http_cookie"}],de=O.find(d=>d.value===v),W=k==="tcp";return e.jsxs(c,{"data-qa-label-header":!0,xs:12,children:[V&&e.jsx(U,{className:`error-for-scroll-${s}`,text:V,variant:"error"}),e.jsxs(c,{container:!0,spacing:2,children:[e.jsxs(c,{md:3,xs:6,children:[e.jsx(_,{InputProps:{id:`port-${s}`},"data-qa-port":!0,disabled:i,errorGroup:u?`${s}`:void 0,errorText:j.port||j.configs,label:"Port",noMarginTop:!0,onChange:I,required:!0,type:"number",value:l||""}),e.jsx(A,{children:"Listen on this port"})]}),e.jsx(c,{md:3,xs:6,children:e.jsx(K,{textFieldProps:{dataAttrs:{"data-qa-protocol-select":!0}},disabled:i,errorGroup:u?`${s}`:void 0,errorText:j.protocol,inputId:`protocol-${s}`,isClearable:!1,label:"Protocol",noMarginTop:!0,onChange:F,options:M,small:!0,value:ce||M[0]})}),k==="https"&&e.jsxs(c,{container:!0,spacing:2,xs:12,children:[e.jsx(c,{md:5,sm:6,xs:12,children:e.jsx(_,{"data-qa-cert-field":!0,disabled:i,errorGroup:u?`${s}`:void 0,errorText:j.ssl_cert,label:"SSL Certificate",multiline:!0,onChange:f,required:k==="https",rows:3,value:N||""})}),e.jsx(c,{md:5,sm:6,xs:12,children:e.jsx(_,{"data-qa-private-key-field":!0,disabled:i,errorGroup:u?`${s}`:void 0,errorText:j.ssl_key,label:"Private Key",multiline:!0,onChange:T,required:k==="https",rows:3,value:m||""})})]}),W&&e.jsxs(c,{md:6,xs:12,children:[e.jsx(K,{textFieldProps:{dataAttrs:{"data-qa-proxy-protocol-select":!0}},disabled:i,errorGroup:u?`${s}`:void 0,errorText:j.proxy_protocol,inputId:`proxy-protocol-${s}`,isClearable:!1,label:"Proxy Protocol",noMarginTop:!0,onChange:E,options:L,small:!0,value:ie||L[0]}),e.jsxs(A,{children:["Proxy Protocol preserves initial TCP connection information. Please consult"," ",e.jsx(Te,{to:"https://www.linode.com/docs/platform/nodebalancer/nodebalancer-proxypass-configuration/",children:"our Proxy Protocol guide"})," ","for information on the differences between each option."]})]}),e.jsxs(c,{md:W?6:3,xs:6,children:[e.jsx(K,{textFieldProps:{dataAttrs:{"data-qa-algorithm-select":!0}},disabled:i,errorGroup:u?`${s}`:void 0,errorText:j.algorithm,inputId:`algorithm-${s}`,isClearable:!1,label:"Algorithm",noMarginTop:!0,onChange:S,options:G,small:!0,value:le||G[0]}),e.jsx(A,{children:"Roundrobin. Least connections assigns connections to the backend with the least connections. Source uses the clientâ€™s IPv4 address"})]}),e.jsxs(c,{md:3,xs:6,children:[e.jsx(K,{textFieldProps:{dataAttrs:{"data-qa-session-stickiness-select":!0}},disabled:i,errorGroup:u?`${s}`:void 0,errorText:j.stickiness,inputId:`session-stickiness-${s}`,isClearable:!1,label:"Session Stickiness",noMarginTop:!0,onChange:H,options:O,small:!0,value:de||O[1]}),e.jsx(A,{children:"Route subsequent requests from the client to the same backend"})]}),e.jsx(c,{xs:12,children:e.jsx(Y,{})})]}),e.jsxs(c,{container:!0,spacing:2,children:[e.jsx(At,{errorMap:j,...t}),e.jsx(It,{...t}),e.jsx(c,{xs:12,children:e.jsx(Y,{})})]}),e.jsxs(c,{container:!0,spacing:2,children:[e.jsxs(c,{xs:12,children:[p&&e.jsx(c,{xs:12,children:e.jsx(U,{text:p,variant:"info"})}),e.jsx(q,{"data-qa-backend-ip-header":!0,variant:"h2",children:"Backend Nodes"}),j.nodes&&e.jsx(A,{error:!0,children:j.nodes})]}),e.jsx(c,{sx:{paddingBottom:"24px"},xs:12,children:e.jsxs(c,{container:!0,spacing:2,sx:{padding:0},children:[C==null?void 0:C.map((d,x)=>e.jsx(wt,{configIdx:s,disabled:!!i,forEdit:!!u,idx:x,node:d,nodeBalancerRegion:t.nodeBalancerRegion,onNodeAddressChange:t.onNodeAddressChange,onNodeLabelChange:te,onNodeModeChange:ae,onNodePortChange:oe,onNodeWeightChange:ne,removeNode:se},`nb-node-${x}`)),e.jsx(c,{style:u||s!==0?{marginBottom:-16,marginTop:0}:{marginTop:16},xs:12,children:e.jsx(ee,{buttonType:"outlined",disabled:i,onClick:re,children:"Add a Node"})})]})})]}),e.jsxs(B.Fragment,{children:[e.jsx(c,{xs:12,children:e.jsx(Y,{})}),e.jsx(c,{alignItems:"center",container:!0,justifyContent:"flex-end",spacing:2,children:e.jsx($t,{primaryButtonProps:u?{"data-testid":"save-config",disabled:i,label:"Save",loading:w,onClick:P}:void 0,secondaryButtonProps:{"data-testid":"delete-config",disabled:i,label:"Delete",onClick:t.onDelete}})})]})]})},$t=je(ye,{label:"StyledActionsPanel"})(({theme:t})=>({paddingBottom:0,paddingRight:`${t.spacing()} !important`})),Rt={address:"address",label:"label",region:"region",tags:"tags"},X={errors:void 0,idxToDelete:void 0,open:!1,submitting:!1},R={configs:[Ne(!0)]},qt=()=>{var Ce;const t=Re(),{data:a}=qe(),{data:s}=Fe(),{data:i}=He(),{data:h}=Me(),{error:u,isLoading:p,mutateAsync:C}=Le(),P=Ge(),[l,m]=B.useState(R),[k,y]=B.useState(!1),[v,N]=B.useState(X),{mutateAsync:w}=Oe(),S=We(),I=Ke(S.breakpoints.down("md")),T=!!(i!=null&&i.restricted)&&!(s!=null&&s.global.add_nodebalancers),F=()=>{T||m(n=>({...n,configs:[...n.configs,Ne()]}))},E=n=>()=>m(o=>{const r=[...o.configs];return r[n].nodes=[...r[n].nodes,Pe()],{...o,configs:r}}),H=n=>o=>m(r=>{const g=[...r.configs];return g[n].nodes=g[n].nodes.filter((b,Q)=>Q!==o),{...r,configs:g}}),f=(n,o,r,g)=>m(b=>{const Q=[...b.configs],he=[...b.configs[n].nodes];return he[o]={...he[o],[r]:g},Q[n].nodes=he,{...b,configs:Q}}),te=(n,o,r)=>f(n,o,"label",r),oe=(n,o,r)=>{f(n,o,"address",r)},ne=(n,o,r)=>f(n,o,"port",r),ae=(n,o,r)=>f(n,o,"weight",r),re=n=>{m(o=>{const r=[...o.configs];return r[n].ssl_cert="",r[n].ssl_key="",{...o,configs:r}})},se=n=>{m(o=>{const r=[...o.configs];return r[n].check_path=R.configs[0].check_path,r[n].check_body=R.configs[0].check_body,r[n].check_attempts=R.configs[0].check_attempts,r[n].check_timeout=R.configs[0].check_timeout,r[n].check_interval=R.configs[0].check_interval,{...o,configs:r}})},j=()=>{m(n=>{const o=[...n.configs].map(r=>({...r,errors:[],nodes:r.nodes.map(g=>({...g,errors:[]}))}));return{...n,configs:o}})},V=n=>{const r=Se(n).map(g=>pe(at(_e([...g.path]),nt(g.error)),ot([])));m(pe(...r)),be()},M=()=>{const n=z(l);n.configs=yt(n.configs),j(),k&&w({eu_model:!0}).catch(Ze),C(n).then(o=>{P.push(`/nodebalancers/${o.id}/summary`),et(`Region: ${o.region}`)}).catch(o=>{const r=tt(o);V(r.map(g=>({...g,...g.field&&{field:g.field.replace(/(\[|\]\.)/g,"_")}}))),be()})},L=n=>()=>N({...z(X),idxToDelete:n,open:!0}),ce=()=>{N(n=>({...n,errors:void 0,submitting:!0})),m(n=>({...n,configs:n.configs.filter((o,r)=>r!==v.idxToDelete)})),N(z(X))},ie=(n,o,r)=>{m(g=>{const b=[...g.configs];return b[n][o]=r,{...g,configs:b}})},G=n=>{m(o=>({...o,label:n.target.value}))},le=n=>{m(o=>({...o,tags:n.map(r=>r.value)}))},O=()=>{const{configs:n}=l,o=n.reduce((r,g)=>[...r,{...g,nodes:[...g.nodes.map(b=>({...b,address:""}))]}],[]);m(r=>({...r,configs:o}))},de=n=>{l.region!==n&&(m(o=>({...o,region:n})),O())},W=()=>N(z(X)),d=()=>(v.errors||[]).map(n=>n.reason).join(","),x=ht(Rt,u??void 0),D=x("none"),{showGDPRCheckbox:me}=dt({agreements:a,profile:i,regions:h,selectedRegionId:l.region??""}),xe=(Ce=h==null?void 0:h.find(n=>n.id===l.region))==null?void 0:Ce.label,Be=gt({basePrice:ut,regionId:l.region}),$=[];return xe&&$.push({title:xe}),l.firewall_id&&$.push({title:"Firewall Assigned"}),$.push({details:l.configs.length,title:"Configs"}),$.push({details:l.configs.reduce((n,o)=>n+o.nodes.length,0),title:"Nodes"}),l.region&&$.unshift({title:`$${pt(Number(Be))}/month`}),e.jsxs(B.Fragment,{children:[e.jsx(Ue,{segment:"Create a NodeBalancer"}),e.jsx(ct,{breadcrumbProps:{breadcrumbDataAttrs:{"data-qa-create-nodebalancer-header":!0},pathname:"/nodebalancers/create"},title:"Create"}),D&&!T&&e.jsx(U,{spacingTop:8,variant:"error",children:D}),T&&e.jsx(U,{text:"You don't have permissions to create a new NodeBalancer. Please contact an account administrator for details.",important:!0,spacingTop:16,variant:"error"}),e.jsxs(Ve,{children:[e.jsx(_,{disabled:T,errorText:x("label"),label:"NodeBalancer Label",noMarginTop:!0,onChange:G,value:l.label||""}),e.jsx(lt,{value:l.tags?l.tags.map(n=>({label:n,value:n})):[],disabled:T,onChange:le,tagError:x("tags")})]}),e.jsx(rt,{currentCapability:"NodeBalancers",disabled:T,error:x("region"),handleSelection:de,regions:h??[],selectedId:l.region}),t.firewallNodebalancer&&e.jsx(it,{handleFirewallChange:n=>{m(o=>({...o,firewall_id:n>0?n:void 0}))},helperText:e.jsxs(q,{children:["Assign an existing Firewall to this NodeBalancer to control inbound network traffic."," ",e.jsx(Te,{to:Qe,children:"Learn more"}),"."]}),entityType:"nodebalancer",selectedFirewallId:l.firewall_id??-1}),e.jsx(Z,{marginBottom:2,marginTop:2,children:l.configs.map((n,o)=>{const r=g=>b=>ie(o,g,b);return e.jsx(ze,{heading:`Configuration - Port ${l.configs[o].port??""}`,sx:{padding:1},defaultExpanded:!0,children:e.jsx(Dt,{healthCheckAttempts:l.configs[o].check_attempts,healthCheckInterval:l.configs[o].check_interval,healthCheckTimeout:l.configs[o].check_timeout,onHealthCheckTypeChange:g=>{r("check")(g),se(o)},onNodeAddressChange:(g,b)=>oe(o,g,b),onNodeLabelChange:(g,b)=>te(o,g,b),onNodePortChange:(g,b)=>ne(o,g,b),onNodeWeightChange:(g,b)=>ae(o,g,b),onProtocolChange:g=>{r("protocol")(g),re(o)},addNode:E(o),algorithm:l.configs[o].algorithm,checkBody:l.configs[o].check_body,checkPassive:l.configs[o].check_passive,checkPath:l.configs[o].check_path,configIdx:o,disabled:T,errors:n.errors,healthCheckType:l.configs[o].check,nodeBalancerRegion:l.region,nodes:l.configs[o].nodes,onAlgorithmChange:r("algorithm"),onCheckBodyChange:r("check_body"),onCheckPassiveChange:r("check_passive"),onCheckPathChange:r("check_path"),onDelete:L(o),onHealthCheckAttemptsChange:r("check_attempts"),onHealthCheckIntervalChange:r("check_interval"),onHealthCheckTimeoutChange:r("check_timeout"),onPortChange:r("port"),onPrivateKeyChange:r("ssl_key"),onProxyProtocolChange:r("proxy_protocol"),onSessionStickinessChange:r("stickiness"),onSslCertificateChange:r("ssl_cert"),port:l.configs[o].port,privateKey:l.configs[o].ssl_key,protocol:l.configs[o].protocol,proxyProtocol:l.configs[o].proxy_protocol,removeNode:H(o),sessionStickiness:l.configs[o].stickiness,sslCertificate:l.configs[o].ssl_cert})},o)})}),e.jsx(ee,{buttonType:"outlined",disabled:T,onClick:F,sx:I?{marginLeft:S.spacing(2)}:null,children:"Add another Configuration"}),e.jsx(st,{displaySections:$,heading:`Summary ${l.label??""}`}),me&&e.jsx(Z,{display:"flex",children:e.jsx(Je,{checked:k,onChange:n=>y(n.target.checked)})}),e.jsx(Z,{sx:{marginTop:S.spacing(4)},display:"flex",justifyContent:"flex-end",children:e.jsx(ee,{sx:{flexShrink:0,mx:I?S.spacing(1):null},buttonType:"primary","data-qa-deploy-nodebalancer":!0,disabled:me&&!k,loading:p,onClick:M,children:"Create NodeBalancer"})}),e.jsx(Xe,{actions:e.jsx(ye,{primaryButtonProps:{label:"Delete",loading:v.submitting,onClick:ce},secondaryButtonProps:{label:"Cancel",onClick:W},style:{padding:0}}),error:d(),onClose:W,open:v.open,title:"Delete this configuration?",children:e.jsx(q,{children:"Are you sure you want to delete this NodeBalancer Configuration?"})})]})},Ft=t=>a=>_e([...t,...a]),Ht=t=>{let a=t,s=[];const i=new RegExp(/configs_(\d+)_/),h=i.exec(t);h&&h[1]&&(s=[...s,"configs",+h[1]],a=a.replace(i,""));const u=new RegExp(/nodes_(\d+)_/),p=u.exec(t);return p&&p[1]&&(s=[...s,"nodes",+p[1]],a=a.replace(u,"")),{field:a,path:s}},Se=t=>t.reduce((a,s)=>{const h=Ye("",["field"],s).split("|").map(u=>Ht(u));return h.length?[...a,...h.map(u=>({error:{field:u.field,reason:s.reason},path:[...u.path,"errors"]}))]:a},[]),ro=Object.freeze(Object.defineProperty({__proto__:null,default:qt,fieldErrorsToNodePathErrors:Se,lensFrom:Ft},Symbol.toStringTag,{value:"Module"}));export{Dt as N,Ne as a,no as b,Pe as c,ao as d,ro as e,Ft as l,kt as n,jt as p,yt as t};
