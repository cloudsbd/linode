import{u as v,cx as I,ao as E,mq as L,j as e,ap as O,ad as h,an as A,T as x,m as P,Z as N,b as z,r as j,kk as F,mr as H,aa as M}from"./index-Eksrs3uK.js";import{T as k,a as u,b as q,c as Q}from"./TableRow-phXfWUGW.js";import{T as $}from"./TableRowEmpty-aXmC67-Z.js";import{T as y}from"./TableRowError-8gKmGX7P.js";import{T as U}from"./TableRowLoading-iP7zIRHG.js";import{T as W}from"./TableSortCell-hcsagFzN.js";import{u as Y}from"./useOrder-rsUMHEuj.js";import{T as Z}from"./TypeToConfirmDialog-9yjZCCL0.js";import{D as G}from"./DateTimeDisplay-bXC9mIcz.js";import{I as J}from"./InlineMenuAction-d5mRENST.js";import{T as K}from"./TableHead-Si_pzkLK.js";import"./Skeleton-iwmO4Yae.js";import"./OrderBy-H-bWJCPy.js";import"./splitAt-pbTnq2Oi.js";import"./TypeToConfirm-koQ3u5up.js";const V=n=>{const{backup:t,database:a,onClose:r,open:l}=n,i=v(),{enqueueSnackbar:m}=I(),{data:c}=E(),{error:d,isLoading:b,mutateAsync:s}=L(a.engine,a.id,t.id),p=()=>{s().then(()=>{i.push("summary"),m("Your database is being restored.",{variant:"success"}),r()})};return e.jsxs(Z,{entity:{action:"restoration",name:a.label,primaryBtnText:"Restore Database",subType:"Cluster",type:"Database"},title:`Restore from Backup ${O(t.created,{timezone:c==null?void 0:c.timezone})}`,label:"Database Label",loading:b,onClick:p,onClose:r,open:l,children:[d?e.jsx(h,{text:A(d,"Unable to restore this backup.")[0].reason,variant:"error"}):null,e.jsx(h,{variant:"warning",children:e.jsxs(x,{style:{fontSize:"0.875rem"},children:[e.jsx("strong",{children:"Warning:"})," Restoring from a backup will erase all existing data on this cluster."]})})]})},X=P()(()=>({inlineActions:{alignItems:"center",display:"flex",justifyContent:"flex-end"}})),_=n=>{const{classes:t}=X(),{backup:a,onRestore:r}=n,l=[{onClick:()=>r(a.id),title:"Restore"}];return e.jsx("div",{className:t.inlineActions,children:l.map(i=>e.jsx(J,{actionText:i.title,onClick:i.onClick},i.title))})},ee=({backup:n,onRestore:t})=>{const{created:a,id:r}=n;return e.jsxs(k,{children:[e.jsx(u,{children:e.jsx(G,{value:a})}),e.jsx(u,{children:N(a).toRelative()}),e.jsx(u,{children:e.jsx(_,{backup:n,onRestore:t})})]},r)},ae=()=>{const{databaseId:n,engine:t}=z(),[a,r]=j.useState(!1),[l,i]=j.useState(),m=Number(n),{data:c,error:d,isLoading:b}=F(t,m),{data:s,error:p,isLoading:D}=H(t,m),{handleOrderChange:R,order:T,orderBy:B}=Y({order:"desc",orderBy:"created"}),C=o=>{i(o),r(!0)},f=s==null?void 0:s.data.find(o=>o.id===l),w=(o,g)=>T==="asc"?new Date(g.created).getTime()-new Date(o.created).getTime():new Date(o.created).getTime()-new Date(g.created).getTime(),S=()=>d?e.jsx(y,{colSpan:3,message:d[0].reason}):p?e.jsx(y,{colSpan:3,message:p[0].reason}):b||D?e.jsx(U,{columns:3}):(s==null?void 0:s.results)===0?e.jsx($,{colSpan:3,message:"No backups to display."}):s?s.data.sort(w).map(o=>e.jsx(ee,{backup:o,onRestore:C},o.id)):null;return e.jsxs(e.Fragment,{children:[e.jsxs(q,{children:[e.jsx(K,{children:e.jsxs(k,{children:[e.jsx(W,{active:B==="created",direction:T,handleClick:R,label:"created",style:{width:155},children:"Date Created"}),e.jsx(u,{}),e.jsx(u,{style:{width:100}})]})}),e.jsx(Q,{children:S()})]}),e.jsxs(M,{style:{marginTop:16},children:[e.jsx(x,{variant:"h3",children:"Backup Schedule"}),e.jsx(x,{style:{lineHeight:"20px",marginTop:4},children:"A backup of this database is created every 24 hours and each backup is retained for 7 days."})]}),c&&f?e.jsx(V,{backup:f,database:c,onClose:()=>r(!1),open:a}):null]})},fe=ae;export{fe as default};
