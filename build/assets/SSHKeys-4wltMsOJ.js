import{r as u,i4 as T,j as e,af as k,ag as D,T as b,i5 as P,bx as A,cx as F,i6 as I,ad as R,bB as v,eS as L,W as f,Z as z,Q as B,G as C,s as K}from"./index-Eksrs3uK.js";import{A as O}from"./AddNewLink-LwviGK8c.js";import{P as $}from"./PaginationFooter-NHWf7fW2.js";import{T as y,a as d,b as M,c as N}from"./TableRow-phXfWUGW.js";import{T as _}from"./TableRowEmpty-aXmC67-Z.js";import{T as G}from"./TableRowError-8gKmGX7P.js";import{T as U}from"./TableRowLoading-iP7zIRHG.js";import{I as h}from"./InlineMenuAction-d5mRENST.js";import{u as Q}from"./usePagination-Sxr0Tlb7.js";import{C as W}from"./CreateSSHKeyDrawer-NnwCGTeL.js";import{u as q}from"./formik.esm-Kap5lsIh.js";import{D as V}from"./Drawer-A9yKjC3Z.js";import{g as Y}from"./getAPIErrorFor-OfQrArkQ.js";import{T as Z}from"./TableHead-Si_pzkLK.js";import"./Skeleton-iwmO4Yae.js";import"./Code-HuerkG4_.js";import"./formikTrimUtil-tfsUpEEv.js";const J=({id:a,label:n,onClose:t,open:l})=>{const{error:o,isLoading:c,mutateAsync:p}=T(a),m=async()=>{await p(),t()};return e.jsx(k,{actions:e.jsx(D,{primaryButtonProps:{"data-testid":"confirm-delete",label:"Delete",loading:c,onClick:m},secondaryButtonProps:{"data-testid":"cancel-delete",label:"Cancel",onClick:t}}),error:o==null?void 0:o[0].reason,onClose:t,open:l,title:"Delete SSH Key",children:e.jsxs(b,{children:["Are you sure you want to delete SSH key ",n,"?"]})})},X=u.memo(J),ee=a=>{const{onDelete:n,onEdit:t}=a;return e.jsxs(e.Fragment,{children:[e.jsx(h,{actionText:"Edit",onClick:t}),e.jsx(h,{actionText:"Delete",onClick:n})]})};function te(a){var n;try{const t=((n=a.split(" "))==null?void 0:n[1])??"",l=Uint8Array.from(atob(t),c=>c.charCodeAt(0)),o=P(l);return ae(o)}catch(t){return A(`Error ${t} when parsing SSH pubkey: ${a}`),"Error generating fingerprint"}}const ae=a=>a.replace(/(.{2})(?=.)/g,"$1:"),re=({onClose:a,open:n,sshKey:t})=>{const{enqueueSnackbar:l}=F(),{error:o,isLoading:c,mutateAsync:p,reset:m}=I((t==null?void 0:t.id)??-1),s=q({enableReinitialize:!0,initialValues:{label:(t==null?void 0:t.label)??""},async onSubmit(g){await p(g),l("Successfully updated SSH key.",{variant:"success"}),s.resetForm(),a()}});u.useEffect(()=>{n&&(m(),s.resetForm())},[n]);const S=Y({label:"Label"},o??void 0),r=S("none");return e.jsxs(V,{onClose:a,open:n,title:`Edit SSH Key ${t==null?void 0:t.label}`,children:[r&&e.jsx(R,{text:r,variant:"error"}),e.jsxs("form",{onSubmit:s.handleSubmit,children:[e.jsx(v,{errorText:S("label"),label:"Label",name:"label",onChange:s.handleChange,value:s.values.label}),e.jsx(D,{primaryButtonProps:{"data-testid":"submit",disabled:!s.dirty,label:"Save",loading:c,type:"submit"},secondaryButtonProps:{label:"Cancel",onClick:a}})]})]})},ne=u.memo(re),se="ssh-keys",Ee=()=>{const[a,n]=u.useState(!1),[t,l]=u.useState(!1),[o,c]=u.useState(!1),[p,m]=u.useState(-1),s=Q(1,se),S={page:s.page,page_size:s.pageSize},{data:r,error:g,isLoading:j}=L(S),x=r==null?void 0:r.data.find(i=>i.id===p),E=i=>{m(i),n(!0)},w=i=>{m(i),c(!0)},H=u.useCallback(()=>j?e.jsx(U,{columns:4}):(r==null?void 0:r.results)===0?e.jsx(_,{colSpan:4}):g?e.jsx(G,{colSpan:4,message:"Unable to load SSH keys. Please try again."}):r==null?void 0:r.data.map(i=>e.jsxs(y,{children:[e.jsx(d,{children:i.label}),e.jsxs(d,{children:[e.jsx(b,{variant:"body1",children:i.ssh_key.slice(0,26)}),e.jsxs(b,{variant:"body1",children:["Fingerprint: ",te(i.ssh_key)]})]}),e.jsx(f,{smDown:!0,children:e.jsx(d,{children:z(i.created).toRelative()})}),e.jsx(d,{actionCell:!0,children:e.jsx(ee,{onDelete:()=>E(i.id),onEdit:()=>w(i.id)})})]},i.id)),[r,g,j]);return e.jsxs(e.Fragment,{children:[e.jsx(B,{segment:"SSH Keys"}),e.jsx(C,{sx:{margin:0,width:"100%"},alignItems:"flex-end",container:!0,justifyContent:"flex-end",spacing:2,children:e.jsx(ie,{children:e.jsx(O,{label:"Add an SSH Key",onClick:()=>l(!0)})})}),e.jsxs(M,{children:[e.jsx(Z,{children:e.jsxs(y,{children:[e.jsx(d,{children:"Label"}),e.jsx(d,{children:"Key"}),e.jsx(f,{smDown:!0,children:e.jsx(d,{children:"Created"})}),e.jsx(d,{})]})}),e.jsx(N,{children:H()})]}),e.jsx($,{count:(r==null?void 0:r.results)??0,eventCategory:"ssh keys",handlePageChange:s.handlePageChange,handleSizeChange:s.handlePageSizeChange,page:s.page,pageSize:s.pageSize}),e.jsx(X,{id:p,label:x==null?void 0:x.label,onClose:()=>n(!1),open:a}),e.jsx(ne,{onClose:()=>c(!1),open:o,sshKey:x}),e.jsx(W,{onClose:()=>l(!1),open:t})]})},ie=K(C)(({theme:a})=>({paddingRight:0,paddingTop:0,[a.breakpoints.down("md")]:{marginRight:a.spacing()}}));export{Ee as SSHKeys};
