import{bP as $e,bQ as Be,s as Ee,r as g,bX as Ke,bR as Me,bT as ae,j as e,bY as Oe,b_ as Fe,a8 as He,a9 as Ue,m as D,ba as ce,ht as de,bb as J,bd as ue,hv as ze,G as x,cn as H,T as y,cx as B,hJ as pe,hK as _e,B as F,an as ge,C as _,ad as I,a3 as Ve,q as qe,hz as Z,hL as Qe,hM as We,aa as me,cp as Ge,f as R,af as E,ag as A,bM as Ye,hN as Xe,hO as ee,hA as V,hP as Je,dM as Ze,hQ as et,cS as be,hD as xe,hR as he,hS as tt,a1 as nt,d0 as st,bB as ie,hT as ot,aW as at,bD as it,dS as lt,V as rt,N as ct,da as dt,hU as ut,bt as le,E as fe,cQ as pt,hs as gt,hu as mt,aZ as bt,bm as xt,b as ht,e as ft,hV as yt,hE as jt,Q as Ct}from"./index-Eksrs3uK.js";import{L as vt}from"./LandingHeader-JXAVBhqg.js";import{T as kt}from"./TagsPanel-CYEBNrGy.js";import{d as ye,P as je}from"./constants-KokzTiEs.js";import{g as Ce,r as M}from"./dynamicPricing-n5eCZqTg.js";import{g as St,K as Nt,a as wt,E as Tt,b as Dt}from"./KubernetesPlansPanel-yuUO1O8e.js";import{D as Pt,U as It}from"./UpgradeVersionModal-Q5n8Z1EB.js";import{S as Rt}from"./lke-download-Hz_dthl6.js";import{d as ve}from"./downloadFile-7KribbgA.js";import{S as Lt}from"./download-J2cziBKr.js";import{C as Y}from"./CopyTooltip-mIyzAQ7E.js";import{D as te}from"./Drawer-A9yKjC3Z.js";import{W as At}from"./index-C8Ov-8_e.js";import{f as $t}from"./filterCurrentLinodeTypes-6QsXu4XU.js";import{p as Bt}from"./PlanInformation-CouBULD4.js";import{g as ke}from"./linodes-orSDvVk7.js";import{s as Et}from"./scrollErrorIntoView-6n4Cku1Y.js";import{u as Kt}from"./formik.esm-Kap5lsIh.js";import{T as Mt}from"./Toggle-AbahDP9J.js";import{O as Ot}from"./OrderBy-H-bWJCPy.js";import{P as Ft}from"./Paginate-XLm_-WxT.js";import{P as Ht}from"./PaginationFooter-NHWf7fW2.js";import{S as Ut}from"./StatusIcon-RuV8PvAV.js";import{e as zt,T as X,a as O,b as _t,c as Vt}from"./TableRow-phXfWUGW.js";import{T as qt}from"./TableContentWrapper-56D5btVR.js";import{T as G}from"./TableSortCell-hcsagFzN.js";import{u as Qt}from"./recentEventForLinode-oZMi36YZ.js";import{A as Wt}from"./ActionMenu-4CPisA_2.js";import{I as Gt}from"./InlineMenuAction-d5mRENST.js";import{T as Yt}from"./TableHead-Si_pzkLK.js";import"./tags-kBUFHmv1.js";import"./DisplayPrice-SNYRHKEX.js";import"./Currency-No8tnN7b.js";import"./FormControl-CNHz4Ctl.js";import"./Radio-HudVgwMW.js";import"./RadioGroup-zpRjMzXK.js";import"./TabbedPanel-IicwaI6L.js";import"./TabList-4PWL4GSj.js";import"./TableRowEmpty-aXmC67-Z.js";import"./SelectionCard-IyO-o1CU.js";import"./TypeToConfirmDialog-9yjZCCL0.js";import"./TypeToConfirm-koQ3u5up.js";import"./index-Y5esPPk-.js";import"./TextTooltip-SPU6hUyt.js";import"./ListItem-joIHQeyv.js";import"./splitAt-pbTnq2Oi.js";import"./TableRowError-8gKmGX7P.js";import"./TableRowLoading-iP7zIRHG.js";import"./Skeleton-iwmO4Yae.js";function Xt(t){return $e("MuiTableFooter",t)}Be("MuiTableFooter",["root"]);const Jt=["className","component"],Zt=t=>{const{classes:o}=t;return Fe({root:["root"]},Xt,o)},en=Ee("tfoot",{name:"MuiTableFooter",slot:"Root",overridesResolver:(t,o)=>o.root})({display:"table-footer-group"}),tn={variant:"footer"},re="tfoot",nn=g.forwardRef(function(o,a){const s=Ke({props:o,name:"MuiTableFooter"}),{className:i,component:r=re}=s,l=Me(s,Jt),n=ae({},s,{component:r}),p=Zt(n);return e.jsx(zt.Provider,{value:tn,children:e.jsx(en,ae({as:r,className:Oe(p.root,i),ref:a,role:r===re?null:"rowgroup",ownerState:n},l))})}),sn=nn;var ne={},on=Ue;Object.defineProperty(ne,"__esModule",{value:!0});var Se=ne.default=void 0,an=on(He()),ln=e,rn=(0,an.default)((0,ln.jsx)("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"}),"OpenInNew");Se=ne.default=rn;const cn=D()(t=>({iconTextOuter:{flexBasis:"72%",minWidth:115},item:{"&:first-of-type":{paddingTop:0},"&:last-of-type":{paddingBottom:0},paddingBottom:t.spacing(1),paddingTop:t.spacing(1)},mainGridContainer:{position:"relative",[t.breakpoints.up("lg")]:{justifyContent:"space-between"}},root:{marginBottom:t.spacing(3),padding:`${t.spacing(2.5)} ${t.spacing(2.5)} ${t.spacing(3)}`}})),dn=t=>{const{cluster:o}=t,{classes:a}=cn(),{data:s}=ce(),{data:i}=de(o.id),r=J((i==null?void 0:i.map(m=>m.type))??[]),l=ue(r),{CPU:n,RAM:p,Storage:u}=ze(i??[],l??[]),d=s==null?void 0:s.find(m=>m.id===o.region),h=(d==null?void 0:d.label)??o.region,C=o.control_plane.high_availability?Ce({basePrice:ye,regionId:d==null?void 0:d.id}):void 0,c=C?parseFloat(C):void 0,f=[`Version ${o.k8s_version}`,h,`$${St({highAvailabilityPrice:c,pools:i??[],region:d==null?void 0:d.id,types:l??[]}).toFixed(2)}/month`],b=[H("CPU Core","CPU Cores",n),`${p/1024} GB RAM`,`${Math.floor(u/1024)} GB Storage`],v=(m,k)=>e.jsx(x,{alignItems:"center",className:a.item,wrap:"nowrap",children:e.jsx(x,{className:a.iconTextOuter,children:e.jsx(y,{children:m})})},`spec-${k}`);return e.jsxs(x,{container:!0,direction:"row",lg:3,spacing:0,xs:12,children:[e.jsx(x,{lg:6,children:f.map(v)}),e.jsx(x,{lg:6,children:b.map(v)})]})},un=t=>g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,viewBox:"0 0 16 16",...t},g.createElement("g",{fill:"none",fillRule:"evenodd",stroke:"#3683DC",strokeLinecap:"round",strokeLinejoin:"round"},g.createElement("path",{d:"M14 14.502c0 .552-.448 1-1 1H1c-.552 0-1-.448-1-1v-13c0-.552.448-1 1-1h10.03c.261 0 .512.102.699.285l1.97 1.921c.192.188.301.446.301.716v11.078z",transform:"translate(1)"}),g.createElement("path",{d:"M8.53 6.002L11.03 8.502 8.53 11.002M5.53 6.002L3.03 8.502 5.53 11.002",transform:"translate(1)"}))),pn=t=>g.createElement("svg",{width:"17px",height:"17px",viewBox:"0 0 17 17",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",...t},g.createElement("title",null,"Group"),g.createElement("g",{id:"Reset-icon",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},g.createElement("g",{id:"Group",transform:"translate(1.000000, 1.000000)",stroke:"#3683DC"},g.createElement("path",{d:"M13.7363253,3.32698217 C12.3899701,1.32056985 10.100209,0 7.50193269,0 C3.35872967,0 0,3.35786438 0,7.5 C0,11.6421356 3.35872967,15 7.50193269,15 C11.6451357,15 15.0038654,11.6421356 15.0038654,7.5 C15.0038654,7.40408797 15.0020646,7.30859644 14.9984949,7.21355735",id:"Path"}),g.createElement("polyline",{id:"Path-2-Copy",strokeLinecap:"round",strokeLinejoin:"round",points:"10.4333273 3.33095006 14.0038654 3.33095006 14.0038654 8.8817842e-16"})))),gn=D()(t=>({disabled:{"& g":{stroke:t.palette.text.secondary},color:t.palette.text.secondary,pointer:"default",pointerEvents:"none"},kubeconfigElement:{"&:hover":{opacity:.7},"&:last-child":{borderRight:"none"},alignItems:"center",borderRight:"1px solid #c4c4c4",cursor:"pointer",display:"flex"},kubeconfigElements:{alignItems:"center",color:t.palette.primary.main,display:"flex"},kubeconfigFileText:{color:t.textColors.linkActiveLight,marginRight:t.spacing(1),whiteSpace:"nowrap"},kubeconfigIcons:{height:16,margin:`0 ${t.spacing(1)}`,objectFit:"contain",width:16},label:{fontFamily:t.font.bold,marginBottom:`calc(${t.spacing(1)} - 3px)`}})),mn=(t,o,a)=>t||(o?"Loading...":a||"Your endpoint will be displayed here once it is available."),bn=t=>{const{clusterId:o,clusterLabel:a,handleOpenDrawer:s,isResettingKubeConfig:i,setResetKubeConfigDialogOpen:r}=t,{enqueueSnackbar:l}=B(),{classes:n,cx:p}=gn(),{refetch:u}=pe(o),{data:d,error:h,isLoading:C}=_e(o),c=async()=>{try{const{data:b}=await u();b&&ve(`${a}-kubeconfig.yaml`,b)}catch(b){const v=ge(b,"Unable to download your kubeconfig")[0].reason;l(v,{variant:"error"})}},f=b=>b.find(v=>v.match(/linodelke\.net:443$/i));return e.jsxs(e.Fragment,{children:[e.jsxs(x,{xs:12,children:[e.jsx(y,{className:n.label,children:"Kubernetes API Endpoint:"}),e.jsx(y,{children:mn(f((d==null?void 0:d.map(b=>b.endpoint))??[]),C,h==null?void 0:h[0].reason)})]}),e.jsxs(x,{xs:12,children:[e.jsx(y,{className:n.label,style:{marginTop:8},children:"Kubeconfig:"}),e.jsxs("div",{className:n.kubeconfigElements,children:[e.jsxs(F,{className:n.kubeconfigElement,onClick:c,children:[e.jsx(Rt,{className:n.kubeconfigIcons,style:{marginLeft:0}}),e.jsx(y,{className:n.kubeconfigFileText,children:`${a}-kubeconfig.yaml`})]}),e.jsxs(F,{className:n.kubeconfigElement,onClick:s,children:[e.jsx(un,{className:n.kubeconfigIcons}),e.jsx(y,{className:n.kubeconfigFileText,children:"View"})]}),e.jsxs(F,{className:n.kubeconfigElement,onClick:()=>r(!0),children:[e.jsx(pn,{className:p({[n.disabled]:i,[n.kubeconfigIcons]:!0})}),e.jsx(y,{className:p({[n.disabled]:i,[n.kubeconfigFileText]:!0}),children:"Reset"})]})]})]})]})},xn=t=>{const{children:o,error:a,errorMessage:s,loading:i,title:r}=t;return i?e.jsx(_,{}):a?e.jsx(I,{spacingTop:8,variant:"error",children:s??`Couldn't load ${r}`}):e.jsx(e.Fragment,{children:o})},hn=D()(t=>({icon:{color:"#3683dc"},iconLink:{background:"none",border:"none",cursor:"pointer",font:"inherit",marginRight:t.spacing(1),padding:0},tooltip:{"& svg":{color:"#3683dc"}}})),fn=t=>{const{classes:o}=hn(),{closeDrawer:a,clusterId:s,clusterLabel:i,open:r}=t,{data:l,error:n,isFetching:p,isLoading:u,refetch:d}=pe(s,r);return g.useEffect(()=>{r&&!u&&!p&&d()},[r]),e.jsx(te,{onClose:a,open:r,title:"View Kubeconfig",wide:!0,children:e.jsxs(xn,{error:!!n,errorMessage:n==null?void 0:n[0].reason,loading:u,title:i,children:[e.jsxs(x,{container:!0,spacing:2,children:[e.jsx(x,{children:e.jsx(y,{variant:"h3",children:i})}),e.jsxs(x,{children:[e.jsx("button",{onClick:()=>ve(`${i}-kubeconfig.yaml`,l??""),className:o.iconLink,title:"Download",children:e.jsx(Lt,{className:o.icon})}),e.jsx(Y,{className:o.tooltip,text:l??""})]})]}),e.jsx(Ve,{language:"yaml",textOrMarkdown:"```\n"+l+"\n```"})]})})},yn=D()(t=>({actionRow:{"& button":{alignItems:"flex-start"},alignItems:"flex-end",alignSelf:"stretch",display:"flex",flexDirection:"row",justifyContent:"flex-end",padding:"8px 0px"},dashboard:{"& svg":{height:14,marginLeft:4}},deleteClusterBtn:{paddingRight:"0px",[t.breakpoints.up("md")]:{paddingRight:"8px"}},mainGridContainer:{position:"relative"},root:{marginBottom:t.spacing(3),padding:`${t.spacing(2.5)} ${t.spacing(1)} ${t.spacing(2.5)} ${t.spacing(3)}`},tags:{"& > div:last-child":{marginBottom:0,marginTop:2,width:"100%"},"&.MuiGrid-item":{paddingBottom:0},alignItems:"flex-end",alignSelf:"stretch",display:"flex",flexDirection:"column",justifyContent:"flex-end",[t.breakpoints.down("lg")]:{width:"100%"},[t.breakpoints.up("lg")]:{"& .MuiChip-root":{marginLeft:4,marginRight:0},"& > div:first-of-type":{justifyContent:"flex-end",marginTop:t.spacing(4)},"& > div:last-child":{display:"flex",flexWrap:"wrap",justifyContent:"flex-end"}}}})),jn=t=>{const{cluster:o}=t,{classes:a}=yn(),s=qe(),{enqueueSnackbar:i}=B(),[r,l]=g.useState(!1),[n,p]=g.useState(!1),{mutateAsync:u}=Z(o.id),d=!!s.kubernetesDashboardAvailability,{data:h,error:C}=Qe(o.id,d),{error:c,isLoading:f,mutateAsync:b}=We(),[v,m]=g.useState(!1),k=()=>b({id:o.id}).then(()=>{m(!1),i("Successfully reset Kubeconfig",{variant:"success"})}),S=()=>{l(!0)},j=w=>u({tags:w});return e.jsxs(e.Fragment,{children:[e.jsx(me,{className:a.root,children:e.jsxs(x,{className:a.mainGridContainer,container:!0,spacing:2,children:[e.jsx(dn,{cluster:o}),e.jsx(x,{container:!0,direction:"column",lg:4,xs:12,children:e.jsx(bn,{clusterId:o.id,clusterLabel:o.label,handleOpenDrawer:S,isResettingKubeConfig:f,setResetKubeConfigDialogOpen:m})}),e.jsxs(x,{container:!0,direction:"column",justifyContent:"space-between",lg:5,xs:12,children:[e.jsxs(x,{className:a.actionRow,children:[o.control_plane.high_availability?e.jsx(Ge,{label:"HA CLUSTER",outlineColor:"green",size:"small",variant:"outlined"}):null,d?e.jsxs(R,{onClick:()=>{window.open(h==null?void 0:h.url,"_blank")},buttonType:"secondary",className:a.dashboard,compactY:!0,disabled:!!C||!h,children:["Kubernetes Dashboard",e.jsx(Se,{})]}):null,e.jsx(R,{buttonType:"secondary",className:a.deleteClusterBtn,compactY:!0,onClick:()=>p(!0),children:"Delete Cluster"})]}),e.jsx(x,{className:a.tags,children:e.jsx(kt,{tags:o.tags,updateTags:j})})]})]})}),e.jsx(fn,{closeDrawer:()=>l(!1),clusterId:o.id,clusterLabel:o.label,open:r}),e.jsx(Pt,{clusterId:o.id,clusterLabel:o.label,onClose:()=>p(!1),open:n}),e.jsx(E,{actions:e.jsx(A,{primaryButtonProps:{label:"Reset Kubeconfig",loading:f,onClick:()=>k()},secondaryButtonProps:{label:"Cancel",onClick:()=>m(!1)}}),error:c&&c.length>0?Ye(c,"Unable to reset Kubeconfig"):void 0,onClose:()=>m(!1),open:v,title:"Reset Cluster Kubeconfig?",children:"This will delete and regenerate the cluster’s Kubeconfig file. You will no longer be able to access this cluster via your previous Kubeconfig file. This action cannot be undone."})]})},Cn=g.memo(jn),vn=t=>{const{clusterId:o,onClose:a,open:s}=t,{enqueueSnackbar:i}=B(),{error:r,isLoading:l,mutateAsync:n}=Xe(o),p=()=>{n().then(()=>{i("All cluster nodes queued for recycling",{variant:"success"}),a()})},u=e.jsx(A,{primaryButtonProps:{"data-testid":"confirm",label:"Recycle All Cluster Nodes",loading:l,onClick:p},secondaryButtonProps:{"data-testid":"cancel",label:"Cancel",onClick:a},style:{padding:0}});return e.jsx(E,{actions:u,error:r==null?void 0:r[0].reason,onClose:a,open:s,title:"Recycle all nodes in cluster?",children:e.jsxs(y,{children:[ee," ",V," This may take several minutes, as nodes will be replaced on a rolling basis."]})})},kn=t=>{const{clusterId:o,nodePoolId:a,onClose:s,open:i}=t,{enqueueSnackbar:r}=B(),{error:l,isLoading:n,mutateAsync:p}=Je(o,a),u=()=>{p().then(()=>{r(`Recycled all nodes in node pool ${a}`,{variant:"success"}),s()})},d=e.jsx(A,{primaryButtonProps:{"data-testid":"confirm",label:"Recycle Pool Nodes",loading:n,onClick:u},secondaryButtonProps:{"data-testid":"cancel",label:"Cancel",onClick:s},style:{padding:0}});return e.jsx(E,{actions:d,error:l==null?void 0:l[0].reason,onClose:s,open:i,title:"Recycle node pool?",children:e.jsxs(y,{children:[ee," ",V," This may take several minutes, as nodes will be replaced on a rolling basis."]})})},Sn=D()(t=>({boxOuter:{[t.breakpoints.down("md")]:{alignItems:"flex-start",flexDirection:"column"},width:"100%"},error:{marginBottom:"0 !important"},plans:{"& > *":{"& > *":{padding:0},marginTop:0}},priceDisplay:{"& span":{fontFamily:t.font.bold},color:t.color.headline,display:"inline",fontSize:"1rem",lineHeight:"1.25rem",marginBottom:t.spacing(2),marginTop:t.spacing(2)}})),Nn=t=>{var z;const{clusterId:o,clusterLabel:a,clusterRegionId:s,onClose:i,open:r,regionsData:l}=t,{classes:n}=Sn(),{data:p}=Ze(r),{error:u,isLoading:d,mutateAsync:h}=et(o),C=$t(p==null?void 0:p.map(be)),[c,f]=g.useState(void 0),b=g.useCallback(N=>N===(c==null?void 0:c.planId)?c.count:0,[c]),v=c?C.find(N=>N.id===c.planId):void 0,m=(z=ke(v,s))==null?void 0:z.monthly,k=c&&m?c.count*m:void 0;g.useEffect(()=>{r&&S()},[r]),g.useEffect(()=>{u&&Et()},[u]);const S=()=>{f(void 0)},j=(N,$)=>{f($>0?{count:$,planId:N}:void 0)},w=()=>{if(c)return h({count:c.count,type:c.planId}).then(()=>{i()})},{hasSelectedRegion:T,isPlanPanelDisabled:q,isSelectedRegionEligibleForPlan:U}=Bt({regionsData:l,selectedRegionID:s});return e.jsxs(te,{wide:!0,PaperProps:{sx:{maxWidth:"790px !important"}},onClose:i,open:r,title:`Add a Node Pool: ${a}`,children:[u&&e.jsx(I,{className:n.error,text:u==null?void 0:u[0].reason,variant:"error"}),e.jsxs("form",{className:n.plans,children:[e.jsx(Nt,{onSelect:N=>{(c==null?void 0:c.planId)!==N&&f({count:1,planId:N})},types:C.filter(N=>N.class!=="nanode"&&N.class!=="gpu"),addPool:w,getTypeCount:b,hasSelectedRegion:T,isPlanPanelDisabled:q,isSelectedRegionEligibleForPlan:U,isSubmitting:d,regionsData:l,resetValues:S,selectedId:c==null?void 0:c.planId,selectedRegionID:s,updatePlanCount:j}),c&&c.count>0&&c.count<3&&e.jsx(I,{important:!0,spacingBottom:16,spacingTop:8,text:xe,variant:"warning"}),c&&!k&&!m&&e.jsx(I,{spacingBottom:16,spacingTop:8,text:je,variant:"error"}),e.jsxs(F,{alignItems:"center",className:n.boxOuter,display:"flex",flexDirection:"row",justifyContent:c?"space-between":"flex-end",children:[c&&e.jsxs(y,{className:n.priceDisplay,children:["This pool will add"," ",e.jsxs("strong",{children:["$",M(k),"/month (",H("node","nodes",c.count)," at $",M(m),"/month)"]})," ","to this cluster."]}),e.jsx(A,{primaryButtonProps:{disabled:!c,label:"Add pool",loading:d,onClick:w}})]})]})]})},wn=D()(t=>({disabled:{opacity:.5},errorText:{color:t.color.red},input:{"& input":{width:70},minWidth:"auto"},inputContainer:{"& label":{marginTop:13}},notice:{fontFamily:t.font.bold,fontSize:15},resize:{fontSize:"inherit",marginLeft:-4,marginRight:0,marginTop:-3.2,minHeight:0,padding:0},slash:{"& p":{fontSize:"1rem",padding:`${t.spacing(2)} 0`},alignSelf:"end",padding:"0px !important"}})),Tn=t=>{const{clusterId:o,handleOpenResizeDrawer:a,nodePool:s,onClose:i,open:r}=t,l=s==null?void 0:s.autoscaler,{classes:n,cx:p}=wn(),{enqueueSnackbar:u}=B(),{error:d,isLoading:h,mutateAsync:C}=he(o,(s==null?void 0:s.id)??-1),c=async T=>{await C({autoscaler:T}).then(()=>{u(`Autoscaling updated for Node Pool ${s==null?void 0:s.id}.`,{variant:"success"}),i()})},f=()=>{i(),m(j)},{errors:b,handleChange:v,handleReset:m,handleSubmit:k,isSubmitting:S,values:j}=Kt({enableReinitialize:!0,initialValues:{enabled:(l==null?void 0:l.enabled)??!1,max:(l==null?void 0:l.max)??1,min:(l==null?void 0:l.min)??1},onSubmit:c,validationSchema:tt}),w=l&&l.max>1&&+j.max<l.max?"The Node Pool will only be scaled down if there are unneeded nodes.":void 0;return e.jsxs(E,{actions:e.jsx(A,{primaryButtonProps:{"data-testid":"confirm",disabled:j.enabled===(l==null?void 0:l.enabled)&&j.min===(l==null?void 0:l.min)&&j.max===(l==null?void 0:l.max)||Object.keys(b).length!==0,label:"Save Changes",loading:h||S,onClick:()=>k()},secondaryButtonProps:{"data-testid":"cancel",label:"Cancel",onClick:f},style:{padding:0}}),error:d==null?void 0:d[0].reason,onClose:f,open:r,title:"Autoscale Pool",children:[w?e.jsxs(I,{className:n.notice,variant:"warning",children:[w,e.jsxs("div",{children:[e.jsx(R,{onClick:()=>{f(),a((s==null?void 0:s.id)??-1)},buttonType:"secondary",className:n.resize,compactX:!0,children:"Resize"}),"to immediately scale your Node Pool up or down."]})]}):null,e.jsxs(y,{children:["Set minimum and maximum node pool constraints for LKE to resize your cluster automatically based on resource demand and overall usage. Maximum limit is 100 nodes."," ",e.jsx(nt,{to:"https://www.linode.com/docs/products/compute/kubernetes/guides/enable-cluster-autoscaling",children:"Learn more."})]}),e.jsxs("form",{onSubmit:k,children:[e.jsx(st,{control:e.jsx(Mt,{checked:j.enabled,disabled:S,name:"enabled",onChange:v}),label:"Autoscaler",style:{marginTop:12}}),e.jsxs(x,{className:n.inputContainer,container:!0,spacing:2,children:[e.jsx(x,{children:e.jsx(ie,{className:n.input,disabled:!j.enabled||S,error:!!b.min,label:"Min",name:"min",onChange:v,type:"number",value:j.min})}),e.jsx(x,{className:p({[n.disabled]:!j.enabled,[n.slash]:!0}),children:e.jsx(y,{children:"/"})}),e.jsx(x,{children:e.jsx(ie,{className:n.input,disabled:!j.enabled||S,error:!!b.max,label:"Max",name:"max",onChange:v,type:"number",value:j.max})}),e.jsxs(x,{style:{padding:"0 8px"},xs:12,children:[b.min?e.jsx(y,{className:n.errorText,children:b.min}):null,b.max?e.jsx(y,{className:n.errorText,children:b.max}):null]})]})]})]})},Dn=t=>{const{kubernetesClusterId:o,nodePool:a,onClose:s,open:i}=t,{error:r,isLoading:l,mutateAsync:n}=ot(o,(a==null?void 0:a.id)??-1),p=()=>{n().then(()=>{s()})},u=(a==null?void 0:a.count)??0,d=e.jsx(A,{primaryButtonProps:{"data-testid":"confirm",label:"Delete",loading:l,onClick:p},secondaryButtonProps:{"data-testid":"cancel",label:"Cancel",onClick:s},style:{padding:0}});return e.jsx(E,{actions:d,error:r==null?void 0:r[0].reason,onClose:s,open:i,title:"Delete Node Pool?",children:e.jsxs(y,{children:["Are you sure you want to delete this Node Pool?"," ",u>0&&`${H("node","nodes",u)} will be deleted.`]})})},Pn=sn,In=t=>{const{instanceLabel:o,nodeId:a,openRecycleNodeDialog:s}=t,i=at(),r=it(i.breakpoints.down("md")),l=[{disabled:!a||!o,onClick:()=>{!a||!o||s(a,o)},title:"Recycle"}];return e.jsx(F,{alignItems:"center",display:"flex",justifyContent:"flex-end",children:r?e.jsx(Wt,{actionsList:l,ariaLabel:`Action menu for Node ${o}`}):l.map(n=>e.jsx(Gt,{actionText:n.title,disabled:n.disabled,onClick:n.onClick},n.title))})},Rn=g.memo(In),Ne=D()((t,o,a)=>({copy:{"& svg":{height:"12px",opacity:0,width:"12px"},marginLeft:4,top:1},error:{color:t.color.red},ipCell:{...t.applyTableHeaderStyles,width:"35%"},labelCell:{...t.applyTableHeaderStyles,width:"35%"},row:{"&:hover":{backgroundColor:t.bg.lightBlue1},[`&:hover .${a.copy} > svg, & .${a.copy}:focus > svg`]:{opacity:1}},statusCell:{...t.applyTableHeaderStyles,width:"15%"},table:{borderLeft:`1px solid ${t.borderColors.borderTable}`,borderRight:`1px solid ${t.borderColors.borderTable}`}})),Ln=t=>{const{nodes:o,openRecycleNodeDialog:a,poolId:s,typeLabel:i}=t,{classes:r}=Ne(),{data:l,error:n,isLoading:p}=ct(),u=o.map(d=>Bn(d,l??[]));return e.jsx(Ot,{data:u,order:"asc",orderBy:"label",children:({data:d,handleOrderChange:h,order:C,orderBy:c})=>e.jsx(Ft,{data:d,children:({count:f,data:b,handlePageChange:v,handlePageSizeChange:m,page:k,pageSize:S})=>e.jsxs(e.Fragment,{children:[e.jsxs(_t,{"aria-label":"List of Your Cluster Nodes",className:r.table,children:[e.jsx(Yt,{children:e.jsxs(X,{children:[e.jsx(G,{active:c==="label",className:r.labelCell,direction:C,handleClick:h,label:"label",children:"Linode"}),e.jsx(G,{active:c==="instanceStatus",className:r.statusCell,direction:C,handleClick:h,label:"instanceStatus",children:"Status"}),e.jsx(G,{active:c==="ip",className:r.ipCell,direction:C,handleClick:h,label:"ip",children:"IP Address"}),e.jsx(O,{})]})}),e.jsx(Vt,{children:e.jsx(qt,{length:b.length,loading:p,loadingProps:{columns:4},children:b.map(j=>e.jsx($n,{instanceId:j.instanceId,instanceStatus:j.instanceStatus,ip:j.ip,label:j.label,linodeError:n??void 0,nodeId:j.nodeId,nodeStatus:j.nodeStatus,openRecycleNodeDialog:a,typeLabel:i},`node-row-${j.nodeId}`))})}),e.jsx(Pn,{children:e.jsx(X,{children:e.jsx(O,{colSpan:4,children:e.jsxs(y,{children:["Pool ID ",s]})})})})]}),e.jsx(Ht,{count:f,eventCategory:"Node Table",handlePageChange:v,handleSizeChange:m,page:k,pageSize:S})]})})})},An=g.memo(Ln),$n=g.memo(t=>{const{instanceId:o,instanceStatus:a,ip:s,label:i,linodeError:r,nodeId:l,nodeStatus:n,openRecycleNodeDialog:p,typeLabel:u}=t,{classes:d}=Ne(),h=Qt(o??-1),C=o?`/linodes/${o}`:void 0,f=n==="ready"&&a==="running"?"active":"inactive",b=i??u,v=n==="not_ready"?"Provisioning":lt(a??"",o??-1,h),m=s??"";return e.jsxs(X,{ariaLabel:i,className:d.row,"data-qa-node-row":l,children:[e.jsx(O,{children:e.jsx(x,{alignItems:"center",container:!0,wrap:"nowrap",children:e.jsx(x,{children:e.jsx(y,{children:C?e.jsx(rt,{to:C,children:b}):b})})})}),e.jsx(O,{statusCell:!r,children:r?e.jsx(y,{className:d.error,children:"Error retrieving status"}):e.jsxs(e.Fragment,{children:[e.jsx(Ut,{status:f}),v]})}),e.jsx(O,{children:r?e.jsx(y,{className:d.error,children:"Error retrieving IP"}):m.length>0?e.jsxs(e.Fragment,{children:[e.jsx(Y,{copyableText:!0,text:m}),e.jsx(Y,{className:d.copy,text:m})]}):null}),e.jsx(O,{children:e.jsx(Rn,{instanceLabel:i,nodeId:l,openRecycleNodeDialog:p})})]})}),Bn=(t,o)=>{const a=o.find(s=>s.id===t.instance_id);return{instanceId:t.instance_id||void 0,instanceStatus:a==null?void 0:a.status,ip:a==null?void 0:a.ipv4[0],label:a==null?void 0:a.label,nodeId:t.id,nodeStatus:t.status}},En=D()(t=>({autoscaleText:{alignSelf:"center",paddingRight:t.spacing(2)},button:{paddingRight:8},deletePoolBtn:{marginBottom:3,paddingRight:8}})),Kn=t=>{const{autoscaler:o,handleClickResize:a,isOnlyNodePool:s,nodes:i,openAutoscalePoolDialog:r,openDeletePoolDialog:l,openRecycleAllNodesDialog:n,openRecycleNodeDialog:p,poolId:u,typeLabel:d}=t,{classes:h}=En();return e.jsxs(x,{alignItems:"center",container:!0,"data-qa-node-pool-id":u,"data-qa-node-pool-section":!0,justifyContent:"space-between",spacing:2,children:[e.jsx(x,{children:e.jsx(y,{variant:"h2",children:d})}),e.jsxs(x,{sx:{display:"flex"},children:[e.jsx(R,{buttonType:"secondary",className:`${o.enabled?h.button:""}`,compactY:!0,onClick:()=>r(u),children:"Autoscale Pool"}),o.enabled?e.jsx(y,{className:h.autoscaleText,children:`(Min ${o.min} / Max ${o.max})`}):null,e.jsx(R,{buttonType:"secondary",compactY:!0,onClick:()=>a(u),children:"Resize Pool"}),e.jsx(R,{buttonType:"secondary",compactY:!0,onClick:()=>n(u),children:"Recycle Pool Nodes"}),e.jsx(dt,{disableFocusListener:!s,disableHoverListener:!s,disableTouchListener:!s,title:"Clusters must contain at least one node pool.",children:e.jsx("div",{children:e.jsx(R,{buttonType:"secondary",className:h.deletePoolBtn,compactY:!0,disabled:s,onClick:()=>l(u),children:"Delete Pool"})})})]}),e.jsx(x,{sx:{paddingTop:0},xs:12,children:e.jsx(An,{nodes:i,openRecycleNodeDialog:p,poolId:u,typeLabel:d})})]})},Mn=t=>{const{clusterId:o,nodeId:a,onClose:s,open:i}=t,{enqueueSnackbar:r}=B(),{error:l,isLoading:n,mutateAsync:p}=ut(o,a),u=()=>{p().then(()=>{r("Node queued for recycling.",{variant:"success"}),s()})},d=e.jsx(A,{primaryButtonProps:{"data-testid":"confirm",label:"Recycle",loading:n,onClick:u},secondaryButtonProps:{"data-testid":"cancel",label:"Cancel",onClick:s},style:{padding:0}});return e.jsx(E,{actions:d,error:l==null?void 0:l[0].reason,onClose:s,open:i,title:`Recycle ${a}?`,children:e.jsxs(y,{children:["This node will be deleted and a new node will be created to replace it."," ",V," This may take several minutes."]})})},On=D()(t=>({helperText:{paddingBottom:`calc(${t.spacing(2)} + 1px)`},section:{paddingBottom:t.spacing(3)},summary:{fontFamily:t.font.bold,fontSize:"16px"}})),Fn=`Resizing to fewer nodes will delete random nodes from
the pool.`,Hn=t=>{var S,j,w;const{kubernetesClusterId:o,kubernetesRegionId:a,nodePool:s,onClose:i,open:r}=t,{classes:l}=On(),n=J(s!=null&&s.type?[s.type]:[]),p=((S=n[0])==null?void 0:S.isLoading)??!1,u=(j=n[0])!=null&&j.data?be(n[0].data):void 0,{error:d,isLoading:h,mutateAsync:C}=he(o,(s==null?void 0:s.id)??-1),[c,f]=g.useState((s==null?void 0:s.count)??0);g.useEffect(()=>{s&&r&&f(s.count)},[s,r]);const b=T=>{f(Math.min(100,Math.floor(T)))};if(!s)return null;const v=()=>{C({count:c}).then(T=>{i()})},m=(w=ke(u,a))==null?void 0:w.monthly,k=u&&wt({count:s.count,region:a,type:s.type,types:u?[u]:[]});return e.jsxs(te,{onClose:i,open:r,title:`Resize Pool: ${(u==null?void 0:u.formattedLabel)??"Unknown"} Plan`,children:[p&&e.jsx(_,{}),e.jsxs("form",{onSubmit:T=>{T.preventDefault(),v()},children:[e.jsx("div",{className:l.section,children:k&&e.jsxs(y,{className:l.summary,children:["Current pool: $",M(k),"/month"," ","(",H("node","nodes",s.count)," at $",M(m),"/month)"]})}),d&&e.jsx(I,{text:d==null?void 0:d[0].reason,variant:"error"}),e.jsxs("div",{className:l.section,children:[e.jsx(y,{className:l.helperText,children:"Enter the number of nodes you'd like in this pool:"}),e.jsx(Tt,{min:1,setValue:b,value:c})]}),e.jsx("div",{className:l.section,children:m&&e.jsxs(y,{className:l.summary,children:[`Resized pool: $${M(c*m)}/month`," ","(",H("node","nodes",c)," at $",M(m),"/month)"]})}),c<s.count&&e.jsx(I,{important:!0,text:Fn,variant:"warning"}),c<3&&e.jsx(I,{important:!0,text:xe,variant:"warning"}),s.count&&(!m||!k)&&e.jsx(I,{spacingBottom:16,spacingTop:8,text:je,variant:"error"}),e.jsx(A,{primaryButtonProps:{"data-testid":"submit",disabled:c===s.count,label:"Save Changes",loading:h,onClick:v}})]})]})},Un=D()(t=>({button:{marginBottom:t.spacing(),marginLeft:t.spacing()},displayTable:{"& > div":{marginBottom:t.spacing(3)},"& > div:last-child":{marginBottom:0},padding:"8px 8px 0px",width:"100%"},nodePoolHeader:{marginBottom:t.spacing(),[t.breakpoints.only("sm")]:{marginLeft:t.spacing()},[t.breakpoints.only("xs")]:{marginLeft:t.spacing()}},nodePoolHeaderOuter:{alignItems:"center",display:"flex"}})),zn=t=>{const{clusterID:o,clusterLabel:a,clusterRegionId:s,regionsData:i}=t,{classes:r,cx:l}=Un(),{data:n,error:p,isLoading:u}=de(o,{refetchInterval:15e3}),[d,h]=g.useState(""),[C,c]=g.useState(-1),f=n==null?void 0:n.find(P=>P.id===C),[b,v]=g.useState(!1),[m,k]=g.useState(!1),[S,j]=g.useState(!1),[w,T]=g.useState(!1),[q,U]=g.useState(!1),[z,N]=g.useState(!1),[$,we]=le.useState(5),K=n==null?void 0:n.slice(0,$),Te=J((K==null?void 0:K.map(P=>P.type))??[]),Q=ue(Te),De=()=>{$<((n==null?void 0:n.length)??0)&&we(Math.min($+25,(n==null?void 0:n.length)??0))},[Pe,se]=le.useState(!1),Ie=()=>{se(!0)},oe=P=>{c(P),k(!0)};return u||n===void 0?e.jsx(_,{}):e.jsxs(e.Fragment,{children:[e.jsxs(x,{alignItems:"center",container:!0,justifyContent:"space-between",spacing:2,children:[e.jsx(x,{children:e.jsx(y,{className:l(r.nodePoolHeader),variant:"h2",children:"Node Pools"})}),e.jsxs(x,{children:[e.jsx(R,{buttonType:"secondary",className:l(r.button),onClick:()=>U(!0),children:"Recycle All Nodes"}),e.jsx(R,{buttonType:"primary",className:l(r.button),onClick:Ie,children:"Add a Node Pool"})]})]}),e.jsx(me,{children:p?e.jsx(fe,{errorText:p==null?void 0:p[0].reason}):e.jsxs(x,{container:!0,direction:"column",children:[e.jsxs(x,{xs:12,children:[K==null?void 0:K.map(P=>{const{id:Re,nodes:Le}=P,W=Q==null?void 0:Q.find(L=>L.id===P.type),Ae=(W==null?void 0:W.formattedLabel)??"Unknown type";return e.jsx("div",{children:e.jsx(Kn,{openAutoscalePoolDialog:L=>{c(L),N(!0)},openDeletePoolDialog:L=>{c(L),v(!0)},openRecycleAllNodesDialog:L=>{c(L),j(!0)},openRecycleNodeDialog:(L,Gn)=>{h(L),T(!0)},autoscaler:P.autoscaler,handleClickResize:oe,isOnlyNodePool:(n==null?void 0:n.length)===1,nodes:Le??[],poolId:P.id,typeLabel:Ae})},Re)}),(n==null?void 0:n.length)>$&&e.jsx(At,{onEnter:De,children:e.jsx("div",{style:{minHeight:50}})})]}),e.jsx(Nn,{clusterId:o,clusterLabel:a,clusterRegionId:s,onClose:()=>se(!1),open:Pe,regionsData:i}),e.jsx(Hn,{kubernetesClusterId:o,kubernetesRegionId:s,nodePool:f,onClose:()=>k(!1),open:m}),e.jsx(Dn,{kubernetesClusterId:o,nodePool:f,onClose:()=>v(!1),open:b}),e.jsx(Tn,{clusterId:o,handleOpenResizeDrawer:oe,nodePool:f,onClose:()=>N(!1),open:z}),e.jsx(Mn,{clusterId:o,nodeId:d,onClose:()=>T(!1),open:w}),e.jsx(kn,{clusterId:o,nodePoolId:C,onClose:()=>j(!1),open:S}),e.jsx(vn,{clusterId:o,onClose:()=>U(!1),open:q})]})})]})},_n=D()(t=>({noticeHeader:{fontSize:"0.875rem"},noticeList:{"& li":{marginBottom:4},fontSize:"0.875rem",marginTop:4,paddingLeft:t.spacing(2)}})),Vn=t=>{const{clusterID:o,onClose:a,open:s,regionID:i}=t,{enqueueSnackbar:r}=B(),[l,n]=g.useState(!1),p=()=>n(m=>!m),{mutateAsync:u}=Z(o),[d,h]=g.useState(),[C,c]=g.useState(!1),{classes:f}=_n(),b=()=>{c(!0),h(void 0),u({control_plane:{high_availability:!0}}).then(()=>{c(!1),r("Enabled HA Control Plane",{variant:"success"}),a()}).catch(m=>{c(!1),h(m[0].reason)})},v=e.jsx(A,{primaryButtonProps:{"data-testid":"confirm",disabled:!l,label:"Upgrade to HA",loading:C,onClick:b},secondaryButtonProps:{"data-testid":"cancel",label:"Cancel",onClick:a}});return e.jsxs(E,{actions:v,error:d,onClose:a,open:s,title:"Upgrade to High Availability",children:[e.jsx(Dt,{}),e.jsxs(y,{style:{marginBottom:8,marginTop:12},variant:"body1",children:["For this region, pricing for the HA control plane is $",Ce({basePrice:ye,regionId:i})," ","per month per cluster."]}),e.jsxs(I,{spacingBottom:16,spacingTop:16,variant:"warning",children:[e.jsx(y,{className:f.noticeHeader,variant:"h3",children:"Caution:"}),e.jsxs("ul",{className:f.noticeList,children:[e.jsx("li",{children:ee}),e.jsx("li",{children:V}),e.jsx("li",{children:"This may take several minutes, as nodes will be replaced on a rolling basis."})]})]}),e.jsx(pt,{checked:l,onChange:p,text:"I agree to the additional fee on my monthly bill and understand HA upgrade can only be reversed by deleting my cluster."})]})},qn=t=>{const{clusterID:o,clusterLabel:a,currentVersion:s}=t,{data:i}=gt(),r=mt(s,i??[]),[l,n]=g.useState(!1),p=e.jsx(R,{buttonType:"primary",onClick:()=>n(!0),children:"Upgrade Version"});return e.jsxs(e.Fragment,{children:[r?e.jsx(bt,{actionButton:p,variant:"info",preferenceKey:`${o}-${s}`,children:e.jsx(x,{alignItems:"center",container:!0,direction:"row",justifyContent:"space-between",children:e.jsx(x,{children:e.jsxs(y,{children:["A new version of Kubernetes is available (",r,")."]})})})}):null,e.jsx(It,{clusterID:o,clusterLabel:a,currentVersion:s,isOpen:l,onClose:()=>n(!1)})]})},Qn=g.memo(qn),Wn=()=>{const{data:t}=xt(),{clusterID:o}=ht(),a=Number(o),s=ft(),{data:i,error:r,isLoading:l}=yt(a),{data:n}=ce(),{mutateAsync:p}=Z(a),[u,d]=g.useState(),[h,C]=g.useState(!1),{isClusterHighlyAvailable:c,showHighAvailability:f}=jt(t,i);if(r)return e.jsx(fe,{errorText:ge(r,"Unable to load cluster data.")[0].reason});if(l||!i)return e.jsx(_,{});const b=k=>(d(void 0),p({label:k}).catch(S=>(d(S[0].reason),Promise.reject(S)))),v=()=>(d(void 0),i==null?void 0:i.label),m=()=>{C(!0)};return e.jsxs(e.Fragment,{children:[e.jsx(Ct,{segment:`Kubernetes Cluster ${i==null?void 0:i.label}`}),e.jsx(x,{children:e.jsx(Qn,{clusterID:i==null?void 0:i.id,clusterLabel:i==null?void 0:i.label,currentVersion:i==null?void 0:i.k8s_version})}),e.jsx(vt,{breadcrumbProps:{breadcrumbDataAttrs:{"data-qa-breadcrumb":!0},firstAndLastOnly:!0,onEditHandlers:{editableTextTitle:i==null?void 0:i.label,errorText:u,onCancel:v,onEdit:b},pathname:s.pathname},onButtonClick:f&&!c?m:void 0,createButtonText:"Upgrade to HA",docsLabel:"Docs",docsLink:"https://www.linode.com/docs/kubernetes/deploy-and-manage-a-cluster-with-linode-kubernetes-engine-a-tutorial/",title:"Kubernetes Cluster Details"}),e.jsx(x,{children:e.jsx(Cn,{cluster:i})}),e.jsx(x,{children:e.jsx(zn,{clusterID:i.id,clusterLabel:i.label,clusterRegionId:i.region,regionsData:n||[]})}),e.jsx(Vn,{clusterID:i.id,onClose:()=>C(!1),open:h,regionID:i.region})]})},Vs=Wn;export{Vs as default};
