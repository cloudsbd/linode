import{ao as q,bp as V,h9 as ve,u as $,j as e,ad as E,d0 as F,bB as k,ag as Z,r as p,ha as G,af as Se,hb as we,J as Ee,T as me,a1 as ke,s as Y,aZ as Te,m as _e,aW as Pe,bD as Ie,V as Ae,cH as Le,W as ce,hc as Be,ak as ue,di as te,hd as Oe,e as Re,cx as Me,he as Fe,cR as Ne,hf as qe,C as Ze,E as Ye,Q as ze,an as ne,f as Ve}from"./index-Eksrs3uK.js";import{D as $e}from"./DeletionDialog-MVB4bfuG.js";import{L as Ge}from"./LandingHeader-JXAVBhqg.js";import{P as He}from"./PaginationFooter-NHWf7fW2.js";import{T as pe,a as w,b as Ue,c as Qe}from"./TableRow-phXfWUGW.js";import{T as M}from"./TableSortCell-hcsagFzN.js";import{u as Ke}from"./useOrder-rsUMHEuj.js";import{u as We}from"./usePagination-Sxr0Tlb7.js";import{u as H}from"./formik.esm-Kap5lsIh.js";import{D as U}from"./Drawer-A9yKjC3Z.js";import{R as N}from"./Radio-HudVgwMW.js";import{R as he}from"./RadioGroup-zpRjMzXK.js";import{D as Je}from"./DateTimeDisplay-bXC9mIcz.js";import{S as Xe}from"./StatusIcon-RuV8PvAV.js";import{s as ea}from"./splitAt-pbTnq2Oi.js";import{A as aa}from"./ActionMenu-4CPisA_2.js";import{I as ta}from"./InlineMenuAction-d5mRENST.js";import{a as na,t as oa}from"./domainUtils-mqxZFuqB.js";import{y as sa,b as ra,R as ia}from"./ResourcesSection-fJQ13r7x.js";import{M as oe}from"./MultipleIPInput-NQt3M-F3.js";import{T as la}from"./TagsInput-cI8zXYga.js";import{h as da}from"./formikTrimUtil-tfsUpEEv.js";import{s as se,e as re}from"./ipUtils-P4y3JNCT.js";import{T as ma}from"./TableHead-Si_pzkLK.js";import"./TypeToConfirm-koQ3u5up.js";import"./OrderBy-H-bWJCPy.js";import"./ListItem-joIHQeyv.js";import"./concat-Y0p1CSCT.js";import"./_isFunction-X3ooR5X_.js";import"./_contains-91K6xqrF.js";import"./tags-kBUFHmv1.js";import"./ipaddr-jlottelM.js";const ca=s=>{var g;const{domain:a,onClose:r,open:d}=s,{data:i}=q(),{data:l}=V(),{error:c,mutateAsync:u,reset:m}=ve((a==null?void 0:a.id)??0),t=$(),n=H({initialValues:{domain:""},onSubmit:async C=>{const y=await u(C);t.push(`/domains/${y.id}`),h()}}),h=()=>{r(),n.resetForm(),m()},b=(i==null?void 0:i.restricted)&&!(l!=null&&l.global.add_domains);return e.jsxs(U,{onClose:h,open:d,title:"Clone Domain",children:[b&&e.jsx(E,{variant:"error",children:"You do not have permission to create new Domains."}),e.jsxs("form",{onSubmit:n.handleSubmit,children:[e.jsxs(he,{"aria-label":"type",name:"type",row:!0,value:a==null?void 0:a.type,children:[e.jsx(F,{control:e.jsx(N,{}),"data-qa-domain-radio":"Primary",disabled:!0,label:"Primary",value:"master"}),e.jsx(F,{control:e.jsx(N,{}),"data-qa-domain-radio":"Secondary",disabled:!0,label:"Secondary",value:"slave"})]}),e.jsx(k,{"data-qa-domain-name":!0,"data-testid":"domain-name-input",disabled:!0,label:"Domain",value:a==null?void 0:a.domain}),e.jsx(k,{"data-qa-clone-name":!0,disabled:b,errorText:c?(g=c[0])==null?void 0:g.reason:void 0,id:"domain",label:"New Domain",name:"domain",onChange:n.handleChange,value:n.values.domain}),e.jsx(Z,{primaryButtonProps:{"data-testid":"create-domain-submit",disabled:!n.dirty,label:"Create Domain",loading:n.isSubmitting,type:"submit"},secondaryButtonProps:{"data-testid":"cancel",label:"Cancel",onClick:h}})]})]})},ua=p.memo(s=>{var t;const{domain:a,onClose:r,open:d}=s,{error:i,isLoading:l,mutateAsync:c,reset:u}=G();p.useEffect(()=>{d&&u()},[d]);const m=()=>{a&&c({id:a.id,status:"disabled"}).then(()=>{we("Disable"),r()})};return e.jsx(Se,{actions:e.jsx(Z,{primaryButtonProps:{label:"Disable Domain",loading:l,onClick:m},secondaryButtonProps:{label:"Cancel",onClick:r}}),error:(t=i==null?void 0:i[0])==null?void 0:t.reason,onClose:r,open:d,title:`Disable Domain ${a==null?void 0:a.domain}?`,children:"Are you sure you want to disable this DNS zone?"})}),ie="domain-banner",pa=p.memo(s=>{const{hidden:a}=s;return a?null:e.jsx(ga,{options:{expiry:Ee.utc().plus({days:30}).toISO(),label:ie},important:!0,preferenceKey:ie,variant:"warning",children:e.jsxs(e.Fragment,{children:[e.jsx(ha,{children:e.jsx("strong",{children:"Your DNS zones are not being served."})}),e.jsxs(me,{children:["Your domains will not be served by Linodeâ€™s nameservers unless you have at least one active Linode on your account."," ",e.jsx(ke,{to:"/linodes/create",children:"You can create one here."})]})]})})}),ha=Y(me,{label:"StyledTypography"})(({theme:s})=>({marginBottom:s.spacing()})),ga=Y(Te,{label:"StyledDismissableBanner"})(({theme:s})=>({"& h3:first-of-type":{marginBottom:s.spacing(1)}})),ba=_e()(()=>({button:{justifyContent:"flex-start",minWidth:66}})),xa=p.memo(s=>{const{classes:a}=ba(),{domain:r,onClone:d,onDisableOrEnable:i,onEdit:l,onRemove:c}=s,u=Pe(),m=Ie(u.breakpoints.down("md")),t=[{onClick:()=>{l(r)},title:"Edit"},{className:a.button,onClick:()=>{i(r.status==="active"?"disable":"enable",r)},title:r.status==="active"?"Disable":"Enable"},{onClick:()=>{d(r)},title:"Clone"},{onClick:()=>{c(r)},title:"Delete"}],n=m?0:2,[h,b]=ea(n,t);return e.jsxs(e.Fragment,{children:[!m&&h.map(g=>e.jsx(ta,{actionText:g.title,className:g.className,onClick:g.onClick},g.title)),e.jsx(aa,{actionsList:b,ariaLabel:`Action menu for Domain ${r}`})]})}),ya=p.memo(s=>{const{domain:a,onDisableOrEnable:r,onClone:d,onRemove:i,onEdit:l}=s;return e.jsxs(pe,{"data-qa-domain-cell":a.domain,ariaLabel:`Domain ${a.domain}`,children:[e.jsx(w,{"data-qa-domain-label":!0,children:e.jsx(Ca,{children:a.type!=="slave"?e.jsx(Ae,{to:`/domains/${a.id}`,tabIndex:0,children:a.domain}):e.jsx(Le,{onClick:()=>s.onEdit(a),children:a.domain})})}),e.jsxs(w,{statusCell:!0,"data-qa-domain-status":!0,children:[e.jsx(Xe,{status:fa(a.status)}),Da(a.status)]}),e.jsxs(ce,{smDown:!0,children:[e.jsx(w,{"data-qa-domain-type":!0,children:na(a.type)}),e.jsx(w,{"data-qa-domain-lastmodified":!0,children:e.jsx(Je,{value:a.updated})})]}),e.jsx(w,{actionCell:!0,children:e.jsx(xa,{domain:a,onDisableOrEnable:r,onRemove:i,onClone:d,onEdit:l})})]},a.id)}),Da=s=>{switch(s){case"active":return"Active";case"disabled":return"Disabled";case"edit_mode":return"Edit Mode";case"has_errors":return"Error";default:return"Unknown"}},fa=s=>{switch(s){case"active":return"active";case"disabled":return"inactive";case"edit_mode":return"inactive";case"has_errors":return"error";default:return"inactive"}},Ca=Y("div",{label:"StyledDiv"})({alignItems:"center",display:"flex",flexFlow:"row nowrap",whiteSpace:"nowrap"}),le=s=>{const{onClose:a,open:r}=s,{data:d}=q(),{data:i}=V(),l=$(),{error:c,mutateAsync:u,reset:m}=Be(),t=H({initialValues:{domain:"",remote_nameserver:""},onSubmit:async D=>{const v=await u(D);l.push(`/domains/${v.id}`)}}),n=()=>{a(),t.resetForm(),m()},h=ue(["domain","remote_nameserver"],c),b=h.none,g=h.domain,C=h.remote_nameserver,y=(d==null?void 0:d.restricted)&&!(i!=null&&i.global.add_domains);return e.jsxs(U,{onClose:n,open:r,title:"Import a Zone",children:[y&&e.jsx(E,{variant:"error",children:"You do not have permission to create new Domains."}),e.jsxs("form",{onSubmit:t.handleSubmit,children:[b&&e.jsx(E,{text:b,variant:"error"}),e.jsx(k,{disabled:y,errorText:g,id:"domain",label:"Domain",name:"domain",onChange:t.handleChange,value:t.values.domain}),e.jsx(k,{disabled:y,errorText:C,id:"remote_nameserver",label:"Remote Nameserver",name:"remote_nameserver",onChange:t.handleChange,value:t.values.remote_nameserver}),e.jsx(Z,{primaryButtonProps:{disabled:!t.dirty,label:"Import",loading:t.isSubmitting,type:"submit"},secondaryButtonProps:{label:"Cancel",onClick:n}})]})]})},ja={description:"A comprehensive, reliable, and fast DNS service that provides easy domain management for no additional cost.",subtitle:"Easy domain management",title:"Domains"},va={links:[{text:"Overview of DNS Manager",to:"https://www.linode.com/docs/products/networking/dns-manager/"},{text:"Getting Started with DNS Manager",to:"https://www.linode.com/docs/products/networking/dns-manager/get-started/"},{text:"Create a Domain Zone",to:"https://www.linode.com/docs/products/networking/dns-manager/guides/create-domain/"}],moreInfo:{text:"View additional DNS Manager guides",to:"https://www.linode.com/docs/products/networking/dns-manager/guides/"},title:"Getting Started Guides"},Sa={links:[{external:!0,text:"Linode DNS Manager | Total Control Over Your DNS Records",to:"https://www.youtube.com/watch?v=ganwcCm53Qs"},{external:!0,text:"Using Domains with Your Server | Common DNS Configurations",to:"https://www.youtube.com/watch?v=Vb1JsfZlFLE"},{external:!0,text:"Connect a Domain to a Linode Server",to:"https://www.youtube.com/watch?v=mKfx4ryuMtY"}],moreInfo:{text:sa,to:ra},title:"Video Playlist"},z={action:"Click:link",category:"Domains landing page empty"},wa=s=>{const{navigateToCreate:a,openImportZoneDrawer:r}=s;return e.jsx(ia,{buttonProps:[{children:"Create Domain",onClick:()=>{te({action:"Click:button",category:z.category,label:"Create Domain"}),a()}},{children:"Import a Zone",onClick:()=>{te({action:"Click:button",category:z.category,label:"Import a Zone"}),r()}}],gettingStartedGuidesData:va,headers:ja,icon:Oe,linkAnalyticsEvent:z,youtubeLinkData:Sa})},Ea=s=>{var v,T,L,_,B,P,O;const{domain:a,onClose:r,open:d}=s,{data:i}=q(),{data:l}=V(),{error:c,mutateAsync:u,reset:m}=G(),t=H({enableReinitialize:!0,initialValues:{axfr_ips:a==null?void 0:a.axfr_ips,domain:a==null?void 0:a.domain,master_ips:a==null?void 0:a.master_ips,soa_email:a==null?void 0:a.soa_email,tags:a==null?void 0:a.tags},onSubmit:async o=>{var S,I;if(!a)return;const j=(S=o==null?void 0:o.master_ips)==null?void 0:S.filter(A=>A!==""),R=(I=o==null?void 0:o.axfr_ips)==null?void 0:I.filter(A=>A!==""),x=a.type==="master"?{domain:o.domain,id:a.id,soa_email:o.soa_email,tags:o.tags}:{axfr_ips:R,domain:o.domain,id:a.id,master_ips:j,tags:o.tags};await u(x),r()}}),n=ue(["axfr_ips","master_ips","domain","type","soa_email","tags","defaultNodeBalancer","defaultLinode"],c);p.useEffect(()=>{d&&(m(),t.resetForm())},[d]);const h=(a==null?void 0:a.type)==="master",b=(a==null?void 0:a.type)==="slave",g=o=>{const j=o.length>0?o.map(re):[""];t.setFieldValue("axfr_ips",j)},C=o=>{const j=o.length>0?o.map(re):[""];t.setFieldValue("master_ips",j)},y=!(i!=null&&i.restricted&&((v=l==null?void 0:l.domain.find(o=>o.id===(a==null?void 0:a.id)))==null?void 0:v.permissions)==="read_only"),D=!y;return e.jsxs(U,{onClose:r,open:d,title:"Edit Domain",children:[!y&&e.jsx(E,{variant:"error",children:"You do not have permission to modify this Domain."}),n.none&&e.jsx(E,{variant:"error",children:n.none}),e.jsxs("form",{onSubmit:t.handleSubmit,children:[e.jsxs(he,{"aria-label":"type",name:"type",row:!0,value:a==null?void 0:a.type,children:[e.jsx(F,{control:e.jsx(N,{}),"data-qa-domain-radio":"Primary",disabled:!0,label:"Primary",value:"master"}),e.jsx(F,{control:e.jsx(N,{}),"data-qa-domain-radio":"Secondary",disabled:!0,label:"Secondary",value:"slave"})]}),e.jsx(k,{"data-qa-domain-name":!0,"data-testid":"domain-name-input",disabled:D,errorText:n.domain,id:"domain",label:"Domain",name:"domain",onChange:t.handleChange,value:t.values.domain}),h&&e.jsx(k,{"data-qa-soa-email":!0,"data-testid":"soa-email-input",disabled:D,errorText:n.soa_email,id:"soa_email",label:"SOA Email Address",name:"soa_email",onBlur:o=>da(o,t),onChange:t.handleChange,type:"email",value:t.values.soa_email}),b&&e.jsxs(p.Fragment,{children:[e.jsx(oe,{error:n.master_ips,ips:((L=(T=t.values)==null?void 0:T.master_ips)==null?void 0:L.map(se))??[],onChange:C,title:"Primary Nameserver IP Address"}),b&&e.jsx(oe,{error:n.axfr_ips,helperText:oa,ips:((B=(_=t.values)==null?void 0:_.axfr_ips)==null?void 0:B.map(se))??[],onChange:g,title:"Domain Transfer IPs"})]}),e.jsx(la,{onChange:o=>t.setFieldValue("tags",o.map(j=>j.value)),value:((O=(P=t.values)==null?void 0:P.tags)==null?void 0:O.map(o=>({label:o,value:o})))??[],disabled:D,tagError:n.tags}),e.jsx(Z,{primaryButtonProps:{"data-testid":"submit",disabled:D||!t.dirty,label:"Save Changes",loading:t.isSubmitting,type:"submit"},secondaryButtonProps:{"data-testid":"cancel",label:"Cancel",onClick:r}})]})]})},ka="/domains/create",de="domains",lt=s=>{var ee;const a=$(),r=Re(),{enqueueSnackbar:d}=Me(),{data:i}=q(),l=We(1,de),{handleOrderChange:c,order:u,orderBy:m}=Ke({order:"asc",orderBy:"domain"},`${de}-order`),t={"+order":u,"+order_by":m},{data:n,error:h,isLoading:b}=Fe({page:l.page,page_size:l.pageSize},t),g=n!==void 0&&n.results>0,{data:C}=Ne({},{},g),y=!!(i!=null&&i.restricted),{domainForEditing:D}=s,[v,T]=p.useState(!1),[L,_]=p.useState(!1),[B,P]=p.useState(!1),[O,o]=p.useState(!1),[j,R]=p.useState(!1),[x,S]=p.useState(),{error:I,isLoading:A,mutateAsync:ge}=qe((x==null?void 0:x.id)??0),{mutateAsync:be}=G(),xe=f=>{S(f),o(!0)},Q=f=>{S(f),R(!0)};p.useEffect(()=>{D&&Q(D)},[D]);const K=()=>{a.push(ka)},W=()=>{T(!0)},J=()=>{T(!1)},ye=f=>{S(f),_(!0)},X=()=>{_(!1)},De=()=>{ge().then(()=>{X()})},fe={onClone:xe,onDisableOrEnable:(f,ae)=>{f==="enable"?be({id:ae.id,status:"active"}).catch(je=>d(ne(je,"There was an issue enabling your domain")[0].reason,{variant:"error"})):(S(ae),P(!0))},onEdit:Q,onRemove:ye};if(b)return e.jsx(Ze,{});if(h)return e.jsx(Ye,{errorText:"There was an error retrieving your domains. Please reload and try again."});if((n==null?void 0:n.results)===0)return e.jsxs(e.Fragment,{children:[e.jsx(wa,{navigateToCreate:K,openImportZoneDrawer:W}),e.jsx(le,{onClose:J,open:v})]});const Ce=!y&&(C==null?void 0:C.results)===0&&n&&n.results>0;return e.jsxs(e.Fragment,{children:[e.jsx(ze,{segment:"Domains"}),e.jsx(pa,{hidden:!Ce}),((ee=r.state)==null?void 0:ee.recordError)&&e.jsx(E,{text:r.state.recordError,variant:"error"}),e.jsx(Ge,{extraActions:e.jsx(Ta,{buttonType:"secondary",onClick:W,children:"Import a Zone"}),docsLink:"https://www.linode.com/docs/platform/manager/dns-manager/",entity:"Domain",onButtonClick:K,title:"Domains"}),e.jsxs(Ue,{children:[e.jsx(ma,{children:e.jsxs(pe,{children:[e.jsx(M,{active:m==="domain",direction:u,handleClick:c,label:"domain",children:"Domain"}),e.jsx(M,{active:m==="status",direction:u,handleClick:c,label:"status",children:"Status"}),e.jsxs(ce,{smDown:!0,children:[e.jsx(M,{active:m==="type",direction:u,handleClick:c,label:"type",children:"Type"}),e.jsx(M,{active:m==="updated",direction:u,handleClick:c,label:"updated",children:"Last Modified"})]}),e.jsx(w,{})]})}),e.jsx(Qe,{children:n==null?void 0:n.data.map(f=>e.jsx(ya,{domain:f,...fe},f.id))})]}),e.jsx(He,{count:(n==null?void 0:n.results)||0,eventCategory:"Domains Table",handlePageChange:l.handlePageChange,handleSizeChange:l.handlePageSizeChange,page:l.page,pageSize:l.pageSize}),e.jsx(le,{onClose:J,open:v}),e.jsx(ua,{domain:x,onClose:()=>P(!1),open:B}),e.jsx(ca,{domain:x,onClose:()=>o(!1),open:O}),e.jsx(Ea,{domain:x,onClose:()=>R(!1),open:j}),e.jsx($e,{error:I?ne(I,"Error deleting Domain.")[0].reason:void 0,entity:"domain",label:(x==null?void 0:x.domain)??"Unknown",loading:A,onClose:X,onDelete:De,open:L,typeToConfirm:!0})]})},Ta=Y(Ve,{label:"StyledButton"})(({theme:s})=>({marginLeft:`-${s.spacing()}`,whiteSpace:"nowrap"}));export{lt as DomainsLanding};
