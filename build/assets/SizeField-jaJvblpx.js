import{r as A,j as e,bI as X,m as G,aW as ee,u as oe,ao as ne,bp as te,ba as ie,h2 as ae,dw as se,dx as le,cx as re,bi as w,dD as ce,h3 as de,h4 as ue,Q as me,B as m,aa as pe,T as H,gV as M,ad as R,bB as $,dB as ge,f as he,c3 as xe,bJ as fe,bN as be}from"./index-Eksrs3uK.js";import{U as ye}from"./constants-KokzTiEs.js";import{g as ve}from"./dynamicPricing-n5eCZqTg.js";import{u as Se}from"./formik.esm-Kap5lsIh.js";import{L as je}from"./LandingHeader-JXAVBhqg.js";import{a as Ce,R as Te}from"./RegionSelect-_Z8IGlox.js";import{L as _e}from"./LinodeSelect-y7DOgXsC.js";import{h as Be,a as Ie}from"./formikErrorUtils-jhqfCjwU.js";import{m as k}from"./maybeCastToNumber-Xn7NqvW6.js";import{F as Ve}from"./FormControl-CNHz4Ctl.js";import{u as we}from"./configs-3PoBJaCX.js";const ke=({regionId:o,size:n})=>{const r=n&&n>=10?n/10:0;return ve({basePrice:r,regionId:o})},Ae=A.memo(o=>{const{error:n,linodeId:r,name:c,onBlur:u,onChange:l,value:p,width:b,...g}=o,{data:s,error:y}=we(r??-1,r!==null),a=s==null?void 0:s.map(i=>({label:i.label,value:i.id}));return A.useEffect(()=>{if((a==null?void 0:a.length)===1){const i=a[0].value;p!==i&&l(a[0].value)}},[a,l,p]),r===null?null:e.jsx(Ve,{fullWidth:!b,style:{marginTop:20,width:b},children:e.jsx(X,{errorText:n??y?"An error occurred while retrieving configs for this Linode.":void 0,noOptionsMessage:()=>!s||s.length==0?"No configs are available for this Linode.":"No options.",onChange:i=>{l(+i.value)},id:c,isClearable:!1,label:"Config",name:c,noMarginTop:!0,onBlur:u,options:a,placeholder:"Select a Config",value:a==null?void 0:a.find(i=>i.value===p),...g})})}),N=160,Ne=G()(o=>({agreement:{maxWidth:"70%",[o.breakpoints.down("sm")]:{maxWidth:"unset"}},button:{marginTop:o.spacing(2),[o.breakpoints.down("md")]:{marginRight:o.spacing()}},buttonGroup:{marginTop:o.spacing(3),[o.breakpoints.down("sm")]:{justifyContent:"flex-end"}},copy:{marginBottom:o.spacing(),maxWidth:700},labelTooltip:{"& .MuiTooltip-tooltip":{minWidth:220}},linodeConfigSelectWrapper:{[o.breakpoints.down("md")]:{alignItems:"flex-start",flexDirection:"column"}},linodeSelect:{marginRight:o.spacing(4)},notice:{borderColor:o.color.green,fontSize:15,lineHeight:"18px"},select:{[o.breakpoints.down("sm")]:{width:320},width:400},size:{position:"relative",width:N},tooltip:{"& .MuiTooltip-tooltip":{minWidth:320}}})),ze=()=>{const o=ee(),{classes:n}=Ne(),r=oe(),{data:c}=ne(),{data:u}=te(),{data:l}=ie(),{mutateAsync:p}=ae(),{data:b}=se(),[g,s]=A.useState(!1),{mutateAsync:y}=le(),a=(l==null?void 0:l.filter(t=>t.capabilities.includes("Block Storage")).map(t=>t.id))??[],i=(c==null?void 0:c.restricted)&&!(u!=null&&u.global.add_volumes),j=t=>e.jsx(xe,{sxTooltipIcon:{marginBottom:"6px",marginLeft:o.spacing(),padding:0},classes:{popper:n.tooltip},status:"help",text:t,tooltipPosition:"right"}),{enqueueSnackbar:_}=re(),{errors:h,handleBlur:x,handleChange:z,handleSubmit:O,isSubmitting:U,setFieldValue:f,status:P,touched:v,values:d}=Se({initialValues:W,onSubmit:(t,{resetForm:S,setErrors:C,setStatus:L,setSubmitting:I})=>{const{config_id:E,label:K,linode_id:F,region:V,size:D}=t;I(!0),L(void 0),p({config_id:E===null?void 0:k(E),label:K,linode_id:F===null?void 0:k(F),region:w(V)||V==="none"?void 0:V,size:k(D)}).then(T=>{g&&y({eu_model:!0,privacy_policy:!0}).catch(ce),S({values:W}),I(!1),_("Volume scheduled for creation.",{variant:"success"}),r.push("/volumes",{volume:T}),de(`Size: ${D}GB`,origin)}).catch(T=>{I(!1),Be(C,T),Ie(L,T,"Unable to create a volume at this time. Please try again later.")})},validationSchema:ue}),{config_id:q,linode_id:Q}=d,Y=v.linode_id?h.linode_id:void 0,{showGDPRCheckbox:B}=Ce({agreements:b,profile:c,regions:l,selectedRegionId:d.region}),Z=!!(i||B&&!g),J=t=>{t!==null?(f("linode_id",t.id),f("region",t.region)):(f("linode_id",null),f("config_id",null))};return e.jsxs(e.Fragment,{children:[e.jsx(me,{segment:"Create a Volume"}),e.jsx(je,{breadcrumbProps:{crumbOverrides:[{label:"Volumes",position:1}],pathname:location.pathname},title:"Create"}),e.jsx("form",{onSubmit:O,children:e.jsxs(m,{display:"flex",flexDirection:"column",children:[e.jsxs(pe,{children:[e.jsx(H,{className:n.copy,"data-qa-volume-size-help":!0,variant:"body1",children:e.jsxs("span",{children:["A single Volume can range from 10 to ",M," GB in size. Up to to eight Volumes can be attached to a single Linode. Select a region to see cost per GB."]})}),P&&e.jsx(R,{spacingBottom:0,spacingTop:12,text:P,variant:"error"}),i&&e.jsx(R,{text:"You don't have permissions to create a new Volume. Please contact an account administrator for details.",important:!0,spacingBottom:0,variant:"error"}),e.jsx($,{tooltipText:`Use only ASCII letters, numbers,
                  underscores, and dashes.`,className:n.select,"data-qa-volume-label":!0,disabled:i,errorText:v.label?h.label:void 0,label:"Label",name:"label",onBlur:x,onChange:z,tooltipClasses:n.labelTooltip,tooltipPosition:"right",value:d.label}),e.jsxs(m,{alignItems:"flex-end",display:"flex",children:[e.jsx(Te,{handleSelection:t=>{f("region",t),f("linode_id",null)},currentCapability:"Block Storage",disabled:i,errorText:v.region?h.region:void 0,isClearable:!0,label:"Region",onBlur:x,regions:l??[],selectedId:d.region,width:400}),j("Volumes must be created in a region. You can choose to create a Volume in a region and attach it later to a Linode in the same region.")]}),e.jsxs(m,{alignItems:"flex-end",className:n.linodeConfigSelectWrapper,display:"flex",children:[e.jsxs(m,{alignItems:"flex-end",className:n.linodeSelect,display:"flex",children:[e.jsx(_e,{optionsFilter:t=>{const S=t.region,C=d.region;return w(C)?a.includes(S):a.includes(S)&&S===C},sx:{[o.breakpoints.down("sm")]:{width:320},width:"400px"},clearable:!0,disabled:i,errorText:Y,onBlur:x,onSelectionChange:J,value:d.linode_id}),j("If you select a Linode, the Volume will be automatically created in that Linodeâ€™s region and attached upon creation.")]}),e.jsx(Ae,{disabled:i,error:v.config_id?h.config_id:void 0,linodeId:Q,name:"configId",onBlur:x,onChange:t=>f("config_id",t),value:q,width:(o.breakpoints.down("sm"),320)})]}),e.jsx(m,{alignItems:"flex-end",display:"flex",position:"relative",children:e.jsx(Le,{disabled:i,error:v.size?h.size:void 0,hasSelectedRegion:!w(d.region),name:"size",onBlur:x,onChange:z,regionId:d.region,textFieldStyles:n.size,value:d.size})}),e.jsx(m,{alignItems:"center",className:n.buttonGroup,display:"flex",flexWrap:"wrap",justifyContent:B?"space-between":"flex-end",children:B?e.jsx(ge,{centerCheckbox:!0,checked:g,className:n.agreement,onChange:t=>s(t.target.checked)}):null})]}),e.jsx(m,{display:"flex",justifyContent:"flex-end",children:e.jsx(he,{buttonType:"primary",className:n.button,"data-qa-deploy-linode":!0,disabled:Z,loading:U,style:{marginLeft:12},type:"submit",children:"Create Volume"})})]})})]})},W={config_id:null,label:"",linode_id:null,region:"",size:20},qe=Object.freeze(Object.defineProperty({__proto__:null,SIZE_FIELD_WIDTH:N,VolumeCreate:ze},Symbol.toStringTag,{value:"Module"})),Pe=G()(o=>({createVolumeText:{display:"block",marginLeft:o.spacing(1.5)},priceDisplay:{"& p":{lineHeight:1,marginTop:4},left:`calc(${N}px + ${o.spacing(2)})`,position:"absolute",top:50}})),Le=o=>{const{classes:n}=Pe(),{error:r,hasSelectedRegion:c,isFromLinode:u,name:l,onBlur:p,onChange:b,regionId:g,resize:s,textFieldStyles:y,value:a,...i}=o,j=s?`This volume can range from ${s} GB to ${M} GB in size.`:void 0,_=ke({regionId:g,size:a}),h=e.jsx(fe,{children:s||u?null:e.jsxs("span",{className:n.createVolumeText,children:["$",_??ye,"/month"]})}),x=!s&&!u&&e.jsx(m,{marginLeft:"10px",marginTop:"4px",children:e.jsx(H,{children:"Select a region to see cost per month."})});return e.jsxs(e.Fragment,{children:[e.jsx($,{InputProps:{endAdornment:e.jsx(be,{position:"end",children:" GB "})},className:y,"data-qa-size":!0,errorText:r,helperText:j,label:"Size",name:l,onBlur:p,onChange:b,required:!0,type:"number",value:a,...i}),e.jsx("div",{className:n.priceDisplay,children:c?h:x})]})};export{Ae as C,Le as S,qe as V,ke as g};
