import{r as u,b3 as R,ba as z,ao as W,ap as te,j as e,lu as $,T as j,a1 as D,$ as N,co as q,cn as ae,i0 as se,i1 as oe,s as g,lv as ne,u as re,di as le,W as w,V as ie,G as O,m as ce,b4 as de,lw as ue,E as me,C as be,Q as he,dk as je,ad as H,lx as ge,ly as xe}from"./index-Eksrs3uK.js";import{O as pe}from"./OrderBy-H-bWJCPy.js";import{T as ye}from"./TypeToConfirmDialog-9yjZCCL0.js";import{u as ke}from"./useOpenClose-GWPIoKTB.js";import{C as we}from"./CancelNotice-81V60KA8.js";import{C as fe}from"./CopyTooltip-mIyzAQ7E.js";import{D as Ce}from"./Drawer-A9yKjC3Z.js";import{A as Se}from"./AccessSelect-HbZAM-Pg.js";import{y as ve,b as Be,R as De}from"./ResourcesSection-fJQ13r7x.js";import{P as Te}from"./Paginate-XLm_-WxT.js";import{P as Le}from"./PaginationFooter-NHWf7fW2.js";import{T as V,a as C,b as Oe,c as Re}from"./TableRow-phXfWUGW.js";import{T as v}from"./TableSortCell-hcsagFzN.js";import{D as ze}from"./DateTimeDisplay-bXC9mIcz.js";import{A as qe}from"./ActionMenu-4CPisA_2.js";import{I as P}from"./InlineMenuAction-d5mRENST.js";import{T as Ae}from"./TableHead-Si_pzkLK.js";import"./splitAt-pbTnq2Oi.js";import"./TypeToConfirm-koQ3u5up.js";import"./index-Y5esPPk-.js";import"./Toggle-AbahDP9J.js";import"./utilities-12-n12_Y.js";import"./ListItem-joIHQeyv.js";const Ee=u.memo(t=>{const{bucketLabel:a,cluster:n,created:c,hostname:s,objectsNumber:o,onClose:m,open:f,size:x}=t,{data:d}=R(),{data:l}=z(),{data:i}=W(),b=d==null?void 0:d.find(k=>k.id===n),p=l==null?void 0:l.find(k=>k.id===(b==null?void 0:b.region));let y;try{c&&(y=te(c,{timezone:i==null?void 0:i.timezone}))}catch{}return e.jsxs(Ce,{onClose:m,open:f,title:$(a??"Bucket Detail"),children:[y?e.jsxs(j,{"data-testid":"createdTime",variant:"subtitle2",children:["Created: ",y]}):null,n?e.jsx(j,{"data-testid":"cluster",variant:"subtitle2",children:(p==null?void 0:p.label)??n}):null,s?e.jsxs($e,{children:[e.jsx(D,{external:!0,to:`https://${s}`,children:$(s,50)}),e.jsx(Ie,{sx:{marginLeft:4},text:s})]}):null,y||n?e.jsx(N,{spacingBottom:16,spacingTop:16}):null,typeof x=="number"?e.jsx(j,{variant:"subtitle2",children:q(x).formatted}):null,typeof o=="number"?e.jsx(D,{to:`/object-storage/buckets/${n}/${a}`,children:ae("object","objects",o)}):null,typeof x=="number"||typeof o=="number"?e.jsx(N,{spacingBottom:16,spacingTop:16}):null,n&&a?e.jsx(Se,{updateAccess:(k,S)=>se(n,a,k==="custom"?{cors_enabled:S}:{acl:k,cors_enabled:S}),getAccess:()=>oe(n,a),name:a,variant:"bucket"}):null]})}),Ie=g(fe,{label:"StyledRootContainer"})(()=>({marginLeft:"1em",padding:0})),$e=g("span",{label:"StyledLinkContainer"})(()=>({display:"flex"})),Ne={description:"",subtitle:"S3-compatible storage solution",title:"Object Storage"},Pe={links:[{text:"Overview of Object Storage",to:"https://www.linode.com/docs/products/storage/object-storage/"},{text:"Using the Linode CLI with Object Storage",to:"https://www.linode.com/docs/products/storage/object-storage/guides/linode-cli"},{text:"Use Object Storage with s3cmd",to:"https://www.linode.com/docs/products/storage/object-storage/guides/s3cmd"},{text:"Use Object Storage with s4cmd",to:"https://www.linode.com/docs/products/storage/object-storage/guides/s4cmd"},{text:"Use Object Storage with Cyberduck",to:"https://www.linode.com/docs/products/storage/object-storage/guides/cyberduck"}],moreInfo:{text:"View additional Object Storage documentation",to:"https://www.linode.com/docs/products/storage/object-storage/"},title:"Getting Started Guides"},Ue={links:[{external:!0,text:"Getting Started with S3 Object Storage on Linode",to:"https://www.youtube.com/watch?v=q88OKsr5l6c"},{external:!0,text:"S3 Object Storage Simply Explained",to:"https://www.youtube.com/watch?v=7J3_NAq7fz0"},{external:!0,text:"Deploy a Static Website Using the Linode CLI and Object Storage",to:"https://www.youtube.com/watch?v=ZfGyeJ8jYxI"}],moreInfo:{text:ve,to:Be},title:"Video Playlist"},U={action:"Click:link",category:"Object Storage landing page empty"},Ge=g(ne)(()=>({transform:"scale(0.80)"})),Me=()=>{const t=re();return e.jsx(De,{buttonProps:[{children:"Create Bucket",onClick:()=>{le({action:"Click:button",category:U.category,label:"Create Bucket"}),t.replace("/object-storage/buckets/create")}}],gettingStartedGuidesData:Pe,headers:Ne,icon:Ge,linkAnalyticsEvent:U,showTransferDisplay:!0,youtubeLinkData:Ue})},We=t=>{const a=[{onClick:()=>{t.onDetails()},title:"Details"},{onClick:()=>{t.onRemove()},title:"Delete"}];return e.jsxs(He,{children:[e.jsxs(w,{mdDown:!0,children:[e.jsx(P,{onClick:()=>{t.onDetails()},actionText:"Details"}),e.jsx(P,{onClick:()=>{t.onRemove()},actionText:"Delete"})]}),e.jsx(w,{mdUp:!0,children:e.jsx(qe,{actionsList:a,ariaLabel:`Action menu for Bucket ${t.label}`})})]})},He=g("div",{label:"StyledRootContainer"})(()=>({display:"flex",justifyContent:"flex-end",padding:0})),Ve=g(V,{label:"StyledBucketRow"})(({theme:t})=>({backgroundColor:t.bg.white})),Je=g("div",{label:"StyledBucketNameWrapper"})(()=>({alignItems:"center",display:"flex",flexFlow:"row nowrap",wordBreak:"break-all"})),Qe=g(ie,{label:"StyledBucketLabelLink"})(()=>({"&:hover, &:focus":{textDecoration:"underline"}})),Ke=g(C,{label:"StyledBucketRegionCell"})(()=>({width:"20%"})),Ye=g(C,{label:"StyledBucketSizeCell"})(()=>({width:"15%"})),Ze=g(C,{label:"StyledBucketObjectsCell"})(()=>({width:"10%"})),Xe=t=>{const{cluster:a,created:n,hostname:c,label:s,objects:o,onDetails:m,onRemove:f,size:x}=t,{data:d}=R(),{data:l}=z(),i=d==null?void 0:d.find(p=>p.id===a),b=l==null?void 0:l.find(p=>p.id===(i==null?void 0:i.region));return e.jsxs(Ve,{ariaLabel:s,"data-qa-bucket-cell":s,children:[e.jsx(C,{children:e.jsx(O,{alignItems:"center",container:!0,spacing:2,wrap:"nowrap",children:e.jsxs(O,{children:[e.jsx(Je,{children:e.jsx(j,{component:"h3","data-qa-label":!0,variant:"body1",children:e.jsxs(Qe,{to:`/object-storage/buckets/${a}/${s}`,children:[s," "]})})}),c]})})}),e.jsx(w,{smDown:!0,children:e.jsx(Ke,{children:e.jsx(j,{"data-qa-region":!0,variant:"body1",children:(b==null?void 0:b.label)??a})})}),e.jsx(w,{lgDown:!0,children:e.jsx(C,{children:e.jsx(ze,{"data-qa-created":!0,value:n})})}),e.jsx(Ye,{noWrap:!0,children:e.jsx(j,{"data-qa-size":!0,variant:"body1",children:q(x).formatted})}),e.jsx(w,{smDown:!0,children:e.jsx(Ze,{children:e.jsx(j,{"data-qa-size":!0,variant:"body1",children:o})})}),e.jsx(C,{children:e.jsx(We,{cluster:a,"data-qa-action-menu":!0,label:s,onDetails:m,onRemove:f})})]},s)},_e=t=>{const{data:a,handleClickDetails:n,handleClickRemove:c,handleOrderChange:s,order:o,orderBy:m}=t;return e.jsx(Te,{data:a,pageSize:25,children:({count:f,data:x,handlePageChange:d,handlePageSizeChange:l,page:i,pageSize:b})=>e.jsxs(u.Fragment,{children:[e.jsxs(Oe,{"aria-label":"List of your Buckets",children:[e.jsx(Ae,{children:e.jsxs(V,{children:[e.jsx(v,{active:m==="label","data-qa-name":!0,direction:o,handleClick:s,label:"label",children:"Name"}),e.jsx(w,{smDown:!0,children:e.jsx(v,{active:m==="cluster","data-qa-region":!0,direction:o,handleClick:s,label:"cluster",children:"Region"})}),e.jsx(w,{lgDown:!0,children:e.jsx(v,{active:m==="created","data-qa-created":!0,direction:o,handleClick:s,label:"created",children:"Created"})}),e.jsx(v,{active:m==="size","data-qa-size":!0,direction:o,handleClick:s,label:"size",children:"Size"}),e.jsx(w,{smDown:!0,children:e.jsx(v,{active:m==="objects","data-qa-objects":!0,direction:o,handleClick:s,label:"objects",children:"Objects"})}),e.jsx(C,{})]})}),e.jsx(Re,{children:e.jsx(Fe,{data:x,onDetails:n,onRemove:c})})]}),e.jsx(Le,{count:f,eventCategory:"object storage landing",handlePageChange:d,handleSizeChange:l,page:i,pageSize:b})]})})},Fe=t=>{const{data:a,onDetails:n,onRemove:c}=t;return e.jsx(e.Fragment,{children:a.map(s=>u.createElement(Xe,{...s,key:`${s.label}-${s.cluster}`,onDetails:()=>n(s),onRemove:()=>c(s)}))})},et=ce()(t=>({copy:{marginTop:t.spacing()}})),Bt=()=>{const{data:t}=W(),a=t==null?void 0:t.restricted,{data:n,error:c,isLoading:s}=R(),{data:o,error:m,isLoading:f}=de(n),{mutateAsync:x}=ue(),{classes:d}=et(),l=ke(),[i,b]=u.useState(void 0),[p,y]=u.useState(!1),[k,S]=u.useState(void 0),[A,E]=u.useState(!1),[r,J]=u.useState(void 0),Q=h=>{E(!0),J(h)},K=()=>{E(!1)},Y=h=>{b(h),S(void 0),l.open()},Z=()=>{if(!i)return;S(void 0),y(!0);const{cluster:h,label:T}=i;x({cluster:h,label:T}).then(()=>{l.close(),y(!1),ge(h)}).catch(L=>{xe(h),y(!1),S(L)})},X=u.useCallback(()=>{l.close()},[l]),B=(o==null?void 0:o.errors.map(h=>h.cluster))||[];if(a)return e.jsx(G,{});if(c||m)return e.jsx(me,{"data-qa-error-state":!0,errorText:"There was an error retrieving your buckets. Please reload and try again."});if(s||f||o===void 0)return e.jsx(be,{});if((o==null?void 0:o.buckets.length)===0)return e.jsxs(e.Fragment,{children:[B.length>0&&e.jsx(M,{unavailableClusters:B}),e.jsx(G,{})]});const _=at(o.buckets),I=i?i.label:"";return e.jsxs(u.Fragment,{children:[e.jsx(he,{segment:"Buckets"}),B.length>0&&e.jsx(M,{unavailableClusters:B}),e.jsxs(O,{xs:12,children:[e.jsx(pe,{data:o.buckets,order:"asc",orderBy:"label",children:({data:h,handleOrderChange:T,order:L,orderBy:F})=>{const ee={data:h,handleClickDetails:Q,handleClickRemove:Y,handleOrderChange:T,order:L,orderBy:F};return e.jsx(_e,{...ee})}}),o.buckets.length>1?e.jsxs(j,{style:{marginTop:18,textAlign:"center",width:"100%"},variant:"body1",children:["Total storage used: ",q(_).formatted]}):null,e.jsx(je,{spacingTop:o.buckets.length>1?8:18})]}),e.jsxs(ye,{entity:{action:"deletion",name:I,primaryBtnText:"Delete",type:"Bucket"},errors:k,label:"Bucket Name",loading:p,onClick:Z,onClose:X,open:l.isOpen,title:`Delete Bucket ${I}`,typographyStyle:{marginTop:"20px"},children:[e.jsx(H,{variant:"warning",children:e.jsxs(j,{style:{fontSize:"0.875rem"},children:[e.jsx("strong",{children:"Warning:"})," Deleting a bucket is permanent and canâ€™t be undone."]})}),e.jsxs(j,{className:d.copy,children:["A bucket must be empty before deleting it. Please"," ",e.jsx(D,{to:"https://www.linode.com/docs/platform/object-storage/lifecycle-policies/",children:"delete all objects"}),", or use"," ",e.jsx(D,{to:"https://www.linode.com/docs/platform/object-storage/how-to-use-object-storage/#object-storage-tools",children:"another tool"})," ","to force deletion."]}),(o==null?void 0:o.buckets.length)===1&&e.jsx(we,{className:d.copy})]}),e.jsx(Ee,{bucketLabel:r==null?void 0:r.label,cluster:r==null?void 0:r.cluster,created:r==null?void 0:r.created,hostname:r==null?void 0:r.hostname,objectsNumber:r==null?void 0:r.objects,onClose:K,open:A,size:r==null?void 0:r.size})]})},G=()=>e.jsx(Me,{}),M=u.memo(({unavailableClusters:t})=>{const{data:a}=z(),n=t.map(c=>{var s;return((s=a==null?void 0:a.find(o=>o.id===c.region))==null?void 0:s.label)??c.region});return e.jsx(tt,{regionsAffected:n})}),tt=u.memo(({regionsAffected:t})=>{const a=t.length>1;return e.jsx(H,{important:!0,variant:"warning",children:e.jsxs(j,{component:"div",style:{fontSize:"1rem"},children:["There was an error loading buckets in"," ",a?"the following regions:":`${t[0]}.`,e.jsx("ul",{children:a&&t.map(n=>e.jsx("li",{children:n},n))}),"If you have buckets in"," ",a?"these regions":t[0],", you may not see them listed below."]})})}),at=t=>t.reduce((a,n)=>(a+=n.size,a),0);export{Bt as BucketLanding,at as sumBucketUsage};
