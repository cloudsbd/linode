var ne=Object.defineProperty;var le=(s,l,e)=>l in s?ne(s,l,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[l]=e;var i=(s,l,e)=>(le(s,typeof l!="symbol"?l+"":l,e),e);import{c9 as ee,cj as de,f3 as ce,c6 as pe,bj as m,s as u,f as $,cx as me,hf as he,r as L,j as t,an as G,p as z,ad as I,ag as te,eX as N,bI as k,bB as U,cb as b,h8 as ue,le as ge,G as C,cA as R,d3 as fe,fV as xe,g as Te,Q as be,T as re,ai as W,af as Se,bM as ye,lf as Fe,ab as Ae,a_ as Re,d5 as De,lg as Ce,b as je,u as ve,e as Ee,hg as Ne,ha as we,lh as Pe,C as _e,E as Z,aa as Le}from"./index-Eksrs3uK.js";import{L as Me}from"./LandingHeader-JXAVBhqg.js";import{T as ke}from"./TagsPanel-CYEBNrGy.js";import{D as Oe}from"./DeletionDialog-MVB4bfuG.js";import{l as B,o as Q}from"./over-27tc0FF7.js";import{O as Ie}from"./OrderBy-H-bWJCPy.js";import{P as Be}from"./Paginate-XLm_-WxT.js";import{P as Ve}from"./PaginationFooter-NHWf7fW2.js";import{a as ae,b as Xe,T as J,c as qe}from"./TableRow-phXfWUGW.js";import{T as $e}from"./TableRowEmpty-aXmC67-Z.js";import{s as ie}from"./scrollErrorIntoView-6n4Cku1Y.js";import{A as Ge}from"./ActionMenu-4CPisA_2.js";import{p as He}from"./immer.esm--MpJ8fpr.js";import{c as ze}from"./cond-gNmMu4CH.js";import{p as f}from"./pick-ELd0PGNj.js";import{s as Ue}from"./set-2Chj4B2I.js";import{D as We}from"./Drawer-A9yKjC3Z.js";import{M as Ze}from"./MultipleIPInput-NQt3M-F3.js";import{g as w}from"./getAPIErrorFor-OfQrArkQ.js";import{s as Qe,e as Je}from"./ipUtils-P4y3JNCT.js";import{m as Ke}from"./maybeCastToNumber-Xn7NqvW6.js";import{t as Ye,b as et,i as tt,c as rt}from"./domainUtils-mqxZFuqB.js";import{T as at}from"./TableHead-Si_pzkLK.js";import{d as it}from"./downloadFile-7KribbgA.js";import"./tags-kBUFHmv1.js";import"./TypeToConfirm-koQ3u5up.js";import"./assocPath-nNkv7F8U.js";import"./splitAt-pbTnq2Oi.js";import"./ipaddr-jlottelM.js";var st=ee(de),ot=ee(function(l,e){return ce([l],e)}),nt=pe(function(l,e,r){return m(e,r[l])});const lt=s=>{const{domainId:l,domainLabel:e}=s,{enqueueSnackbar:r}=me(),{mutateAsync:a,error:o,isLoading:n}=he(l),[d,c]=L.useState(!1),g=()=>{a().then(()=>{r("Domain deleted successfully.",{variant:"success"}),s.onSuccess&&s.onSuccess()})};return t.jsxs(t.Fragment,{children:[t.jsx(dt,{buttonType:"outlined",onClick:()=>c(!0),children:"Delete Domain"}),t.jsx(Oe,{typeToConfirm:!0,entity:"domain",open:d,label:e,loading:n,error:o?G(o,"Error deleting domain.")[0].reason:void 0,onClose:()=>c(!1),onDelete:g})]})},dt=u($,{label:"StyledButton"})(({theme:s})=>({[s.breakpoints.down("lg")]:{marginRight:s.spacing()}})),x=s=>{const{deleteData:l,editPayload:e,onEdit:r}=s,a=()=>{r(e)},o=()=>{l.onDelete(l.recordID)},n=[{onClick:()=>{a()},title:"Edit"},st("deleteData",s)?{onClick:()=>{o()},title:"Delete"}:null].filter(Boolean);return t.jsx(Ge,{actionsList:n,ariaLabel:`Action menu for Record ${s.label}`})},p=class p extends L.Component{constructor(){super(...arguments);i(this,"DefaultTTLField",()=>t.jsx(this.MSSelect,{field:"ttl_sec",fn:this.setTTLSec,label:"Default TTL"}));i(this,"DomainTransferField",()=>{const e=(this.state.fields.axfr_ips??[""]).map(Qe);return t.jsx(Ze,{error:w(p.errorFields,this.state.errors)("axfr_ips"),helperText:Ye,ips:e,onChange:this.handleTransferUpdate,title:"Domain Transfer IPs"})});i(this,"ExpireField",()=>{const e=[{label:"Default",value:0},{label:"1 week",value:604800},{label:"2 weeks",value:1209600},{label:"4 weeks",value:2419200}],r=e.find(a=>a.value===N(p.defaultFieldsState(this.props).expire_sec,this.state.fields.expire_sec));return t.jsx(k,{textFieldProps:{dataAttrs:{"data-qa-domain-select":"Expire Rate"}},defaultValue:r,isClearable:!1,label:"Expire Rate",onChange:a=>this.setExpireSec(a.value),options:e})});i(this,"MSSelect",({field:e,fn:r,label:a})=>{const o=[{label:"Default",value:0},{label:"30 seconds",value:30},{label:"2 minutes",value:120},{label:"5 minutes",value:300},{label:"1 hour",value:3600},{label:"2 hours",value:7200},{label:"4 hours",value:14400},{label:"8 hours",value:28800},{label:"16 hours",value:57600},{label:"1 day",value:86400},{label:"2 days",value:172800},{label:"4 days",value:345600},{label:"1 week",value:604800},{label:"2 weeks",value:1209600},{label:"4 weeks",value:2419200}],n=o.find(d=>d.value===N(p.defaultFieldsState(this.props)[e],this.state.fields[e]));return t.jsx(k,{textFieldProps:{dataAttrs:{"data-qa-domain-select":a}},defaultValue:n,isClearable:!1,label:a,onChange:d=>r(d.value),options:o})});i(this,"NameOrTargetField",({field:e,label:r,multiline:a})=>{const{domain:o,type:n}=this.props,d=this.state.fields[e],c=d.indexOf("@")>=0&&X(n,e);return t.jsx(this.TextField,{placeholder:X(n,e)?"hostname or @ for root":void 0,field:e,helperText:c?se(d,o):void 0,label:r,multiline:a})});i(this,"NumberField",({field:e,label:r,...a})=>t.jsx(U,{errorText:w(p.errorFields,this.state.errors)(e),onBlur:o=>this.updateField(e)(o.target.value),onChange:o=>this.updateField(e)(o.target.value),"data-qa-target":r,label:r,type:"number",value:this.state.fields[e],...a}));i(this,"PortField",()=>t.jsx(this.NumberField,{field:"port",label:"Port"}));i(this,"PriorityField",e=>t.jsx(this.NumberField,{field:"priority",...e}));i(this,"ProtocolField",()=>{const e=[{label:"tcp",value:"tcp"},{label:"udp",value:"udp"},{label:"xmpp",value:"xmpp"},{label:"tls",value:"tls"},{label:"smtp",value:"smtp"}],r=e.find(a=>a.value===N(p.defaultFieldsState(this.props).protocol,this.state.fields.protocol));return t.jsx(k,{textFieldProps:{dataAttrs:{"data-qa-domain-select":"Protocol"}},defaultValue:r,isClearable:!1,label:"Protocol",onChange:a=>this.setProtocol(a.value),options:e})});i(this,"RefreshRateField",()=>t.jsx(this.MSSelect,{field:"refresh_sec",fn:this.setRefreshSec,label:"Refresh Rate"}));i(this,"RetryRateField",()=>t.jsx(this.MSSelect,{field:"retry_sec",fn:this.setRetrySec,label:"Retry Rate"}));i(this,"ServiceField",()=>t.jsx(this.TextField,{field:"service",label:"Service"}));i(this,"TTLField",()=>t.jsx(this.MSSelect,{field:"ttl_sec",fn:this.setTTLSec,label:"TTL"}));i(this,"TagField",()=>{const e=[{label:"issue",value:"issue"},{label:"issuewild",value:"issuewild"},{label:"iodef",value:"iodef"}],r=e.find(a=>a.value===N(p.defaultFieldsState(this.props).tag,this.state.fields.tag));return t.jsx(k,{textFieldProps:{dataAttrs:{"data-qa-domain-select":"caa tag"}},defaultValue:r||e[0],isClearable:!1,label:"Tag",onChange:a=>this.setTag(a.value),options:e})});i(this,"TextField",({field:e,helperText:r,label:a,multiline:o,placeholder:n,trimmed:d})=>t.jsx(U,{errorText:w(p.errorFields,this.state.errors)(e),onBlur:c=>this.updateField(e)(c.target.value),onChange:c=>this.updateField(e)(c.target.value),value:N(p.defaultFieldsState(this.props)[e],this.state.fields[e]),"data-qa-target":a,helperText:r,label:a,multiline:o,placeholder:n,trimmed:d}));i(this,"WeightField",()=>t.jsx(this.NumberField,{field:"weight",label:"Weight"}));i(this,"filterDataByType",(e,r)=>ze([[()=>m("master",r),()=>f(["domain","soa_email","refresh_sec","retry_sec","expire_sec","ttl_sec","axfr_ips"],e)],[()=>m("A",r),()=>f(["name","target","ttl_sec"],e)],[()=>m("AAAA",r),()=>f(["name","target","ttl_sec"],e)],[()=>m("CAA",r),()=>f(["name","tag","target","ttl_sec"],e)],[()=>m("CNAME",r),()=>f(["name","target","ttl_sec"],e)],[()=>m("MX",r),()=>f(["target","priority","ttl_sec","name"],e)],[()=>m("NS",r),()=>f(["target","name","ttl_sec"],e)],[()=>m("SRV",r),()=>f(["service","protocol","priority","port","weight","target","ttl_sec"],e)],[()=>m("TXT",r),()=>f(["name","target","ttl_sec"],e)]])());i(this,"handleRecordSubmissionSuccess",()=>{this.props.updateRecords(),this.onClose()});i(this,"handleSubmissionErrors",e=>{const r=G(e);this.setState({errors:r,submitting:!1},()=>{ie()})});i(this,"handleTransferUpdate",e=>{const r=e.length>0?e.map(Je):[""];this.updateField("axfr_ips")(r)});i(this,"onClose",()=>{this.setState({errors:void 0,fields:p.defaultFieldsState({}),submitting:!1}),this.props.onClose()});i(this,"onDomainEdit",()=>{const{domainId:e,type:r,updateDomain:a}=this.props;this.setState({errors:void 0,submitting:!0});const o={...this.filterDataByType(this.state.fields,r)};o.axfr_ips&&(o.axfr_ips=o.axfr_ips.filter(n=>n!=="").map(n=>n.trim())),a({id:e,...o,status:"active"}).then(()=>{this.onClose()}).catch(this.handleSubmissionErrors)});i(this,"onRecordCreate",()=>{const{domain:e,records:r,type:a}=this.props;if(a==="master"||a==="slave")return;this.setState({errors:void 0,submitting:!0});const o={type:a,...this.filterDataByType(this.state.fields,a)};let n=K(o,e,a);n=Y(n);const d=b("",["name"],n),c=n.type==="CNAME"&&!tt(d,r);if(!rt(d,r)||c){const g={field:"name",reason:"Record conflict - CNAMES must be unique"};this.handleSubmissionErrors([g]);return}ue(this.props.domainId,n).then(this.handleRecordSubmissionSuccess).catch(this.handleSubmissionErrors)});i(this,"onRecordEdit",()=>{const{domain:e,domainId:r,id:a,type:o}=this.props,n=this.state.fields;if(o==="master"||o==="slave"||!a)return;this.setState({errors:void 0,submitting:!0});const d={...this.filterDataByType(n,o)};let c=K(d,e,o);c=Y(c),ge(r,a,c).then(this.handleRecordSubmissionSuccess).catch(this.handleSubmissionErrors)});i(this,"updateField",e=>r=>this.setState(Ue(B(["fields",e]),r)));i(this,"setExpireSec",this.updateField("expire_sec"));i(this,"setProtocol",this.updateField("protocol"));i(this,"setRefreshSec",this.updateField("refresh_sec"));i(this,"setRetrySec",this.updateField("retry_sec"));i(this,"setTTLSec",this.updateField("ttl_sec"));i(this,"setTag",this.updateField("tag"));i(this,"state",{fields:p.defaultFieldsState(this.props),submitting:!1});i(this,"types",{AAAA:{fields:[e=>t.jsx(this.NameOrTargetField,{field:"name",label:"Hostname"},e),e=>t.jsx(this.NameOrTargetField,{field:"target",label:"IP Address"},e),e=>t.jsx(this.TTLField,{},e)]},CAA:{fields:[e=>t.jsx(this.NameOrTargetField,{field:"name",label:"Name"},e),e=>t.jsx(this.TagField,{},e),e=>t.jsx(this.NameOrTargetField,{field:"target",label:"Value"},e),e=>t.jsx(this.TTLField,{},e)]},CNAME:{fields:[e=>t.jsx(this.NameOrTargetField,{field:"name",label:"Hostname"},e),e=>t.jsx(this.NameOrTargetField,{field:"target",label:"Alias to"},e),e=>t.jsx(this.TTLField,{},e),,]},MX:{fields:[e=>t.jsx(this.NameOrTargetField,{field:"target",label:"Mail Server"},e),,e=>t.jsx(this.PriorityField,{label:"Preference",max:255,min:0},e),e=>t.jsx(this.TTLField,{},e),e=>t.jsx(this.NameOrTargetField,{field:"name",label:"Subdomain"},e)]},NS:{fields:[e=>t.jsx(this.NameOrTargetField,{field:"target",label:"Name Server"},e),e=>t.jsx(this.NameOrTargetField,{field:"name",label:"Subdomain"},e),e=>t.jsx(this.TTLField,{},e)]},SRV:{fields:[e=>t.jsx(this.ServiceField,{},e),e=>t.jsx(this.ProtocolField,{},e),e=>t.jsx(this.PriorityField,{label:"Priority",max:255,min:0},e),e=>t.jsx(this.WeightField,{},e),e=>t.jsx(this.PortField,{},e),e=>t.jsx(this.NameOrTargetField,{field:"target",label:"Target"},e),e=>t.jsx(this.TTLField,{},e)]},TXT:{fields:[e=>t.jsx(this.NameOrTargetField,{field:"name",label:"Hostname"},e),e=>t.jsx(this.NameOrTargetField,{field:"target",label:"Value",multiline:!0},e),e=>t.jsx(this.TTLField,{},e)]},master:{fields:[e=>t.jsx(this.TextField,{field:"domain",label:"Domain"},e),e=>t.jsx(this.TextField,{field:"soa_email",label:"SOA Email",trimmed:!0},e),e=>t.jsx(this.DomainTransferField,{},e),e=>t.jsx(this.DefaultTTLField,{},e),e=>t.jsx(this.RefreshRateField,{},e),e=>t.jsx(this.RetryRateField,{},e),e=>t.jsx(this.ExpireField,{},e)]}})}componentDidUpdate(e){this.props.open&&!e.open&&this.setState({fields:p.defaultFieldsState(this.props)})}render(){const{submitting:e}=this.state,{mode:r,open:a,records:o,type:n}=this.props,{fields:d}=this.types[n],c=r==="create",g=n==="master"||n==="slave",j=o.find(h=>["A","AAAA"].includes(h.type)),v="Please create an A/AAAA record for this domain to avoid a Zone File invalidation.",D=[w({},this.state.errors)("_unknown"),w({},this.state.errors)("none")].filter(Boolean);return t.jsxs(We,{onClose:this.onClose,open:a,title:`${z([r],ct)} ${z([n],pt)} Record`,children:[D.length>0&&D.map((h,S)=>t.jsx(I,{variant:"error",text:h},S)),!j&&n==="NS"&&t.jsx(I,{spacingTop:8,text:v,variant:"warning"}),d.map((h,S)=>h(S)),t.jsx(te,{primaryButtonProps:{"data-testid":"save",disabled:e,label:"Save",loading:e,onClick:g?this.onDomainEdit:c?this.onRecordCreate:this.onRecordEdit},secondaryButtonProps:{"data-testid":"cancel",label:"Cancel",onClick:this.onClose}})]})}};i(p,"defaultFieldsState",e=>({axfr_ips:et(e.axfr_ips),domain:e.domain,expire_sec:e.expire_sec??0,id:e.id,name:e.name??"",port:e.port??"80",priority:e.priority??"10",protocol:e.protocol??"tcp",refresh_sec:e.refresh_sec??0,retry_sec:e.retry_sec??0,service:e.service??"",soa_email:e.soa_email??"",tag:e.tag??"issue",target:e.target??"",ttl_sec:e.ttl_sec??0,weight:e.weight??"5"})),i(p,"errorFields",{axfr_ips:"domain transfers",domain:"domain",expire_sec:"expire rate",name:"name",port:"port",priority:"priority",protocol:"protocol",refresh_sec:"refresh rate",retry_sec:"retry rate",service:"service",soa_email:"SOA email address",tag:"tag",target:"target",ttl_sec:"ttl_sec",type:"type",weight:"weight"});let V=p;const ct={create:"Create",edit:"Edit"},pt={A:"A",AAAA:"A/AAAA",CAA:"CAA",CNAME:"CNAME",MX:"MX",NS:"NS",PTR:"PTR",SRV:"SRV",TXT:"TXT",master:"SOA",slave:"SOA"},X=(s,l)=>{switch(s){case"AAAA":return l==="name";case"SRV":return l==="target";case"CNAME":return l==="target";default:return!1}},se=(s,l)=>s.replace(/\@/,l),K=(s,l,e)=>{const r={...s};for(const[a,o]of Object.entries(r))X(e,a)&&typeof o=="string"&&(r[a]=se(o,l));return r},mt=["port","weight","priority"],Y=(s,l=mt)=>He(s,e=>{l.forEach(r=>{e[r]=Ke(e[r])})}),ht=u(C,{label:"StyledGrid"})(({theme:s})=>({margin:0,marginTop:s.spacing(2),width:"100%","& .MuiGrid-item":{paddingLeft:0,paddingRight:0},"& .domain-btn":{[s.breakpoints.down("lg")]:{marginRight:s.spacing()}},[s.breakpoints.down("md")]:{marginLeft:s.spacing(),marginRight:s.spacing()}})),ut=u(ae,{label:"StyledTabelCell"})(({theme:s})=>({whiteSpace:"nowrap",width:"auto","& .data":{maxWidth:300,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",[s.breakpoints.up("md")]:{maxWidth:750}},"&:last-of-type":{display:"flex",justifyContent:"flex-end"}})),gt=u("div",{label:"StyledDiv"})(({theme:s})=>({[s.breakpoints.down("md")]:{marginLeft:s.spacing(),marginRight:s.spacing()}})),F=(s,l)=>t.jsx($,{buttonType:"primary",className:"domain-btn",onClick:l,children:s}),_=class _ extends L.Component{constructor(e){super(e);i(this,"confirmDeletion",e=>this.updateConfirmDialog(r=>({...r,open:!0,recordId:e})));i(this,"deleteDomainRecord",()=>{const{domain:{id:e}}=this.props,{confirmDialog:{recordId:r}}=this.state;!e||!r||(this.updateConfirmDialog(a=>({...a,errors:void 0,submitting:!0})),Fe(e,r).then(()=>{this.props.updateRecords(),this.updateConfirmDialog(a=>({errors:void 0,open:!1,recordId:void 0,submitting:!1}))}).catch(a=>{const o=G(a);this.updateConfirmDialog(n=>({...n,errors:o,submitting:!1}))}),this.updateConfirmDialog(a=>({...a,submitting:!0})))});i(this,"eventsSubscription$");i(this,"generateTypes",()=>[{columns:[{render:e=>e.domain,title:"Primary Domain"},{render:e=>e.soa_email,title:"Email"},{render:R(P,b(0,["ttl_sec"])),title:"Default TTL"},{render:R(P,b(0,["refresh_sec"])),title:"Refresh Rate"},{render:R(P,b(0,["retry_sec"])),title:"Retry Rate"},{render:R(P,b(0,["expire_sec"])),title:"Expire Time"},{render:e=>e.type==="master"?t.jsx(x,{editPayload:e,label:this.props.domain.domain,onEdit:this.handleOpenSOADrawer}):null,title:""}],data:[this.props.domain],order:"asc",orderBy:"domain",title:"SOA Record"},{columns:[{render:e=>e.target,title:"Name Server"},{render:e=>{const r=e.name,{domain:{domain:a}}=this.props;return Ae(r)?a:`${r}.${a}`},title:"Subdomain"},{render:A,title:"TTL"},{render:({id:e,name:r,target:a,ttl_sec:o})=>e===-1?null:t.jsx(x,{deleteData:{onDelete:this.confirmDeletion,recordID:e},editPayload:{id:e,name:r,target:a,ttl_sec:o},label:r,onEdit:this.openForEditNSRecord}),title:""}],data:xt(this.props),link:()=>F("Add an NS Record",this.openForCreateNSRecord),order:"asc",orderBy:"target",title:"NS Record"},{columns:[{render:e=>e.target,title:"Mail Server"},{render:e=>String(e.priority),title:"Preference"},{render:e=>e.name,title:"Subdomain"},{render:A,title:"TTL"},{render:({id:e,name:r,priority:a,target:o,ttl_sec:n})=>t.jsx(x,{deleteData:{onDelete:this.confirmDeletion,recordID:e},editPayload:{id:e,name:r,priority:a,target:o,ttl_sec:n},label:r,onEdit:this.openForEditMXRecord}),title:""}],data:this.props.domainRecords.filter(T("MX")),link:()=>F("Add a MX Record",this.openForCreateMXRecord),order:"asc",orderBy:"target",title:"MX Record"},{columns:[{render:e=>e.name||this.props.domain.domain,title:"Hostname"},{render:e=>e.target,title:"IP Address"},{render:A,title:"TTL"},{render:({id:e,name:r,target:a,ttl_sec:o})=>t.jsx(x,{deleteData:{onDelete:this.confirmDeletion,recordID:e},editPayload:{id:e,name:r,target:a,ttl_sec:o},label:r||this.props.domain.domain,onEdit:this.openForEditARecord}),title:""}],data:this.props.domainRecords.filter(e=>T("AAAA",e)||T("A",e)),link:()=>F("Add an A/AAAA Record",this.openForCreateARecord),order:"asc",orderBy:"name",title:"A/AAAA Record"},{columns:[{render:e=>e.name,title:"Hostname"},{render:e=>e.target,title:"Aliases to"},{render:A,title:"TTL"},{render:({id:e,name:r,target:a,ttl_sec:o})=>t.jsx(x,{deleteData:{onDelete:this.confirmDeletion,recordID:e},editPayload:{id:e,name:r,target:a,ttl_sec:o},label:r,onEdit:this.openForEditCNAMERecord}),title:""}],data:this.props.domainRecords.filter(T("CNAME")),link:()=>F("Add a CNAME Record",this.openForCreateCNAMERecord),order:"asc",orderBy:"name",title:"CNAME Record"},{columns:[{render:e=>e.name,title:"Hostname"},{render:e=>Re(e.target,100),title:"Value"},{render:A,title:"TTL"},{render:({id:e,name:r,target:a,ttl_sec:o})=>t.jsx(x,{deleteData:{onDelete:this.confirmDeletion,recordID:e},editPayload:{id:e,name:r,target:a,ttl_sec:o},label:r,onEdit:this.openForEditTXTRecord}),title:""}],data:this.props.domainRecords.filter(T("TXT")),link:()=>F("Add a TXT Record",this.openForCreateTXTRecord),order:"asc",orderBy:"name",title:"TXT Record"},{columns:[{render:e=>e.name,title:"Name"},{render:()=>this.props.domain.domain,title:"Domain"},{render:e=>String(e.priority),title:"Priority"},{render:e=>String(e.weight),title:"Weight"},{render:e=>String(e.port),title:"Port"},{render:e=>e.target,title:"Target"},{render:A,title:"TTL"},{render:({id:e,port:r,priority:a,protocol:o,service:n,target:d,weight:c})=>t.jsx(x,{deleteData:{onDelete:this.confirmDeletion,recordID:e},editPayload:{id:e,port:r,priority:a,protocol:o,service:n,target:d,weight:c},label:this.props.domain.domain,onEdit:this.openForEditSRVRecord}),title:""}],data:this.props.domainRecords.filter(T("SRV")),link:()=>F("Add an SRV Record",this.openForCreateSRVRecord),order:"asc",orderBy:"name",title:"SRV Record"},{columns:[{render:e=>e.name,title:"Name"},{render:e=>e.tag,title:"Tag"},{render:e=>e.target,title:"Value"},{render:A,title:"TTL"},{render:({id:e,name:r,tag:a,target:o,ttl_sec:n})=>t.jsx(x,{deleteData:{onDelete:this.confirmDeletion,recordID:e},editPayload:{id:e,name:r,tag:a,target:o,ttl_sec:n},label:r,onEdit:this.openForEditCAARecord}),title:""}],data:this.props.domainRecords.filter(T("CAA")),link:()=>F("Add a CAA Record",this.openForCreateCAARecord),order:"asc",orderBy:"name",title:"CAA Record"}]);i(this,"handleCloseDialog",()=>{this.updateConfirmDialog(()=>({open:!1,recordId:void 0,submitting:!1}))});i(this,"handleOpenSOADrawer",e=>e.type==="master"?this.openForEditPrimaryDomain(e):this.openForEditSecondaryDomain(e));i(this,"openForCreateARecord",()=>this.openForCreation("AAAA"));i(this,"openForCreateCAARecord",()=>this.openForCreation("CAA"));i(this,"openForCreateCNAMERecord",()=>this.openForCreation("CNAME"));i(this,"openForCreateMXRecord",()=>this.openForCreation("MX"));i(this,"openForCreateNSRecord",()=>this.openForCreation("NS"));i(this,"openForCreateSRVRecord",()=>this.openForCreation("SRV"));i(this,"openForCreateTXTRecord",()=>this.openForCreation("TXT"));i(this,"openForCreation",e=>this.updateDrawer(()=>({mode:"create",open:!0,submitting:!1,type:e})));i(this,"openForEditARecord",e=>this.openForEditing("AAAA",e));i(this,"openForEditCAARecord",e=>this.openForEditing("CAA",e));i(this,"openForEditCNAMERecord",e=>this.openForEditing("CNAME",e));i(this,"openForEditMXRecord",e=>this.openForEditing("MX",e));i(this,"openForEditNSRecord",e=>this.openForEditing("NS",e));i(this,"openForEditPrimaryDomain",e=>this.openForEditing("master",e));i(this,"openForEditSRVRecord",e=>this.openForEditing("SRV",e));i(this,"openForEditSecondaryDomain",e=>this.openForEditing("slave",e));i(this,"openForEditTXTRecord",e=>this.openForEditing("TXT",e));i(this,"openForEditing",(e,r)=>this.updateDrawer(()=>({fields:r,mode:"edit",open:!0,submitting:!1,type:e})));i(this,"renderDialogActions",()=>t.jsx(te,{primaryButtonProps:{label:"Delete",loading:this.state.confirmDialog.submitting,onClick:this.deleteDomainRecord},secondaryButtonProps:{label:"Cancel",onClick:this.handleCloseDialog}}));i(this,"resetDrawer",()=>this.updateDrawer(()=>_.defaultDrawerState));i(this,"updateConfirmDialog",e=>this.setState(Q(B(["confirmDialog"]),e),()=>{ie()}));i(this,"updateDrawer",e=>this.setState(Q(B(["drawer"]),e)));this.state={confirmDialog:{open:!1,submitting:!1},drawer:_.defaultDrawerState,types:this.generateTypes()}}componentDidUpdate(e){(!m(e.domainRecords,this.props.domainRecords)||!m(e.domain,this.props.domain))&&this.setState({types:this.generateTypes()})}render(){const{domain:e,domainRecords:r}=this.props,{confirmDialog:a,drawer:o}=this.state;return t.jsxs(t.Fragment,{children:[t.jsx(be,{segment:`${e.domain} - DNS Records`}),this.state.types.map((n,d)=>{const c=L.createRef();return t.jsxs("div",{children:[t.jsxs(ht,{alignItems:"center",container:!0,justifyContent:"space-between",spacing:2,children:[t.jsx(C,{ref:c,sx:{paddingLeft:0,paddingRight:0},children:t.jsx(re,{"aria-level":2,className:"m0","data-qa-domain-record":n.title,role:"heading",variant:"h2",children:n.title})}),n.link&&t.jsxs(C,{sx:{paddingLeft:0,paddingRight:0},children:[" ",t.jsx(gt,{children:n.link()})," "]})]}),t.jsx(Ie,{data:n.data,order:n.order,orderBy:n.orderBy,children:({data:g})=>t.jsx(Be,{data:g,pageSize:W.infinitePageSize.get(),pageSizeSetter:W.infinitePageSize.set,scrollToRef:c,children:({count:j,data:v,handlePageChange:D,handlePageSizeChange:h,page:S,pageSize:O})=>t.jsxs(t.Fragment,{children:[t.jsxs(Xe,{"aria-label":`List of Domains ${n.title}`,children:[t.jsx(at,{children:t.jsx(J,{children:n.columns.length>0&&n.columns.map((E,y)=>t.jsx(ae,{children:E.title},y))})}),t.jsx(qe,{children:n.data.length===0?t.jsx($e,{colSpan:n.columns.length}):v.map((E,y)=>t.jsx(J,{"data-qa-record-row":n.title,children:n.columns.length>0&&n.columns.map(({render:M,title:H},oe)=>t.jsx(ut,{"data-qa-column":H,parentColumn:H,children:M(E)},oe))},y))})]}),t.jsx(Ve,{count:j,eventCategory:`${n.title.toLowerCase()} panel`,handlePageChange:D,handleSizeChange:h,page:S,pageSize:O,showAll:!1})]})})})]},d)}),t.jsx(Se,{error:a.errors?ye(a.errors):void 0,actions:this.renderDialogActions,onClose:this.handleCloseDialog,open:a.open,title:"Confirm Deletion",children:"Are you sure you want to delete this record?"}),t.jsx(V,{domain:this.props.domain.domain,domainId:this.props.domain.id,mode:o.mode,onClose:this.resetDrawer,open:o.open,records:r,type:o.type,updateDomain:this.props.updateDomain,updateRecords:this.props.updateRecords,...o.fields})]})}};i(_,"defaultDrawerState",{mode:"create",open:!1,type:"NS"});let q=_;const P=s=>b(null,[s],{0:"Default",30:"30 seconds",120:"2 minutes",300:"5 minutes",3600:"1 hour",7200:"2 hours",14400:"4 hours",28800:"8 hours",57600:"16 hours",86400:"1 day",172800:"2 days",345600:"4 days",604800:"1 week",1209600:"2 weeks",2419200:"4 weeks"}),A=R(P,b(0,["ttl_sec"])),T=nt("type"),ft=R(fe,ot([{id:-1,name:"",port:0,priority:0,protocol:null,service:null,tag:null,target:"ns1.linode.com",ttl_sec:0,type:"NS",weight:0},{id:-1,name:"",port:0,priority:0,protocol:null,service:null,tag:null,target:"ns2.linode.com",ttl_sec:0,type:"NS",weight:0},{id:-1,name:"",port:0,priority:0,protocol:null,service:null,tag:null,target:"ns3.linode.com",ttl_sec:0,type:"NS",weight:0},{id:-1,name:"",port:0,priority:0,protocol:null,service:null,tag:null,target:"ns4.linode.com",ttl_sec:0,type:"NS",weight:0},{id:-1,name:"",port:0,priority:0,protocol:null,service:null,tag:null,target:"ns5.linode.com",ttl_sec:0,type:"NS",weight:0}])),xt=R(ft,xe(T("NS")),b([],["domainRecords"])),Tt=Te(De)(q),bt=s=>{const{domainId:l,domainLabel:e}=s,r=async()=>{const a=await Ce(l),o=a==null?void 0:a.zone_file.join(`
`);o&&it(`${e}.txt`,o)};return t.jsx($,{buttonType:"secondary",onClick:r,children:"Download DNS Zone File"})},ar=()=>{const s=je(),l=Number(s.domainId),e=ve(),r=Ee(),{data:a,error:o,isLoading:n}=Ne(l),{mutateAsync:d}=we(),{data:c,error:g,isLoading:j,refetch:v}=Pe(l),[D,h]=L.useState(),S=y=>(h(void 0),a?d({domain:y,id:a.id}).catch(M=>(h(M[0].reason),Promise.reject(M))):Promise.reject("No Domain found.")),O=()=>(h(void 0),a==null?void 0:a.domain),E=y=>d({id:l,tags:y});return n||j?t.jsx(_e,{}):o?t.jsx(Z,{errorText:"There was an error retrieving your Domain."}):g?t.jsx(Z,{errorText:"There was an error retrieving your Domain's Records."}):a===void 0||c===void 0?null:t.jsxs(t.Fragment,{children:[t.jsx(Me,{breadcrumbProps:{labelOptions:{noCap:!0},onEditHandlers:{editableTextTitle:a.domain,errorText:D,onCancel:O,onEdit:S},pathname:r.pathname},extraActions:t.jsx(bt,{domainId:a.id,domainLabel:a.domain}),docsLabel:"Docs",docsLink:"https://www.linode.com/docs/guides/dns-manager/",title:"Domain Details"}),r.state&&r.state.recordError&&t.jsx(Ft,{variant:"error",text:r.state.recordError}),t.jsxs(At,{container:!0,children:[t.jsx(Rt,{xs:12,children:t.jsx(Tt,{domain:a,domainRecords:c,updateDomain:d,updateRecords:v})}),t.jsxs(Dt,{xs:12,children:[t.jsxs(yt,{children:[t.jsx(St,{"data-qa-title":!0,variant:"h3",children:"Tags"}),t.jsx(ke,{tags:a.tags,updateTags:E})]}),t.jsx(Ct,{children:t.jsx(lt,{domainId:a.id,domainLabel:a.domain,onSuccess:()=>e.push("/domains")})})]})]})]})},St=u(re,{label:"StyledTypography"})(({theme:s})=>({marginBottom:s.spacing(2)})),yt=u(Le,{label:"StyledPaper"})(({theme:s})=>({height:"93%",marginBottom:s.spacing(2),minHeight:"160px",padding:s.spacing(2.5)})),Ft=u(I,{label:"StyledNotice"})(({theme:s})=>({marginBottom:"0 !important",marginTop:`${s.spacing(3)} !important`})),At=u(C,{label:"StyledRootGrid"})(({theme:s})=>({marginBottom:s.spacing(3),marginLeft:0,marginRight:0})),Rt=u(C,{label:"StyledMainGrid"})(({theme:s})=>({"&.MuiGrid-item":{padding:0},[s.breakpoints.up("md")]:{order:1}})),Dt=u(C,{label:"StyledTagGrid"})(({theme:s})=>({"&.MuiGrid-item":{paddingLeft:0,paddingRight:0},[s.breakpoints.up("md")]:{marginTop:s.spacing(2),order:2}})),Ct=u("div",{label:"StyledDiv"})(({theme:s})=>({display:"flex",justifyContent:"flex-end",[s.breakpoints.down("lg")]:{marginLeft:s.spacing()}}));export{ar as DomainDetail};
