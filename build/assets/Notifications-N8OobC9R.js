import{av as _,aw as B,dV as w,l8 as Q,r as k,j as t,ad as v,T as l,ag as S,a1 as q,s as U,cx as L,c as C,dr as D,l9 as P,dE as F,ao as E,cH as O,aq as Y,af as z,Z as W,ap as $,J as G,la as H,cn as R,b as K,ig as J}from"./index-Eksrs3uK.js";import{u as V}from"./disks-ZTjtBBb6.js";import{a as Z}from"./LinodeDisks-jJddYOGd.js";import{D as X}from"./Drawer-A9yKjC3Z.js";import{L as f}from"./ListItem-joIHQeyv.js";import{M as ee}from"./MaintenanceBanner-5tjriDAX.js";import{u as te}from"./accountMaintenance-hC6-dGbb.js";import{u as ne}from"./useDialog-Tn1TxMfw.js";const re=a=>{const e=_();return B(()=>Q(a),{onSuccess(){e.invalidateQueries([w,"paginated"]),e.invalidateQueries([w,"all"]),e.invalidateQueries([w,"infinite"]),e.invalidateQueries([w,"linode",a,"details"])}})};class se extends k.Component{constructor(e){super(e),this.state={extendedUpgradeInfo:{disk:{currentAmount:e.currentTypeInfo.disk!==null?e.currentTypeInfo.disk/1024:e.currentTypeInfo.disk,label:"Storage",newAmount:e.mutateInfo.disk!==null?e.mutateInfo.disk/1024:e.mutateInfo.disk,unit:"GB"},memory:{currentAmount:e.currentTypeInfo.memory,label:"RAM",newAmount:e.mutateInfo.memory,unit:"MB"},network_out:{currentAmount:e.currentTypeInfo.network_out,label:"Outbound Mbits",newAmount:e.mutateInfo.network_out,unit:"Mbits"},transfer:{currentAmount:e.currentTypeInfo.transfer,label:"Transfer",newAmount:e.mutateInfo.transfer,unit:"GB"},vcpus:{currentAmount:e.currentTypeInfo.vcpus,label:"vCPUs",newAmount:e.mutateInfo.vcpus,unit:""}}}}render(){const{error:e,estimatedTimeToUpgradeInMins:u,handleClose:i,loading:s,open:n}=this.props,{extendedUpgradeInfo:c}=this.state;return t.jsxs(X,{onClose:i,open:n,title:"Free Upgrade Available",children:[e&&t.jsx(v,{text:e,variant:"error"}),t.jsx(l,{children:"This Linode has pending upgrades. The resources that are affected include:"}),this.props.isMovingFromSharedToDedicated?t.jsx(ae,{}):t.jsx("ul",{className:"nonMUI-list",children:Object.keys(c).map(d=>{const{currentAmount:r,label:o,newAmount:g,unit:h}=c[d];return g===null?null:t.jsx(f,{children:t.jsxs(l,{children:[o," goes from ",r," ",h," to"," ",t.jsxs("strong",{children:[g," ",h]})]})},o)})}),t.jsx(l,{style:{marginBottom:16,marginTop:32},variant:"h2",children:"How it Works"}),t.jsx(l,{children:"After entering the upgrade queue, the following will occur:"}),t.jsxs("ol",{className:"nonMUI-list",children:[t.jsx(f,{children:"Wait your turn in the upgrade queue."}),t.jsx(f,{children:"Your Linode will be shut down and its disk images will be migrated."}),t.jsx(f,{children:"Your Linode will be upgraded and booted (if it was previously running)."})]}),t.jsxs(l,{style:{marginTop:16},variant:"body1",children:["After the migration completes, you can take advantage of the new resources by resizing your disk images. We estimate this upgrade process will take"," ",t.jsxs("strong",{children:[u<1?"< 1":u,u<1?" minute":" minutes"]}),", but that may vary based on host and network load."]}),t.jsx(S,{primaryButtonProps:{label:"Enter the Upgrade Queue",loading:s,onClick:this.props.initMutation},style:{marginTop:32}}),t.jsxs(l,{style:{display:"none"},children:["Need help? Refer to the ",t.jsx(q,{external:!0,to:"google.com",children:"supporting documentation"}),"."]})]})}}const ae=()=>t.jsx("ul",{className:"nonMUI-list",children:t.jsx(f,{children:t.jsxs(l,{children:["Linode now uses ",t.jsx("strong",{children:"dedicated CPU cores"})]})})}),je=a=>{const{linodeId:e}=a,{enqueueSnackbar:u}=L(),{data:i}=C(e),{data:s}=D((i==null?void 0:i.type)??"",!!(i!=null&&i.type)),{data:n}=D((s==null?void 0:s.successor)??"",!!(s!=null&&s.successor)),{data:c}=V(e,n!==void 0),[d,r]=k.useState(!1),{error:o,isLoading:g,mutateAsync:h}=re(e),b=()=>{h().then(()=>{r(!1),F(),u("Linode upgrade has been initiated.",{variant:"info"})})},M=Z(c??[]),p=Math.ceil(M/P/60);if(!s||!n)return null;const{disk:x,memory:T,network_out:m,transfer:y,vcpus:j}=s;return t.jsxs(t.Fragment,{children:[t.jsx(v,{important:!0,variant:"warning",children:t.jsxs(l,{children:["You have a pending upgrade. The estimated time to complete this upgrade is"," "+(p<1?"< 1":p),p<1?" minute":" minutes",". To learn more,Â ",t.jsx(ie,{onKeyDown:I=>{I.key==="Enter"&&r(!0)},onClick:()=>r(!0),role:"button",tabIndex:0,children:"click here"}),"."]})}),t.jsx(se,{currentTypeInfo:{disk:s.disk,memory:s.memory,network_out:m,transfer:s.transfer,vcpus:s.vcpus},isMovingFromSharedToDedicated:oe(s.id,n.id),mutateInfo:{disk:n.disk!==x?n.disk:null,memory:n.memory!==T?n.memory:null,network_out:n.network_out!==m?n.network_out:null,transfer:n.transfer!==y?n.transfer:null,vcpus:n.vcpus!==j?n.vcpus:null},error:o==null?void 0:o[0].reason,estimatedTimeToUpgradeInMins:p,handleClose:()=>r(!1),initMutation:b,linodeId:e,loading:g,open:d})]})},ie=U("span",{label:"StyledSpan"})(({theme:a})=>({...a.applyLinkStyles})),oe=(a,e)=>a.startsWith("g6-highmem")&&e.startsWith("g7-highmem"),ue={critical:"error",major:"warning",minor:"warning"},ce=({severity:a,text:e})=>{const i={variant:ue[a]??"warning"};return t.jsx(v,{...i,important:!0,children:e})},le=k.memo(a=>{const{enqueueSnackbar:e}=L(),{linodeID:u,migrationTime:i,notificationMessage:s,notificationType:n,requestNotifications:c}=a,{data:d}=E(),{closeDialog:r,dialog:o,handleError:g,openDialog:h,submitDialog:b}=ne(m=>H(m)),M=()=>{b(u).then(m=>{e(n==="migration_scheduled"?"Your Linode has been entered into the migration queue.":"Your migration has been scheduled.",{variant:"success"}),c()}).catch(m=>{g(n==="migration_scheduled"?"An error occurred entering the migration queue.":"An error occurred scheduling your migration.")})},p=()=>t.jsx(S,{primaryButtonProps:{label:"Enter Migration Queue",loading:o.isLoading,onClick:M},secondaryButtonProps:{"data-testid":"cancel",label:"Cancel",onClick:r}}),x=n==="migration_scheduled"?"enter the migration queue now":"schedule your migration now",T=()=>{const m="You have a scheduled migration, which will automatically execute",y=W(i).toLocal(),j=$(i,{timezone:d==null?void 0:d.timezone}),I=G.local(),A=Math.round(y.diff(I,"hours").as("hours")),N=R("hour","hours",A);return A<=24?`${m} in approximately ${N} (${j}).`:`${m} on ${j}.`};return t.jsxs(t.Fragment,{children:[t.jsx(v,{important:!0,variant:"warning",children:t.jsxs(l,{children:[n==="migration_scheduled"?T():s," ",t.jsx(O,{onClick:()=>h(u),children:Y(x)}),"."]})}),t.jsx(z,{actions:p,error:o.error,onClose:()=>r(),open:o.isOpen,title:"Confirm Migration",children:t.jsxs(l,{variant:"subtitle1",children:["Are you sure you want to ",x,"?"]})})]})}),we=()=>{const{linodeId:a}=K(),{data:e}=C(Number(a)),{data:u,refetch:i}=J(),s=u==null?void 0:u.filter(r=>{var o;return((o=r.entity)==null?void 0:o.type)==="linode"&&r.entity.id===Number(a)}),{data:n}=te({},{status:{"+or":["pending, started"]}}),c=n==null?void 0:n.find(r=>r.entity.type==="linode"&&r.entity.id===(e==null?void 0:e.id)),d=r=>{switch(r.type){case"maintenance":return null;case"migration_pending":case"migration_scheduled":return(e==null?void 0:e.status)==="migrating"?null:t.jsx(le,{linodeID:Number(e==null?void 0:e.id),migrationTime:r.when,notificationMessage:r.message,notificationType:r.type,requestNotifications:i});default:return t.jsx(ce,{severity:r.severity,text:r.message})}};return t.jsxs(t.Fragment,{children:[s==null?void 0:s.map((r,o)=>t.jsx(k.Fragment,{children:d(r)},o)),c?t.jsx(ee,{maintenanceStart:c.when,type:c.type}):null]})};export{je as M,we as N};
