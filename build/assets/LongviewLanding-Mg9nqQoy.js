import{s as g,cp as Y,ad as S,c1 as K,r as i,j as e,aW as $,eq as Q,ao as X,bp as J,dg as D,jL as O,gO as Z,Q as ee,aa as te,f as ne,jM as ae,an as B,af as se,T as ie,ag as oe,g as re,_ as M,cx as le,K as ce,ab as de,jN as ue,bq as pe}from"./index-Eksrs3uK.js";import{L as ge}from"./LandingHeader-JXAVBhqg.js";import{S as k}from"./SafeTabPanel-S0Pp8CVT.js";import{T as me}from"./TabLinkList-BrXtJznm.js";import{T as he,a as be}from"./TabList-4PWL4GSj.js";import{w as xe}from"./longview.container-N5k_O7w1.js";import{u as E}from"./useAPIRequest-UcK5fafY.js";import{R as fe}from"./Radio-HudVgwMW.js";import{a as T,b as Se,T as A,c as ve}from"./TableRow-phXfWUGW.js";import{T as je}from"./TableRowError-8gKmGX7P.js";import{T as we}from"./TableRowLoading-iP7zIRHG.js";import{T as ye}from"./TableHead-Si_pzkLK.js";const Le=g(Y,{label:"StyledChip"})(({theme:t})=>({borderRadius:1,fontSize:"0.65rem",marginLeft:t.spacing(2),paddingLeft:t.spacing(.5),paddingRight:t.spacing(.5),textTransform:"uppercase"})),q=g(T,{label:"StyledClientCell"})(({theme:t})=>({[t.breakpoints.up("md")]:{width:"10%"}})),v=g(T,{label:"StyledDataOrPriceCell"})(({theme:t})=>({[t.breakpoints.up("md")]:{width:"15%"}})),Ce=g("div",{label:"StyledDiv"})(({theme:t})=>({alignItems:"center",display:"flex",marginLeft:2,paddingRight:t.spacing(3),[t.breakpoints.down("lg")]:{paddingRight:0}})),Te=g(S,{label:"StyledNotice"})(({theme:t})=>({"& a":{color:t.textColors.linkActiveLight},"& a:hover":{color:t.palette.primary.main}})),Pe=g(T,{label:"StyledPlanCell"})(({theme:t})=>({[t.breakpoints.up("md")]:{width:"40%"}})),Re=g(Se,{label:"StyledTable"})(({theme:t})=>({"& tbody tr":{cursor:"pointer"},"& td":{whiteSpace:"nowrap"},border:`1px solid ${t.borderColors.borderTable}`})),_e=g(A,{label:"StyledTableRow",shouldForwardProp:K(["disabled"])})(({disabled:t})=>({...t&&{cursor:"not-allowed"}})),j="longview-free",R=e.jsxs("span",{children:["Longview Pro is included with Linode Managed. If you need additional clients, please"," ",e.jsx(Q,{description:"",text:"contact Support",title:"Request for additional Longview clients"})," ","for additional Longview plan options."]}),F=t=>{const{subscriptionRequestHook:o}=t,r=$(),l=i.useRef(!1),{data:c}=X(),{data:s}=J(),{data:n}=D(),m=!!(n!=null&&n.managed),u=!(c!=null&&c.restricted)||(s==null?void 0:s.global.longview_subscription)&&s.global.account_access==="read_write",[p,h]=i.useState(void 0),[d,b]=i.useState(p||""),[w,x]=i.useState(!1),[f,a]=i.useState(""),[C,_]=i.useState("");i.useEffect(()=>(l.current=!0,()=>{l.current=!1}),[]),i.useEffect(()=>{O().then(y=>{if(!l.current)return;const L=y.id??j;h(L),b(L)}).catch(y=>{l.current&&a("Error loading your current Longview plan")})},[]);const z=()=>{if(d===p)return;x(!0),a(""),_(""),ae(d===j?{}:{longview_subscription:d}).then(L=>{x(!1),_("Plan updated successfully."),h(d)}).catch(L=>{const W=B(L,"There was an error updating your Longview Plan.");x(!1),a(W[0].reason)})},U=i.useCallback(y=>b(y.currentTarget.value),[]),V=!!o.error||p===d||u,G=!!o.error||p===d||!u;return c?e.jsxs(e.Fragment,{children:[e.jsx(ee,{segment:"Plan Details"}),m?e.jsxs(te,{sx:{minHeight:0,padding:r.spacing(3),paddingBottom:"4px"},children:[f&&e.jsx(S,{text:f,variant:"error"}),C&&e.jsx(S,{text:C,variant:"success"}),e.jsx(Te,{variant:"success",children:R})]}):e.jsxs(e.Fragment,{children:[u&&f&&e.jsx(S,{text:f,variant:"error"}),!u&&e.jsx(S,{important:!0,text:"You don't have permissions to change the Longview plan. Please contact an account administrator for details.",variant:"error"}),C&&e.jsx(S,{text:C,variant:"success"}),V&&e.jsxs(e.Fragment,{children:[e.jsxs(Re,{children:[e.jsx(ye,{children:e.jsxs(A,{children:[e.jsx(Pe,{children:"Plan"}),e.jsx(q,{children:"Clients"}),e.jsx(v,{children:"Data Retention"}),e.jsx(v,{children:"Data Resolution"}),e.jsx(v,{children:"Price"})]})}),e.jsx(ve,{children:e.jsx(I,{currentSubscriptionOnAccount:p,disabled:!u,error:o.error,loading:o.loading,onRadioSelect:U,onRowSelect:b,selectedSub:d,subscriptions:o.data})})]}),e.jsx(ne,{buttonType:"primary","data-testid":"submit-button",disabled:G,loading:w,onClick:z,sx:{marginBottom:r.spacing(3),marginTop:r.spacing(3)},children:"Change Plan"})]})]})]}):e.jsx(Z,{"data-testid":"loading"})},ke=i.memo(F),I=i.memo(t=>{const{error:o,loading:r,selectedSub:l,subscriptions:c,...s}=t;return r?e.jsx(we,{columns:5}):o&&o.length>0?e.jsx(je,{colSpan:12,message:o[0].reason}):e.jsxs(e.Fragment,{children:[e.jsx(P,{clients:10,dataResolution:"Every 5 minutes",dataRetention:"Limited to 12 hours",id:j,isSelected:l===j,plan:"Longview Free",price:"FREE",...s},j),c.map(n=>e.jsx(P,{clients:n.clients_included,dataResolution:"Every minute",dataRetention:"Unlimited",id:n.id,isSelected:l===n.id,plan:n.label,price:N(n.price),...s},n.id))]})}),P=i.memo(t=>{const{clients:o,currentSubscriptionOnAccount:r,dataResolution:l,dataRetention:c,disabled:s,id:n,isSelected:m,onRadioSelect:u,onRowSelect:p,plan:h,price:d}=t,b=$(),w=()=>{s||p(n)};return e.jsxs(_e,{ariaLabel:h,disabled:s,"data-testid":`lv-sub-table-row-${n}`,onClick:w,children:[e.jsx(T,{"data-testid":`plan-cell-${n}`,children:e.jsxs(Ce,{children:[e.jsx(fe,{checked:m,"data-testid":`lv-sub-radio-${n}`,disabled:s,id:n,onChange:u,sx:{marginLeft:`-${b.spacing(.5)}`,marginRight:b.spacing(2),padding:"2px"},value:n}),h,r===n&&e.jsx(Le,{"data-testid":`current-plan-${n}`,label:"Current Plan"})]})}),e.jsx(q,{"data-testid":`clients-cell-${n}`,children:o}),e.jsx(v,{"data-testid":`data-retention-cell-${n}`,children:c}),e.jsx(v,{"data-testid":`data-resolution-cell-${n}`,children:l}),e.jsx(v,{"data-testid":`price-cell-${n}`,children:d})]},n)}),N=t=>`$${t.hourly.toFixed(2)}/hr ($${t.monthly}/mo)`,Ee=Object.freeze(Object.defineProperty({__proto__:null,LONGVIEW_FREE_ID:j,LongviewPlans:F,LongviewPlansTableBody:I,LongviewSubscriptionRow:P,default:ke,formatPrice:N,managedText:R},Symbol.toStringTag,{value:"Module"})),$e=t=>{const{clientLimit:o,isManaged:r,isOpen:l,onClose:c,onSubmit:s}=t,n=()=>e.jsx(oe,{primaryButtonProps:{label:r?"Contact Support":"View upgrade options",onClick:s,role:"link"},secondaryButtonProps:{label:"Cancel",onClick:c}}),m=r?R:e.jsxs("span",{children:["Your current plan allows you to create up to ",o," clients. To create more clients and receive additional benefits, such as longer data retention and more frequent data updates, please upgrade your plan."]});return e.jsx(se,{actions:n,onClose:c,open:l,title:"Maximum Clients Reached",children:e.jsx(ie,{variant:"body1",children:m})})},De=i.lazy(()=>M(()=>import("./LongviewClients-q8S4Gl4o.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]))),Oe=i.lazy(()=>M(()=>Promise.resolve().then(()=>Ee),void 0)),H=t=>{const{enqueueSnackbar:o}=le(),r=E(()=>O().then(a=>a),{}),l=E(()=>ue().then(a=>a.data),[]),{createLongviewClient:c}=t,{data:s}=D(),n=!!(s!=null&&s.managed),[m,u]=i.useState(!1),[p,h]=i.useState(!1),d=[{routeName:`${t.match.url}/clients`,title:"Clients"},{routeName:`${t.match.url}/plan-details`,title:"Plan Details"}],b=a=>!!pe(a,{path:t.location.pathname}),w=a=>{t.history.push(d[a].routeName)},x=()=>{u(!0),c().then(a=>{u(!1),t.history.location.pathname!=="/longview/clients"&&t.history.push("/longview/clients")}).catch(a=>{a[0].reason.match(/subscription/)?h(!0):(o(B(a,"Error creating Longview client.")[0].reason,{variant:"error"}),u(!1))})},f=()=>{const{history:{push:a}}=t;if(n){a({pathname:"/support/tickets",state:{open:!0,title:"Request for additional Longview clients"}});return}t.history.push("/longview/plan-details")};return e.jsxs(e.Fragment,{children:[e.jsx(ge,{createButtonText:"Add Client",docsLink:"https://www.linode.com/docs/platform/longview/longview/",entity:"Client",loading:m,onButtonClick:x,removeCrumbX:1,title:"Longview"}),e.jsxs(Be,{index:Math.max(d.findIndex(a=>b(a.routeName)),0),onChange:w,children:[e.jsx(me,{tabs:d}),e.jsx(i.Suspense,{fallback:e.jsx(ce,{}),children:e.jsxs(he,{children:[e.jsx(k,{index:0,children:e.jsx(De,{activeSubscription:r.data,handleAddClient:x,newClientLoading:m,...t})}),e.jsx(k,{index:1,children:e.jsx(Oe,{subscriptionRequestHook:l})})]})})]}),e.jsx($e,{clientLimit:de(r.data)?10:r.data.clients_included,isManaged:n,isOpen:p,onClose:()=>h(!1),onSubmit:f})]})},Be=g(be,{label:"StyledTabs"})(()=>({marginTop:0})),Me=re(xe())(H),Ke=Object.freeze(Object.defineProperty({__proto__:null,LongviewLanding:H,default:Me},Symbol.toStringTag,{value:"Module"}));export{Ke as L,$e as S};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/LongviewClients-q8S4Gl4o.js","assets/index-Eksrs3uK.js","assets/index-RL6WRErT.css","assets/DebouncedSearchTextField-EUZwzd3g.js","assets/longview.container-N5k_O7w1.js","assets/formatUptime-T2o8loDP.js","assets/Drawer-A9yKjC3Z.js","assets/TableRow-phXfWUGW.js","assets/TableRowEmpty-aXmC67-Z.js","assets/useClientLastUpdated-a0PNleVi.js","assets/TableHead-Si_pzkLK.js","assets/utilities-JekaXHyt.js","assets/Paginate-XLm_-WxT.js","assets/PaginationFooter-NHWf7fW2.js","assets/ActionMenu-4CPisA_2.js","assets/LandingHeader-JXAVBhqg.js","assets/InstallationInstructions-co98NL17.js","assets/CopyTooltip-mIyzAQ7E.js","assets/index-Y5esPPk-.js","assets/SafeTabPanel-S0Pp8CVT.js","assets/TabList-4PWL4GSj.js","assets/TabLinkList-BrXtJznm.js","assets/useAPIRequest-UcK5fafY.js","assets/immer.esm--MpJ8fpr.js","assets/Radio-HudVgwMW.js","assets/TableRowError-8gKmGX7P.js","assets/TableRowLoading-iP7zIRHG.js","assets/Skeleton-iwmO4Yae.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}