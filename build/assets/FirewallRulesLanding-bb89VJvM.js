import{c9 as ve,cF as Ee,r as d,j as e,ad as re,bI as _,bB as Z,aq as O,T as B,d0 as ie,ag as z,s as S,aW as V,bD as Y,B as f,c1 as Ie,f as Se,cH as Re,W as H,jX as Fe,cA as Te,d2 as ke,mk as Ae,cx as Le,af as De,an as Oe}from"./index-Eksrs3uK.js";import{P as Be}from"./Prompt-hwoFL8xF.js";import{F as Me}from"./formik.esm-Kap5lsIh.js";import{D as Ne}from"./Drawer-A9yKjC3Z.js";import{P as M,a as de,e as _e,g as Ue,p as $e,b as We,v as Ge,i as ce,c as He,f as qe,s as ze,d as Ve}from"./FirewallRuleDrawer.utils-gE7QU4cL.js";import{M as Ye}from"./MultipleIPInput-NQt3M-F3.js";import{R as ue}from"./Radio-HudVgwMW.js";import{R as Ke}from"./RadioGroup-zpRjMzXK.js";import{h as Qe,i as pe,j as Xe,k as ge,p as Je,l as Ze,m as er}from"./shared-QcuPM2Px.js";import{i as rr}from"./ipUtils-P4y3JNCT.js";import{a as or}from"./uniq-xa8_MmzW.js";import{S as sr,D as tr,C as lr,P as ar}from"./drag-indicator-1t7mhJe7.js";import{A as nr}from"./ActionMenu-4CPisA_2.js";import{I as ir}from"./InlineMenuAction-d5mRENST.js";import{p as dr,K as cr}from"./immer.esm--MpJ8fpr.js";import"./ipaddr-jlottelM.js";import"./sortBy-avzW26A0.js";import"./_contains-91K6xqrF.js";var ur=ve(function(r,s){var t=r<0?s.length+r:r;return Ee(s)?s.charAt(t):s[t]}),N=ur(-1);const pr="If you do not specify a mask, /32 will be assumed for IPv4 addresses and /128 will be assumed for IPv6 addresses.",gr=d.memo(o=>{const{addressesLabel:r,category:s,errors:t,handleBlur:n,handleChange:i,handleSubmit:p,ips:h,mode:m,presetPorts:y,ruleErrors:c,setFieldError:w,setFieldValue:g,setIPs:C,setPresetPorts:u,status:D,touched:F,values:b}=o,I=y.some(l=>l.value===M.CUSTOM.value),T=y.some(l=>l.value===M.ALL.value)?de.filter(l=>l.value===M.ALL.value):de,P=I?void 0:t.ports;d.useEffect(()=>{c==null||c.forEach(l=>{l.formField!=="addresses"&&w(l.formField,l.reason)})},[c,w]);const j=d.useCallback(l=>{const v=l==null?void 0:l.value;v===b.type||!v||(g("type",v),F.label||g("label",`${b.action.toLocaleLowerCase()}-${s}-${l==null?void 0:l.label}`),v!=="custom"&&(g("protocol","TCP"),g("addresses","all"),u([M[Qe[v]]])))},[g,F,s,u,b.action,b.type]),A=d.useCallback(l=>{i(l)},[i]),R=d.useCallback(l=>{g("protocol",l==null?void 0:l.value),((l==null?void 0:l.value)==="ICMP"||(l==null?void 0:l.value)==="IPENCAP")&&(g("ports",""),u([]))},[g,u]),K=d.useCallback(l=>{g("addresses",l==null?void 0:l.value),C([{address:""}])},[g,C]),U=d.useCallback((l,v)=>{g("action",v)},[g]),$=d.useCallback(l=>{C(l)},[C]),Q=l=>{const v=_e(l);C(v)},W=d.useCallback(l=>{if(l.some(v=>v.value===M.ALL.value)){u([M.ALL]),g("ports","");return}u(l),l.some(v=>v.value==="CUSTOM")||g("ports","")},[u,g]),G=d.useMemo(()=>pe.find(l=>l.value===b.addresses)||null,[b]);return e.jsxs("form",{onSubmit:p,children:[D&&e.jsx(re,{"data-qa-error":!0,text:D.generalError,variant:"error"},D),e.jsx(_,{"aria-label":"Preset for firewall rule",isClearable:!1,label:"Preset",name:"type",onBlur:n,onChange:j,options:Xe,placeholder:"Select a rule preset..."}),e.jsx(Z,{"aria-label":"Label for firewall rule",errorText:t.label,label:"Label",name:"label",onBlur:n,onChange:A,placeholder:"Enter a label...",required:!0,value:b.label}),e.jsx(Z,{"aria-label":"Description for firewall rule",errorText:t.description,label:"Description",name:"description",onBlur:n,onChange:A,placeholder:"Enter a description...",value:b.description}),e.jsx(_,{"aria-label":"Select rule protocol.",errorText:t.protocol,isClearable:!1,label:"Protocol",name:"protocol",onBlur:n,onChange:R,options:ge,placeholder:"Select a protocol...",required:!0,value:ge.find(l=>l.value===b.protocol)}),e.jsx(_,{textFieldProps:{helperText:["ICMP","IPENCAP"].includes(b.protocol)?`Ports are not allowed for ${b.protocol} protocols.`:void 0},disabled:["ICMP","IPENCAP"].includes(b.protocol),errorText:P,isMulti:!0,label:"Ports",onChange:W,options:T,required:!0,value:y}),I?e.jsx(Z,{"aria-label":"Custom port range for firewall rule",errorText:t.ports,label:"Custom Port Range",name:"ports",onBlur:n,onChange:A,placeholder:"Enter a custom port range...",value:b.ports}):null,e.jsx(_,{"aria-label":`Select rule ${r}s.`,errorText:t.addresses,isClearable:!1,label:`${O(r)}s`,name:"addresses",onBlur:n,onChange:K,options:pe,placeholder:`Select ${r}s...`,required:!0,value:G}),b.addresses==="ip/netmask"&&e.jsx(hr,{"aria-label":"IP / Netmask for Firewall rule",inputProps:{autoFocus:!0},ips:h,onBlur:Q,onChange:$,placeholder:rr,title:"IP / Netmask",tooltip:pr}),e.jsxs(br,{children:[e.jsx(B,{children:e.jsx("strong",{children:"Action"})}),e.jsxs(Ke,{"aria-label":"action",name:"action",onChange:U,row:!0,value:b.action,children:[e.jsx(ie,{control:e.jsx(ue,{}),label:"Accept",value:"ACCEPT"}),e.jsx(ie,{control:e.jsx(ue,{}),label:"Drop",value:"DROP"}),e.jsxs(B,{style:{paddingTop:4},children:["This will take precedence over the Firewall’s ",s," ","policy."]})]})]}),e.jsx(z,{primaryButtonProps:{"data-testid":"submit",label:m==="create"?"Add Rule":"Add Changes",onClick:()=>p()}})]})}),br=S("div",{label:"StyledDiv"})(({theme:o})=>({marginTop:o.spacing(2)})),hr=S(Ye,{label:"StyledMultipleIPInput"})(({theme:o})=>({marginTop:o.spacing(2)})),xr=d.memo(o=>{const{category:r,isOpen:s,mode:t,onClose:n,ruleToModify:i}=o,[p,h]=d.useState([{address:""}]),[m,y]=d.useState([]);d.useEffect(()=>{t==="edit"&&i?(h(Ue(i)),y($e(i.ports)[0])):s?y([]):h([{address:""}])},[t,s,i]);const c=t==="create"?`Add an ${O(r)} Rule`:"Edit Rule",w=r==="inbound"?"source":"destination",g=({addresses:u,description:D,label:F,ports:b,protocol:I})=>{const L=Ge(p,{allowEmptyAddress:u!=="ip/netmask"});h(L);const T=ce(m,b);return{...He({addresses:u,description:D,label:F,ports:T,protocol:I}),...L.filter(P=>!!P.error)}},C=u=>{const D=ce(m,u.ports),F=u.protocol,b=qe(u.addresses,p),I={action:u.action,addresses:b,ports:D,protocol:F};I.label=u.label===""?null:u.label,I.description=u.description===""?null:u.description,o.onSubmit(r,I),n()};return e.jsxs(Ne,{onClose:n,open:s,title:c,children:[e.jsx(Me,{initialValues:We(i),onSubmit:C,validate:g,validateOnBlur:!1,validateOnChange:!1,children:u=>e.jsx(gr,{addressesLabel:w,category:r,ips:p,mode:t,presetPorts:m,ruleErrors:i==null?void 0:i.errors,setIPs:h,setPresetPorts:y,...u})}),e.jsx(B,{variant:"body1",children:"Rule changes don’t take effect immediately. You can add or delete rules before saving all your changes to this Firewall."})]})}),mr=o=>d.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,viewBox:"0 0 16 16",...o},d.createElement("g",{fill:"none",fillRule:"evenodd",stroke:"#3683DC",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5},d.createElement("path",{d:"M0.481 0.48L0.481 5.292 5.294 5.292",transform:"translate(.3 .3)"}),d.createElement("path",{d:"M7.7 14.917c3.987.003 7.22-3.227 7.223-7.214C14.926 3.717 11.696.483 7.71.48 4.648.478 1.919 2.407.899 5.292",transform:"translate(.3 .3)"}))),be=d.memo(o=>{const r=V(),s=Y(r.breakpoints.down("md")),{disabled:t,idx:n,triggerCloneFirewallRule:i,triggerDeleteFirewallRule:p,triggerOpenRuleDrawerForEditing:h,...m}=o,y=[{disabled:t,onClick:()=>{h(n)},title:"Edit"},{disabled:t,onClick:()=>{i(n)},title:"Clone"},{disabled:t,onClick:()=>{p(n)},title:"Delete"}];return e.jsxs(e.Fragment,{children:[!s&&y.map(c=>e.jsx(ir,{actionText:c.title,disabled:c.disabled,onClick:c.onClick},c.title)),s&&e.jsx(nr,{actionsList:y,ariaLabel:"Action menu for Firewall Rule",...m})]})}),oe={alignItems:"center",display:"flex",width:"100%"},k={padding:"0 8px"},yr=S(f,{label:"StyledFirewallRuleBox",shouldForwardProp:Ie(["originalIndex","ruleId"])})(({disabled:o,originalIndex:r,ruleId:s,status:t,theme:n})=>({borderBottom:`1px solid ${n.borderColors.borderTable}`,color:n.textColors.tableStatic,fontSize:"0.875rem",margin:0,...oe,...t==="PENDING_DELETION"||o?{"& td":{color:"#D2D3D4"},backgroundColor:"rgba(247, 247, 247, 0.25)"}:{},...t==="MODIFIED"||t==="NEW"||r!==s?{backgroundColor:n.bg.lightBlue1}:{},...t==="NOT_MODIFIED"?{backgroundColor:n.bg.bgPaper}:{}})),fr=S(f,{label:"StyledInnerBox"})(({theme:o})=>({backgroundColor:o.bg.tableHeader,color:o.textColors.tableHeader,fontFamily:o.font.bold,fontSize:".875rem",height:"46px"})),Cr=S(f,{label:"StyledUlBox"})(({theme:o})=>({alignItems:"center",backgroundColor:o.bg.bgPaper,borderBottom:`1px solid ${o.borderColors.borderTable}`,color:o.textColors.tableStatic,display:"flex",fontSize:"0.875rem",justifyContent:"center",padding:o.spacing(1),width:"100%"})),wr=S("button",{label:"StyledFirewallRuleButton"})(({status:o,theme:r})=>({backgroundColor:"transparent",border:"none",cursor:"pointer",...o!=="PENDING_DELETION"?{backgroundColor:r.bg.lightBlue1}:{}})),Dr=S(Se,{label:"StyledFirewallTableButton"})(({theme:o})=>({margin:`${o.spacing(1)} 0px`})),Pr=S(Re,{label:"MoreStyledLinkButton"})(({...o})=>({color:o.disabled?"inherit":""})),jr=S("div",{label:"StyledButtonDiv"})({alignContent:"center",display:"flex",flexDirection:"row",justifyContent:"flex-end"}),vr=S("div",{label:"StyledErrorDiv"})(({theme:o})=>({"& p":{color:o.color.red}})),Er=S("div",{label:"StyledHeaderDiv"})(({theme:o})=>({alignItems:"center",display:"flex",flexDirection:"row",justifyContent:"space-between",[o.breakpoints.down("md")]:{marginLeft:o.spacing(1),marginRight:o.spacing(1)}})),Ir=S(sr,{label:"StyledDragIndicator"})(({theme:o})=>({color:o.color.grey8,marginRight:o.spacing(1.5),position:"relative",top:2})),Sr=S("ul",{label:"StyledUl"})(({theme:o})=>({backgroundColor:o.color.border3,listStyle:"none",margin:0,paddingLeft:0,width:"100%"})),he=o=>{const{category:r,disabled:s,handlePolicyChange:t,openRuleDrawer:n,policy:i,rulesWithStatus:p,triggerCloneFirewallRule:h,triggerDeleteFirewallRule:m,triggerOpenRuleDrawerForEditing:y,triggerReorder:c,triggerUndo:w}=o,g=V(),C=Y(g.breakpoints.down("sm")),u=r==="inbound"?"sources":"destinations",D=Tr(p),F=d.useCallback(()=>{n(r,"create")},[n,r]),b=`No ${r} rules have been added.`,I="Some screen readers may require you to enter focus mode to interact with firewall rule list items. In focus mode, press spacebar to begin a drag or tab to access item actions.",L=P=>{var j;P.destination&&c(P.source.index,(j=P.destination)==null?void 0:j.index)},T=P=>{t(r,P)};return e.jsxs(e.Fragment,{children:[e.jsxs(Er,{children:[e.jsx(B,{variant:"h2",children:`${O(r)} Rules`}),e.jsxs(Dr,{buttonType:"primary",disabled:s,onClick:F,children:["Add an ",O(r)," Rule"]})]}),e.jsxs(f,{"aria-label":`${r} Rules List`,sx:{margin:0,width:"100%"},children:[e.jsxs(fr,{"aria-label":`${r} Rules List Headers`,sx:oe,tabIndex:0,children:[e.jsx(f,{sx:{...k,paddingLeft:"27px",width:C?"50%":"32%"},children:"Label"}),e.jsx(H,{lgDown:!0,children:e.jsx(f,{sx:{...k,width:"10%"},children:"Protocol"})}),e.jsxs(H,{smDown:!0,children:[e.jsx(f,{sx:{...k,width:"15%"},children:"Port Range"}),e.jsx(f,{sx:{...k,width:"15%"},children:O(u)})]}),e.jsx(f,{sx:{...k,width:"5%"},children:"Action"})]}),e.jsxs(f,{sx:{...oe,flexDirection:"column"},children:[e.jsx(tr,{onDragEnd:L,children:e.jsx(lr,{droppableId:"droppable",isDropDisabled:s,children:P=>e.jsxs(Sr,{ref:P.innerRef,...P.droppableProps,children:[D.length===0?e.jsx(Cr,{"data-testid":"table-row-empty",children:e.jsx(f,{children:b})}):D.map((j,A)=>e.jsx(ar,{draggableId:String(j.id),index:A,children:R=>e.jsx("li",{"aria-label":j.label??`firewall rule ${j.id}`,"aria-roledescription":I,"aria-selected":!1,ref:R.innerRef,role:"option",...R.draggableProps,...R.dragHandleProps,children:e.jsx(Rr,{triggerCloneFirewallRule:h,triggerDeleteFirewallRule:m,triggerOpenRuleDrawerForEditing:y,disabled:s,triggerUndo:w,...j})},j.id)},j.id)),P.placeholder]})})}),e.jsx(Fr,{category:r,disabled:s,handlePolicyChange:T,policy:i})]})]})]})},Rr=d.memo(o=>{const r=V(),s=Y(r.breakpoints.down("sm")),{action:t,addresses:n,disabled:i,errors:p,id:h,label:m,originalIndex:y,ports:c,protocol:w,status:g,triggerCloneFirewallRule:C,triggerDeleteFirewallRule:u,triggerOpenRuleDrawerForEditing:D,triggerUndo:F}=o,b={disabled:g==="PENDING_DELETION"||i,idx:h,triggerCloneFirewallRule:C,triggerDeleteFirewallRule:u,triggerOpenRuleDrawerForEditing:D};return e.jsxs(yr,{"aria-label":m??`firewall rule ${h}`,disabled:i,originalIndex:y,ruleId:h,status:g,children:[e.jsxs(f,{sx:{...k,overflowWrap:"break-word",paddingLeft:"8px",width:s?"50%":"32%"},"aria-label":`Label: ${m}`,children:[e.jsx(Ir,{"aria-label":"Drag indicator icon"}),m||e.jsx(Pr,{disabled:i,onClick:()=>D(h),children:"Add a label"})," "]}),e.jsx(H,{lgDown:!0,children:e.jsxs(f,{"aria-label":`Protocol: ${w}`,sx:{...k,width:"10%"},children:[w,e.jsx(ee,{errors:p,formField:"protocol"})]})}),e.jsxs(H,{smDown:!0,children:[e.jsxs(f,{"aria-label":`Ports: ${c}`,sx:{...k,width:"15%"},children:[c==="1-65535"?"All Ports":c,e.jsx(ee,{errors:p,formField:"ports"})]}),e.jsxs(f,{"aria-label":`Addresses: ${n}`,sx:{...k,overflowWrap:"break-word",width:"15%"},children:[n," ",e.jsx(ee,{errors:p,formField:"addresses"})]})]}),e.jsx(f,{"aria-label":`Action: ${t}`,sx:{...k,width:"5%"},children:O((t==null?void 0:t.toLocaleLowerCase())??"")}),e.jsx(f,{sx:{...k,marginLeft:"auto"},children:g!=="NOT_MODIFIED"?e.jsxs(jr,{children:[e.jsx(wr,{"aria-label":"Undo change to Firewall Rule",disabled:i,onClick:()=>F(h),status:g,children:e.jsx(mr,{})}),e.jsx(be,{...b})]}):e.jsx(be,{...b})})]},h)}),xe=[{label:"Accept",value:"ACCEPT"},{label:"Drop",value:"DROP"}],Fr=d.memo(o=>{const{category:r,disabled:s,handlePolicyChange:t,policy:n}=o,i=V(),h=Y(i.breakpoints.down("lg"))?e.jsxs("strong",{children:[O(r)," policy:"]}):e.jsxs("span",{children:[e.jsxs("strong",{children:["Default ",r," policy:"]})," This policy applies to any traffic not covered by the ",r," rules listed above."]}),m={alignItems:"center",backgroundColor:i.bg.bgPaper,borderBottom:`1px solid ${i.borderColors.borderTable}`,color:i.textColors.tableStatic,display:"grid",fontSize:".875rem",gridTemplateAreas:"'one two three four five'",gridTemplateColumns:"32% 10% 10% 15% 120px",height:"40px",marginTop:"10px",[i.breakpoints.down("lg")]:{gridTemplateAreas:"'one two three four'",gridTemplateColumns:"32% 15% 15% 120px"},[i.breakpoints.down("sm")]:{gridTemplateAreas:"'one two'",gridTemplateColumns:"50% 50%"},width:"100%"},y={gridArea:"1 / 1 / 1 / 5",padding:"0px 15px 0px 15px",textAlign:"right",[i.breakpoints.down("lg")]:{gridArea:"1 / 1 / 1 / 4"},[i.breakpoints.down("sm")]:{gridArea:"one"}},c={gridArea:"five",[i.breakpoints.down("lg")]:{gridArea:"four"},[i.breakpoints.down("sm")]:{gridArea:"two"}};return e.jsxs(f,{sx:m,children:[e.jsx(f,{sx:y,children:h}),e.jsx(f,{sx:c,children:e.jsx(_,{onChange:w=>t(w.value),value:xe.find(w=>w.value===n),disabled:s,hideLabel:!0,isClearable:!1,label:`${r} policy`,menuPlacement:"top",options:xe})})]})}),ee=d.memo(o=>{const{errors:r,formField:s}=o,t=or(Fe("formField"),r??[]);return e.jsx(e.Fragment,{children:t.map(n=>s!==n.formField||!n.reason?null:e.jsx(vr,{children:e.jsx(B,{variant:"body1",children:n.reason})},n.idx))})}),Tr=o=>o.map((r,s)=>{const t=Je(r);return{...r,addresses:Ze(r.addresses),id:s,ports:ze(r.ports||""),type:er(t)}}),kr=(o,r)=>{let s;switch(r.type){case"NEW_RULE":o.push([{...r.rule,originalIndex:o.length,status:"NEW"}]);return;case"DELETE_RULE":if(s=N(o[r.idx]),!s)return;delete s.errors,o[r.idx].push({...s,status:"PENDING_DELETION"});return;case"MODIFY_RULE":if(s=N(o[r.idx]),!s)return;delete s.errors,o[r.idx].push({...s,...r.modifiedRule,status:"MODIFIED"});return;case"CLONE_RULE":const t=N(o[r.idx]);if(!t)return;const{action:n,addresses:i,description:p,label:h,ports:m,protocol:y}=t;o.push([{action:n,addresses:i,description:p,label:h,originalIndex:o.length,ports:m,protocol:y,status:"NEW"}]);return;case"SET_ERROR":if(s=N(o[r.idx]),!s)return;s.errors||(s.errors=[]),s.errors.push(r.error);return;case"UNDO":s=N(o[r.idx]),o[r.idx].pop(),o[r.idx].length===0&&o.splice(r.idx,1);return;case"DISCARD_CHANGES":const c=[];return o.forEach(g=>{const C=g[0];C.status==="NOT_MODIFIED"&&(c[C.originalIndex]=[C])}),c;case"RESET":return se(r.rules);case"REORDER":const[w]=o.splice(r.startIdx,1);o.splice(r.endIdx,0,w);return}},me=dr(kr),se=o=>o.map((r,s)=>[{...r,originalIndex:s,status:"NOT_MODIFIED"}])??[],q=o=>cr(o.map(r=>Object.assign({},r[r.length-1]))),ye=o=>ke(["errors","status","originalIndex"],o),Ar=o=>o.map(r=>((r.protocol==="ICMP"||r.protocol==="IPENCAP")&&r.ports===""&&delete r.ports,r)),Lr=o=>o.map(r=>{var n,i,p,h;const s=((n=r.addresses)==null?void 0:n.ipv4)&&r.addresses.ipv4.length>0,t=((i=r.addresses)==null?void 0:i.ipv6)&&r.addresses.ipv6.length>0;return{...r,addresses:{ipv4:s?(p=r.addresses)==null?void 0:p.ipv4:void 0,ipv6:t?(h=r.addresses)==null?void 0:h.ipv6:void 0}}}),Or=o=>o.filter(r=>r.status!=="PENDING_DELETION"),fe=Te(Lr,Ar,Or,q),Ce=o=>q(o).some((s,t)=>s.status!=="NOT_MODIFIED"||s.originalIndex!==t),so=d.memo(o=>{const{disabled:r,firewallID:s,rules:t}=o,{mutateAsync:n}=Ae(s),{enqueueSnackbar:i}=Le(),[p,h]=d.useState({inbound:t.inbound_policy,outbound:t.outbound_policy}),m=(a,x)=>{h(E=>({...E,[a]:x}))},y=()=>p.inbound!==t.inbound_policy||p.outbound!==t.outbound_policy,[c,w]=d.useState({category:"inbound",isOpen:!1,mode:"create"}),[g,C]=d.useState(!1),[u,D]=d.useState(),[F,b]=d.useState(!1),I=(a,x,E)=>w({category:a,isOpen:!0,mode:x,ruleIdx:E}),L=()=>w({...c,isOpen:!1}),[T,P]=d.useReducer(me,t.inbound??[],se),[j,A]=d.useReducer(me,t.outbound??[],se),R=a=>a==="inbound"?P:A,K=(a,x)=>{R(a)({rule:x,type:"NEW_RULE"})},U=(a,x)=>{R(a)({idx:x,type:"CLONE_RULE"})},$=(a,x,E)=>{R(a)({endIdx:E,startIdx:x,type:"REORDER"})},Q=(a,x)=>{if(c.ruleIdx===void 0)return;R(a)({idx:c.ruleIdx,modifiedRule:x,type:"MODIFY_RULE"})},W=(a,x)=>{R(a)({idx:x,type:"DELETE_RULE"})},G=(a,x)=>{R(a)({idx:x,type:"UNDO"})},l=()=>{C(!0),D(void 0);const a={inbound:fe(T),outbound:fe(j)},x={inbound:a.inbound.map(ye),inbound_policy:p.inbound,outbound:a.outbound.map(ye),outbound_policy:p.outbound};n(x).then(E=>{C(!1),P({rules:E.inbound??[],type:"RESET"}),A({rules:E.outbound??[],type:"RESET"}),i("Firewall rules successfully updated",{variant:"success"})}).catch(E=>{C(!1);const ae=Oe(E);for(const ne of ae){const X=Ve(ne);if(X===null)D(J=>[...J??[],ne]);else{const{category:J,idx:je}=X;R(J)({error:X,idx:je,type:"SET_ERROR"})}}i("Failed to update Firewall rules",{variant:"error"})})},v=d.useMemo(()=>!!(Ce(T)||Ce(j)||y()),[T,j,p,t]),te=d.useMemo(()=>q(T),[T]),le=d.useMemo(()=>q(j),[j]),Pe=c.ruleIdx!==void 0?c.category==="inbound"?te[c.ruleIdx]:le[c.ruleIdx]:void 0;return e.jsxs(e.Fragment,{children:[e.jsx(Be,{confirmWhenLeaving:!0,when:v,children:({handleCancel:a,handleConfirm:x,isModalOpen:E})=>e.jsx(De,{actions:()=>e.jsx(z,{primaryButtonProps:{label:"Go back and review changes",onClick:a},secondaryButtonProps:{label:"Leave and discard changes",onClick:x}}),onClose:a,open:E,title:"Discard Firewall changes?",children:e.jsx(B,{variant:"subtitle1",children:"The changes you made to this Firewall haven’t been applied. If you navigate away from this page, your changes will be discarded."})})}),r?e.jsx(re,{text:"You don't have permissions to modify this Firewall. Please contact an account administrator for details.",important:!0,variant:"error"}):null,(u==null?void 0:u.length)===1&&e.jsx(re,{spacingTop:8,text:u[0].reason,variant:"error"}),e.jsx(we,{children:e.jsx(he,{triggerCloneFirewallRule:a=>U("inbound",a),triggerOpenRuleDrawerForEditing:a=>I("inbound","edit",a),triggerReorder:(a,x)=>$("inbound",a,x),category:"inbound",disabled:r,handlePolicyChange:m,openRuleDrawer:I,policy:p.inbound,rulesWithStatus:te,triggerDeleteFirewallRule:a=>W("inbound",a),triggerUndo:a=>G("inbound",a)})}),e.jsx(we,{children:e.jsx(he,{triggerCloneFirewallRule:a=>U("outbound",a),triggerOpenRuleDrawerForEditing:a=>I("outbound","edit",a),triggerReorder:(a,x)=>$("outbound",a,x),category:"outbound",disabled:r,handlePolicyChange:m,openRuleDrawer:I,policy:p.outbound,rulesWithStatus:le,triggerDeleteFirewallRule:a=>W("outbound",a),triggerUndo:a=>G("outbound",a)})}),e.jsx(xr,{category:c.category,isOpen:c.isOpen,mode:c.mode,onClose:L,onSubmit:c.mode==="create"?K:Q,ruleToModify:Pe}),e.jsx(Br,{primaryButtonProps:{disabled:!v||r,label:"Save Changes",loading:g,onClick:l},secondaryButtonProps:{disabled:!v||r,label:"Discard Changes",onClick:()=>b(!0)}}),e.jsx(Mr,{handleDiscard:()=>{b(!1),D(void 0),h({inbound:t.inbound_policy,outbound:t.outbound_policy}),P({type:"DISCARD_CHANGES"}),A({type:"DISCARD_CHANGES"})},handleClose:()=>b(!1),isOpen:F})]})}),Br=S(z,{label:"StyledActionsPanel"})({float:"right"}),we=S("div",{label:"StyledDiv"})(({theme:o})=>({marginBottom:o.spacing(4),marginTop:o.spacing(2)})),Mr=d.memo(o=>{const{handleClose:r,handleDiscard:s,isOpen:t}=o,n=d.useCallback(()=>e.jsx(z,{primaryButtonProps:{label:"Go back and review changes",onClick:r},secondaryButtonProps:{label:"Discard changes",onClick:s}}),[s,r]);return e.jsx(De,{actions:n,onClose:()=>r(),open:t,title:"Discard Firewall changes?",children:e.jsx(B,{variant:"subtitle1",children:"Are you sure you want to discard changes to this Firewall?"})})});export{Mr as DiscardChangesDialog,so as FirewallRulesLanding};
