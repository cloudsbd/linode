import{c9 as Pe,ch as Je,cc as Ze,cj as et,cx as he,e2 as tt,j as e,af as we,T as $,ag as ve,dE as ot,u as nt,aW as ge,bD as rt,B as xe,r as b,mB as st,dp as it,s as H,dq as at,cA as lt,fO as dt,bI as le,$ as Be,d0 as E,c as ct,mC as ut,q as mt,f5 as pt,ba as ft,av as bt,bn as ht,b8 as vt,eY as gt,bH as xt,G as F,ad as be,bB as re,bJ as Ct,cb as yt,f as jt,c3 as _t,a1 as Se,C as kt,E as Lt,bj as St,b as Tt,bp as It,bE as Dt,mD as At}from"./index-Eksrs3uK.js";import{A as Et}from"./AddNewLink-LwviGK8c.js";import{O as Pt}from"./OrderBy-H-bWJCPy.js";import{P as wt}from"./Paginate-XLm_-WxT.js";import{P as Bt}from"./PaginationFooter-NHWf7fW2.js";import{T as Fe,a as G,b as Ft,c as $t}from"./TableRow-phXfWUGW.js";import{T as Rt}from"./TableContentWrapper-56D5btVR.js";import{T as Mt}from"./TableSortCell-hcsagFzN.js";import{a as Ot,b as Nt,d as Vt,u as Gt}from"./configs-3PoBJaCX.js";import{u as $e}from"./disks-ZTjtBBb6.js";import{f as Ht,v as Qt}from"./vpcs-qp5yIH1u.js";import{s as qt}from"./splitAt-pbTnq2Oi.js";import{A as Kt}from"./ActionMenu-4CPisA_2.js";import{I as Ut}from"./InlineMenuAction-d5mRENST.js";import{u as Wt}from"./formik.esm-Kap5lsIh.js";import{F as U}from"./FormControl-CNHz4Ctl.js";import{F as ce}from"./FormLabel-2wEwBKx7.js";import{R as V}from"./Radio-HudVgwMW.js";import{T as K}from"./Toggle-AbahDP9J.js";import{D as zt,c as Xt}from"./DeviceSelection-JvpNAIro.js";import{g as Yt,L as Jt,h as Zt}from"./constants-jI3mcPVd.js";import{q as Te,I as eo}from"./InterfaceSelect--p7gvXq_.js";import{h as to,a as oo}from"./formikErrorUtils-jhqfCjwU.js";import{g as Ie}from"./getSelectedOptionFromGroupedOptions-4YyATpGV.js";import{s as no}from"./scrollErrorIntoView-6n4Cku1Y.js";import{g as ro}from"./groupBy-7jUcQ2cf.js";import{_ as so,R as io}from"./RadioGroup-zpRjMzXK.js";import{T as ao}from"./TableHead-Si_pzkLK.js";import"./TableRowEmpty-aXmC67-Z.js";import"./TableRowError-8gKmGX7P.js";import"./TableRowLoading-iP7zIRHG.js";import"./Skeleton-iwmO4Yae.js";import"./LinkButton-O1af9aD7.js";import"./SelectFirewallPanel-xh9FN-rV.js";import"./CreateFirewallDrawer-dcf-B8xd.js";import"./Drawer-A9yKjC3Z.js";import"./LinodeSelect-y7DOgXsC.js";import"./Autocomplete-XvrzKoAo.js";import"./NodeBalancerSelect-tPR8nvIa.js";import"./grants-2yY1GgvJ.js";import"./useCreateVPC-U4LUEfXY.js";import"./RegionSelect-_Z8IGlox.js";import"./Flag-kVTQNGw3.js";import"./ListItem-joIHQeyv.js";import"./visuallyHidden-DVicuktI.js";var lo=Pe(function(t,n){var i=Number(n),d=0,c;if(i<0||isNaN(i))throw new RangeError("n must be a non-negative number");for(c=new Array(i);d<i;)c[d]=t(d),d+=1;return c}),co=Pe(function(t,n){return lo(Je(t),n)}),uo=Ze(function(t){var n=[];for(var i in t)et(i,t)&&(n[n.length]=[i,t[i]]);return n});const mo=o=>{const{config:t,linodeId:n,onClose:i,open:d}=o,{enqueueSnackbar:c}=he(),{error:s,isLoading:h,mutateAsync:u}=tt(n),p=async()=>{await u({config_id:(t==null?void 0:t.id)??-1}),ot(),c(`Successfully booted config ${t==null?void 0:t.label}`,{variant:"success"}),i()},x=e.jsx(ve,{primaryButtonProps:{label:"Boot",loading:h,onClick:p},secondaryButtonProps:{label:"Cancel",onClick:i},style:{padding:0}});return e.jsx(we,{actions:x,error:s==null?void 0:s[0].reason,onClose:i,open:d,title:"Confirm Boot",children:e.jsxs($,{children:['Are you sure you want to boot "',t==null?void 0:t.label,'"?']})})},po=o=>{const{idx:t,interfaceEntry:n}=o,{data:i}=Ht((n==null?void 0:n.vpc_id)??-1,!!n.vpc_id),d=`eth${t}`,c=s=>{var p;if(s.purpose==="public")return"Public Internet";const h=s.label;if(s.purpose==="vlan"){const x=s.ipam_address;return`VLAN: ${h} ${!!x?`(${x})`:""}`}const u=(p=s.ipv4)==null?void 0:p.vpc;return`VPC: ${i==null?void 0:i.label} ${u?`(${u})`:""}`};return e.jsxs("li",{"data-testid":"interface-list-item",style:{paddingBottom:4},children:[d," – ",c(n)]})},fo=o=>{const{config:t,linodeId:n,onBoot:i,onDelete:d,onEdit:c,readOnly:s}=o,h=nt(),u=ge(),p=rt(u.breakpoints.down("md")),S=[{onClick:i,title:"Boot"},{onClick:c,title:"Edit"},{disabled:s,onClick:()=>{h.push(`/linodes/${n}/clone/configs?selectedConfig=${t.id}`)},title:"Clone"},{disabled:s,onClick:d,title:"Delete",tooltip:s?"You don't have permission to perform this action":void 0}],D=p?0:2,[R,P]=qt(D,S);return e.jsxs(xe,{alignItems:"center",display:"flex",justifyContent:"flex-end",children:[!p&&R.map(f=>e.jsx(Ut,{actionText:f.title,disabled:f.disabled,onClick:f.onClick,tooltip:f.tooltip},f.title)),e.jsx(Kt,{actionsList:P,ariaLabel:`Action menu for Linode Config ${o.label}`})]})},bo=b.memo(o=>{const{config:t,linodeId:n,onBoot:i,onDelete:d,onEdit:c,readOnly:s}=o,{data:h}=st(t.kernel),{data:u}=$e(n),{data:p}=it(n,{page_size:at}),x=(t==null?void 0:t.interfaces)??[],S=b.useMemo(()=>Object.keys(t.devices).map(f=>{var M,A;const v=t.devices[f];let k=null;if(v!=null&&v.disk_id?k=((M=u==null?void 0:u.find(w=>{var T;return w.id===((T=t.devices[f])==null?void 0:T.disk_id)}))==null?void 0:M.label)??`disk-${v.disk_id}`:v!=null&&v.volume_id&&(k=((A=p==null?void 0:p.data.find(w=>{var T;return w.id===((T=t.devices[f])==null?void 0:T.volume_id)}))==null?void 0:A.label)??`volume-${v.volume_id}`),!!k)return e.jsxs("li",{style:{paddingBottom:4},children:["/dev/",f," - ",k]},f)}).filter(Boolean),[p,u,t.devices]),D=b.useMemo(()=>e.jsx(De,{children:S}),[S]),R=e.jsx(De,{children:x.map((f,v)=>e.jsx(po,{idx:v,interfaceEntry:f},f.label??"public"+v))}),P="eth0 – Public Internet";return e.jsxs(Fe,{"data-qa-config":t.label,children:[e.jsxs(G,{children:[t.label," – ",(h==null?void 0:h.label)??t.kernel]}),e.jsx(G,{children:D}),e.jsx(G,{children:x.length>0?R:P}),e.jsx(ho,{children:e.jsx(fo,{config:t,label:t.label,linodeId:n,onBoot:i,onDelete:d,onEdit:c,readOnly:s})})]},t.id)}),De=H("ul",{label:"StyledUl"})(({theme:o})=>({listStyleType:"none",margin:0,paddingBottom:o.spacing(),paddingLeft:0,paddingTop:o.spacing()})),ho=H(G,{label:"StyledTableCell"})({"&.MuiTableCell-root":{paddingRight:0},padding:"0 !important"}),vo=o=>{const{config:t,linodeId:n,onClose:i,open:d}=o,{enqueueSnackbar:c}=he(),{error:s,isLoading:h,mutateAsync:u}=Ot(n,(t==null?void 0:t.id)??-1),p=async()=>{await u(),c(`Configuration ${t==null?void 0:t.label} successfully deleted`,{variant:"success"}),i()},x=e.jsx(ve,{primaryButtonProps:{label:"Delete",loading:h,onClick:p},secondaryButtonProps:{label:"Cancel",onClick:i},style:{padding:0}});return e.jsx(we,{actions:x,error:s==null?void 0:s[0].reason,onClose:i,open:d,title:"Confirm Delete",children:e.jsxs($,{children:['Are you sure you want to delete "',t==null?void 0:t.label,'"?']})})},go=(o,[t,n])=>n===null?o:xo(n)?{...o,[t]:`disk-${n.disk_id}`}:Co(n)?{...o,[t]:`volume-${n.volume_id}`}:o,xo=o=>typeof o.disk_id=="number",Co=o=>typeof o.volume_id=="number",yo=lt(dt(go,{}),uo),jo=b.memo(o=>{const{errorText:t,kernels:n,onChange:i,readOnly:d,selectedKernel:c}=o,s=Lo(n);return e.jsx(le,{disabled:!!d,errorGroup:"linode-config-drawer",errorText:t,isClearable:!1,label:"Select a Kernel",onChange:i,options:s,value:_o(c,s)})}),_o=(o,t)=>o?t.reduce((i,d)=>[...i,...d.options],[]).find(i=>o===i.value):null,ko=o=>o.label.match(/latest/i)||["GRUB (Legacy)","GRUB 2"].includes(o.label)||o.label==="Direct Disk"?"Current":o.deprecated?"Deprecated":o.architecture==="x86_64"?"64 bit":o.architecture==="i386"?"32 bit":"Current",Lo=o=>{const t=ro(ko,o);return t.Current=To(t.Current),Object.keys(t).reduce((n,i)=>{const d=t[i];return!d||d.length===0?n:[...n,{label:i,options:t[i].map(c=>({label:c.label,value:c.id}))}]},[]).sort(So)},se={"32 bit":2,"64 bit":3,Current:4,Deprecated:1},So=(o,t)=>se[o.label]>se[t.label]?-1:se[o.label]<se[t.label]?1:0,To=(o=[])=>[o.find(t=>t.label.match(/64 bit/i)),o.find(t=>t.label.match(/32 bit/i)),o.find(t=>t.label.match(/direct disk/i)),o.find(t=>t.label.match(/grub 2/i)),o.find(t=>t.label.match(/grub \(legacy\)/i))].filter(Boolean),Io=o=>e.jsx(so,{...o}),Ce={'&.MuiFormGroup-root[role="radiogroup"]':{marginBottom:0},alignItems:"flex-start"},ue=H(io,{label:"StyledRadioGroup"})({...Ce}),Do=H(U,{label:"StyledFormControl"})({...Ce}),Ao=H(Io,{label:"StyledFormGroup"})({...Ce}),ie=H(Be,{label:"StyledDivider"})(({theme:o})=>({margin:"36px 8px 12px",width:`calc(100% - ${o.spacing(2)})`})),ee=H(E,{label:"StyledFormControlLabel"})(({theme:o})=>({"& button":{color:o.textColors.tableHeader,order:3}})),Eo={ipam_address:"",label:"",purpose:"none"},Po=(o,t,n=3)=>[...o,...co(t,Math.max(0,n-o.length))],Re=o=>Po(o,Eo,3),ye=Re([{ipam_address:"",label:"",purpose:"public"}]),Ae={comments:"",devices:{},helpers:{devtmpfs_automount:!0,distro:!0,modules_dep:!0,network:!0,updatedb_disabled:!0},initrd:"",interfaces:ye,kernel:"linode/latest-64bit",label:"",memory_limit:0,root_device:"/dev/sda",run_level:"default",setMemoryLimit:"no_limit",useCustomRoot:!1,virt_mode:"paravirt"},ae=[{label:"/dev/sda",value:"/dev/sda"},{label:"/dev/sdb",value:"/dev/sdb"},{label:"/dev/sdc",value:"/dev/sdc"},{label:"/dev/sdd",value:"/dev/sdd"},{label:"/dev/sde",value:"/dev/sde"},{label:"/dev/sdf",value:"/dev/sdf"},{label:"/dev/sdg",value:"/dev/sdg"},{label:"/dev/sdh",value:"/dev/sdh"}],wo=o=>{if(!o||o.length===0)return ye;const t=o.map(({id:n,ipam_address:i,ipv4:d,label:c,primary:s,purpose:h,subnet_id:u,vpc_id:p})=>({id:n,ipam_address:i,ipv4:d,label:c,primary:s,purpose:h,subnet_id:u,vpc_id:p}));return Re(t)},Bo=(o,t)=>!o||o.length===0?[]:St(o,ye)?[]:(t!==void 0&&(o[t].primary=!0),o.filter(n=>n.purpose!=="none")),me=["sda","sdb","sdc","sdd","sde","sdf","sdg","sdh"],Ee=1,pe=25669,Fo=o=>{var Le;const{config:t,isReadOnly:n,linodeId:i,onClose:d,open:c}=o,{data:s}=ct(i,c),{enqueueSnackbar:h}=he(),{data:u,error:p,isLoading:x}=ut({},{[(s==null?void 0:s.hypervisor)??"kvm"]:!0},c&&s!==void 0),{data:S}=$e(i),D=t!=null&&t.initrd?String(t.initrd):"",{mutateAsync:R}=Nt(i),{mutateAsync:P}=Vt(i,(t==null?void 0:t.id)??-1),f=ge(),v=mt(),{account:k}=pt(),M=ft().data??[],A=bt(),[w,T]=b.useState(Ee),[W,C]=b.useState(!1),[z,X]=b.useState(),te=M.some(r=>r.id===(s==null?void 0:s.region)&&r.capabilities.includes("Vlans")),oe=M.some(r=>r.id===(s==null?void 0:s.region)&&r.capabilities.includes("VPCs")),B=ht("VPCs",!!v.vpc,(k==null?void 0:k.capabilities)??[]),{resetForm:Y,setFieldValue:j,values:m,...l}=Wt({initialValues:Ae,onSubmit:r=>Oe(r),validate:r=>Me(r),validateOnChange:!1,validateOnMount:!1}),O=r=>{const{comments:a,devices:g,helpers:y,initrd:_,interfaces:I,kernel:Q,label:L,memory_limit:q,root_device:N,run_level:J,setMemoryLimit:Z,virt_mode:Ye}=r;return{comments:a,devices:Xt(g),helpers:y,initrd:_!==""?_:null,interfaces:Bo(I,z),kernel:Q,label:L,memory_limit:Z==="no_limit"?0:q,root_device:N,run_level:J,virt_mode:Ye}},Me=r=>{const a={},{interfaces:g}=r,y=g[1],_=g[2];return(y==null?void 0:y.purpose)==="none"&&_.purpose!=="none"?(a.interfaces="You cannot assign an interface to eth2 without an interface assigned to eth1.",a):(g.forEach((I,Q)=>{I.purpose==="vlan"&&!I.label&&(a[`interfaces[${Q}].label`]="VLAN is required.")}),a)},Oe=r=>{var I,Q;l.setSubmitting(!0);const a=O(r);Number(a.initrd)===pe&&(a.initrd=pe),te||(a.interfaces=(I=a.interfaces)==null?void 0:I.filter(L=>L.purpose!=="vlan")),oe||(a.interfaces=(Q=a.interfaces)==null?void 0:Q.filter(L=>L.purpose!=="vpc"));const g=t?"updated":"created",y=()=>{var L,q;l.setSubmitting(!1),A.invalidateQueries(["linode","configs",o.linodeId]),(L=a.interfaces)!=null&&L.some(N=>N.purpose==="vlan")&&A.invalidateQueries(Te),(q=a.interfaces)!=null&&q.some(N=>N.purpose==="vpc")&&A.invalidateQueries(Qt),h(`Configuration ${a.label} successfully ${g}`,{variant:"success"}),d()},_=L=>{const q=J=>l.setStatus({generalError:J}),N=J=>{J.forEach(Z=>{Z.field&&["disk_id","volume_id"].includes(Z.field)&&(Z.field="devices")})};l.setSubmitting(!1),N(L),to(l.setErrors,L),oo(q,L,"An unexpected error occurred."),no("linode-config-dialog")};return t?P(a).then(y).catch(_):R(a).then(y).catch(_)};b.useEffect(()=>{if(c)if(A.invalidateQueries(Te),t){const r=yo(t.devices),a=Object.keys(r),g=a[a.length-1],y=me.indexOf(g);T(y),C(!ae.some(I=>I.value===(t==null?void 0:t.root_device)));const _=t.interfaces.findIndex(I=>I.primary===!0);B&&_!==-1&&X(_),Y({values:{comments:t.comments,devices:r,helpers:t.helpers,initrd:D,interfaces:wo(t.interfaces),kernel:t.kernel,label:t.label,memory_limit:t.memory_limit,root_device:t.root_device,run_level:t.run_level,setMemoryLimit:t.memory_limit!==0?"set_limit":"no_limit",useCustomRoot:Ro(t.root_device),virt_mode:t.virt_mode}})}else Y({values:Ae}),C(!1),T(Ee),X(0)},[c,t,D,Y,A,B]);const je=(Le=l.status)==null?void 0:Le.generalError,{data:de}=vt({},{region:s==null?void 0:s.region},c),Ne=(de==null?void 0:de.filter(r=>{const a=r.linode_id===o.linodeId,g=r.linode_id===null;return a||g}))??[],_e={disks:(S==null?void 0:S.map(r=>({...r,_id:`disk-${r.id}`})))??[],volumes:Ne.map(r=>({...r,_id:`volume-${r.id}`}))},Ve={disks:_e.disks.filter(r=>r.filesystem==="initrd")},ne=Object.entries(Ve).map(([r,a])=>({label:gt(r),options:[...a.map(({id:y,label:_})=>({label:_,value:String(y)})),{label:"Recovery – Finnix (initrd)",value:String(pe)}],value:r}));ne.unshift({label:"",options:[{label:"None",value:null}],value:""});const ke=r=>r.map((a,g)=>({label:`eth${g}`,value:g})),Ge=ke(m.interfaces),He=r=>{X(r.value)},Qe=b.useCallback(r=>{j("kernel",(r==null?void 0:r.value)??"")},[j]),qe=b.useCallback((r,a)=>{j(`devices[${r}]`,a),l.setFieldError("devices","")},[j,l]),Ke=b.useCallback((r,a)=>{j(`interfaces[${r}]`,a)},[j]),Ue=b.useCallback(r=>{C(r.target.checked),r.target.checked||j("root_device",ae[0].value)},[C,j]),We=b.useCallback(r=>{j("root_device",r.value)},[j]),ze=b.useCallback(r=>{j("initrd",r.value)},[j]),Xe=e.jsxs($,{children:["Configure the network that a selected interface will connect to (",B?'"Public Internet", VLAN, or VPC':'either "Public Internet" or a VLAN',") . Each Linode can have up to three Network Interfaces. For more information, see our"," ",e.jsx(Se,{to:"https://www.linode.com/docs/products/networking/vlans/guides/attach-to-compute-instance/#attaching-a-vlan-to-an-existing-compute-instance",children:"Network Interfaces guide"}),"."]});return e.jsxs(xt,{fullHeight:!0,fullWidth:!0,onClose:d,open:c,title:`${t?"Edit":"Add"} Configuration`,children:[e.jsx(F,{container:!0,direction:"row",children:e.jsx($o,{errors:p,loading:x,children:e.jsxs(b.Fragment,{children:[je&&e.jsx(F,{children:e.jsx(be,{errorGroup:"linode-config-dialog",spacingBottom:0,text:je,variant:"error"})}),e.jsxs(F,{xs:12,children:[e.jsx(re,{disabled:n,errorGroup:"linode-config-dialog",errorText:l.errors.label,label:"Label",name:"label",onChange:l.handleChange,required:!0,value:m.label}),e.jsx(re,{disabled:n,errorGroup:"linode-config-dialog",errorText:l.errors.comments,label:"Comments",multiline:!0,name:"comments",onChange:l.handleChange,rows:1.5,value:m.comments})]}),e.jsx(ie,{}),e.jsxs(F,{xs:12,children:[e.jsx($,{variant:"h3",children:"Virtual Machine"}),e.jsxs(U,{children:[e.jsx(ce,{"aria-describedby":"virtModeCaption",disabled:n,htmlFor:"virt_mode",children:"VM Mode"}),e.jsxs(ue,{"aria-label":"virt_mode",name:"virt_mode",onChange:l.handleChange,value:m.virt_mode,children:[e.jsx(E,{control:e.jsx(V,{}),disabled:n,label:"Paravirtualization",value:"paravirt"}),e.jsx(E,{control:e.jsx(V,{}),disabled:n,label:"Full virtualization",value:"fullvirt"}),e.jsx(Ct,{id:"virtModeCaption",children:"Controls if devices inside your virtual machine are paravirtualized or fully virtualized. Paravirt is what you want, unless you’re doing weird things."})]})]})]}),e.jsx(ie,{}),e.jsxs(F,{xs:12,children:[e.jsx($,{variant:"h3",children:"Boot Settings"}),u&&e.jsx(jo,{errorText:l.errors.kernel,kernels:u,onChange:Qe,readOnly:n,selectedKernel:m.kernel}),e.jsxs(U,{disabled:n,fullWidth:!0,children:[e.jsx(ce,{htmlFor:"run_level",children:"Run Level"}),e.jsxs(ue,{"aria-label":"run_level",name:"run_level",onChange:l.handleChange,value:m.run_level,children:[e.jsx(E,{control:e.jsx(V,{}),disabled:n,label:"Run Default Level",value:"default"}),e.jsx(E,{control:e.jsx(V,{}),disabled:n,label:"Single user mode",value:"single"}),e.jsx(E,{control:e.jsx(V,{}),disabled:n,label:"init=/bin/bash",value:"binbash"})]})]}),e.jsxs(U,{children:[e.jsx(ce,{disabled:n,htmlFor:"memory_limit",children:"Memory Limit"}),e.jsxs(ue,{"aria-label":"memory_limit",name:"setMemoryLimit",onChange:l.handleChange,value:m.setMemoryLimit,children:[e.jsx(E,{control:e.jsx(V,{}),disabled:n,label:"Do not set any limits on memory usage",value:"no_limit"}),e.jsx(E,{control:e.jsx(V,{}),disabled:n,label:"Limit the amount of RAM this config uses",value:"set_limit"})]})]}),m.setMemoryLimit==="set_limit"&&e.jsx(re,{disabled:n,errorText:l.errors.memory_limit,helperText:`Max: ${s==null?void 0:s.specs.memory} MB`,label:"Memory Limit Allotment (in MB)",max:s==null?void 0:s.specs.memory,min:0,name:"memory_limit",onChange:l.handleChange,type:"number",value:m.memory_limit})]}),e.jsx(ie,{}),e.jsxs(F,{xs:12,children:[e.jsx($,{variant:"h3",children:"Block Device Assignment"}),e.jsx(zt,{counter:w,devices:_e,disabled:n,errorText:l.errors.devices,getSelected:r=>yt("",[r],m.devices),onChange:qe,slots:me}),e.jsx(U,{fullWidth:!0,children:e.jsx(le,{defaultValue:Ie(D,ne),value:Ie(m.initrd,ne),isClearable:!1,label:"initrd",noMarginTop:!0,onChange:ze,options:ne,placeholder:"None"})}),e.jsx(jt,{sx:{marginLeft:"1px",marginTop:f.spacing()},buttonType:"secondary",compactX:!0,disabled:n||w>=me.length-1,onClick:()=>T(r=>r+1),children:"Add a Device"}),e.jsxs(Do,{fullWidth:!0,children:[e.jsx(E,{control:e.jsx(K,{checked:W,disabled:n,onChange:Ue}),label:"Use Custom Root",name:"useCustomRoot"}),W?e.jsx(re,{disabled:n,errorGroup:"linode-config-dialog",errorText:l.errors.root_device,fullWidth:!0,inputProps:{id:"root_device",name:"root_device"},label:"Custom",name:"root_device",onChange:l.handleChange,value:m.root_device}):e.jsx(le,{value:ae.find(r=>r.value===m.root_device),disabled:n,errorText:l.errors.root_device,id:"root_device",isClearable:!1,label:"Root Device",name:"root_device",onChange:We,options:ae,placeholder:"None"})]})]}),e.jsx(ie,{}),e.jsxs(F,{xs:12,children:[e.jsxs(xe,{alignItems:"center",display:"flex",children:[e.jsx($,{variant:"h3",children:B?"Networking":"Network Interfaces"}),e.jsx(_t,{sxTooltipIcon:{paddingBottom:0,paddingTop:0},interactive:!0,status:"help",sx:{tooltip:{maxWidth:350}},text:Xe})]}),l.errors.interfaces&&e.jsx(be,{text:l.errors.interfaces,variant:"error"}),B&&e.jsxs(e.Fragment,{children:[e.jsx(le,{defaultValue:Ge[z??0],"data-testid":"primary-interface-dropdown",disabled:n,isClearable:!1,label:"Primary Interface (Default Route)",onChange:He,options:ke(m.interfaces)}),e.jsx(Be,{sx:{margin:`${f.spacing(4.5)} ${f.spacing()} ${f.spacing(1.5)} `,width:`calc(100% - ${f.spacing(2)})`}})]}),m.interfaces.map((r,a)=>{var g,y;return e.jsxs(e.Fragment,{children:[Mo({_interface:r,primaryInterfaceIndex:z,thisIndex:a,values:m}),e.jsx(eo,{errors:{ipamError:l.errors[`interfaces[${a}].ipam_address`],labelError:l.errors[`interfaces[${a}].label`],primaryError:l.errors[`interfaces[${a}].primary`],publicIPv4Error:l.errors[`interfaces[${a}].ipv4.nat_1_1`],subnetError:l.errors[`interfaces[${a}].subnet_id`],vpcError:l.errors[`interfaces[${a}].vpc_id`],vpcIPv4Error:l.errors[`interfaces[${a}].ipv4.vpc`]},handleChange:_=>Ke(a,_),ipamAddress:r.ipam_address,label:r.label,nattedIPv4Address:(g=r.ipv4)==null?void 0:g.nat_1_1,purpose:r.purpose,readOnly:n,region:s==null?void 0:s.region,regionHasVLANs:te,regionHasVPCs:oe,slotNumber:a,subnetId:r.subnet_id,vpcIPv4:(y=r.ipv4)==null?void 0:y.vpc,vpcId:r.vpc_id},`eth${a}-interface`)]})})]}),e.jsxs(F,{xs:12,children:[e.jsx($,{variant:"h3",children:"Filesystem/Boot Helpers"}),e.jsx(U,{fullWidth:!0,children:e.jsxs(Ao,{children:[e.jsx(ee,{control:e.jsx(K,{checked:m.helpers.distro,disabled:n,onChange:l.handleChange,tooltipText:"Helps maintain correct inittab/upstart console device"}),label:"Enable distro helper",name:"helpers.distro"}),e.jsx(ee,{control:e.jsx(K,{checked:m.helpers.updatedb_disabled,disabled:n,onChange:l.handleChange,tooltipText:"Disables updatedb cron job to avoid disk thrashing"}),label:"Disable updatedb",name:"helpers.updatedb_disabled"}),e.jsx(ee,{control:e.jsx(K,{checked:m.helpers.modules_dep,disabled:n,onChange:l.handleChange,tooltipText:"Creates a modules dependency file for the kernel you run"}),label:"Enable modules.dep helper",name:"helpers.modules_dep"}),e.jsx(ee,{control:e.jsx(K,{checked:m.helpers.devtmpfs_automount,disabled:n,onChange:l.handleChange,tooltipText:"Controls if pv_ops kernels automount devtmpfs at boot"}),label:"Auto-mount devtmpfs",name:"helpers.devtmpfs_automount"}),e.jsx(ee,{control:e.jsx(K,{tooltipText:e.jsxs(e.Fragment,{children:["Automatically configure static networking",e.jsx(Se,{to:"https://www.linode.com/docs/platform/network-helper/",children:"(more info)"})]}),checked:m.helpers.network,disabled:n,interactive:!0,onChange:l.handleChange}),label:"Auto-configure networking",name:"helpers.network"})]})})]})]})})}),e.jsx(ve,{primaryButtonProps:{disabled:n,label:t?"Save Changes":"Add Configuration",loading:l.isSubmitting,onClick:l.submitForm},secondaryButtonProps:{label:"Cancel",onClick:d},sx:{display:"flex",justifySelf:"flex-end"}})]})},$o=o=>{const{errors:t,loading:n}=o;return n?e.jsx(kt,{}):t?e.jsx(Lt,{errorText:"Unable to load configurations."}):o.children},Ro=o=>["/dev/sda","/dev/sdb","/dev/sdc","/dev/sdd","/dev/sde","/dev/sdf","/dev/sdg","/dev/sdh"].includes(o)===!1,fe=o=>e.jsx(be,{"data-testid":"notice-for-unrecommended-scenario",text:o,variant:"warning"}),Mo=({_interface:o,primaryInterfaceIndex:t,thisIndex:n,values:i})=>{var u;const d=o.purpose==="vpc",c=!!((u=o.ipv4)!=null&&u.nat_1_1),s=i.interfaces.filter(p=>p.purpose!=="none"),h=t!==void 0?i.interfaces[t].purpose==="vpc":!1;return d&&t!==n&&!h?fe(c?Yt:Jt):s.length===1&&d&&!c?fe(Zt):null},Pn=()=>{var W;const o=ge(),{linodeId:t}=Tt(),n=Number(t),i=b.useRef(),{data:d}=It(),c=d!==void 0&&((W=d==null?void 0:d.linode.find(C=>C.id===n))==null?void 0:W.permissions)==="read_only",{data:s,error:h,isLoading:u}=Gt(n),[p,x]=b.useState(!1),[S,D]=b.useState(!1),[R,P]=b.useState(!1),[f,v]=b.useState(),k=s==null?void 0:s.find(C=>C.id===f),M=C=>{v(C),P(!0)},A=C=>{v(C),D(!0)},w=C=>{v(C),x(!0)},T=()=>{v(void 0),x(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(xe,{display:"flex",gap:2,justifyContent:"flex-end",sx:{padding:"7px 0"},children:[e.jsx(Dt,{href:"https://www.linode.com/docs/products/compute/compute-instances/guides/configuration-profiles/",onClick:()=>{At("Configuration Profiles")},label:"Configuration Profiles"}),e.jsx(Et,{disabled:c,label:"Add Configuration",onClick:T})]}),e.jsx(Pt,{data:s??[],order:"asc",orderBy:"label",children:({data:C,handleOrderChange:z,order:X,orderBy:te})=>e.jsx(wt,{data:C,scrollToRef:i,children:({count:oe,data:B,handlePageChange:Y,handlePageSizeChange:j,page:m,pageSize:l})=>e.jsxs(b.Fragment,{children:[e.jsxs(Ft,{"aria-label":"List of Configurations",children:[e.jsx(ao,{children:e.jsxs(Fe,{children:[e.jsx(Mt,{sx:{...o.applyTableHeaderStyles,width:"35%"},active:te==="label",direction:X,handleClick:z,label:"label",children:e.jsx("strong",{children:"Config"})}),e.jsx(G,{sx:{borderRight:`1px solid ${o.palette.divider}`,fontFamily:o.font.bold,width:"25%"},children:"Disks"}),e.jsx(G,{sx:{borderRight:`1px solid ${o.palette.divider}`,fontFamily:o.font.bold,width:"30%"},children:"Network Interfaces"}),e.jsx(G,{sx:{width:"10%"}})]})}),e.jsx($t,{children:e.jsx(Rt,{loadingProps:{columns:4},error:h??void 0,length:B.length,loading:u,children:B.map(O=>e.jsx(bo,{config:O,linodeId:n,onBoot:()=>M(O.id),onDelete:()=>A(O.id),onEdit:()=>w(O.id),readOnly:c},`config-row-${O.id}`))})})]}),e.jsx(Bt,{count:oe,eventCategory:"linode configs",handlePageChange:Y,handleSizeChange:j,page:m,pageSize:l})]})})}),e.jsx(Fo,{config:k,isReadOnly:c,linodeId:n,onClose:()=>x(!1),open:p}),e.jsx(mo,{config:k,linodeId:n,onClose:()=>P(!1),open:R}),e.jsx(vo,{config:k,linodeId:n,onClose:()=>D(!1),open:S})]})};export{Pn as default};
